<?xml version="1.0" encoding="UTF-8"?>
<System AppServerName="" AutoConnectToEdit="T" CalendarTable="ZT070" DBCP="" DatabaseName="jdbc:ucanaccess://&lt;CURRENT>\mfgorder.accdb;memory=false" DatabasePassword="" DatabaseUser="" DateFormat="jp11" DriverVMOptions="-Xms256m -Xmx256m" EditorUser="00000" EditorUserPassword="0000000000" ExchangeRateAnnualTable="ZT080" ExchangeRateMonthlyTable="ZT081" FormatVersion="1.2" ImageFileFolder="&lt;CURRENT>\db\image" LoginScript="/////////////////////////////////////#EOL#// 前後日付算出（検索条件初期値用）//#EOL#/////////////////////////////////////#EOL#var today = session.getToday() + '';#EOL#var tomorrow = session.getOffsetDate(today, 1, 0);#EOL#var dateLastWeek = session.getOffsetDate(today, -7, 0);#EOL#var dateNextWeek = session.getOffsetDate(today, 7, 0);#EOL#var date3MonthsAgo = session.getOffsetDate(today, -91, 0);#EOL#var date2MonthsAgo = session.getOffsetDate(today, -61, 0);#EOL#var dateLastMonth = session.getOffsetDate(today, -30, 0);#EOL#var dateNextMonth = session.getOffsetDate(today, 30, 0);#EOL#var dateLastYear = session.getOffsetDate(today, -365, 0);#EOL#var currentFYear = session.getFYearOfDate(today);#EOL##EOL#//////////////////////////#EOL#// セッション属性の登録 //#EOL#//////////////////////////#EOL#session.setAttribute('Today', today);#EOL#session.setAttribute('Tomorrow', tomorrow);#EOL#session.setAttribute('DateLastWeek', dateLastWeek);#EOL#session.setAttribute('DateNextWeek', dateNextWeek);#EOL#session.setAttribute('Date3MonthsAgo', date3MonthsAgo);#EOL#session.setAttribute('Date2MonthsAgo', date2MonthsAgo);#EOL#session.setAttribute('DateLastMonth', dateLastMonth);#EOL#session.setAttribute('DateNextMonth', dateNextMonth);#EOL#session.setAttribute('DateLastYear', dateLastYear);#EOL#session.setAttribute('CurrentFYear', currentFYear);#EOL#" Name="CONCEPTWARE／受注生産" NumberingTable="ZT030" OutputFolder="" Remarks="◆システムの概要#EOL#ＤＢＣ社提供の基本設計ライブラリー「CONCEPTWARE／受注生産」にもとづいてまとめられた「そのまま動作する仕様書」です。発注･仕入･支払管理、見積･製造･売上･請求･受領管理、在庫管理、統計情報管理のためのモジュールを含みます。#EOL##EOL#◆システムへのログインとメニューについて#EOL#システム起動のボタン（またはＦ５）を押すと、X-TEA Driverが起動され、詳細設計（このファイルの内容）が解釈されてシステムが立ち上がります。その際、&quot;00000&quot;のユーザＩＤで自動的にログインされます。これは、X-TEA Editorの「その他の設定」のタブの「Editorユーザ」と「パスワード」がそのように設定されているためです。ログインに成功すると１つまたは複数のメニューがタブ形式で示されますが、どのメニューを並べるかはユーザ毎に設定されています。すなわち、ユーザテーブル上の「利用可能メニュー」に&quot;ALL&quot;と指定すればすべてのメニューがタブ表示され、&quot;10,20&quot;のようにメニューＩＤをコンマ区切りで指定すればそれらのみがタブ表示されます（その様子をX-TEA Editor上でユーザテーブル(ZT020)の「データ」のタブで確認できます）。デスクトップのショートカットから起動させることも可能です（Readme参照）。#EOL##EOL#◆基本設計情報について#EOL#データモデル、業務フロー、業務マニュアルを含む基本設計については、このファイルと同じフォルダに置かれたMfgOrder.xeadを参照してください。これを閲覧・編集するためには別途 X-TEA Modeler をインストールする必要があります。#EOL##EOL#◆利用条件#EOL#・本データの著作権および所有権はDBC社が有します#EOL#・本データを使用したことによって発生したいかなるトラブル、損害にも、著作者は一切の責任を負いません#EOL#・本データを再配布・転載する際には、著作権や利用条件の表示を書き換えないでください#EOL#・以上の点が了承・遵守される限りにおいて、本データを無償にてご利用できます。なお、商業的な再配布・転載等の際には、事前に御相談ください" ScriptFunctions="//////////////////////////#EOL#// メッセージ表示用関数 //#EOL#//////////////////////////#EOL#function showMessage(message) {#EOL#&#x9;javax.swing.JOptionPane.showMessageDialog(null, message);#EOL#}" SessionDetailTable="ZT051" SessionTable="ZT050" SkipModuleCheck="F" SkipPreload="F" SmtpHost="" SmtpPassword="" SmtpPort="" SmtpUser="" SystemFont="Meiryo UI" TaxTable="ZT060" UserTable="ZT020" UserVariantsTable="ZT040" VariantsTable="ZT010" Version="1.0.2" WelcomePageURL="http://homepage2.nifty.com/dbc/xeadFramework/MenuPage.html"><Menu CrossCheckersToBeLoaded="" FunctionsToBeLoaded="" HelpURL="" ID="10" Name="マスター管理メニュー"><Option FunctionID="AF010" Index="00" OptionName=""/><Option FunctionID="AF020" Index="01" OptionName=""/><Option FunctionID="AF030" Index="10" OptionName=""/><Option FunctionID="AF040" Index="02" OptionName=""/><Option FunctionID="BF010" Index="11" OptionName=""/><Option FunctionID="BF050" Index="12" OptionName=""/></Menu><Menu CrossCheckersToBeLoaded="" FunctionsToBeLoaded="" HelpURL="" ID="90" Name="システム管理メニュー"><Option FunctionID="ZF010" Index="00" OptionName=""/><Option FunctionID="ZF020" Index="01" OptionName=""/><Option FunctionID="ZF030" Index="02" OptionName=""/><Option FunctionID="ZF040" Index="03" OptionName=""/><Option FunctionID="ZF050" Index="05" OptionName=""/><Option FunctionID="ZF060" Index="10" OptionName=""/><Option FunctionID="ZF080" Index="12" OptionName=""/><Option FunctionID="ZF082" Index="13" OptionName=""/><Option FunctionID="ZF070" Index="11" OptionName=""/><Option FunctionID="ZF400" Index="16" OptionName=""/><Option FunctionID="ZF900" Index="15" OptionName=""/><Option FunctionID="ZF410" Index="17" OptionName=""/><Option FunctionID="ZF054" Index="06" OptionName=""/></Menu><Menu CrossCheckersToBeLoaded="" FunctionsToBeLoaded="" HelpURL="" ID="20" Name="発注管理メニュー"><Option FunctionID="HF011" Index="00" OptionName="発注エントリー"/><Option FunctionID="HF010" Index="01" OptionName=""/><Option FunctionID="HF021A" Index="03" OptionName="入荷指示エントリー"/><Option FunctionID="HF020" Index="04" OptionName=""/><Option FunctionID="DF010" Index="12" OptionName=""/><Option FunctionID="DF110" Index="16" OptionName=""/><Option FunctionID="HF023" Index="05" OptionName=""/><Option FunctionID="DF100" Index="13" OptionName=""/><Option FunctionID="DF111A" Index="15" OptionName="支払依頼エントリー"/><Option FunctionID="KF020" Index="08" OptionName=""/><Option FunctionID="KF010" Index="07" OptionName=""/><Option FunctionID="FF010" Index="10" OptionName=""/></Menu><Menu CrossCheckersToBeLoaded="" FunctionsToBeLoaded="" HelpURL="" ID="30" Name="営業管理メニュー"><Option FunctionID="EF010" Index="03" OptionName=""/><Option FunctionID="EF100" Index="04" OptionName=""/><Option FunctionID="EF111" Index="12" OptionName=""/><Option FunctionID="EF110" Index="13" OptionName=""/><Option FunctionID="LF010" Index="00" OptionName=""/><Option FunctionID="LF020" Index="01" OptionName=""/><Option FunctionID="FF010" Index="10" OptionName=""/></Menu><Menu CrossCheckersToBeLoaded="" FunctionsToBeLoaded="" HelpURL="" ID="40" Name="製造管理メニュー"><Option FunctionID="JF011" Index="00" OptionName="製造指示エントリー"/><Option FunctionID="JF010" Index="01" OptionName=""/><Option FunctionID="JF041" Index="02" OptionName=""/><Option FunctionID="FF010" Index="10" OptionName=""/><Option FunctionID="JF013A" Index="03" OptionName="完成・出荷エントリー"/></Menu><Menu CrossCheckersToBeLoaded="" FunctionsToBeLoaded="" HelpURL="" ID="70" Name="統計管理メニュー"><Option FunctionID="YF010" Index="00" OptionName=""/><Option FunctionID="YF900" Index="02" OptionName=""/><Option FunctionID="ZF410" Index="01" OptionName=""/></Menu><Menu CrossCheckersToBeLoaded="" FunctionsToBeLoaded="" HelpURL="" ID="50" Name="在庫管理メニュー"><Option FunctionID="FF010" Index="10" OptionName=""/><Option FunctionID="FF100" Index="11" OptionName=""/><Option FunctionID="MF010" Index="00" OptionName=""/><Option FunctionID="MF020" Index="01" OptionName=""/><Option FunctionID="MF030" Index="02" OptionName=""/></Menu><Menu CrossCheckersToBeLoaded="" FunctionsToBeLoaded="" HelpURL="" ID="60" Name="経理担当メニュー"><Option FunctionID="DF120" Index="00" OptionName=""/><Option FunctionID="EF120" Index="10" OptionName=""/><Option FunctionID="DF010" Index="01" OptionName=""/><Option FunctionID="EF010" Index="11" OptionName=""/></Menu><Subsystem ID="A" Name="組織マスター管理" Remarks="部門、従業員、取引先といった全社的な基本台帳とその管理機能を提供するサブシステム"/><Subsystem ID="Z" Name="システム管理" Remarks="システムへのログインや利用履歴、およびシステム変数等の基本的なシステム設定値を管理するためのサブシステム"/><Subsystem ID="H" Name="発注・入荷データ管理" Remarks="発注、入荷といった標準的な仕入活動に関する帳簿とその管理機能を提供するサブシステム"/><Subsystem ID="D" Name="買掛残高データ管理" Remarks="仕入先台帳や支払指示関連の取引簿とそれらの管理機能を提供するサブシステム"/><Subsystem ID="B" Name="製造マスター管理" Remarks="品目や受注生産品に関する台帳とその管理機能を提供するサブシステム"/><Subsystem ID="F" Name="在庫残高データ管理" Remarks="在庫残高や受払に関する帳簿とその管理機能を提供するサブシステム"/><Subsystem ID="K" Name="一般仕入取引データ管理" Remarks="仕入返品、発注なし入荷等の、通常入荷以外の買掛増減取引の帳簿とその管理機能を提供するサブシステム"/><Subsystem ID="J" Name="製造指示データ管理" Remarks="受注品や標準品の製造に関する帳簿とその管理機能を提供するサブシステム"/><Subsystem ID="E" Name="売掛残高データ管理" Remarks="顧客台帳、及び、売上・請求関連の取引簿とそれらの管理機能を提供するサブシステム"/><Subsystem ID="M" Name="一般在庫取引データ管理" Remarks="在庫振替、棚卸、在庫移動に関する帳簿とその管理機能を提供するサブシステム"/><Subsystem ID="L" Name="一般売上取引データ管理" Remarks="売上返品、受注なし出荷等の、通常出荷以外の売掛増減取引の帳簿とその管理機能を提供するサブシステム"/><Subsystem ID="Y" Name="統計データ管理" Remarks="残高増減履歴にもとづく年月度別の統計データとそれらの集計処理を含むサブシステム"/><Table ActiveWhere="" ID="AT010" Name="部門" RangeKey="" Remarks="部門定義を保持するためのテーブル" SubsystemID="A"><Field ID="CDBUMON" Name="部門Ｃ" Nullable="F" Order="0010" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field ID="TXBUMON" Name="部門名" Nullable="F" Order="0020" Remarks="" Size="30" Type="CHAR" TypeOptions="KANJI"/><Field ID="NRKANRISYA" Name="管理者№" Nullable="F" Order="0030" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Key Fields="CDBUMON" Type="PK"/><Refer Fields="TXKANJI" Order="0" TableAlias="" ToKeyFields="" ToTable="AT020" WithKeyFields="AT010.NRKANRISYA"/><Field ID="TXTEKIYO" Name="摘要" Nullable="T" Order="0040" Remarks="" Size="300" Type="VARCHAR" TypeOptions="KANJI"/></Table><Table ActiveWhere="" ID="AT011" Name="部門階層" RangeKey="" Remarks="組織階層情報を保持するためのテーブル。部門毎に年月期間別の上位部門が定義される。" SubsystemID="A"><Field ID="CDBUMON" Name="部門Ｃ" Nullable="F" Order="0" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field ID="DTHAKKOUNENGETSU" Name="発効年月" Nullable="F" Order="1" Remarks="" Size="6" Type="CHAR" TypeOptions="YMONTH"/><Field ID="CDJYOUIBUMON" Name="上位部門Ｃ" Nullable="F" Order="2" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field ID="DTSIKKOUNENGETSU" Name="失効年月" Nullable="F" Order="3" Remarks="" Size="6" Type="CHAR" TypeOptions="YMONTH"/><Key Fields="CDBUMON;DTHAKKOUNENGETSU" Type="PK"/><Refer Fields="TXBUMON" Order="0010" TableAlias="AT010A1" ToKeyFields="" ToTable="AT010" WithKeyFields="AT011.CDBUMON"/><Refer Fields="TXBUMON" Order="0020" TableAlias="AT010A2" ToKeyFields="" ToTable="AT010" WithKeyFields="AT011.CDJYOUIBUMON"/><Script EventP="BC;BU" EventR="BR()" Name="失効年月のエラー検査" Order="0010" Text="if (AT011_DTSIKKOUNENGETSU.value != '' &amp;&amp; AT011_DTSIKKOUNENGETSU.value &lt;=  AT011_DTHAKKOUNENGETSU.value) {#EOL#&#x9;AT011_DTSIKKOUNENGETSU.error = '発効年月より未来に設定してください。'#EOL#}"/><Script EventP="BC;BU" EventR="AR()" Function="" Name="上位部門のエラー検査" Order="0020" Text="//////////////////////////////////////////////#EOL#// Javaパッケージの導入 for Class ArrayList //#EOL#//////////////////////////////////////////////#EOL#var importedPackage = new JavaImporter(java.util);#EOL#with (importedPackage) {#EOL##EOL#&#x9;//////////////#EOL#&#x9;// 変数定義 //#EOL#&#x9;//////////////#EOL#&#x9;var rAT011;#EOL#&#x9;var tougaibumon = ''; //当該部門CD//#EOL#&#x9;var jyouibumon = '';  //上位部門CD//#EOL#&#x9;var dthakkounengetsu = ''; //発効年月//#EOL#&#x9;var dtsikkounengetsu = ''; //失効年月//#EOL#&#x9;var jyouibumonList = new ArrayList(); //上位部門CDリスト//#EOL#&#x9;var dthakkounengetsuList = new ArrayList(); //発効年月リスト//#EOL#&#x9;var dtsikkounengetsuList = new ArrayList(); //失効年月リスト//#EOL##EOL#&#x9;if (AT011_CDJYOUIBUMON.value != '') {#EOL##EOL#&#x9;&#x9;////////////////////////////////////////////////////////////////#EOL#&#x9;&#x9;// '00001'のような値が数値の1として比較されないために明示的に //#EOL#&#x9;&#x9;// 両辺を文字列化したうえで、部門Ｃと上位部門Ｃとを比較する   //#EOL#&#x9;&#x9;////////////////////////////////////////////////////////////////#EOL#&#x9;&#x9;tougaibumon = AT011_CDBUMON.value + '';#EOL#&#x9;&#x9;jyouibumon = AT011_CDJYOUIBUMON.value + '';#EOL#&#x9;&#x9;if (tougaibumon == jyouibumon) {#EOL#&#x9;&#x9;&#x9;AT011_CDJYOUIBUMON.error = '自分自身を上位部門としては指定できません。';#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;// 階層ループチェック //#EOL#&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;jyouibumonList.add(jyouibumon);#EOL#&#x9;&#x9;&#x9;dthakkounengetsuList.add(AT011_DTHAKKOUNENGETSU.value);#EOL#&#x9;&#x9;&#x9;dtsikkounengetsuList.add(AT011_DTSIKKOUNENGETSU.value);#EOL#&#x9;&#x9;&#x9;for (var i = 0; i &lt; jyouibumonList.size(); i++) {#EOL#&#x9;&#x9;&#x9;&#x9;rAT011 = instance.createTableOperator('Select', 'AT011');#EOL#&#x9;&#x9;&#x9;&#x9;rAT011.addKeyValue('CDBUMON',&#x9;&#x9;&#x9;&#x9;jyouibumonList.get(i));#EOL#&#x9;&#x9;&#x9;&#x9;rAT011.addKeyValue('DTHAKKOUNENGETSU &lt;',&#x9;dtsikkounengetsuList.get(i));#EOL#&#x9;&#x9;&#x9;&#x9;rAT011.addKeyValue('DTSIKKOUNENGETSU >',&#x9;dthakkounengetsuList.get(i));#EOL#&#x9;&#x9;&#x9;&#x9;while(rAT011.next()) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;jyouibumon = rAT011.getValueOf('CDJYOUIBUMON') + '';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;dthakkounengetsu = rAT011.getValueOf('DTHAKKOUNENGETSU');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;dtsikkounengetsu = rAT011.getValueOf('DTSIKKOUNENGETSU');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (jyouibumon == tougaibumon) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AT011_CDJYOUIBUMON.error = '指定の部門が階層上でループします。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;i = jyouibumonList.size();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;jyouibumonList.add(jyouibumon);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;dthakkounengetsuList.add(dthakkounengetsu);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;dtsikkounengetsuList.add(dtsikkounengetsu);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}"/><Script EventP="BC" EventR="BR()" Function="" Name="追加時初期設定" Order="0030" Text="if (AT011_DTHAKKOUNENGETSU.value == '') {#EOL#&#x9;AT011_DTHAKKOUNENGETSU.value = session.getThisMonth() + '';#EOL#}#EOL#if (AT011_DTSIKKOUNENGETSU.value == '') {#EOL#&#x9;AT011_DTSIKKOUNENGETSU.value = '999912';#EOL#}"/></Table><Table ActiveWhere="" ID="AT020" Name="従業員" RangeKey="" Remarks="従業員情報を保持するためのテーブル" SubsystemID="A"><Field ID="NRJYUGYOIN" Name="従業員№" Nullable="F" Order="0" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field ID="TXKANA" Name="カナ名" Nullable="F" Order="1" Remarks="" Size="30" Type="CHAR" TypeOptions="KATAKANA"/><Field ID="TXKANJI" Name="漢字名" Nullable="F" Order="2" Remarks="" Size="30" Type="CHAR" TypeOptions="KANJI"/><Field ID="KBKOYOU" Name="雇用区分" Nullable="F" Order="3" Remarks="" Size="5" Type="CHAR" TypeOptions="KUBUN(KBKOYOU)"/><Field ID="DTNYUSYA" Name="入社日" Nullable="F" Order="4" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field ID="DTTAISYA" Name="退社日" Nullable="T" Order="5" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Key Fields="NRJYUGYOIN" Type="PK"/></Table><Table ActiveWhere="" ID="AT021" Name="従業員所属部門" RangeKey="DTSYOZOKUNENGETSU;DTSIKKONENGETSU" Remarks="従業員の所属部門を保持するためのテーブル。従業員毎に年月期間別の所属部門が定義される。" SubsystemID="A"><Field ID="NRJYUGYOIN" Name="従業員№" Nullable="F" Order="0010" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field ID="DTSYOZOKUNENGETSU" Name="所属発効年月" Nullable="F" Order="0020" Remarks="" Size="6" Type="CHAR" TypeOptions="YMONTH"/><Field ID="CDBUMON" Name="部門Ｃ" Nullable="F" Order="0030" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field ID="DTSIKKONENGETSU" Name="所属失効年月" Nullable="T" Order="0040" Remarks="" Size="6" Type="CHAR" TypeOptions="YMONTH,VIRTUAL"/><Key Fields="NRJYUGYOIN;DTSYOZOKUNENGETSU" Type="PK"/><Refer Fields="TXKANJI" Order="0" TableAlias="" ToKeyFields="" ToTable="AT020" WithKeyFields="AT021.NRJYUGYOIN"/><Refer Fields="TXBUMON" Order="1" TableAlias="" ToKeyFields="" ToTable="AT010" WithKeyFields="AT021.CDBUMON"/></Table><Table ActiveWhere="" ID="ZT070" Name="休日テーブル" RangeKey="" Remarks="公休日や会社の特別休日の情報を保持するためのテーブル。日付選択用カレンダーの休日表示設定のために利用される。" SubsystemID="Z"><Field ID="DTOFF" Name="休日日付" Nullable="F" Order="0020" Size="10" Type="DATE" TypeOptions=""/><Field ID="TXOFF" Name="摘要" Nullable="T" Order="0030" Size="20" Type="CHAR" TypeOptions="KANJI"/><Key Fields="KBCALENDAR;DTOFF" Type="PK"/><Field ID="KBCALENDAR" Name="カレンダー区分" Nullable="F" Order="0010" Size="2" Type="CHAR" TypeOptions="KUBUN(KBCALENDAR)"/></Table><Table ActiveWhere="" ID="ZT040" Name="ユーザ定義区分" RangeKey="" Remarks="キー値と摘要の組み合わせで定義できる区分情報を保持するためのテーブル" SubsystemID="Z"><Field ID="IDUSERKUBUN" Name="区分ＩＤ" Nullable="F" Order="0010" Size="20" Type="CHAR" TypeOptions=""/><Field ID="KBUSERKUBUN" Name="区分値" Nullable="F" Order="0020" Size="5" Type="CHAR" TypeOptions=""/><Field ID="TXUSERKUBUN" Name="区分値摘要" Nullable="F" Order="0030" Size="20" Type="CHAR" TypeOptions="KANJI"/><Field ID="SQLIST" Name="一覧順序" Nullable="T" Order="0040" Size="4" Type="CHAR" TypeOptions=""/><Key Fields="IDUSERKUBUN;KBUSERKUBUN" Type="PK"/><Field ID="KBVALUE1" Name="１桁区分値" Nullable="F" Order="0050" Remarks="値交換用の仮想フィールド。区分値がセットされる" Size="1" Type="CHAR" TypeOptions="VIRTUAL"/><Field ID="KBVALUE2" Name="２桁区分値" Nullable="F" Order="0051" Remarks="値交換用の仮想フィールド。区分値がセットされる" Size="2" Type="CHAR" TypeOptions="VIRTUAL"/><Field ID="KBVALUE3" Name="３桁区分値" Nullable="F" Order="0052" Remarks="値交換用の仮想フィールド。区分値がセットされる" Size="3" Type="CHAR" TypeOptions="VIRTUAL"/><Field ID="KBVALUE4" Name="４桁区分値" Nullable="F" Order="0053" Remarks="値交換用の仮想フィールド。区分値がセットされる" Size="4" Type="CHAR" TypeOptions="VIRTUAL"/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールドの設定" Order="0000" Text="ZT040_KBVALUE1.value = ZT040_KBUSERKUBUN.value;#EOL#ZT040_KBVALUE2.value = ZT040_KBUSERKUBUN.value;#EOL#ZT040_KBVALUE3.value = ZT040_KBUSERKUBUN.value;#EOL#ZT040_KBVALUE4.value = ZT040_KBUSERKUBUN.value;"/></Table><Table ActiveWhere="" ID="ZT020" Name="ユーザ" RangeKey="" Remarks="ユーザ定義を保持するためのテーブル。ユーザは必ずしも従業員と関連されている必要はない。" SubsystemID="Z"><Field ID="IDUSER" Name="ユーザＩＤ" Nullable="F" Order="0010" Size="5" Type="CHAR" TypeOptions=""/><Field ID="TXPASSWORD" Name="パスワード" Nullable="F" Order="0030" Size="32" Type="CHAR" TypeOptions=""/><Field ID="DTVALID" Name="発効日" Nullable="F" Order="0040" Size="10" Type="DATE" TypeOptions=""/><Field ID="DTEXPIRE" Name="失効日" Nullable="F" Order="0050" Size="10" Type="DATE" TypeOptions=""/><Field ID="TXMENUS" Name="利用可能メニュー" Nullable="F" Order="0070" Size="30" Type="CHAR" TypeOptions=""/><Key Fields="IDUSER" Type="PK"/><Script EventP="BC;BU" EventR="BR()" Name="失効日のエラー検査" Order="0" Text="if (ZT020_DTEXPIRE.value != '' &amp;&amp; ZT020_DTEXPIRE.value &lt;=  ZT020_DTVALID.value) {#EOL# ZT020_DTEXPIRE.error = '発効日より未来に設定してください。'#EOL#}"/><Field ID="NREMPLOYEE" Name="従業員№" Nullable="T" Order="0080" Size="5" Type="CHAR" TypeOptions=""/><Field ID="TXNAME" Name="ユーザ名" NoUpdate="F" Nullable="F" Order="0020" Size="30" Type="CHAR" TypeOptions="KANJI"/><Refer Fields="" Order="0010" OrderBy="" TableAlias="" ToKeyFields="NRJYUGYOIN" ToTable="AT020" WithKeyFields="ZT020.NREMPLOYEE"/><Script EventP="BC;BU" EventR="BR()" Function="" Name="パスワードの初期化" Order="0010" Text="if (ZT020_TXPASSWORD.value == '') {#EOL#&#x9;ZT020_TXPASSWORD.value = 'f1b708bba17f1ce948dc979f4d7092bc' //&quot;0000000000&quot;のハッシュコード値//#EOL#}"/><Field ID="TXEMAIL" Name="メールアドレス" Nullable="T" Order="0060" Size="40" Type="CHAR" TypeOptions=""/></Table><Table ActiveWhere="" ID="ZT051" Name="セッション明細" RangeKey="" Remarks="セッション毎の機能の利用履歴を保持するためのテーブル" SubsystemID="Z"><Field ID="NRSESSION" Name="セッション№" Nullable="F" Order="0" Size="7" Type="CHAR" TypeOptions=""/><Field ID="SQPROGRAM" Name="行番" Nullable="F" Order="1" Size="4" Type="SMALLINT" TypeOptions=""/><Field ID="IDMENU" Name="メニューID" Nullable="F" Order="2" Size="2" Type="CHAR" TypeOptions=""/><Field ID="IDPROGRAM" Name="プログラムID" Nullable="F" Order="3" Size="10" Type="CHAR" TypeOptions=""/><Field ID="TXPROGRAM" Name="プログラム名" Nullable="F" Order="4" Size="30" Type="CHAR" TypeOptions="KANJI"/><Field ID="DTSTART" Name="利用開始日時" Nullable="F" Order="5" Size="23" Type="DATETIME" TypeOptions=""/><Field ID="DTEND" Name="利用終了日時" Nullable="T" Order="6" Size="23" Type="DATETIME" TypeOptions=""/><Field ID="KBPROGRAMSTATUS" Name="終了状態" Nullable="T" Order="7" Size="2" Type="CHAR" TypeOptions=""/><Field ID="TXERRORLOG" Name="処理ログ" Nullable="T" Order="8" Size="0" Type="LONG VARCHAR" TypeOptions=""/><Key Fields="NRSESSION;SQPROGRAM" Type="PK"/><Script EventP="BC;BU;BD;AR" EventR="AR()" Name="終了状態にもとづく配色設定" Order="0" Text="if (ZT051_KBPROGRAMSTATUS.value == '99') {#EOL#  ZT051_KBPROGRAMSTATUS.color = 'red';#EOL#}"/></Table><Table ActiveWhere="" ID="ZT060" Name="消費税率" RangeKey="" Remarks="開始日別の消費税率を保持するためのテーブル" SubsystemID="Z"><Field ID="DTSTART" Name="開始日" Nullable="F" Order="0" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="2" ID="VLTAXRATE" Name="税率" Nullable="F" Order="1" Size="3" Type="NUMERIC" TypeOptions=""/><Key Fields="DTSTART" Type="PK"/><Script EventP="BC;BU" EventR="BR()" Name="消費税率のエラー検査" Order="0" Text="if (ZT060_VLTAXRATE.value >= 1.00) {#EOL# ZT060_VLTAXRATE.error = '1.00より小さい値を設定してください。'#EOL#}"/></Table><Table ActiveWhere="" ID="ZT050" Name="セッション" RangeKey="" Remarks="ユーザがシステムにログインすることで開始されるセッションの履歴を保持するためのテーブル" SubsystemID="Z"><Field ID="NRSESSION" Name="セッション№" Nullable="F" Order="0010" Size="7" Type="CHAR" TypeOptions=""/><Field ID="DTLOGIN" Name="ログイン日時" Nullable="F" Order="0020" Size="23" Type="DATETIME" TypeOptions=""/><Field ID="DTLOGOUT" Name="ログアウト日時" Nullable="T" Order="0030" Size="23" Type="DATETIME" TypeOptions=""/><Field ID="IDUSER" Name="ユーザＩＤ" Nullable="F" Order="0040" Size="5" Type="CHAR" TypeOptions=""/><Field ID="TXIPADDRESS" Name="ＩＰアドレス" Nullable="F" Order="0050" Size="20" Type="CHAR" TypeOptions=""/><Field ID="KBSESSIONSTATUS" Name="状態" Nullable="F" Order="0070" Size="3" Type="CHAR" TypeOptions="VALUES(ACT;ERR;END)"/><Key Fields="NRSESSION" Type="PK"/><Refer Fields="TXNAME" Order="0" OrderBy="" TableAlias="" ToKeyFields="" ToTable="ZT020" WithKeyFields="ZT050.IDUSER"/><Script EventP="BC;BU;BD;AR" EventR="AR()" Name="セッション状態にもとづく配色設定" Order="0" Text="if (ZT050_KBSESSIONSTATUS.value == 'ERR') {#EOL#  ZT050_KBSESSIONSTATUS.color = 'red';#EOL#}#EOL#if (ZT050_KBSESSIONSTATUS.value.equals('ACT')) {#EOL#  ZT050_KBSESSIONSTATUS.color = 'green';#EOL#}"/><Field ID="VLVERSION" Name="処理系バージョン" Nullable="F" Order="0060" Size="10" Type="CHAR" TypeOptions=""/></Table><Table ActiveWhere="" ID="ZT010" Name="システム変数" RangeKey="" Remarks="企業名や年度開始月といったシステム変数を保持するためのテーブル" SubsystemID="Z"><Field ID="IDVARIANT" Name="変数ＩＤ" Nullable="F" Order="0010" Size="20" Type="CHAR" TypeOptions=""/><Field ID="TXTYPE" Name="変数タイプ" Nullable="F" Order="0030" Size="10" Type="CHAR" TypeOptions="VALUES(STRING;NUMBER)"/><Field ID="TXVALUE" Name="変数値" Nullable="F" Order="0040" Size="100" Type="CHAR" TypeOptions=""/><Key Fields="IDVARIANT" Type="PK"/><Field ID="TXNAME" Name="変数名" Nullable="F" Order="0020" Size="10" Type="CHAR" TypeOptions="KANJI"/><Field ID="TXREMARKS" Name="摘要" Nullable="T" Order="0041" Remarks="" Size="500" Type="VARCHAR" TypeOptions="KANJI"/></Table><Table ActiveWhere="" ID="ZT081" Name="月次為替レート" RangeKey="" Remarks="月次為替レートを保持するためのテーブル" SubsystemID="Z"><Field ID="KBCURRENCY" Name="通貨区分" Nullable="F" Order="0000" Size="5" Type="CHAR" TypeOptions="KUBUN(KBCURRENCY)"/><Field ID="DTNEND" Name="年度" Nullable="F" Order="0001" Size="4" Type="SMALLINT" TypeOptions="FYEAR"/><Field ID="DTMSEQ" Name="月度" Nullable="F" Order="0011" Size="2" Type="SMALLINT" TypeOptions="MSEQ"/><Field Decimal="3" ID="VLRATEB" Name="ＴＴＢレート" Nullable="F" Order="0012" Size="10" Type="NUMERIC" TypeOptions=""/><Field Decimal="3" ID="VLRATEM" Name="ＴＴＭレート" Nullable="F" Order="0013" Size="10" Type="NUMERIC" TypeOptions=""/><Field Decimal="3" ID="VLRATES" Name="ＴＴＳレート" Nullable="F" Order="0014" Size="10" Type="NUMERIC" TypeOptions=""/><Key Fields="KBCURRENCY;DTNEND;DTMSEQ" Type="PK"/></Table><Table ActiveWhere="" ID="ZT080" Name="年次為替レート" RangeKey="" Remarks="年次為替レートを保持するためのテーブル" SubsystemID="Z"><Field ID="KBCURRENCY" Name="通貨区分" Nullable="F" Order="0010" Size="5" Type="CHAR" TypeOptions="KUBUN(KBCURRENCY)"/><Field Decimal="3" ID="VLRATEB" Name="ＴＴＢレート" Nullable="F" Order="0030" Size="10" Type="NUMERIC" TypeOptions=""/><Field ID="DTNEND" Name="年度" Nullable="F" Order="0020" Size="4" Type="SMALLINT" TypeOptions="FYEAR"/><Field Decimal="3" ID="VLRATEM" Name="ＴＴＭレート" Nullable="F" Order="0031" Size="10" Type="NUMERIC" TypeOptions=""/><Field Decimal="3" ID="VLRATES" Name="ＴＴＳレート" Nullable="F" Order="0032" Size="10" Type="NUMERIC" TypeOptions=""/><Key Fields="KBCURRENCY;DTNEND" Type="PK"/></Table><Table ID="AT030" Name="取引先" Remarks="仕入先および得意先を含む企業情報を保持するためのテーブル" SubsystemID="A"><Field Decimal="" ID="IDTORIHIKISAKI" Name="取引先ID" Nullable="F" Order="0010" Remarks="自動採番項目" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(IDTORIHIKISAKI)"/><Field Decimal="" ID="CDTORIHIKISAKI" Name="取引先Ｃ" Nullable="F" Order="0020" Remarks="" Size="8" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="TXKANA" Name="カナ名" Nullable="F" Order="0030" Remarks="" Size="40" Type="CHAR" TypeOptions="KATAKANA"/><Field Decimal="" ID="TXKANJI" Name="漢字名" Nullable="F" Order="0040" Remarks="" Size="40" Type="CHAR" TypeOptions="KANJI"/><Field Decimal="" ID="NRYUBIN" Name="郵便番号" Nullable="F" Order="0050" Remarks="" Size="8" Type="CHAR" TypeOptions="ZIPNO"/><Field Decimal="" ID="TXJYUSYO1" Name="住所１" Nullable="F" Order="0060" Remarks="" Size="30" Type="CHAR" TypeOptions="ZIPADRS"/><Field Decimal="" ID="TXJYUSYO2" Name="住所２" Nullable="T" Order="0070" Remarks="" Size="30" Type="CHAR" TypeOptions="KANJI"/><Field Decimal="" ID="NRDENWA" Name="代表電話番号" Nullable="F" Order="0080" Remarks="" Size="14" Type="CHAR" TypeOptions="DIAL"/><Field Decimal="" ID="NRFAX" Name="FAX番号" Nullable="F" Order="0090" Remarks="" Size="14" Type="CHAR" TypeOptions="DIAL"/><Field Decimal="" ID="TXURL" Name="ＵＲＬ" Nullable="T" Order="0100" Remarks="" Size="40" Type="CHAR" TypeOptions="URL"/><Field Decimal="" ID="FGTOKUISAKI" Name="得意先対象FLAG" NoUpdate="T" Nullable="F" Order="0110" Remarks="得意先テーブルに対応レコードが存在するならばTRUEがセットされる" Size="1" Type="CHAR" TypeOptions="VIRTUAL,BOOLEAN(T;F)"/><Field Decimal="" ID="FGSIIRESAKI" Name="仕入先対象FLAG" NoUpdate="T" Nullable="F" Order="0120" Remarks="仕入先テーブルに対応レコードが存在するならばTRUEがセットされる" Size="1" Type="CHAR" TypeOptions="VIRTUAL,BOOLEAN(T;F)"/><Key Fields="IDTORIHIKISAKI" Type="PK"/><Key Fields="CDTORIHIKISAKI" Type="SK"/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールドの設定" Order="0000" Text="//////////////////////////////////////////////#EOL#// 仕入先の存在検査と仕入先対象フラグの設定 //#EOL#//////////////////////////////////////////////#EOL#var rDT010 = instance.createTableOperator('Select', 'DT010');#EOL#rDT010.addKeyValue('IDSIIRESAKI',&#x9;AT030_IDTORIHIKISAKI.value);#EOL#if (rDT010.next()) {#EOL#&#x9;AT030_FGSIIRESAKI.value = 'T';#EOL#&#x9;AT030_KBSIIRESAKI.value = 'T';#EOL#} else {#EOL#&#x9;AT030_FGSIIRESAKI.value = 'F';#EOL#&#x9;AT030_KBSIIRESAKI.value = 'F';#EOL#}#EOL##EOL#//////////////////////////////////////////////#EOL#// 得意先の存在検査と得意先対象フラグの設定 //#EOL#//////////////////////////////////////////////#EOL#var rET010 = instance.createTableOperator('Select', 'ET010');#EOL#rET010.addKeyValue('IDTOKUISAKI',&#x9;AT030_IDTORIHIKISAKI.value);#EOL#if (rET010.next()) {#EOL#&#x9;AT030_FGTOKUISAKI.value = 'T';#EOL#&#x9;AT030_KBTOKUISAKI.value = 'T';#EOL#} else {#EOL#&#x9;AT030_FGTOKUISAKI.value = 'F';#EOL#&#x9;AT030_KBTOKUISAKI.value = 'F';#EOL#}#EOL#"/><Field Decimal="" ID="KBTOKUISAKI" Name="得意先対象区分" NoUpdate="T" Nullable="F" Order="0130" Remarks="絞込み用" Size="1" Type="CHAR" TypeOptions="VIRTUAL,KUBUN(KBFLAG1)"/><Field Decimal="" ID="KBSIIRESAKI" Name="仕入先対象区分" NoUpdate="T" Nullable="F" Order="0140" Remarks="絞込み用" Size="1" Type="CHAR" TypeOptions="VIRTUAL,KUBUN(KBFLAG1)"/></Table><Table ID="AT040" Name="倉庫" Remarks="在庫の保管場所に関する情報を保持するためのテーブル" SubsystemID="A"><Field Decimal="" ID="CDSOUKO" Name="倉庫Ｃ" Nullable="F" Order="0000" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="TXSOUKO" Name="倉庫名" Nullable="F" Order="0010" Remarks="" Size="20" Type="CHAR" TypeOptions="KANJI"/><Field Decimal="" ID="NRYUBIN" Name="郵便番号" Nullable="F" Order="0020" Remarks="" Size="8" Type="CHAR" TypeOptions="ZIPNO"/><Field Decimal="" ID="TXJYUSYO1" Name="住所１" Nullable="F" Order="0030" Remarks="" Size="30" Type="CHAR" TypeOptions="ZIPADRS"/><Field Decimal="" ID="TXJYUSYO2" Name="住所２" Nullable="T" Order="0040" Remarks="" Size="30" Type="CHAR" TypeOptions="KANJI"/><Field Decimal="" ID="NRDENWA" Name="代表電話番号" Nullable="F" Order="0050" Remarks="" Size="14" Type="CHAR" TypeOptions="DIAL"/><Field Decimal="" ID="NRFAX" Name="FAX番号" Nullable="F" Order="0060" Remarks="" Size="14" Type="CHAR" TypeOptions="DIAL"/><Key Fields="CDSOUKO" Type="PK"/></Table><Table ID="BT010" Name="品目" Remarks="品番毎の品名、単位区分といった品目の基本情報を定義するためのテーブル。ＰＫは内部的な連番である品目ＩＤ。" SubsystemID="B"><Field Decimal="" ID="IDHINMOKU" Name="品目ID" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(IDHINMOKU)"/><Field Decimal="" ID="TXHINBAN" Name="品番" Nullable="F" Order="0020" Remarks="" Size="10" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="TXHINMEI" Name="品名" Nullable="F" Order="0030" Remarks="" Size="30" Type="CHAR" TypeOptions="KANJI"/><Field Decimal="" ID="KBHINSYU" Name="品種区分" Nullable="F" Order="0040" Remarks="" Size="2" Type="CHAR" TypeOptions="KUBUN(KBHINSYU)"/><Field Decimal="" ID="PRGENKA" Name="標準原価" Nullable="T" Order="0050" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="KBUNIT" Name="単位区分" Nullable="F" Order="0060" Remarks="在庫単位、製造単位、受注単位を兼ねる" Size="3" Type="CHAR" TypeOptions="KUBUN(KBUNIT)"/><Field Decimal="" ID="KBUNITPUR" Name="発注単位区分" Nullable="T" Order="0070" Remarks="" Size="3" Type="CHAR" TypeOptions="KUBUN(KBUNIT)"/><Field Decimal="" ID="VLKANZAN" Name="単位換算係数" Nullable="F" Order="0080" Remarks="発注数に掛け合わせると「単位区分」での値になる" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="IDSIIRESAKI" Name="標準仕入先ID" Nullable="T" Order="0090" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="FGKOUNYU" Name="購入対象フラグ" Nullable="F" Order="0110" Remarks="" Size="1" Type="CHAR" TypeOptions="BOOLEAN(T;F)"/><Field Decimal="" ID="FGHANBAI" Name="販売対象フラグ" Nullable="F" Order="0120" Remarks="" Size="1" Type="CHAR" TypeOptions="BOOLEAN(T;F)"/><Field Decimal="" ID="FGZAIKO" Name="在庫管理フラグ" Nullable="F" Order="0100" Remarks="" Size="1" Type="CHAR" TypeOptions="BOOLEAN(T;F)"/><Field Decimal="" ID="TXTEKIYO" Name="摘要" Nullable="T" Order="0150" Remarks="" Size="300" Type="VARCHAR" TypeOptions=""/><Key Fields="IDHINMOKU" Type="PK"/><Key Fields="TXHINBAN" Type="SK"/><Field Decimal="" ID="KBKOUNYU" Name="購入対象区分" Nullable="F" Order="0170" Remarks="絞込み用仮想フィールド" Size="1" Type="CHAR" TypeOptions="VIRTUAL,KUBUN(KBFLAG1)"/><Field Decimal="" ID="KBHANBAI" Name="販売対象区分" Nullable="F" Order="0180" Remarks="絞込み用仮想フィールド" Size="1" Type="CHAR" TypeOptions="VIRTUAL,KUBUN(KBFLAG1)"/><Field Decimal="" ID="KBZAIKO" Name="在庫管理区分" Nullable="F" Order="0160" Remarks="絞込み用仮想フィールド" Size="1" Type="CHAR" TypeOptions="VIRTUAL,KUBUN(KBFLAG1)"/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールドの設定" Order="0000" Text="BT010_KBKOUNYU.value = BT010_FGKOUNYU.value;#EOL#BT010_KBHANBAI.value = BT010_FGHANBAI.value;#EOL#BT010_KBSEIZO.value = BT010_FGSEIZO.value;#EOL#BT010_KBZAIKO.value = BT010_FGZAIKO.value;#EOL#"/><Script EventP="AR" EventR="BR()" Function="" Name="明細タブの無効化(BF012)" Order="0010" Text="//////////////////////////////////////////////#EOL#// 扱い対象フラグにもとづく明細タブの無効化 //#EOL#//////////////////////////////////////////////#EOL#if (instance.functionID == 'BF012') {#EOL#&#x9;var parmValue = '';#EOL##EOL#&#x9;//在庫対象フラグ//#EOL#&#x9;if (BT010_FGZAIKO.value == 'F') {#EOL#&#x9;&#x9;parmValue = '0,7,';#EOL#&#x9;}#EOL##EOL#&#x9;//購入対象フラグ//#EOL#&#x9;if (BT010_FGKOUNYU.value == 'F') {#EOL#&#x9;&#x9;parmValue = parmValue + '1,';#EOL#&#x9;}#EOL##EOL#&#x9;//販売対象フラグ//#EOL#&#x9;if (BT010_FGHANBAI.value == 'F') {#EOL#&#x9;&#x9;parmValue = parmValue + '2,';#EOL#&#x9;}#EOL##EOL#&#x9;//製造対象フラグ//#EOL#&#x9;if (BT010_FGSEIZO.value == 'F') {#EOL#&#x9;&#x9;parmValue = parmValue + '3,4,5,6';#EOL#&#x9;}#EOL##EOL#&#x9;instance.parmMap.put('DISABLED_TAB_LIST', parmValue);#EOL#}"/><Script EventP="AC" EventR="" Function="" Name="複写時における関連データの複写" Order="0020" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rBT020; var cBT020; var rBT030; var cBT030; var rBT040; var cBT040;#EOL##EOL#//////////////////////////////////////////////#EOL#// 複写元品番がブランクでなければ以下を実行 //#EOL#//////////////////////////////////////////////#EOL#if (instance.parmMap.get('IDHINMOKU') != '' &amp;&amp; instance.parmMap.get('IDHINMOKU') != null) {#EOL##EOL#&#x9;//////////////////////////#EOL#&#x9;// 仕様明細を検索・複写 //#EOL#&#x9;//////////////////////////#EOL#&#x9;rBT020 = instance.createTableOperator('Select', 'BT020');#EOL#&#x9;rBT020.addKeyValue('IDSEIZOHIN',&#x9;instance.parmMap.get('IDHINMOKU')); //複写元品番//#EOL#&#x9;while (rBT020.next()) {#EOL#&#x9;&#x9;cBT020 = instance.createTableOperator('Insert', 'BT020');#EOL#&#x9;&#x9;cBT020.addValue('IDSEIZOHIN',&#x9;BT010_IDHINMOKU.value); //複写先品番//#EOL#&#x9;&#x9;cBT020.addValue('SQSPEC',&#x9;&#x9;rBT020.getValueOf('SQSPEC'));#EOL#&#x9;&#x9;cBT020.addValue('TXNAME',&#x9;&#x9;rBT020.getValueOf('TXNAME'));#EOL#&#x9;&#x9;cBT020.addValue('KBDATATYPE',&#x9;rBT020.getValueOf('KBDATATYPE'));#EOL#&#x9;&#x9;cBT020.addValue('VLDIGITS',&#x9;&#x9;rBT020.getValueOf('VLDIGITS'));#EOL#&#x9;&#x9;cBT020.addValue('VLDECIMAL',&#x9;rBT020.getValueOf('VLDECIMAL'));#EOL#&#x9;&#x9;cBT020.addValue('VLFORMULA',&#x9;rBT020.getValueOf('VLFORMULA'));#EOL#&#x9;&#x9;cBT020.addValue('SQLIST',&#x9;&#x9;rBT020.getValueOf('SQLIST'));#EOL#&#x9;&#x9;cBT020.execute();#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////////////#EOL#&#x9;// 工程明細を検索・複写 //#EOL#&#x9;//////////////////////////#EOL#&#x9;rBT030 = instance.createTableOperator('Select', 'BT030');#EOL#&#x9;rBT030.addKeyValue('IDSEIZOHIN',&#x9;instance.parmMap.get('IDHINMOKU')); //複写元品番//#EOL#&#x9;while (rBT030.next()) {#EOL#&#x9;&#x9;cBT030 = instance.createTableOperator('Insert', 'BT030');#EOL#&#x9;&#x9;cBT030.addValue('IDSEIZOHIN',&#x9;BT010_IDHINMOKU.value); //複写先品番//#EOL#&#x9;&#x9;cBT030.addValue('SQKOUTEI',&#x9;&#x9;rBT030.getValueOf('SQKOUTEI'));#EOL#&#x9;&#x9;cBT030.addValue('CDKOUTEI',&#x9;&#x9;rBT030.getValueOf('CDKOUTEI'));#EOL#&#x9;&#x9;cBT030.addValue('SQLIST',&#x9;&#x9;rBT030.getValueOf('SQLIST'));#EOL#&#x9;&#x9;cBT030.addValue('VLLTFIX',&#x9;&#x9;rBT030.getValueOf('VLLTFIX'));#EOL#&#x9;&#x9;cBT030.addValue('VLLTQTY',&#x9;&#x9;rBT030.getValueOf('VLLTQTY'));#EOL#&#x9;&#x9;cBT030.addValue('CDCENTER',&#x9;&#x9;rBT030.getValueOf('CDCENTER'));#EOL#&#x9;&#x9;cBT030.execute();#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////////////#EOL#&#x9;// 材料明細を検索・複写 //#EOL#&#x9;//////////////////////////#EOL#&#x9;rBT040 = instance.createTableOperator('Select', 'BT040');#EOL#&#x9;rBT040.addKeyValue('IDSEIZOHIN',&#x9;instance.parmMap.get('IDHINMOKU')); //複写元品番//#EOL#&#x9;while (rBT040.next()) {#EOL#&#x9;&#x9;cBT040 = instance.createTableOperator('Insert', 'BT040');#EOL#&#x9;&#x9;cBT040.addValue('IDSEIZOHIN',&#x9;BT010_IDHINMOKU.value); //複写先品番//#EOL#&#x9;&#x9;cBT040.addValue('SQZAIRYO',&#x9;&#x9;rBT040.getValueOf('SQZAIRYO'));#EOL#&#x9;&#x9;cBT040.addValue('IDHINCHILD',&#x9;rBT040.getValueOf('IDHINCHILD'));#EOL#&#x9;&#x9;cBT040.addValue('VLKOUSEI',&#x9;&#x9;rBT040.getValueOf('VLKOUSEI'));#EOL#&#x9;&#x9;cBT040.addValue('SQKOUTEI',&#x9;&#x9;rBT040.getValueOf('SQKOUTEI'));#EOL#&#x9;&#x9;cBT040.addValue('SQLIST',&#x9;&#x9;rBT040.getValueOf('SQLIST'));#EOL#&#x9;&#x9;cBT040.execute();#EOL#&#x9;}#EOL#}"/><Field Decimal="" ID="FGSEIZO" Name="製造対象フラグ" Nullable="F" Order="0140" Remarks="" Size="1" Type="CHAR" TypeOptions="BOOLEAN(T;F)"/><Field Decimal="" ID="KBSEIZO" Name="製造対象区分" Nullable="F" Order="0191" Remarks="絞込み用仮想フィールド" Size="1" Type="CHAR" TypeOptions="VIRTUAL,KUBUN(KBFLAG1)"/><Script EventP="BU" EventR="BR()" Function="" Name="更新時の入力不可設定" Order="0021" Text="if (instance.functionID != 'BF011') {#EOL#&#x9;BT010_IDHINMOKU.editable = false;#EOL#&#x9;BT010_TXHINBAN.editable = false;#EOL#&#x9;BT010_TXHINMEI.editable = false;#EOL#&#x9;BT010_KBHINSYU.editable = false;#EOL#&#x9;BT010_PRGENKA.editable = false;#EOL#&#x9;BT010_KBUNIT.editable = false;#EOL#&#x9;BT010_KBUNITPUR.editable = false;#EOL#&#x9;BT010_VLKANZAN.editable = false;#EOL#&#x9;BT010_IDSIIRESAKI.editable = false;#EOL#&#x9;BT010_FGZAIKO.editable = false;#EOL#&#x9;BT010_FGKOUNYU.editable = false;#EOL#&#x9;BT010_FGHANBAI.editable = false;#EOL#&#x9;BT010_FGSEIZO.editable = false;#EOL#&#x9;BT010_TXTEKIYO.editable = false;#EOL#}#EOL#"/><Script EventP="BU" EventR="BR()" Function="" Name="関連する計画工程の件数チェック（１）" Order="0031" Text="if (instance.functionID == 'BF030') {#EOL#&#x9;BT010_CTWORK.value = 0;#EOL#}"/><Field ID="CTWORK" Name="作業用件数" Nullable="T" Order="0201" Size="4" Type="SMALLINT" TypeOptions="VIRTUAL"/><Script EventP="BU" EventR="AS()" Function="" Name="関連する計画工程の件数チェック（２）" Order="0032" Text="if (instance.functionID == 'BF030') {#EOL#&#x9;if (BT010_CTWORK.value > 1) {#EOL#&#x9;&#x9;BT010_CTWORK.error = '工程明細に組み込める計画工程は１個のみです。';#EOL#&#x9;}#EOL#&#x9;if (BT010_CTWORK.value == 0) {#EOL#&#x9;&#x9;BT010_CTWORK.error = '工程明細に計画工程が組み込まれていません。';#EOL#&#x9;}#EOL#}"/><Field Decimal="" ID="PRHANBAI" Name="標準売価" Nullable="T" Order="0051" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="PRKOUNYU" Name="標準買価" Nullable="T" Order="0081" Remarks="発注単位での値" Size="7" Type="INTEGER" TypeOptions=""/><Refer Fields="CDTORIHIKISAKI;TXKANJI" Order="0050" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="BT010.IDSIIRESAKI"/><Script EventP="BC;BU;AR" EventR="BR()" Function="" Name="初期値設定" Order="0042" Text="if (BT010_VLKANZAN.value == 0) {#EOL#&#x9;BT010_VLKANZAN.value = 1;#EOL#}"/></Table><Table ID="MT010" Name="在庫振替" Remarks="在庫高の他勘定振替を管理するためのテーブル。振替区分はユーザ区分として定義される。" SubsystemID="M"><Field Decimal="" ID="NRZAIHURI" Name="在庫振替№" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRZAIHURI)"/><Field Decimal="" ID="CDSOUKO" Name="倉庫Ｃ" NoUpdate="T" Nullable="F" Order="0020" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="KBZAIHURI" Name="振替区分" NoUpdate="T" Nullable="F" Order="0050" Remarks="" Size="2" Type="CHAR" TypeOptions="KUBUN(KBZAIHURI)"/><Field Decimal="" ID="IDHINMOKU" Name="品目ID" NoUpdate="T" Nullable="F" Order="0080" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="PRHURIKAE" Name="取引単価" Nullable="F" Order="0090" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTHURIKAE" Name="取引数" Nullable="F" Order="0100" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="TXTEKIYO" Name="摘要" Nullable="T" Order="0110" Remarks="" Size="300" Type="VARCHAR" TypeOptions=""/><Field Decimal="" ID="NRSOURCE" Name="取引ソース№" NoUpdate="T" Nullable="F" Order="0120" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRSOURCE)"/><Key Fields="NRZAIHURI" Type="PK"/><Key Fields="NRSOURCE" Type="SK"/><Field Decimal="" ID="DTHURIKAE" Name="振替日" Nullable="F" Order="0030" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Refer Fields="TXSOUKO" Order="0020" OrderBy="" TableAlias="" ToKeyFields="CDSOUKO" ToTable="AT040" WithKeyFields="MT010.CDSOUKO"/><Refer Fields="TXHINBAN;TXHINMEI;KBUNIT" Order="0030" OrderBy="" TableAlias="" ToKeyFields="IDHINMOKU" ToTable="BT010" WithKeyFields="MT010.IDHINMOKU"/><Script EventP="AU" EventR="" Function="" Name="変更時の在庫更新" Order="0040" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rFT100; var uFT100; var cFT100; var rFT010; var cFT010; var uFT010; var kbUkebarai = '';#EOL#var amNyuko = 0; var amSyukko = 0; var amNyukoOld = 0; var amSyukkoOld = 0;#EOL#var qtNyuko = 0; var qtSyukko = 0; var qtNyukoOld = 0; var qtSyukkoOld = 0;#EOL#var amNyukoUpdated = 0; var amSyukkoUpdated = 0; var qtNyukoUpdated = 0; var qtSyukkoUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var dtNendOld = 0; var dtMSeqOld = 0; var count = 0; var errorMessage = '';#EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#////////////////// 完成入庫の赤伝処理 //////////////////////////////////#EOL#////////////////////////////////////////////////////////////////////////#EOL#if (MT010_QTHURIKAE.valueChanged || MT010_PRHURIKAE.valueChanged || MT010_DTHURIKAE.valueChanged) {#EOL##EOL#&#x9;///////////////////////////////////////#EOL#&#x9;// 関連する受払実績(FT100)の失効処理 //#EOL#&#x9;///////////////////////////////////////#EOL#&#x9;rFT100 = instance.createTableOperator('Select', 'FT100');#EOL#&#x9;rFT100.setSelectFields('NRZAITORI, UPDCOUNTER');#EOL#&#x9;rFT100.addKeyValue('NRSOURCE', MT010_NRSOURCE.value);#EOL#&#x9;while (rFT100.next()) {#EOL#&#x9;&#x9;uFT100 = instance.createTableOperator('Update', 'FT100');#EOL#&#x9;&#x9;uFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;uFT100.addValue('UPDCOUNTER',&#x9;Number(rFT100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;uFT100.addKeyValue('NRZAITORI',&#x9;rFT100.getValueOf('NRZAITORI'));#EOL#&#x9;&#x9;uFT100.addKeyValue('UPDCOUNTER',&#x9;rFT100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;count = uFT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '受払実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////#EOL#&#x9;// 年度・月度・受払区分・取引高の設定 //#EOL#&#x9;////////////////////////////////////////#EOL#&#x9;dtNendOld = session.getFYearOfDate(MT010_DTHURIKAE.oldValue);#EOL#&#x9;dtMSeqOld = session.getMSeqOfDate(MT010_DTHURIKAE.oldValue);#EOL#&#x9;if (MT010_KBZOUGEN.value == '1') {#EOL#&#x9;&#x9;kbUkebarai = '020'; //振替入庫//#EOL#&#x9;&#x9;qtNyukoOld = MT010_QTHURIKAE.oldValue * -1; //入庫数減//#EOL#&#x9;&#x9;amNyukoOld = MT010_QTHURIKAE.oldValue * MT010_PRHURIKAE.oldValue;#EOL#&#x9;} else {#EOL#&#x9;&#x9;kbUkebarai = '120'; //振替出庫//#EOL#&#x9;&#x9;qtSyukkoOld = MT010_QTHURIKAE.oldValue * -1; //出庫数減//#EOL#&#x9;&#x9;amSyukkoOld = MT010_QTHURIKAE.oldValue * MT010_PRHURIKAE.oldValue;#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////#EOL#&#x9;// 受払実績(FT100)の追加 //#EOL#&#x9;///////////////////////////#EOL#&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;cFT100.addValue('KBUKEBARAI',&#x9;kbUkebarai);#EOL#&#x9;cFT100.addValue('KBZAIHURI',&#x9;MT010_KBZAIHURI.value);#EOL#&#x9;cFT100.addValue('DTTORIHIKI',&#x9;MT010_DTHURIKAE.oldValue);#EOL#&#x9;cFT100.addValue('IDHINMOKU',&#x9;MT010_IDHINMOKU.value);#EOL#&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;MT010_CDSOUKO.value);#EOL#&#x9;cFT100.addValue('TXAITESAKI',&#x9;'');#EOL#&#x9;cFT100.addValue('PRTORIHIKI',&#x9;MT010_PRHURIKAE.oldValue);#EOL#&#x9;cFT100.addValue('QTTORIHIKI',&#x9;MT010_QTHURIKAE.oldValue);#EOL#&#x9;cFT100.addValue('AMTORIHIKI',&#x9;MT010_QTHURIKAE.oldValue * MT010_PRHURIKAE.oldValue);#EOL#&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;MT010_NRSOURCE.value);#EOL#&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;MT010_NRZAIHURI.value);#EOL#&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#&#x9;count = cFT100.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#////////////////// 完成入庫の黒伝処理 //////////////////////////////////#EOL#////////////////////////////////////////////////////////////////////////#EOL#if (MT010_QTHURIKAE.valueChanged || MT010_PRHURIKAE.valueChanged || MT010_DTHURIKAE.valueChanged) {#EOL##EOL#&#x9;////////////////////////////////////////#EOL#&#x9;// 年度・月度・受払区分・取引高の設定 //#EOL#&#x9;////////////////////////////////////////#EOL#&#x9;dtNend = session.getFYearOfDate(MT010_DTHURIKAE.value);#EOL#&#x9;dtMSeq = session.getMSeqOfDate(MT010_DTHURIKAE.value);#EOL#&#x9;if (MT010_KBZOUGEN.value == '1') {#EOL#&#x9;&#x9;kbUkebarai = '020'; //振替入庫//#EOL#&#x9;&#x9;qtNyuko = MT010_QTHURIKAE.value; //入庫増//#EOL#&#x9;&#x9;amNyuko = MT010_QTHURIKAE.value * MT010_PRHURIKAE.value;#EOL#&#x9;} else {#EOL#&#x9;&#x9;kbUkebarai = '120'; //振替出庫//#EOL#&#x9;&#x9;qtSyukko = MT010_QTHURIKAE.value; //出庫増//#EOL#&#x9;&#x9;amSyukko = MT010_QTHURIKAE.value * MT010_PRHURIKAE.value;#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////#EOL#&#x9;// 受払実績(FT100)の追加 //#EOL#&#x9;///////////////////////////#EOL#&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;cFT100.addValue('KBUKEBARAI',&#x9;kbUkebarai);#EOL#&#x9;cFT100.addValue('KBZAIHURI',&#x9;MT010_KBZAIHURI.value);#EOL#&#x9;cFT100.addValue('DTTORIHIKI',&#x9;MT010_DTHURIKAE.value);#EOL#&#x9;cFT100.addValue('IDHINMOKU',&#x9;MT010_IDHINMOKU.value);#EOL#&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;MT010_CDSOUKO.value);#EOL#&#x9;cFT100.addValue('TXAITESAKI',&#x9;'');#EOL#&#x9;cFT100.addValue('PRTORIHIKI',&#x9;MT010_PRHURIKAE.value);#EOL#&#x9;cFT100.addValue('QTTORIHIKI',&#x9;MT010_QTHURIKAE.value);#EOL#&#x9;cFT100.addValue('AMTORIHIKI',&#x9;MT010_PRHURIKAE.value * MT010_QTHURIKAE.value);#EOL#&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;MT010_NRSOURCE.value);#EOL#&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;MT010_NRZAIHURI.value);#EOL#&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;count = cFT100.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL##EOL#}#EOL#////////////////////////////////////////////////////////////////////////#EOL#//////////////////////////// 残高更新 //////////////////////////////////#EOL#////////////////////////////////////////////////////////////////////////#EOL#rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#rFT010.setSelectFields('QTKISYU, QTNYUKO, QTSYUKKO, AMKISYU, AMNYUKO, AMSYUKKO, UPDCOUNTER');#EOL#rFT010.addKeyValue('IDHINMOKU',&#x9;MT010_IDHINMOKU.value);#EOL#rFT010.addKeyValue('CDSOUKO',&#x9;MT010_CDSOUKO.value);#EOL#if (rFT010.next()) {#EOL#&#x9;qtNyukoUpdated = Number(rFT010.getValueOf('QTNYUKO')) + Number(qtNyuko) + Number(qtNyukoOld);#EOL#&#x9;amNyukoUpdated = Number(rFT010.getValueOf('AMNYUKO')) + Number(amNyuko) + Number(amNyukoOld);#EOL#&#x9;qtSyukkoUpdated = Number(rFT010.getValueOf('QTSYUKKO')) + Number(qtSyukko) + Number(qtSyukkoOld);#EOL#&#x9;amSyukkoUpdated = Number(rFT010.getValueOf('AMSYUKKO')) + Number(amSyukko) + Number(amSyukkoOld);#EOL#&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;uFT010.addValue('AMNYUKO',&#x9;&#x9;&#x9;amNyukoUpdated);#EOL#&#x9;uFT010.addValue('QTNYUKO',&#x9;&#x9;&#x9;qtNyukoUpdated);#EOL#&#x9;uFT010.addValue('AMSYUKKO',&#x9;&#x9;&#x9;amSyukkoUpdated);#EOL#&#x9;uFT010.addValue('QTSYUKKO',&#x9;&#x9;&#x9;qtSyukkoUpdated);#EOL#&#x9;uFT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;MT010_IDHINMOKU.value);#EOL#&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;MT010_CDSOUKO.value);#EOL#&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;count = uFT010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#} else {#EOL#&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;cFT010.addValue('IDHINMOKU',&#x9;MT010_IDHINMOKU.value);#EOL#&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;MT010_CDSOUKO.value);#EOL#&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;0);#EOL#&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;Number(amNyuko) + Number(amNyukoOld));#EOL#&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;Number(amSyukko) + Number(amSyukkoOld));#EOL#&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;0);#EOL#&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;Number(qtNyuko) + Number(qtNyukoOld));#EOL#&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;Number(qtSyukko) + Number(qtSyukkoOld));#EOL#&#x9;count = cFT010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}"/><Script EventP="AD" EventR="" Function="" Name="削除時の在庫更新" Order="0050" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rFT100; var uFT100; var cFT100;#EOL#var rFT010; var cFT010; var uFT010; var kbUkebarai = '';#EOL#var amNyuko = 0; var amSyukko = 0; var qtNyuko = 0; var qtSyukko = 0;#EOL#var amNyukoUpdated = 0; var amSyukkoUpdated = 0; var qtNyukoUpdated = 0; var qtSyukkoUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var count = 0; var errorMessage = '';#EOL##EOL#///////////////////////////////////////#EOL#// 関連する受払実績(FT100)の失効処理 //#EOL#///////////////////////////////////////#EOL#rFT100 = instance.createTableOperator('Select', 'FT100');#EOL#rFT100.setSelectFields('NRZAITORI, UPDCOUNTER');#EOL#rFT100.addKeyValue('NRSOURCE', MT010_NRSOURCE.value);#EOL#while (rFT100.next()) {#EOL#&#x9;uFT100 = instance.createTableOperator('Update', 'FT100');#EOL#&#x9;uFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;uFT100.addValue('UPDCOUNTER',&#x9;Number(rFT100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;uFT100.addKeyValue('NRZAITORI',&#x9;rFT100.getValueOf('NRZAITORI'));#EOL#&#x9;uFT100.addKeyValue('UPDCOUNTER',&#x9;rFT100.getValueOf('UPDCOUNTER'));#EOL#&#x9;count = uFT100.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '受払実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;break;#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL##EOL#////////////////////////////////////////#EOL#// 年度・月度・受払区分・取引高の設定 //#EOL#////////////////////////////////////////#EOL#dtNend = session.getFYearOfDate(MT010_DTHURIKAE.oldValue);#EOL#dtMSeq = session.getMSeqOfDate(MT010_DTHURIKAE.oldValue);#EOL#if (MT010_KBZOUGEN.value == '1') {#EOL#&#x9;kbUkebarai = '020'; //振替入庫//#EOL#&#x9;qtNyuko = MT010_QTHURIKAE.oldValue * -1; //入庫数減//#EOL#&#x9;amNyuko = MT010_QTHURIKAE.oldValue * MT010_PRHURIKAE.oldValue;#EOL#} else {#EOL#&#x9;kbUkebarai = '120'; //振替出庫//#EOL#&#x9;qtSyukko = MT010_QTHURIKAE.oldValue * -1; //出庫数減//#EOL#&#x9;amSyukko = MT010_QTHURIKAE.oldValue * MT010_PRHURIKAE.oldValue;#EOL#}#EOL##EOL#///////////////////////////#EOL#// 受払実績(FT100)の追加 //#EOL#///////////////////////////#EOL#cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#cFT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#cFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#cFT100.addValue('KBUKEBARAI',&#x9;kbUkebarai);#EOL#cFT100.addValue('KBZAIHURI',&#x9;MT010_KBZAIHURI.value);#EOL#cFT100.addValue('DTTORIHIKI',&#x9;MT010_DTHURIKAE.oldValue);#EOL#cFT100.addValue('IDHINMOKU',&#x9;MT010_IDHINMOKU.value);#EOL#cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#cFT100.addValue('CDSOUKO',&#x9;&#x9;MT010_CDSOUKO.value);#EOL#cFT100.addValue('TXAITESAKI',&#x9;'');#EOL#cFT100.addValue('PRTORIHIKI',&#x9;MT010_PRHURIKAE.oldValue);#EOL#cFT100.addValue('QTTORIHIKI',&#x9;MT010_QTHURIKAE.oldValue);#EOL#cFT100.addValue('AMTORIHIKI',&#x9;MT010_PRHURIKAE.oldValue * MT010_QTHURIKAE.oldValue);#EOL#cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#cFT100.addValue('NRSOURCE',&#x9;&#x9;MT010_NRSOURCE.value);#EOL#cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#cFT100.addValue('TXREFNO',&#x9;&#x9;MT010_NRZAIHURI.value);#EOL#cFT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#count = cFT100.execute();#EOL#if (count != 1) {#EOL#&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#//////////////////////////// 残高更新 //////////////////////////////////#EOL#////////////////////////////////////////////////////////////////////////#EOL#rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#rFT010.setSelectFields('QTKISYU, QTNYUKO, QTSYUKKO, AMKISYU, AMNYUKO, AMSYUKKO, UPDCOUNTER');#EOL#rFT010.addKeyValue('IDHINMOKU',&#x9;MT010_IDHINMOKU.value);#EOL#rFT010.addKeyValue('CDSOUKO',&#x9;MT010_CDSOUKO.value);#EOL#if (rFT010.next()) {#EOL#&#x9;qtNyukoUpdated = Number(rFT010.getValueOf('QTNYUKO')) + Number(qtNyuko);#EOL#&#x9;amNyukoUpdated = Number(rFT010.getValueOf('AMNYUKO')) + Number(amNyuko);#EOL#&#x9;qtSyukkoUpdated = Number(rFT010.getValueOf('QTSYUKKO')) + Number(qtSyukko);#EOL#&#x9;amSyukkoUpdated = Number(rFT010.getValueOf('AMSYUKKO')) + Number(amSyukko);#EOL#&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;uFT010.addValue('AMNYUKO',&#x9;&#x9;&#x9;amNyukoUpdated);#EOL#&#x9;uFT010.addValue('QTNYUKO',&#x9;&#x9;&#x9;qtNyukoUpdated);#EOL#&#x9;uFT010.addValue('AMSYUKKO',&#x9;&#x9;&#x9;amSyukkoUpdated);#EOL#&#x9;uFT010.addValue('QTSYUKKO',&#x9;&#x9;&#x9;qtSyukkoUpdated);#EOL#&#x9;uFT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;MT010_IDHINMOKU.value);#EOL#&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;MT010_CDSOUKO.value);#EOL#&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;count = uFT010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#} else {#EOL#&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;cFT010.addValue('IDHINMOKU',&#x9;MT010_IDHINMOKU.value);#EOL#&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;MT010_CDSOUKO.value);#EOL#&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;0);#EOL#&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;amNyuko);#EOL#&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;amSyukko);#EOL#&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;0);#EOL#&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;qtNyuko);#EOL#&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;qtSyukko);#EOL#&#x9;count = cFT010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}"/><Script EventP="AC" EventR="" Function="" Name="追加時の在庫更新" Order="0030" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rFT100; var uFT100; var cFT100;#EOL#var rFT010; var cFT010; var uFT010; var kbUkebarai = '';#EOL#var amNyuko = 0; var amSyukko = 0; var qtNyuko = 0; var qtSyukko = 0;#EOL#var amNyukoUpdated = 0; var amSyukkoUpdated = 0; var qtNyukoUpdated = 0; var qtSyukkoUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var count = 0; var errorMessage = '';#EOL##EOL#////////////////////////////////////////#EOL#// 年度・月度・受払区分・取引高の設定 //#EOL#////////////////////////////////////////#EOL#dtNend = session.getFYearOfDate(MT010_DTHURIKAE.value);#EOL#dtMSeq = session.getMSeqOfDate(MT010_DTHURIKAE.value);#EOL#if (MT010_KBZOUGEN.value == '1') {#EOL#&#x9;kbUkebarai = '020'; //振替入庫//#EOL#&#x9;qtNyuko = MT010_QTHURIKAE.value; //入庫増//#EOL#&#x9;amNyuko = MT010_QTHURIKAE.value * MT010_PRHURIKAE.value;#EOL#} else {#EOL#&#x9;kbUkebarai = '120'; //振替出庫//#EOL#&#x9;qtSyukko = MT010_QTHURIKAE.value; //出庫増//#EOL#&#x9;amSyukko = MT010_QTHURIKAE.value * MT010_PRHURIKAE.value;#EOL#}#EOL##EOL#///////////////////////////#EOL#// 受払実績(FT100)の追加 //#EOL#///////////////////////////#EOL#cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#cFT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#cFT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#cFT100.addValue('KBUKEBARAI',&#x9;kbUkebarai);#EOL#cFT100.addValue('KBZAIHURI',&#x9;MT010_KBZAIHURI.value);#EOL#cFT100.addValue('DTTORIHIKI',&#x9;MT010_DTHURIKAE.value);#EOL#cFT100.addValue('IDHINMOKU',&#x9;MT010_IDHINMOKU.value);#EOL#cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#cFT100.addValue('CDSOUKO',&#x9;&#x9;MT010_CDSOUKO.value);#EOL#cFT100.addValue('TXAITESAKI',&#x9;'');#EOL#cFT100.addValue('PRTORIHIKI',&#x9;MT010_PRHURIKAE.value);#EOL#cFT100.addValue('QTTORIHIKI',&#x9;MT010_QTHURIKAE.value);#EOL#cFT100.addValue('AMTORIHIKI',&#x9;MT010_QTHURIKAE.value * MT010_PRHURIKAE.value);#EOL#cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#cFT100.addValue('NRSOURCE',&#x9;&#x9;MT010_NRSOURCE.value);#EOL#cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#cFT100.addValue('TXREFNO',&#x9;&#x9;MT010_NRZAIHURI.value);#EOL#cFT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#count = cFT100.execute();#EOL#if (count != 1) {#EOL#&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#//////////////////////////// 残高更新 //////////////////////////////////#EOL#////////////////////////////////////////////////////////////////////////#EOL#rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#rFT010.setSelectFields('QTKISYU, QTNYUKO, QTSYUKKO, AMKISYU, AMNYUKO, AMSYUKKO, UPDCOUNTER');#EOL#rFT010.addKeyValue('IDHINMOKU',&#x9;MT010_IDHINMOKU.value);#EOL#rFT010.addKeyValue('CDSOUKO',&#x9;MT010_CDSOUKO.value);#EOL#if (rFT010.next()) {#EOL#&#x9;qtNyukoUpdated = Number(rFT010.getValueOf('QTNYUKO')) + Number(qtNyuko);#EOL#&#x9;amNyukoUpdated = Number(rFT010.getValueOf('AMNYUKO')) + Number(amNyuko);#EOL#&#x9;qtSyukkoUpdated = Number(rFT010.getValueOf('QTSYUKKO')) + Number(qtSyukko);#EOL#&#x9;amSyukkoUpdated = Number(rFT010.getValueOf('AMSYUKKO')) + Number(amSyukko);#EOL#&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;uFT010.addValue('AMNYUKO',&#x9;&#x9;&#x9;amNyukoUpdated);#EOL#&#x9;uFT010.addValue('QTNYUKO',&#x9;&#x9;&#x9;qtNyukoUpdated);#EOL#&#x9;uFT010.addValue('AMSYUKKO',&#x9;&#x9;&#x9;amSyukkoUpdated);#EOL#&#x9;uFT010.addValue('QTSYUKKO',&#x9;&#x9;&#x9;qtSyukkoUpdated);#EOL#&#x9;uFT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;MT010_IDHINMOKU.value);#EOL#&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;MT010_CDSOUKO.value);#EOL#&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;count = uFT010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#} else {#EOL#&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;cFT010.addValue('IDHINMOKU',&#x9;MT010_IDHINMOKU.value);#EOL#&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;MT010_CDSOUKO.value);#EOL#&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;0);#EOL#&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;amNyuko);#EOL#&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;amSyukko);#EOL#&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;0);#EOL#&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;qtNyuko);#EOL#&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;qtSyukko);#EOL#&#x9;count = cFT010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}"/><Script EventP="BC" EventR="AR()" Function="" Name="追加前の初期値設定" Order="0010" Text="if (MT010_DTHURIKAE.value == '') {#EOL#&#x9;MT010_DTHURIKAE.value = session.today + '';#EOL#&#x9;MT010_KBZOUGEN.value = '1';#EOL#&#x9;MT010_KBZAIHURI.value = '10';#EOL#}#EOL#"/><Field Decimal="" ID="KBZOUGEN" Name="増減区分" NoUpdate="T" Nullable="F" Order="0040" Remarks="" Size="2" Type="CHAR" TypeOptions="KUBUN(KBZOUGEN)"/><Script EventP="BC;BU;BD" EventR="BR()" Function="" Name="会計日付の妥当性検査" Order="0021" Text="MT010_DTHURIKAE.error = session.getErrorOfAccountDate(MT010_DTHURIKAE.value);"/></Table><Table ID="LT020" Name="特殊売上" Remarks="「顧客からの返品」および「受注なしの出荷」に関する情報を保持するためのテーブル" SubsystemID="L"><Field Decimal="" ID="IDTOKUISAKI" Name="得意先ID" NoUpdate="T" Nullable="F" Order="0020" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="SQSYUKKASAKI" Name="出荷先行番" Nullable="T" Order="0030" Remarks="直出荷の際に設定される。売上返品では無指定" Size="3" Type="SMALLINT" TypeOptions=""/><Field Decimal="" ID="DTTORIHIKI" Name="取引日" Nullable="F" Order="0040" Remarks="" Size="8" Type="DATE" TypeOptions=""/><Field Decimal="" ID="IDHINMOKU" Name="品目ID" NoUpdate="T" Nullable="F" Order="0050" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="CDSOUKO" Name="取引倉庫Ｃ" NoUpdate="T" Nullable="F" Order="0060" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="PRTORIHIKI" Name="取引単価" Nullable="F" Order="0070" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTTORIHIKI" Name="取引数量" Nullable="F" Order="0080" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="TXTEKIYO" Name="摘要" Nullable="T" Order="0100" Remarks="" Size="300" Type="VARCHAR" TypeOptions="KANJI"/><Field Decimal="" ID="NRSOURCE" Name="取引ソース№" NoUpdate="T" Nullable="F" Order="0120" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRSOURCE)"/><Field Decimal="" ID="AMTORIHIKI" Name="税抜取引額" NoUpdate="T" Nullable="T" Order="0130" Remarks="" Size="9" Type="INTEGER" TypeOptions="VIRTUAL"/><Field Decimal="" ID="AMTAX" Name="消費税額" NoUpdate="T" Nullable="T" Order="0140" Remarks="" Size="7" Type="INTEGER" TypeOptions="VIRTUAL"/><Key Fields="NRTOKUURI" Type="PK"/><Key Fields="NRSOURCE" Type="SK"/><Refer Fields="KBSEIKYUHOUSHIKI;NRTANTOUJYUGYOIN" Order="0030" OrderBy="" TableAlias="" ToKeyFields="IDTOKUISAKI" ToTable="ET010" WithKeyFields="LT020.IDTOKUISAKI"/><Refer Fields="CDTORIHIKISAKI;TXKANJI;NRYUBIN;TXJYUSYO1;TXJYUSYO2;NRDENWA" Order="0040" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="LT020.IDTOKUISAKI"/><Refer Fields="TXHINBAN;TXHINMEI;KBUNIT" Order="0050" OrderBy="" TableAlias="" ToKeyFields="IDHINMOKU" ToTable="BT010" WithKeyFields="LT020.IDHINMOKU"/><Refer Fields="TXSOUKO" Optional="T" Order="0060" OrderBy="" TableAlias="" ToKeyFields="CDSOUKO" ToTable="AT040" WithKeyFields="LT020.CDSOUKO"/><Field Decimal="" ID="NRTOKUURI" Name="特殊売上№" Nullable="F" Order="0001" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRTOKUURI)"/><Field Decimal="" ID="KBTOKUURI" Name="取引区分" NoUpdate="T" Nullable="F" Order="0011" Remarks="" Size="2" Type="CHAR" TypeOptions="KUBUN(KBTOKUURI)"/><Field Decimal="" ID="PRZAIKO" Name="在庫単価" Nullable="T" Order="0091" Remarks="売上返品では手入力され、直出荷では入力不可で移動平均単価が設定される" Size="9" Type="INTEGER" TypeOptions=""/><Refer Fields="TXKANJI;NRYUBIN;TXJYUSYO1;TXJYUSYO2;NRDENWA" Order="0070" OrderBy="" TableAlias="" ToKeyFields="IDTOKUISAKI;SQSYUKKASAKI" ToTable="ET011" WithKeyFields="LT020.IDTOKUISAKI;LT020.SQSYUKKASAKI"/><Refer Fields="TXKANJI" Order="0080" OrderBy="" TableAlias="" ToKeyFields="NRJYUGYOIN" ToTable="AT020" WithKeyFields="ET010.NRTANTOUJYUGYOIN"/><Script EventP="BC" EventR="AR()" Function="" Name="追加前の初期値設定と妥当性検査" Order="0010" Text="//////////////////////#EOL#// 取引日と取引区分 //#EOL#//////////////////////#EOL#if (LT020_DTTORIHIKI.value == '') {#EOL#&#x9;LT020_DTTORIHIKI.value = session.today + '';#EOL#&#x9;LT020_KBTOKUURI.value = '10';#EOL#}#EOL##EOL#//////////////////////#EOL#// 取引額と消費税額 //#EOL#//////////////////////#EOL#LT020_AMTORIHIKI.value = LT020_QTTORIHIKI.value * LT020_PRTORIHIKI.value;#EOL#LT020_AMTAX.value = session.getTaxAmount(LT020_DTTORIHIKI.value + '', LT020_AMTORIHIKI.value);#EOL#LT020_AMTORIHIKI.editable = false;#EOL#LT020_AMTAX.editable = false;#EOL##EOL#//////////////////////////////#EOL#// 在庫取引数と在庫取引単価 //#EOL#//////////////////////////////#EOL#if (LT020_KBTOKUURI.value == '10') {#EOL#&#x9;LT020_QTZAIKO.editable = true;#EOL#&#x9;LT020_PRZAIKO.editable = true;#EOL#&#x9;if (LT020_QTZAIKO.value == 0 &amp;&amp; LT020_PRZAIKO.value > 0) {#EOL#&#x9;&#x9;LT020_QTZAIKO.error = '値を入力してください。';#EOL#&#x9;}#EOL#&#x9;if (LT020_QTZAIKO.value > 0 &amp;&amp; LT020_PRZAIKO.value == 0) {#EOL#&#x9;&#x9;LT020_PRZAIKO.error = '値を入力してください。';#EOL#&#x9;}#EOL#} else {#EOL#&#x9;LT020_QTZAIKO.value = LT020_QTTORIHIKI.value;#EOL#&#x9;var rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#&#x9;rFT010.setSelectFields('QTKISYU, QTNYUKO, QTSYUKKO, AMKISYU, AMNYUKO, AMSYUKKO, UPDCOUNTER');#EOL#&#x9;rFT010.addKeyValue('IDHINMOKU',&#x9;LT020_IDHINMOKU.value);#EOL#&#x9;rFT010.addKeyValue('CDSOUKO',&#x9;LT020_CDSOUKO.value);#EOL#&#x9;if (rFT010.next()) {#EOL#&#x9;&#x9;var qtGenzaiko = Number(rFT010.getValueOf('QTKISYU')) + Number(rFT010.getValueOf('QTNYUKO')) - Number(rFT010.getValueOf('QTSYUKKO'));#EOL#&#x9;&#x9;var amGenzaiko = Number(rFT010.getValueOf('AMKISYU')) + Number(rFT010.getValueOf('AMNYUKO')) - Number(rFT010.getValueOf('AMSYUKKO'));#EOL#&#x9;&#x9;if (qtGenzaiko &lt;= 0) {#EOL#&#x9;&#x9;&#x9;LT020_PRZAIKO.value = 0;#EOL#&#x9;&#x9;&#x9;LT020_PRZAIKO.error = '在庫が存在しないため、出庫単価を設定できません。';#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;LT020_PRZAIKO.value = Math.round(amGenzaiko / qtGenzaiko);#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;LT020_PRZAIKO.value = 0;#EOL#&#x9;&#x9;LT020_PRZAIKO.error = '在庫が存在しないため、出庫単価を設定できません。';#EOL#&#x9;}#EOL#&#x9;LT020_QTZAIKO.editable = false;#EOL#&#x9;LT020_PRZAIKO.editable = false;#EOL#}#EOL##EOL#////////////////////////#EOL#// 出荷先の設定と検査 //#EOL#////////////////////////#EOL#if (LT020_KBTOKUURI.value == '10') {#EOL#&#x9;LT020_SQSYUKKASAKI.value = 0;#EOL#&#x9;LT020_SQSYUKKASAKI.editable = false;#EOL#} else {#EOL#&#x9;if (LT020_SQSYUKKASAKI.value == 0) {#EOL#&#x9;&#x9;LT020_SQSYUKKASAKI.error = 'いずれかの出荷先を設定してください。';#EOL#&#x9;}#EOL#&#x9;LT020_SQSYUKKASAKI.editable = true;#EOL#}#EOL#"/><Script EventP="BU;BD;AR" EventR="AR()" Function="" Name="仮想フィールドの設定" Order="0030" Text="//////////////////////#EOL#// 取引額と消費税額 //#EOL#//////////////////////#EOL#LT020_AMTORIHIKI.value = LT020_QTTORIHIKI.value * LT020_PRTORIHIKI.value;#EOL#LT020_AMTAX.value = session.getTaxAmount(LT020_DTTORIHIKI.value + '', LT020_AMTORIHIKI.value);#EOL#LT020_AMTORIHIKI.oldValue = LT020_QTTORIHIKI.oldValue * LT020_PRTORIHIKI.oldValue;#EOL#LT020_AMTAX.oldValue = session.getTaxAmount(LT020_DTTORIHIKI.oldValue + '', LT020_AMTORIHIKI.oldValue);#EOL#"/><Script EventP="AR" EventR="BR()" Function="" Name="機能キーの無効化(LF023)" Order="0050" Text="if (instance.functionID == 'LF023') {#EOL#&#x9;if (LT020_KBTOKUURI.value == '10') {#EOL#&#x9;&#x9;instance.parmMap.put('DISABLED_BUTTON_LIST', '10'); //F10:直出荷納品書の発行//#EOL#&#x9;}#EOL#}"/><Field Decimal="" ID="QTZAIKO" Name="在庫取引数" Nullable="T" Order="0092" Remarks="売上返品では手入力され、直出荷では入力不可で取引数量がそのまま設定される" Size="7" Type="INTEGER" TypeOptions=""/><Script EventP="AU" EventR="" Function="" Name="更新時の在庫更新" Order="0060" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rFT100; var uFT100; var cFT100; var rFT010; var cFT010; var uFT010;#EOL#var amNyuko = 0; var qtNyuko = 0; var amSyukko = 0; var qtSyukko = 0; var amTorihiki = 0; var amTax = 0;#EOL#var amNyukoOld = 0; var qtNyukoOld = 0; var amSyukkoOld = 0; var qtSyukkoOld = 0;#EOL#var amNyukoUpdated = 0; var amSyukkoUpdated = 0; var qtNyukoUpdated = 0; var qtSyukkoUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var dtNendOld = 0; var dtMSeqOld = 0; var amSagaku = 0; var amSagakuOld = 0;#EOL#var prUkebarai = 0; var kbUkebarai = ''; var count = 0; var errorMessage = '';#EOL##EOL#//////////////////////////////////#EOL#// 変更されたかどうかのチェック //#EOL#//////////////////////////////////#EOL#if (LT020_DTTORIHIKI.valueChanged || LT020_PRZAIKO.valueChanged || LT020_QTZAIKO.valueChanged) {#EOL##EOL#&#x9;///////////////////////////////////////#EOL#&#x9;// 関連する受払実績(FT100)の失効処理 //#EOL#&#x9;///////////////////////////////////////#EOL#&#x9;rFT100 = instance.createTableOperator('Select', 'FT100');#EOL#&#x9;rFT100.setSelectFields('NRZAITORI, UPDCOUNTER');#EOL#&#x9;rFT100.addKeyValue('NRSOURCE', LT020_NRSOURCE.value);#EOL#&#x9;while (rFT100.next()) {#EOL#&#x9;&#x9;uFT100 = instance.createTableOperator('Update', 'FT100');#EOL#&#x9;&#x9;uFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;uFT100.addValue('UPDCOUNTER',&#x9;Number(rFT100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;uFT100.addKeyValue('NRZAITORI',&#x9;rFT100.getValueOf('NRZAITORI'));#EOL#&#x9;&#x9;uFT100.addKeyValue('UPDCOUNTER',&#x9;rFT100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;count = uFT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '受払実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////#EOL#&#x9;// エラー処理 //#EOL#&#x9;////////////////#EOL#&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;////////////////// 特殊売上の赤伝処理 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL##EOL#&#x9;//////////////////////////////#EOL#&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;//////////////////////////////#EOL#&#x9;dtNendOld = session.getFYearOfDate(LT020_DTTORIHIKI.oldValue);#EOL#&#x9;dtMSeqOld = session.getMSeqOfDate(LT020_DTTORIHIKI.oldValue);#EOL#&#x9;if (LT020_KBTOKUURI.value == '10') {#EOL#&#x9;&#x9;qtNyukoOld = LT020_QTZAIKO.oldValue;#EOL#&#x9;&#x9;amNyukoOld = LT020_QTZAIKO.oldValue * LT020_PRZAIKO.oldValue;#EOL#&#x9;&#x9;kbUkebarai = '050'; //売上返品//#EOL#&#x9;&#x9;amSagakuOld = LT020_AMTORIHIKI.oldValue - amNyukoOld;#EOL#&#x9;}#EOL#&#x9;if (LT020_KBTOKUURI.value == '20') {#EOL#&#x9;&#x9;qtSyukkoOld = LT020_QTZAIKO.oldValue;#EOL#&#x9;&#x9;amSyukkoOld = LT020_QTZAIKO.oldValue * LT020_PRZAIKO.oldValue;#EOL#&#x9;&#x9;kbUkebarai = '150'; //直出荷//#EOL#&#x9;&#x9;amSagakuOld = LT020_AMTORIHIKI.oldValue - amSyukkoOld;#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////#EOL#&#x9;// 受払実績(FT100)の追加 //#EOL#&#x9;///////////////////////////#EOL#&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;cFT100.addValue('KBUKEBARAI',&#x9;kbUkebarai);#EOL#&#x9;cFT100.addValue('DTTORIHIKI',&#x9;LT020_DTTORIHIKI.oldValue);#EOL#&#x9;cFT100.addValue('IDHINMOKU',&#x9;LT020_IDHINMOKU.value);#EOL#&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;LT020_CDSOUKO.value);#EOL#&#x9;cFT100.addValue('TXAITESAKI',&#x9;AT030_TXKANJI.value);#EOL#&#x9;cFT100.addValue('PRTORIHIKI',&#x9;LT020_PRZAIKO.oldValue);#EOL#&#x9;cFT100.addValue('QTTORIHIKI',&#x9;LT020_QTZAIKO.oldValue);#EOL#&#x9;cFT100.addValue('AMTORIHIKI',&#x9;LT020_QTZAIKO.oldValue * LT020_PRZAIKO.oldValue);#EOL#&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;amSagakuOld);#EOL#&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;LT020_NRSOURCE.value);#EOL#&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;LT020_NRTOKUURI.value);#EOL#&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#&#x9;count = cFT100.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;////////////////// 特殊売上の黒伝処理 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL##EOL#&#x9;//////////////////////////////#EOL#&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;//////////////////////////////#EOL#&#x9;dtNend = session.getFYearOfDate(LT020_DTTORIHIKI.value);#EOL#&#x9;dtMSeq = session.getMSeqOfDate(LT020_DTTORIHIKI.value);#EOL#&#x9;if (LT020_KBTOKUURI.value == '10') {#EOL#&#x9;&#x9;qtNyuko = LT020_QTZAIKO.value;#EOL#&#x9;&#x9;amNyuko = LT020_QTZAIKO.value * LT020_PRZAIKO.value;#EOL#&#x9;&#x9;kbUkebarai = '050'; //売上返品//#EOL#&#x9;&#x9;amSagaku = LT020_AMTORIHIKI.value - amNyuko;#EOL#&#x9;}#EOL#&#x9;if (LT020_KBTOKUURI.value == '20') {#EOL#&#x9;&#x9;qtSyukko = LT020_QTZAIKO.value;#EOL#&#x9;&#x9;amSyukko = LT020_QTZAIKO.value * LT020_PRZAIKO.value;#EOL#&#x9;&#x9;kbUkebarai = '150'; //直出荷//#EOL#&#x9;&#x9;amSagaku = LT020_AMTORIHIKI.value - amSyukko;#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////#EOL#&#x9;// 受払実績(ET100)の追加 //#EOL#&#x9;///////////////////////////#EOL#&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;cFT100.addValue('KBUKEBARAI',&#x9;kbUkebarai);#EOL#&#x9;cFT100.addValue('DTTORIHIKI',&#x9;LT020_DTTORIHIKI.value);#EOL#&#x9;cFT100.addValue('IDHINMOKU',&#x9;LT020_IDHINMOKU.value);#EOL#&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;LT020_CDSOUKO.value);#EOL#&#x9;cFT100.addValue('TXAITESAKI',&#x9;AT030_TXKANJI.value);#EOL#&#x9;cFT100.addValue('PRTORIHIKI',&#x9;LT020_PRZAIKO.value);#EOL#&#x9;cFT100.addValue('QTTORIHIKI',&#x9;LT020_QTZAIKO.value);#EOL#&#x9;cFT100.addValue('AMTORIHIKI',&#x9;LT020_QTZAIKO.value * LT020_PRZAIKO.value);#EOL#&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;amSagaku);#EOL#&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;LT020_NRSOURCE.value);#EOL#&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;LT020_NRTOKUURI.value);#EOL#&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;count = cFT100.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////////////////////// 残高更新 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#&#x9;rFT010.setSelectFields('QTKISYU, QTNYUKO, QTSYUKKO, AMKISYU, AMNYUKO, AMSYUKKO, UPDCOUNTER');#EOL#&#x9;rFT010.addKeyValue('IDHINMOKU',&#x9;LT020_IDHINMOKU.value);#EOL#&#x9;rFT010.addKeyValue('CDSOUKO',&#x9;LT020_CDSOUKO.value);#EOL#&#x9;if (rFT010.next()) {#EOL#&#x9;&#x9;qtNyukoUpdated = Number(rFT010.getValueOf('QTNYUKO')) + Number(qtNyuko) - Number(qtNyukoOld);#EOL#&#x9;&#x9;amNyukoUpdated = Number(rFT010.getValueOf('AMNYUKO')) + Number(amNyuko) - Number(amNyukoOld);#EOL#&#x9;&#x9;qtSyukkoUpdated = Number(rFT010.getValueOf('QTSYUKKO')) + Number(qtSyukko) - Number(qtSyukkoOld);#EOL#&#x9;&#x9;amSyukkoUpdated = Number(rFT010.getValueOf('AMSYUKKO')) + Number(amSyukko) - Number(amSyukkoOld);#EOL#&#x9;&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;&#x9;uFT010.addValue('AMNYUKO',&#x9;&#x9;&#x9;amNyukoUpdated);#EOL#&#x9;&#x9;uFT010.addValue('QTNYUKO',&#x9;&#x9;&#x9;qtNyukoUpdated);#EOL#&#x9;&#x9;uFT010.addValue('AMSYUKKO',&#x9;&#x9;&#x9;amSyukkoUpdated);#EOL#&#x9;&#x9;uFT010.addValue('QTSYUKKO',&#x9;&#x9;&#x9;qtSyukkoUpdated);#EOL#&#x9;&#x9;uFT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;LT020_IDHINMOKU.value);#EOL#&#x9;&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;LT020_CDSOUKO.value);#EOL#&#x9;&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;count = uFT010.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;&#x9;cFT010.addValue('IDHINMOKU',&#x9;LT020_IDHINMOKU.value);#EOL#&#x9;&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;LT020_CDSOUKO.value);#EOL#&#x9;&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;0);#EOL#&#x9;&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;Number(amNyuko) - Number(amNyukoOld));#EOL#&#x9;&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;Number(amSyukko) - Number(amSyukkoOld));#EOL#&#x9;&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;0);#EOL#&#x9;&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;Number(qtNyuko) - Number(qtNyukoOld));#EOL#&#x9;&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;Number(qtSyukko) - Number(qtSyukkoOld));#EOL#&#x9;&#x9;count = cFT010.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL#"/><Script EventP="AU" EventR="" Function="" Hold="F" Name="更新時の売掛更新" Order="0070" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rET100; var uET100; var cET100; var rET010; var uET010;#EOL#var amTorihiki = 0; var amTorihikiOld = 0; var amTax = 0; var amTaxOld = 0;#EOL#var kbUritori = ''; var fgValid = 'F';#EOL#var dtNend = 0; var dtMSeq = 0; var dtNendOld = 0; var dtMSeqOld = 0;#EOL#var amUriageUpdated = 0; var count = 0; var errorMessage = '';#EOL##EOL#///////////////////////////////////////#EOL#// 関連する売上実績(ET100)の失効処理 //#EOL#///////////////////////////////////////#EOL#rET100 = instance.createTableOperator('Select', 'ET100');#EOL#rET100.setSelectFields('NRURIKAKE, NRSEIKYU, UPDCOUNTER');#EOL#rET100.addKeyValue('NRSOURCE',&#x9;LT020_NRSOURCE.value);#EOL#rET100.addKeyValue('FGVALID',&#x9;'T');#EOL#while (rET100.next()) {#EOL#&#x9;if (rET100.getValueOf('NRSEIKYU') == '') {#EOL#&#x9;&#x9;uET100 = instance.createTableOperator('Update', 'ET100');#EOL#&#x9;&#x9;uET100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;uET100.addValue('UPDCOUNTER',&#x9;Number(rET100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;uET100.addKeyValue('NRURIKAKE',&#x9;&#x9;rET100.getValueOf('NRURIKAKE'));#EOL#&#x9;&#x9;uET100.addKeyValue('UPDCOUNTER',&#x9;rET100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;count = uET100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '売上実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;fgValid = 'T';#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL##EOL#////////////////////////////////////#EOL#// 赤伝：年度・月度・取引高の設定 //#EOL#////////////////////////////////////#EOL#dtNendOld = session.getFYearOfDate(LT020_DTTORIHIKI.oldValue);#EOL#dtMSeqOld = session.getMSeqOfDate(LT020_DTTORIHIKI.oldValue);#EOL#if (LT020_KBTOKUURI.value == '10') {#EOL#&#x9;kbUritori = '02'; //売上返品//#EOL#&#x9;amTorihikiOld = LT020_AMTORIHIKI.oldValue * -1;#EOL#&#x9;amTaxOld = LT020_AMTAX.oldValue * -1;#EOL#}#EOL#if (LT020_KBTOKUURI.value == '20') {#EOL#&#x9;kbUritori = '01'; //直出荷//#EOL#&#x9;amTorihikiOld = LT020_AMTORIHIKI.oldValue;#EOL#&#x9;amTaxOld = LT020_AMTAX.oldValue;#EOL#}#EOL##EOL#///////////////////////////////#EOL#// 売上実績(ET100)の赤伝追加 //#EOL#///////////////////////////////#EOL#cET100 = instance.createTableOperator('Insert', 'ET100');#EOL#cET100.addValue('NRURIKAKE',&#x9;session.getNextNumber('NRURIKAKE'));#EOL#cET100.addValue('IDTOKUISAKI',&#x9;LT020_IDTOKUISAKI.value);#EOL#cET100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#cET100.addValue('FGVALID',&#x9;&#x9;fgValid);#EOL#cET100.addValue('KBURITORI',&#x9;kbUritori);#EOL#cET100.addValue('KBURIHURI',&#x9;'');#EOL#cET100.addValue('DTTORIHIKI',&#x9;LT020_DTTORIHIKI.oldValue);#EOL#cET100.addValue('IDHINMOKU',&#x9;LT020_IDHINMOKU.value);#EOL#cET100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#cET100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#cET100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#cET100.addValue('PRTORIHIKI',&#x9;LT020_PRTORIHIKI.oldValue);#EOL#cET100.addValue('QTTORIHIKI',&#x9;LT020_QTTORIHIKI.oldValue);#EOL#cET100.addValue('AMTORIHIKI',&#x9;LT020_AMTORIHIKI.oldValue);#EOL#cET100.addValue('AMTAX',&#x9;&#x9;LT020_AMTAX.oldValue);#EOL#cET100.addValue('AMGENKA',&#x9;&#x9;LT020_PRZAIKO.oldValue * LT020_QTZAIKO.oldValue);#EOL#cET100.addValue('NRSEIKYU',&#x9;&#x9;'');#EOL#cET100.addValue('NRSOURCE',&#x9;&#x9;LT020_NRSOURCE.value);#EOL#cET100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#cET100.addValue('TXREFNO',&#x9;&#x9;LT020_NRTOKUURI.value);#EOL#cET100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#cET100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#count = cET100.execute();#EOL#if (count != 1) {#EOL#&#x9;errorMessage = '売上実績(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////////////////////////#EOL#// 黒伝：年度・月度・取引額の設定 //#EOL#////////////////////////////////////#EOL#dtNend = session.getFYearOfDate(LT020_DTTORIHIKI.value);#EOL#dtMSeq = session.getMSeqOfDate(LT020_DTTORIHIKI.value);#EOL#if (LT020_KBTOKUURI.value == '10') {#EOL#&#x9;kbUritori = '02'; //売上返品//#EOL#&#x9;amTorihiki = LT020_AMTORIHIKI.value * -1;#EOL#&#x9;amTax = LT020_AMTAX.value * -1;#EOL#}#EOL#if (LT020_KBTOKUURI.value == '20') {#EOL#&#x9;kbUritori = '01'; //直出荷//#EOL#&#x9;amTorihiki = LT020_AMTORIHIKI.value;#EOL#&#x9;amTax = LT020_AMTAX.value;#EOL#}#EOL##EOL#///////////////////////////////#EOL#// 売上実績(ET100)の黒伝追加 //#EOL#///////////////////////////////#EOL#var nrUrikake = session.getNextNumber('NRURIKAKE');#EOL#cET100 = instance.createTableOperator('Insert', 'ET100');#EOL#cET100.addValue('NRURIKAKE',&#x9;nrUrikake);#EOL#cET100.addValue('IDTOKUISAKI',&#x9;LT020_IDTOKUISAKI.value);#EOL#cET100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#cET100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#cET100.addValue('KBURITORI',&#x9;kbUritori);#EOL#cET100.addValue('KBURIHURI',&#x9;'');#EOL#cET100.addValue('DTTORIHIKI',&#x9;LT020_DTTORIHIKI.value);#EOL#cET100.addValue('IDHINMOKU',&#x9;LT020_IDHINMOKU.value);#EOL#cET100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#cET100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#cET100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#cET100.addValue('PRTORIHIKI',&#x9;LT020_PRTORIHIKI.value);#EOL#cET100.addValue('QTTORIHIKI',&#x9;LT020_QTTORIHIKI.value);#EOL#cET100.addValue('AMTORIHIKI',&#x9;LT020_AMTORIHIKI.value);#EOL#cET100.addValue('AMTAX',&#x9;&#x9;LT020_AMTAX.value);#EOL#cET100.addValue('AMGENKA',&#x9;&#x9;LT020_PRZAIKO.value * LT020_QTZAIKO.value);#EOL#cET100.addValue('NRSEIKYU',&#x9;&#x9;'');#EOL#cET100.addValue('NRSOURCE',&#x9;&#x9;LT020_NRSOURCE.value);#EOL#cET100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#cET100.addValue('TXREFNO',&#x9;&#x9;LT020_NRTOKUURI.value);#EOL#cET100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#cET100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#count = cET100.execute();#EOL#if (count == 1) {#EOL#&#x9;if (ET010_KBSEIKYUHOUSHIKI.value == '20') {#EOL#&#x9;&#x9;instance.parmMap.put('NRURIKAKE',&#x9;nrUrikake);#EOL#&#x9;&#x9;instance.callFunction('EF112'); //都度請求処理//#EOL#&#x9;}#EOL#} else {#EOL#&#x9;errorMessage = '売上実績(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#//////////////////////////// 残高更新 //////////////////////////////////#EOL#////////////////////////////////////////////////////////////////////////#EOL#rET010 = instance.createTableOperator('Select', 'ET010');#EOL#rET010.setSelectFields('AMURIAGE, UPDCOUNTER');#EOL#rET010.addKeyValue('IDTOKUISAKI',&#x9;LT020_IDTOKUISAKI.value);#EOL#if (rET010.next()) {#EOL#&#x9;amUriageUpdated = Number(rET010.getValueOf('AMURIAGE'))#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;+ Number(amTorihiki) + Number(amTax) - Number(amTorihikiOld) - Number(amTaxOld);#EOL#&#x9;uET010 = instance.createTableOperator('Update', 'ET010');#EOL#&#x9;uET010.addValue('AMURIAGE',&#x9;&#x9;&#x9;amUriageUpdated);#EOL#&#x9;uET010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rET010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;uET010.addKeyValue('IDTOKUISAKI',&#x9;LT020_IDTOKUISAKI.value);#EOL#&#x9;uET010.addKeyValue('UPDCOUNTER',&#x9;rET010.getValueOf('UPDCOUNTER'));#EOL#&#x9;count = uET010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#} else {#EOL#&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}"/><Script EventP="BC;BU;BD" EventR="BR()" Function="" Name="会計日付の妥当性検査" Order="0040" Text="LT020_DTTORIHIKI.error = session.getErrorOfAccountDate(LT020_DTTORIHIKI.value);"/><Script EventP="AC" EventR="" Function="" Name="追加時の在庫更新" Order="0051" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rFT100; var uFT100; var cFT100; var rFT010; var cFT010; var uFT010;#EOL#var amNyuko = 0; var qtNyuko = 0; var amSyukko = 0; var qtSyukko = 0; var amTorihiki = 0; var amTax = 0;#EOL#var amNyukoUpdated = 0; var amSyukkoUpdated = 0; var qtNyukoUpdated = 0; var qtSyukkoUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var amSagaku = 0;#EOL#var prUkebarai = 0; var kbUkebarai = ''; var count = 0; var errorMessage = '';#EOL##EOL#//////////////////////////////////////////////#EOL#// 在庫取引数が入力されたかどうかのチェック //#EOL#//////////////////////////////////////////////#EOL#if (LT020_QTZAIKO.value > 0) {#EOL##EOL#&#x9;//////////////////////////////#EOL#&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;//////////////////////////////#EOL#&#x9;dtNend = session.getFYearOfDate(LT020_DTTORIHIKI.value);#EOL#&#x9;dtMSeq = session.getMSeqOfDate(LT020_DTTORIHIKI.value);#EOL#&#x9;if (LT020_KBTOKUURI.value == '10') {#EOL#&#x9;&#x9;qtNyuko = LT020_QTZAIKO.value;#EOL#&#x9;&#x9;amNyuko = LT020_QTZAIKO.value * LT020_PRZAIKO.value;#EOL#&#x9;&#x9;kbUkebarai = '050'; //売上返品//#EOL#&#x9;&#x9;amSagaku = LT020_AMTORIHIKI.value - amNyuko;#EOL#&#x9;}#EOL#&#x9;if (LT020_KBTOKUURI.value == '20') {#EOL#&#x9;&#x9;qtSyukko = LT020_QTZAIKO.value;#EOL#&#x9;&#x9;amSyukko = LT020_QTZAIKO.value * LT020_PRZAIKO.value;#EOL#&#x9;&#x9;kbUkebarai = '150'; //直出荷//#EOL#&#x9;&#x9;amSagaku = LT020_AMTORIHIKI.value - amSyukko;#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////#EOL#&#x9;// 受払実績(ET100)の追加 //#EOL#&#x9;///////////////////////////#EOL#&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;cFT100.addValue('KBUKEBARAI',&#x9;kbUkebarai);#EOL#&#x9;cFT100.addValue('DTTORIHIKI',&#x9;LT020_DTTORIHIKI.value);#EOL#&#x9;cFT100.addValue('IDHINMOKU',&#x9;LT020_IDHINMOKU.value);#EOL#&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;LT020_CDSOUKO.value);#EOL#&#x9;cFT100.addValue('TXAITESAKI',&#x9;AT030_TXKANJI.value);#EOL#&#x9;cFT100.addValue('PRTORIHIKI',&#x9;LT020_PRZAIKO.value);#EOL#&#x9;cFT100.addValue('QTTORIHIKI',&#x9;LT020_QTZAIKO.value);#EOL#&#x9;cFT100.addValue('AMTORIHIKI',&#x9;LT020_QTZAIKO.value * LT020_PRZAIKO.value);#EOL#&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;amSagaku);#EOL#&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;LT020_NRSOURCE.value);#EOL#&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;LT020_NRTOKUURI.value);#EOL#&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;count = cFT100.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////////////////////// 残高更新 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#&#x9;rFT010.setSelectFields('QTKISYU, QTNYUKO, QTSYUKKO, AMKISYU, AMNYUKO, AMSYUKKO, UPDCOUNTER');#EOL#&#x9;rFT010.addKeyValue('IDHINMOKU',&#x9;LT020_IDHINMOKU.value);#EOL#&#x9;rFT010.addKeyValue('CDSOUKO',&#x9;LT020_CDSOUKO.value);#EOL#&#x9;if (rFT010.next()) {#EOL#&#x9;&#x9;qtNyukoUpdated = Number(rFT010.getValueOf('QTNYUKO')) + Number(qtNyuko);#EOL#&#x9;&#x9;amNyukoUpdated = Number(rFT010.getValueOf('AMNYUKO')) + Number(amNyuko);#EOL#&#x9;&#x9;qtSyukkoUpdated = Number(rFT010.getValueOf('QTSYUKKO')) + Number(qtSyukko);#EOL#&#x9;&#x9;amSyukkoUpdated = Number(rFT010.getValueOf('AMSYUKKO')) + Number(amSyukko);#EOL#&#x9;&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;&#x9;uFT010.addValue('AMNYUKO',&#x9;&#x9;&#x9;amNyukoUpdated);#EOL#&#x9;&#x9;uFT010.addValue('QTNYUKO',&#x9;&#x9;&#x9;qtNyukoUpdated);#EOL#&#x9;&#x9;uFT010.addValue('AMSYUKKO',&#x9;&#x9;&#x9;amSyukkoUpdated);#EOL#&#x9;&#x9;uFT010.addValue('QTSYUKKO',&#x9;&#x9;&#x9;qtSyukkoUpdated);#EOL#&#x9;&#x9;uFT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;LT020_IDHINMOKU.value);#EOL#&#x9;&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;LT020_CDSOUKO.value);#EOL#&#x9;&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;count = uFT010.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;&#x9;cFT010.addValue('IDHINMOKU',&#x9;LT020_IDHINMOKU.value);#EOL#&#x9;&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;LT020_CDSOUKO.value);#EOL#&#x9;&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;0);#EOL#&#x9;&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;amNyuko);#EOL#&#x9;&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;amSyukko);#EOL#&#x9;&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;0);#EOL#&#x9;&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;qtNyuko);#EOL#&#x9;&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;qtSyukko);#EOL#&#x9;&#x9;count = cFT010.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}"/><Script EventP="AD" EventR="" Function="" Name="削除時の在庫更新" Order="0061" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rFT100; var uFT100; var cFT100; var rFT010; var cFT010; var uFT010;#EOL#var amTorihiki = 0; var amTax = 0; var amNyukoOld = 0; var qtNyukoOld = 0; var amSyukkoOld = 0; var qtSyukkoOld = 0;#EOL#var amNyukoUpdated = 0; var amSyukkoUpdated = 0; var qtNyukoUpdated = 0; var qtSyukkoUpdated = 0;#EOL#var dtNendOld = 0; var dtMSeqOld = 0; var amSagakuOld = 0;#EOL#var prUkebarai = 0; var kbUkebarai = ''; var count = 0; var errorMessage = '';#EOL##EOL#////////////////////////////////////////////#EOL#// 在庫取引を伴っていたかどうかのチェック //#EOL#////////////////////////////////////////////#EOL#if (LT020_QTZAIKO.oldValue > 0) {#EOL##EOL#&#x9;///////////////////////////////////////#EOL#&#x9;// 関連する受払実績(FT100)の失効処理 //#EOL#&#x9;///////////////////////////////////////#EOL#&#x9;rFT100 = instance.createTableOperator('Select', 'FT100');#EOL#&#x9;rFT100.setSelectFields('NRZAITORI, UPDCOUNTER');#EOL#&#x9;rFT100.addKeyValue('NRSOURCE', LT020_NRSOURCE.value);#EOL#&#x9;while (rFT100.next()) {#EOL#&#x9;&#x9;uFT100 = instance.createTableOperator('Update', 'FT100');#EOL#&#x9;&#x9;uFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;uFT100.addValue('UPDCOUNTER',&#x9;Number(rFT100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;uFT100.addKeyValue('NRZAITORI',&#x9;rFT100.getValueOf('NRZAITORI'));#EOL#&#x9;&#x9;uFT100.addKeyValue('UPDCOUNTER',&#x9;rFT100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;count = uFT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '受払実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////#EOL#&#x9;// エラー処理 //#EOL#&#x9;////////////////#EOL#&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////////////////#EOL#&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;//////////////////////////////#EOL#&#x9;dtNendOld = session.getFYearOfDate(LT020_DTTORIHIKI.oldValue);#EOL#&#x9;dtMSeqOld = session.getMSeqOfDate(LT020_DTTORIHIKI.oldValue);#EOL#&#x9;if (LT020_KBTOKUURI.value == '10') {#EOL#&#x9;&#x9;qtNyukoOld = LT020_QTZAIKO.oldValue;#EOL#&#x9;&#x9;amNyukoOld = LT020_QTZAIKO.oldValue * LT020_PRZAIKO.oldValue;#EOL#&#x9;&#x9;kbUkebarai = '050'; //売上返品//#EOL#&#x9;&#x9;amSagakuOld = LT020_AMTORIHIKI.oldValue - amNyukoOld;#EOL#&#x9;}#EOL#&#x9;if (LT020_KBTOKUURI.value == '20') {#EOL#&#x9;&#x9;qtSyukkoOld = LT020_QTZAIKO.oldValue;#EOL#&#x9;&#x9;amSyukkoOld = LT020_QTZAIKO.oldValue * LT020_PRZAIKO.oldValue;#EOL#&#x9;&#x9;kbUkebarai = '150'; //直出荷//#EOL#&#x9;&#x9;amSagakuOld = LT020_AMTORIHIKI.oldValue - amSyukkoOld;#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////#EOL#&#x9;// 受払実績(FT100)の追加 //#EOL#&#x9;///////////////////////////#EOL#&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;cFT100.addValue('KBUKEBARAI',&#x9;kbUkebarai);#EOL#&#x9;cFT100.addValue('DTTORIHIKI',&#x9;LT020_DTTORIHIKI.oldValue);#EOL#&#x9;cFT100.addValue('IDHINMOKU',&#x9;LT020_IDHINMOKU.value);#EOL#&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;LT020_CDSOUKO.value);#EOL#&#x9;cFT100.addValue('TXAITESAKI',&#x9;AT030_TXKANJI.value);#EOL#&#x9;cFT100.addValue('PRTORIHIKI',&#x9;LT020_PRZAIKO.oldValue);#EOL#&#x9;cFT100.addValue('QTTORIHIKI',&#x9;LT020_QTZAIKO.oldValue);#EOL#&#x9;cFT100.addValue('AMTORIHIKI',&#x9;LT020_QTZAIKO.oldValue * LT020_PRZAIKO.oldValue);#EOL#&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;amSagakuOld);#EOL#&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;LT020_NRSOURCE.value);#EOL#&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;LT020_NRTOKUURI.value);#EOL#&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#&#x9;count = cFT100.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////////////////////// 残高更新 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#&#x9;rFT010.setSelectFields('QTKISYU, QTNYUKO, QTSYUKKO, AMKISYU, AMNYUKO, AMSYUKKO, UPDCOUNTER');#EOL#&#x9;rFT010.addKeyValue('IDHINMOKU',&#x9;LT020_IDHINMOKU.value);#EOL#&#x9;rFT010.addKeyValue('CDSOUKO',&#x9;LT020_CDSOUKO.value);#EOL#&#x9;if (rFT010.next()) {#EOL#&#x9;&#x9;qtNyukoUpdated = Number(rFT010.getValueOf('QTNYUKO')) - Number(qtNyukoOld);#EOL#&#x9;&#x9;amNyukoUpdated = Number(rFT010.getValueOf('AMNYUKO')) - Number(amNyukoOld);#EOL#&#x9;&#x9;qtSyukkoUpdated = Number(rFT010.getValueOf('QTSYUKKO')) - Number(qtSyukkoOld);#EOL#&#x9;&#x9;amSyukkoUpdated = Number(rFT010.getValueOf('AMSYUKKO')) - Number(amSyukkoOld);#EOL#&#x9;&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;&#x9;uFT010.addValue('AMNYUKO',&#x9;&#x9;&#x9;amNyukoUpdated);#EOL#&#x9;&#x9;uFT010.addValue('QTNYUKO',&#x9;&#x9;&#x9;qtNyukoUpdated);#EOL#&#x9;&#x9;uFT010.addValue('AMSYUKKO',&#x9;&#x9;&#x9;amSyukkoUpdated);#EOL#&#x9;&#x9;uFT010.addValue('QTSYUKKO',&#x9;&#x9;&#x9;qtSyukkoUpdated);#EOL#&#x9;&#x9;uFT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;LT020_IDHINMOKU.value);#EOL#&#x9;&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;LT020_CDSOUKO.value);#EOL#&#x9;&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;count = uFT010.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;&#x9;cFT010.addValue('IDHINMOKU',&#x9;LT020_IDHINMOKU.value);#EOL#&#x9;&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;LT020_CDSOUKO.value);#EOL#&#x9;&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;0);#EOL#&#x9;&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;0 - Number(amNyukoOld));#EOL#&#x9;&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;0 - Number(amSyukkoOld));#EOL#&#x9;&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;0);#EOL#&#x9;&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;0 - Number(qtNyukoOld));#EOL#&#x9;&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;0 - Number(qtSyukkoOld));#EOL#&#x9;&#x9;count = cFT010.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL#"/><Script EventP="AC" EventR="" Function="" Hold="F" Name="追加時の売掛更新" Order="0062" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rET100; var uET100; var cET100; var rET010; var uET010;#EOL#var amTorihiki = 0; var amTax = 0; var kbUritori = ''; var dtNend = 0; var dtMSeq = 0;#EOL#var amUriageUpdated = 0; var count = 0; var errorMessage = '';#EOL##EOL#////////////////////////////////////#EOL#// 黒伝：年度・月度・取引額の設定 //#EOL#////////////////////////////////////#EOL#dtNend = session.getFYearOfDate(LT020_DTTORIHIKI.value);#EOL#dtMSeq = session.getMSeqOfDate(LT020_DTTORIHIKI.value);#EOL#if (LT020_KBTOKUURI.value == '10') {#EOL#&#x9;kbUritori = '02'; //売上返品//#EOL#&#x9;amTorihiki = LT020_AMTORIHIKI.value * -1; //残高減//#EOL#&#x9;amTax = LT020_AMTAX.value * -1; //残高減//#EOL#}#EOL#if (LT020_KBTOKUURI.value == '20') {#EOL#&#x9;kbUritori = '01'; //直出荷//#EOL#&#x9;amTorihiki = LT020_AMTORIHIKI.value; //残高増//#EOL#&#x9;amTax = LT020_AMTAX.value; //残高増//#EOL#}#EOL##EOL#///////////////////////////////#EOL#// 売上実績(ET100)の黒伝追加 //#EOL#///////////////////////////////#EOL#var nrUrikake = session.getNextNumber('NRURIKAKE');#EOL#cET100 = instance.createTableOperator('Insert', 'ET100');#EOL#cET100.addValue('NRURIKAKE',&#x9;nrUrikake);#EOL#cET100.addValue('IDTOKUISAKI',&#x9;LT020_IDTOKUISAKI.value);#EOL#cET100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#cET100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#cET100.addValue('KBURITORI',&#x9;kbUritori);#EOL#cET100.addValue('KBURIHURI',&#x9;'');#EOL#cET100.addValue('DTTORIHIKI',&#x9;LT020_DTTORIHIKI.value);#EOL#cET100.addValue('IDHINMOKU',&#x9;LT020_IDHINMOKU.value);#EOL#cET100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#cET100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#cET100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#cET100.addValue('PRTORIHIKI',&#x9;LT020_PRTORIHIKI.value);#EOL#cET100.addValue('QTTORIHIKI',&#x9;LT020_QTTORIHIKI.value);#EOL#cET100.addValue('AMTORIHIKI',&#x9;LT020_AMTORIHIKI.value);#EOL#cET100.addValue('AMTAX',&#x9;&#x9;LT020_AMTAX.value);#EOL#cET100.addValue('AMGENKA',&#x9;&#x9;LT020_PRZAIKO.value * LT020_QTZAIKO.value);#EOL#cET100.addValue('NRSEIKYU',&#x9;&#x9;'');#EOL#cET100.addValue('NRSOURCE',&#x9;&#x9;LT020_NRSOURCE.value);#EOL#cET100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#cET100.addValue('TXREFNO',&#x9;&#x9;LT020_NRTOKUURI.value);#EOL#cET100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#cET100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#count = cET100.execute();#EOL#if (count == 1) {#EOL#&#x9;if (ET010_KBSEIKYUHOUSHIKI.value == '20') {#EOL#&#x9;&#x9;instance.parmMap.put('NRURIKAKE',&#x9;nrUrikake);#EOL#&#x9;&#x9;instance.callFunction('EF112'); //都度請求処理//#EOL#&#x9;}#EOL#} else {#EOL#&#x9;errorMessage = '売上実績(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#//////////////////////////// 残高更新 //////////////////////////////////#EOL#////////////////////////////////////////////////////////////////////////#EOL#rET010 = instance.createTableOperator('Select', 'ET010');#EOL#rET010.setSelectFields('AMURIAGE, UPDCOUNTER');#EOL#rET010.addKeyValue('IDTOKUISAKI',&#x9;LT020_IDTOKUISAKI.value);#EOL#if (rET010.next()) {#EOL#&#x9;amUriageUpdated = Number(rET010.getValueOf('AMURIAGE')) + Number(amTorihiki) + Number(amTax);#EOL#&#x9;uET010 = instance.createTableOperator('Update', 'ET010');#EOL#&#x9;uET010.addValue('AMURIAGE',&#x9;&#x9;&#x9;amUriageUpdated);#EOL#&#x9;uET010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rET010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;uET010.addKeyValue('IDTOKUISAKI',&#x9;LT020_IDTOKUISAKI.value);#EOL#&#x9;uET010.addKeyValue('UPDCOUNTER',&#x9;rET010.getValueOf('UPDCOUNTER'));#EOL#&#x9;count = uET010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#} else {#EOL#&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}"/><Script EventP="AD" EventR="" Function="" Hold="F" Name="削除時の売掛更新" Order="0071" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rET100; var uET100; var cET100; var rET010; var uET010;#EOL#var amTorihikiOld = 0; var amTaxOld = 0; var kbUritori = '';#EOL#var fgValid = 'F'; var dtNendOld = 0; var dtMSeqOld = 0;#EOL#var amUriageUpdated = 0; var count = 0; var errorMessage = '';#EOL##EOL#///////////////////////////////////////#EOL#// 関連する売上実績(ET100)の失効処理 //#EOL#///////////////////////////////////////#EOL#rET100 = instance.createTableOperator('Select', 'ET100');#EOL#rET100.setSelectFields('NRURIKAKE, NRSEIKYU, UPDCOUNTER');#EOL#rET100.addKeyValue('NRSOURCE',&#x9;LT020_NRSOURCE.value);#EOL#rET100.addKeyValue('FGVALID',&#x9;'T');#EOL#while (rET100.next()) {#EOL#&#x9;if (rET100.getValueOf('NRSEIKYU') == '') {#EOL#&#x9;&#x9;uET100 = instance.createTableOperator('Update', 'ET100');#EOL#&#x9;&#x9;uET100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;uET100.addValue('UPDCOUNTER',&#x9;Number(rET100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;uET100.addKeyValue('NRURIKAKE',&#x9;&#x9;rET100.getValueOf('NRURIKAKE'));#EOL#&#x9;&#x9;uET100.addKeyValue('UPDCOUNTER',&#x9;rET100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;count = uET100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '売上実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;fgValid = 'T';#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL##EOL#////////////////////////////////////#EOL#// 赤伝：年度・月度・取引高の設定 //#EOL#////////////////////////////////////#EOL#dtNendOld = session.getFYearOfDate(LT020_DTTORIHIKI.oldValue);#EOL#dtMSeqOld = session.getMSeqOfDate(LT020_DTTORIHIKI.oldValue);#EOL#if (LT020_KBTOKUURI.value == '10') {#EOL#&#x9;kbUritori = '02'; //売上返品//#EOL#&#x9;amTorihikiOld = LT020_AMTORIHIKI.oldValue; //残高増//#EOL#&#x9;amTaxOld = LT020_AMTAX.oldValue; //残高増//#EOL#}#EOL#if (LT020_KBTOKUURI.value == '20') {#EOL#&#x9;kbUritori = '01'; //直出荷//#EOL#&#x9;amTorihikiOld = LT020_AMTORIHIKI.oldValue * -1; //残高減//#EOL#&#x9;amTaxOld = LT020_AMTAX.oldValue * -1; //残高減//#EOL#}#EOL##EOL#///////////////////////////////#EOL#// 売上実績(ET100)の赤伝追加 //#EOL#///////////////////////////////#EOL#cET100 = instance.createTableOperator('Insert', 'ET100');#EOL#cET100.addValue('NRURIKAKE',&#x9;session.getNextNumber('NRURIKAKE'));#EOL#cET100.addValue('IDTOKUISAKI',&#x9;LT020_IDTOKUISAKI.value);#EOL#cET100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#cET100.addValue('FGVALID',&#x9;&#x9;fgValid);#EOL#cET100.addValue('KBURITORI',&#x9;kbUritori);#EOL#cET100.addValue('KBURIHURI',&#x9;'');#EOL#cET100.addValue('DTTORIHIKI',&#x9;LT020_DTTORIHIKI.oldValue);#EOL#cET100.addValue('IDHINMOKU',&#x9;LT020_IDHINMOKU.value);#EOL#cET100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#cET100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#cET100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#cET100.addValue('PRTORIHIKI',&#x9;LT020_PRTORIHIKI.oldValue);#EOL#cET100.addValue('QTTORIHIKI',&#x9;LT020_QTTORIHIKI.oldValue);#EOL#cET100.addValue('AMTORIHIKI',&#x9;LT020_AMTORIHIKI.oldValue);#EOL#cET100.addValue('AMTAX',&#x9;&#x9;LT020_AMTAX.oldValue);#EOL#cET100.addValue('AMGENKA',&#x9;&#x9;LT020_PRZAIKO.oldValue * LT020_QTZAIKO.oldValue);#EOL#cET100.addValue('NRSEIKYU',&#x9;&#x9;'');#EOL#cET100.addValue('NRSOURCE',&#x9;&#x9;LT020_NRSOURCE.value);#EOL#cET100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#cET100.addValue('TXREFNO',&#x9;&#x9;LT020_NRTOKUURI.value);#EOL#cET100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#cET100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#count = cET100.execute();#EOL#if (count != 1) {#EOL#&#x9;errorMessage = '売上実績(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#//////////////////////////// 残高更新 //////////////////////////////////#EOL#////////////////////////////////////////////////////////////////////////#EOL#rET010 = instance.createTableOperator('Select', 'ET010');#EOL#rET010.setSelectFields('AMURIAGE, UPDCOUNTER');#EOL#rET010.addKeyValue('IDTOKUISAKI',&#x9;LT020_IDTOKUISAKI.value);#EOL#if (rET010.next()) {#EOL#&#x9;amUriageUpdated = Number(rET010.getValueOf('AMURIAGE')) + Number(amTorihikiOld) + Number(amTaxOld);#EOL#&#x9;uET010 = instance.createTableOperator('Update', 'ET010');#EOL#&#x9;uET010.addValue('AMURIAGE',&#x9;&#x9;&#x9;amUriageUpdated);#EOL#&#x9;uET010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rET010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;uET010.addKeyValue('IDTOKUISAKI',&#x9;LT020_IDTOKUISAKI.value);#EOL#&#x9;uET010.addKeyValue('UPDCOUNTER',&#x9;rET010.getValueOf('UPDCOUNTER'));#EOL#&#x9;count = uET010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#} else {#EOL#&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}"/></Table><Table ID="LT010" Name="売掛振替" Remarks="売掛に関連する勘定科目との振替指示情報を保持するためのテーブル。" SubsystemID="L"><Field Decimal="" ID="IDTOKUISAKI" Name="得意先ID" NoUpdate="T" Nullable="F" Order="0060" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="TXTEKIYO" Name="摘要" Nullable="F" Order="0080" Remarks="" Size="30" Type="CHAR" TypeOptions="KANJI"/><Field Decimal="" ID="NRSOURCE" Name="取引ソース№" NoUpdate="T" Nullable="F" Order="0100" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRSOURCE)"/><Key Fields="NRURIHURI" Type="PK"/><Key Fields="NRSOURCE" Type="SK"/><Field Decimal="" ID="NRURIHURI" Name="売掛振替№" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRURIHURI)"/><Field Decimal="" ID="KBURIHURI" Name="振替区分" NoUpdate="T" Nullable="F" Order="0030" Remarks="" Size="2" Type="CHAR" TypeOptions="KUBUN(KBURIHURI)"/><Field Decimal="" ID="DTHURIKAE" Name="振替日" Nullable="F" Order="0050" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="" ID="AMHURIKAE" Name="振替額" Nullable="F" Order="0070" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="KBZOUGEN" Name="増減区分" NoUpdate="T" Nullable="F" Order="0020" Remarks="" Size="2" Type="CHAR" TypeOptions="KUBUN(KBZOUGEN)"/><Script EventP="BC" EventR="BR()" Function="" Name="追加前の初期値設定" Order="0010" Text="if (LT010_DTHURIKAE.value == '') {#EOL#&#x9;LT010_DTHURIKAE.value = session.today + '';#EOL#&#x9;LT010_KBZOUGEN.value = '1';#EOL#&#x9;LT010_KBURIHURI.value = '10';#EOL#}"/><Script EventP="AU" EventR="" Function="" Name="更新時の売掛更新" Order="0050" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rET100; var uET100; var cET100; var rET010; var uET010;#EOL#var amTorihiki = 0; var amTorihikiOld = 0; var kbUritori = ''; var fgValid = 'F';#EOL#var dtNend = 0; var dtMSeq = 0; var dtNendOld = 0; var dtMSeqOld = 0;#EOL#var amUriageUpdated = 0; var count = 0; var errorMessage = '';#EOL##EOL#///////////////////////////////////////#EOL#// 関連する売上実績(ET100)の失効処理 //#EOL#///////////////////////////////////////#EOL#rET100 = instance.createTableOperator('Select', 'ET100');#EOL#rET100.setSelectFields('NRURIKAKE, NRSEIKYU, UPDCOUNTER');#EOL#rET100.addKeyValue('NRSOURCE',&#x9;LT010_NRSOURCE.value);#EOL#rET100.addKeyValue('FGVALID',&#x9;'T');#EOL#while (rET100.next()) {#EOL#&#x9;if (rET100.getValueOf('NRSEIKYU') == '') {#EOL#&#x9;&#x9;uET100 = instance.createTableOperator('Update', 'ET100');#EOL#&#x9;&#x9;uET100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;uET100.addValue('UPDCOUNTER',&#x9;Number(rET100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;uET100.addKeyValue('NRURIKAKE',&#x9;&#x9;rET100.getValueOf('NRURIKAKE'));#EOL#&#x9;&#x9;uET100.addKeyValue('UPDCOUNTER',&#x9;rET100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;count = uET100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '売上実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;fgValid = 'T';#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL##EOL#////////////////////////////////////#EOL#// 赤伝：年度・月度・取引高の設定 //#EOL#////////////////////////////////////#EOL#dtNendOld = session.getFYearOfDate(LT010_DTHURIKAE.oldValue);#EOL#dtMSeqOld = session.getMSeqOfDate(LT010_DTHURIKAE.oldValue);#EOL#if (LT010_KBZOUGEN.value == '1') {#EOL#&#x9;kbUritori = '11'; //振替計上//#EOL#&#x9;amTorihikiOld = LT010_AMHURIKAE.oldValue * -1; //残高減//#EOL#} else {#EOL#&#x9;kbUritori = '10'; //振替控除//#EOL#&#x9;amTorihikiOld = LT010_AMHURIKAE.oldValue; //残高増//#EOL#}#EOL##EOL#///////////////////////////////#EOL#// 売上実績(ET100)の赤伝追加 //#EOL#///////////////////////////////#EOL#cET100 = instance.createTableOperator('Insert', 'ET100');#EOL#cET100.addValue('NRURIKAKE',&#x9;session.getNextNumber('NRURIKAKE'));#EOL#cET100.addValue('IDTOKUISAKI',&#x9;LT010_IDTOKUISAKI.value);#EOL#cET100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#cET100.addValue('FGVALID',&#x9;&#x9;fgValid);#EOL#cET100.addValue('KBURITORI',&#x9;kbUritori);#EOL#cET100.addValue('KBURIHURI',&#x9;LT010_KBURIHURI.value);#EOL#cET100.addValue('DTTORIHIKI',&#x9;LT010_DTHURIKAE.oldValue);#EOL#cET100.addValue('IDHINMOKU',&#x9;'');#EOL#cET100.addValue('TXHINBAN',&#x9;&#x9;'');#EOL#cET100.addValue('TXHINMEI',&#x9;&#x9;LT010_TXTEKIYO.oldValue);#EOL#cET100.addValue('KBUNIT',&#x9;&#x9;'CNT');#EOL#cET100.addValue('PRTORIHIKI',&#x9;LT010_AMHURIKAE.oldValue);#EOL#cET100.addValue('QTTORIHIKI',&#x9;1);#EOL#cET100.addValue('AMTORIHIKI',&#x9;LT010_AMHURIKAE.oldValue);#EOL#cET100.addValue('AMTAX',&#x9;&#x9;0);#EOL#cET100.addValue('AMGENKA',&#x9;&#x9;0);#EOL#cET100.addValue('NRSEIKYU',&#x9;&#x9;'');#EOL#cET100.addValue('NRSOURCE',&#x9;&#x9;LT010_NRSOURCE.value);#EOL#cET100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#cET100.addValue('TXREFNO',&#x9;&#x9;LT010_NRURIHURI.value);#EOL#cET100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#cET100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#count = cET100.execute();#EOL#if (count != 1) {#EOL#&#x9;errorMessage = '売上実績(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////////////////////////#EOL#// 黒伝：年度・月度・取引額の設定 //#EOL#////////////////////////////////////#EOL#dtNend = session.getFYearOfDate(LT010_DTHURIKAE.value);#EOL#dtMSeq = session.getMSeqOfDate(LT010_DTHURIKAE.value);#EOL#if (LT010_KBZOUGEN.value == '1') {#EOL#&#x9;kbKaitori = '11'; //振替計上//#EOL#&#x9;amTorihiki = LT010_AMHURIKAE.value; //残高増//#EOL#} else {#EOL#&#x9;kbKaitori = '10'; //振替控除//#EOL#&#x9;amTorihiki = LT010_AMHURIKAE.value * -1; //残高減//#EOL#}#EOL##EOL#///////////////////////////////#EOL#// 売上実績(ET100)の黒伝追加 //#EOL#///////////////////////////////#EOL#var nrUrikake = session.getNextNumber('NRURIKAKE');#EOL#cET100 = instance.createTableOperator('Insert', 'ET100');#EOL#cET100.addValue('NRURIKAKE',&#x9;nrUrikake);#EOL#cET100.addValue('IDTOKUISAKI',&#x9;LT010_IDTOKUISAKI.value);#EOL#cET100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#cET100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#cET100.addValue('KBURITORI',&#x9;kbUritori);#EOL#cET100.addValue('KBURIHURI',&#x9;LT010_KBURIHURI.value);#EOL#cET100.addValue('DTTORIHIKI',&#x9;LT010_DTHURIKAE.value);#EOL#cET100.addValue('IDHINMOKU',&#x9;'');#EOL#cET100.addValue('TXHINBAN',&#x9;&#x9;'');#EOL#cET100.addValue('TXHINMEI',&#x9;&#x9;LT010_TXTEKIYO.value);#EOL#cET100.addValue('KBUNIT',&#x9;&#x9;'CNT');#EOL#cET100.addValue('PRTORIHIKI',&#x9;LT010_AMHURIKAE.value);#EOL#cET100.addValue('QTTORIHIKI',&#x9;1);#EOL#cET100.addValue('AMTORIHIKI',&#x9;LT010_AMHURIKAE.value);#EOL#cET100.addValue('AMTAX',&#x9;&#x9;0);#EOL#cET100.addValue('AMGENKA',&#x9;&#x9;0);#EOL#cET100.addValue('NRSEIKYU',&#x9;&#x9;'');#EOL#cET100.addValue('NRSOURCE',&#x9;&#x9;LT010_NRSOURCE.value);#EOL#cET100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#cET100.addValue('TXREFNO',&#x9;&#x9;LT010_NRURIHURI.value);#EOL#cET100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#cET100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#count = cET100.execute();#EOL#if (count == 1) {#EOL#&#x9;if (ET010_KBSEIKYUHOUSHIKI.value == '20') {#EOL#&#x9;&#x9;instance.parmMap.put('NRURIKAKE',&#x9;nrUrikake);#EOL#&#x9;&#x9;instance.callFunction('EF112'); //都度請求処理//#EOL#&#x9;}#EOL#} else {#EOL#&#x9;errorMessage = '売上実績(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#//////////////////////////// 残高更新 //////////////////////////////////#EOL#////////////////////////////////////////////////////////////////////////#EOL#rET010 = instance.createTableOperator('Select', 'ET010');#EOL#rET010.setSelectFields('AMURIAGE, UPDCOUNTER');#EOL#rET010.addKeyValue('IDTOKUISAKI',&#x9;LT010_IDTOKUISAKI.value);#EOL#if (rET010.next()) {#EOL#&#x9;amUriageUpdated = Number(rET010.getValueOf('AMURIAGE')) + Number(amTorihiki) + Number(amTorihikiOld);#EOL#&#x9;uET010 = instance.createTableOperator('Update', 'ET010');#EOL#&#x9;uET010.addValue('AMURIAGE',&#x9;&#x9;&#x9;amUriageUpdated);#EOL#&#x9;uET010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rET010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;uET010.addKeyValue('IDTOKUISAKI',&#x9;LT010_IDTOKUISAKI.value);#EOL#&#x9;uET010.addKeyValue('UPDCOUNTER',&#x9;rET010.getValueOf('UPDCOUNTER'));#EOL#&#x9;count = uET010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#} else {#EOL#&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}"/><Refer Fields="KBSEIKYUHOUSHIKI" Order="0010" OrderBy="" TableAlias="" ToKeyFields="IDTOKUISAKI" ToTable="ET010" WithKeyFields="LT010.IDTOKUISAKI"/><Refer Fields="TXKANJI;CDTORIHIKISAKI" Order="0020" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="LT010.IDTOKUISAKI"/><Script EventP="AC" EventR="" Function="" Name="追加時の売掛更新" Order="0040" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rET100; var uET100; var cET100; var rET010; var uET010;#EOL#var amTorihiki = 0; var kbUritori = ''; var amUriageUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var count = 0; var errorMessage = '';#EOL##EOL#//////////////////////////////#EOL#// 年度・月度・取引額の設定 //#EOL#//////////////////////////////#EOL#dtNend = session.getFYearOfDate(LT010_DTHURIKAE.value);#EOL#dtMSeq = session.getMSeqOfDate(LT010_DTHURIKAE.value);#EOL#if (LT010_KBZOUGEN.value == '1') {#EOL#&#x9;kbUritori = '11'; //振替計上//#EOL#&#x9;amTorihiki = LT010_AMHURIKAE.value; //残高増//#EOL#} else {#EOL#&#x9;kbUritori = '10'; //振替控除//#EOL#&#x9;amTorihiki = LT010_AMHURIKAE.value * -1; //残高減//#EOL#}#EOL##EOL#///////////////////////////#EOL#// 売上実績(ET100)の追加 //#EOL#///////////////////////////#EOL#var nrUrikake = session.getNextNumber('NRURIKAKE');#EOL#cET100 = instance.createTableOperator('Insert', 'ET100');#EOL#cET100.addValue('NRURIKAKE',&#x9;nrUrikake);#EOL#cET100.addValue('IDTOKUISAKI',&#x9;LT010_IDTOKUISAKI.value);#EOL#cET100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#cET100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#cET100.addValue('KBURITORI',&#x9;kbUritori);#EOL#cET100.addValue('KBURIHURI',&#x9;LT010_KBURIHURI.value);#EOL#cET100.addValue('DTTORIHIKI',&#x9;LT010_DTHURIKAE.value);#EOL#cET100.addValue('IDHINMOKU',&#x9;'');#EOL#cET100.addValue('TXHINBAN',&#x9;&#x9;'');#EOL#cET100.addValue('TXHINMEI',&#x9;&#x9;LT010_TXTEKIYO.value);#EOL#cET100.addValue('KBUNIT',&#x9;&#x9;'CNT');#EOL#cET100.addValue('PRTORIHIKI',&#x9;LT010_AMHURIKAE.value);#EOL#cET100.addValue('QTTORIHIKI',&#x9;1);#EOL#cET100.addValue('AMTORIHIKI',&#x9;LT010_AMHURIKAE.value);#EOL#cET100.addValue('AMTAX',&#x9;&#x9;0);#EOL#cET100.addValue('AMGENKA',&#x9;&#x9;0);#EOL#cET100.addValue('NRSEIKYU',&#x9;&#x9;'');#EOL#cET100.addValue('NRSOURCE',&#x9;&#x9;LT010_NRSOURCE.value);#EOL#cET100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#cET100.addValue('TXREFNO',&#x9;&#x9;LT010_NRURIHURI.value);#EOL#cET100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#cET100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#count = cET100.execute();#EOL#if (count == 1) {#EOL#&#x9;if (ET010_KBSEIKYUHOUSHIKI.value == '20') {#EOL#&#x9;&#x9;instance.parmMap.put('NRURIKAKE',&#x9;nrUrikake);#EOL#&#x9;&#x9;instance.callFunction('EF112'); //都度請求処理//#EOL#&#x9;}#EOL#} else {#EOL#&#x9;errorMessage = '売上実績(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#//////////////////////////// 残高更新 //////////////////////////////////#EOL#////////////////////////////////////////////////////////////////////////#EOL#rET010 = instance.createTableOperator('Select', 'ET010');#EOL#rET010.setSelectFields('AMURIAGE, UPDCOUNTER');#EOL#rET010.addKeyValue('IDTOKUISAKI',&#x9;LT010_IDTOKUISAKI.value);#EOL#if (rET010.next()) {#EOL#&#x9;amUriageUpdated = Number(rET010.getValueOf('AMURIAGE')) + Number(amTorihiki);#EOL#&#x9;uET010 = instance.createTableOperator('Update', 'ET010');#EOL#&#x9;uET010.addValue('AMURIAGE',&#x9;&#x9;&#x9;amUriageUpdated);#EOL#&#x9;uET010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rET010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;uET010.addKeyValue('IDTOKUISAKI',&#x9;LT010_IDTOKUISAKI.value);#EOL#&#x9;uET010.addKeyValue('UPDCOUNTER',&#x9;rET010.getValueOf('UPDCOUNTER'));#EOL#&#x9;count = uET010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#} else {#EOL#&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}"/><Script EventP="AD" EventR="" Function="" Name="削除時の売掛更新" Order="0060" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rET100; var uET100; var cET100; var rET010; var uET010;#EOL#var amTorihikiOld = 0; var kbUritori = ''; var fgValid = 'F';#EOL#var amUriageUpdated = 0; var dtNendOld = 0; var dtMSeqOld = 0;#EOL#var count = 0; var errorMessage = '';#EOL##EOL#///////////////////////////////////////#EOL#// 関連する売上実績(ET100)の失効処理 //#EOL#///////////////////////////////////////#EOL#rET100 = instance.createTableOperator('Select', 'ET100');#EOL#rET100.setSelectFields('NRURIKAKE, NRSEIKYU, UPDCOUNTER');#EOL#rET100.addKeyValue('NRSOURCE',&#x9;LT010_NRSOURCE.value);#EOL#rET100.addKeyValue('FGVALID',&#x9;'T');#EOL#while (rET100.next()) {#EOL#&#x9;if (rET100.getValueOf('NRSEIKYU') == '') {#EOL#&#x9;&#x9;uET100 = instance.createTableOperator('Update', 'ET100');#EOL#&#x9;&#x9;uET100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;uET100.addValue('UPDCOUNTER',&#x9;Number(rET100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;uET100.addKeyValue('NRURIKAKE',&#x9;&#x9;rET100.getValueOf('NRURIKAKE'));#EOL#&#x9;&#x9;uET100.addKeyValue('UPDCOUNTER',&#x9;rET100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;count = uET100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '売上実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;fgValid = 'T';#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL##EOL#////////////////////////////////////#EOL#// 赤伝：年度・月度・取引高の設定 //#EOL#////////////////////////////////////#EOL#dtNendOld = session.getFYearOfDate(LT010_DTHURIKAE.oldValue);#EOL#dtMSeqOld = session.getMSeqOfDate(LT010_DTHURIKAE.oldValue);#EOL#if (LT010_KBZOUGEN.value == '1') {#EOL#&#x9;kbUritori = '11'; //振替計上//#EOL#&#x9;amTorihikiOld = LT010_AMHURIKAE.oldValue * -1; //残高減//#EOL#} else {#EOL#&#x9;kbUritori = '10'; //振替控除//#EOL#&#x9;amTorihikiOld = LT010_AMHURIKAE.oldValue; //残高増//#EOL#}#EOL##EOL#///////////////////////////////#EOL#// 売上実績(ET100)の赤伝追加 //#EOL#///////////////////////////////#EOL#cET100 = instance.createTableOperator('Insert', 'ET100');#EOL#cET100.addValue('NRURIKAKE',&#x9;session.getNextNumber('NRURIKAKE'));#EOL#cET100.addValue('IDTOKUISAKI',&#x9;LT010_IDTOKUISAKI.value);#EOL#cET100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#cET100.addValue('FGVALID',&#x9;&#x9;fgValid);#EOL#cET100.addValue('KBURITORI',&#x9;kbUritori);#EOL#cET100.addValue('KBURIHURI',&#x9;LT010_KBURIHURI.value);#EOL#cET100.addValue('DTTORIHIKI',&#x9;LT010_DTHURIKAE.oldValue);#EOL#cET100.addValue('IDHINMOKU',&#x9;'');#EOL#cET100.addValue('TXHINBAN',&#x9;&#x9;'');#EOL#cET100.addValue('TXHINMEI',&#x9;&#x9;LT010_TXTEKIYO.oldValue);#EOL#cET100.addValue('KBUNIT',&#x9;&#x9;'CNT');#EOL#cET100.addValue('PRTORIHIKI',&#x9;LT010_AMHURIKAE.oldValue);#EOL#cET100.addValue('QTTORIHIKI',&#x9;1);#EOL#cET100.addValue('AMTORIHIKI',&#x9;LT010_AMHURIKAE.oldValue);#EOL#cET100.addValue('AMTAX',&#x9;&#x9;0);#EOL#cET100.addValue('AMGENKA',&#x9;&#x9;0);#EOL#cET100.addValue('NRSEIKYU',&#x9;&#x9;'');#EOL#cET100.addValue('NRSOURCE',&#x9;&#x9;LT010_NRSOURCE.value);#EOL#cET100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#cET100.addValue('TXREFNO',&#x9;&#x9;LT010_NRURIHURI.value);#EOL#cET100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#cET100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#count = cET100.execute();#EOL#if (count != 1) {#EOL#&#x9;errorMessage = '売上実績(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#//////////////////////////// 残高更新 //////////////////////////////////#EOL#////////////////////////////////////////////////////////////////////////#EOL#rET010 = instance.createTableOperator('Select', 'ET010');#EOL#rET010.setSelectFields('AMURIAGE, UPDCOUNTER');#EOL#rET010.addKeyValue('IDTOKUISAKI',&#x9;LT010_IDTOKUISAKI.value);#EOL#if (rET010.next()) {#EOL#&#x9;amUriageUpdated = Number(rET010.getValueOf('AMURIAGE')) + Number(amTorihikiOld);#EOL#&#x9;uET010 = instance.createTableOperator('Update', 'ET010');#EOL#&#x9;uET010.addValue('AMURIAGE',&#x9;&#x9;&#x9;amUriageUpdated);#EOL#&#x9;uET010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rET010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;uET010.addKeyValue('IDTOKUISAKI',&#x9;LT010_IDTOKUISAKI.value);#EOL#&#x9;uET010.addKeyValue('UPDCOUNTER',&#x9;rET010.getValueOf('UPDCOUNTER'));#EOL#&#x9;count = uET010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#} else {#EOL#&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}"/><Script EventP="BC;BU;BD" EventR="BR()" Function="" Name="会計日付の妥当性検査" Order="0030" Text="LT010_DTHURIKAE.error = session.getErrorOfAccountDate(LT010_DTHURIKAE.value);"/></Table><Table ID="KT020" Name="特殊仕入" Remarks="「仕入先返品」および「発注なし入荷」に関する情報を保持するためのテーブル" SubsystemID="K"><Field Decimal="" ID="NRTOKUSIIRE" Name="特殊仕入№" Nullable="F" Order="0000" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRTOKUSIIRE)"/><Field Decimal="" ID="KBTOKUSIIRE" Name="取引区分" NoUpdate="T" Nullable="F" Order="0010" Remarks="#EOL#" Size="2" Type="CHAR" TypeOptions="KUBUN(KBTOKUSIIRE)"/><Field Decimal="" ID="IDSIIRESAKI" Name="仕入先ID" NoUpdate="T" Nullable="F" Order="0020" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="DTTORIHIKI" Name="取引日" Nullable="F" Order="0030" Remarks="" Size="8" Type="DATE" TypeOptions=""/><Field Decimal="" ID="IDHINMOKU" Name="品目ID" NoUpdate="T" Nullable="F" Order="0040" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="CDSOUKO" Name="倉庫Ｃ" NoUpdate="T" Nullable="F" Order="0050" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="PRTORIHIKI" Name="取引単価" Nullable="F" Order="0060" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTTORIHIKI" Name="取引数量" Nullable="F" Order="0070" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="PRZAIKO" Name="在庫単価" NoUpdate="T" Nullable="T" Order="0100" Remarks="仕入返品時には在庫出庫額として入力され、直接入荷時には入力不可で値が自動設定される。" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="TXTEKIYO" Name="摘要" NoUpdate="T" Nullable="T" Order="0110" Remarks="" Size="300" Type="VARCHAR" TypeOptions="KANJI"/><Field Decimal="" ID="NRSOURCE" Name="取引ソース№" NoUpdate="T" Nullable="F" Order="0120" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRSOURCE)"/><Field Decimal="" ID="AMTORIHIKI" Name="税抜取引額" NoUpdate="T" Nullable="T" Order="0130" Remarks="" Size="7" Type="INTEGER" TypeOptions="VIRTUAL"/><Field Decimal="" ID="AMTAX" Name="消費税額" NoUpdate="T" Nullable="T" Order="0140" Remarks="" Size="7" Type="INTEGER" TypeOptions="VIRTUAL"/><Key Fields="NRTOKUSIIRE" Type="PK"/><Key Fields="NRSOURCE" Type="SK"/><Refer Fields="" Order="0100" OrderBy="" TableAlias="" ToKeyFields="IDSIIRESAKI" ToTable="DT010" WithKeyFields="KT020.IDSIIRESAKI"/><Refer Fields="CDTORIHIKISAKI;TXKANJI" Order="0110" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="KT020.IDSIIRESAKI"/><Refer Fields="TXHINBAN;TXHINMEI;KBUNIT;KBUNITPUR;VLKANZAN" Order="0120" OrderBy="" TableAlias="" ToKeyFields="IDHINMOKU" ToTable="BT010" WithKeyFields="KT020.IDHINMOKU"/><Refer Fields="TXSOUKO" Order="0130" OrderBy="" TableAlias="" ToKeyFields="CDSOUKO" ToTable="AT040" WithKeyFields="KT020.CDSOUKO"/><Script EventP="BC" EventR="AR()" Function="" Name="追加前の初期値設定" Order="0010" Text="//////////////////////#EOL#// 取引日と取引区分 //#EOL#//////////////////////#EOL#if (KT020_DTTORIHIKI.value == '') {#EOL#&#x9;KT020_DTTORIHIKI.value = session.today + '';#EOL#&#x9;KT020_KBTOKUSIIRE.value = '10';#EOL#}#EOL##EOL#//////////////////////#EOL#// 取引額と消費税額 //#EOL#//////////////////////#EOL#KT020_AMTORIHIKI.value = KT020_QTTORIHIKI.value * KT020_PRTORIHIKI.value;#EOL#KT020_AMTAX.value = session.getTaxAmount(KT020_DTTORIHIKI.value + '', KT020_AMTORIHIKI.value);#EOL#KT020_AMTORIHIKI.editable = false;#EOL#KT020_AMTAX.editable = false;#EOL##EOL#//////////////////////////////#EOL#// 在庫換算数と在庫取引単価 //#EOL#//////////////////////////////#EOL#KT020_QTZAIKO.value = KT020_QTTORIHIKI.value * BT010_VLKANZAN.value;#EOL#if (KT020_KBTOKUSIIRE.value == '10') {#EOL#&#x9;var rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#&#x9;rFT010.setSelectFields('QTKISYU, QTNYUKO, QTSYUKKO, AMKISYU, AMNYUKO, AMSYUKKO, UPDCOUNTER');#EOL#&#x9;rFT010.addKeyValue('IDHINMOKU',&#x9;KT020_IDHINMOKU.value);#EOL#&#x9;rFT010.addKeyValue('CDSOUKO',&#x9;KT020_CDSOUKO.value);#EOL#&#x9;if (rFT010.next()) {#EOL#&#x9;&#x9;var qtGenzaiko = Number(rFT010.getValueOf('QTKISYU')) + Number(rFT010.getValueOf('QTNYUKO')) - Number(rFT010.getValueOf('QTSYUKKO'));#EOL#&#x9;&#x9;var amGenzaiko = Number(rFT010.getValueOf('AMKISYU')) + Number(rFT010.getValueOf('AMNYUKO')) - Number(rFT010.getValueOf('AMSYUKKO'));#EOL#&#x9;&#x9;if (qtGenzaiko &lt;= 0) {#EOL#&#x9;&#x9;&#x9;KT020_PRZAIKO.value = 0;#EOL#&#x9;&#x9;&#x9;KT020_PRZAIKO.error = '在庫が存在しないため、出庫単価を設定できません。';#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;KT020_PRZAIKO.value = Math.round(amGenzaiko / qtGenzaiko);#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;KT020_PRZAIKO.value = 0;#EOL#&#x9;&#x9;KT020_PRZAIKO.error = '在庫が存在しないため、出庫単価を設定できません。';#EOL#&#x9;}#EOL#} else {#EOL#&#x9;var amNyuka = Number(KT020_AMTORIHIKI.value) + Number(KT020_AMTAX.value);#EOL#&#x9;KT020_PRZAIKO.value = Math.round(amNyuka / KT020_QTZAIKO.value);#EOL#}#EOL#KT020_QTZAIKO.editable = false;#EOL#KT020_PRZAIKO.editable = false;"/><Script EventP="AU" EventR="" Function="" Name="更新時の在庫更新" Order="0070" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rFT100; var uFT100; var cFT100; var rFT010; var cFT010; var uFT010;#EOL#var amNyuko = 0; var qtNyuko = 0; var amSyukko = 0; var qtSyukko = 0; var amTorihiki = 0; var amTax = 0;#EOL#var amNyukoOld = 0; var qtNyukoOld = 0; var amSyukkoOld = 0; var qtSyukkoOld = 0;#EOL#var amNyukoUpdated = 0; var amSyukkoUpdated = 0; var qtNyukoUpdated = 0; var qtSyukkoUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var dtNendOld = 0; var dtMSeqOld = 0;#EOL#var prUkebarai = 0; var kbUkebarai = ''; var count = 0; var errorMessage = '';#EOL##EOL#//////////////////////////////////#EOL#// 変更されたかどうかのチェック //#EOL#//////////////////////////////////#EOL#if (KT020_DTTORIHIKI.valueChanged || KT020_PRTORIHIKI.valueChanged || KT020_QTTORIHIKI.valueChanged) {#EOL##EOL#&#x9;///////////////////////////////////////#EOL#&#x9;// 関連する受払実績(FT100)の失効処理 //#EOL#&#x9;///////////////////////////////////////#EOL#&#x9;rFT100 = instance.createTableOperator('Select', 'FT100');#EOL#&#x9;rFT100.setSelectFields('NRZAITORI, UPDCOUNTER');#EOL#&#x9;rFT100.addKeyValue('NRSOURCE', KT020_NRSOURCE.value);#EOL#&#x9;while (rFT100.next()) {#EOL#&#x9;&#x9;uFT100 = instance.createTableOperator('Update', 'FT100');#EOL#&#x9;&#x9;uFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;uFT100.addValue('UPDCOUNTER',&#x9;Number(rFT100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;uFT100.addKeyValue('NRZAITORI',&#x9;rFT100.getValueOf('NRZAITORI'));#EOL#&#x9;&#x9;uFT100.addKeyValue('UPDCOUNTER',&#x9;rFT100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;count = uFT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '受払実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////#EOL#&#x9;// エラー処理 //#EOL#&#x9;////////////////#EOL#&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;////////////////// 特殊仕入の赤伝処理 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL##EOL#&#x9;//////////////////////////////#EOL#&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;//////////////////////////////#EOL#&#x9;dtNendOld = session.getFYearOfDate(KT020_DTTORIHIKI.oldValue);#EOL#&#x9;dtMSeqOld = session.getMSeqOfDate(KT020_DTTORIHIKI.oldValue);#EOL#&#x9;if (KT020_KBTOKUSIIRE.value == '10') {#EOL#&#x9;&#x9;qtSyukkoOld = KT020_QTTORIHIKI.oldValue * BT010_VLKANZAN.value;#EOL#&#x9;&#x9;amSyukkoOld = Number(KT020_AMTORIHIKI.oldValue) + Number(KT020_AMTAX.oldValue);#EOL#&#x9;&#x9;prUkebarai = Math.round(amSyukkoOld / qtSyukkoOld);#EOL#&#x9;&#x9;kbUkebarai = '140'; //仕入返品//#EOL#&#x9;}#EOL#&#x9;if (KT020_KBTOKUSIIRE.value == '20') {#EOL#&#x9;&#x9;qtNyukoOld = KT020_QTTORIHIKI.oldValue * BT010_VLKANZAN.value;#EOL#&#x9;&#x9;amNyukoOld = Number(KT020_AMTORIHIKI.oldValue) + Number(KT020_AMTAX.oldValue);#EOL#&#x9;&#x9;prUkebarai = Math.round(amNyukoOld / qtNyukoOld);#EOL#&#x9;&#x9;kbUkebarai = '040'; //直入荷//#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////#EOL#&#x9;// 受払実績(FT100)の追加 //#EOL#&#x9;///////////////////////////#EOL#&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;cFT100.addValue('KBUKEBARAI',&#x9;kbUkebarai);#EOL#&#x9;cFT100.addValue('DTTORIHIKI',&#x9;KT020_DTTORIHIKI.oldValue);#EOL#&#x9;cFT100.addValue('IDHINMOKU',&#x9;KT020_IDHINMOKU.value);#EOL#&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;KT020_CDSOUKO.value);#EOL#&#x9;cFT100.addValue('TXAITESAKI',&#x9;AT030_TXKANJI.value);#EOL#&#x9;cFT100.addValue('PRTORIHIKI',&#x9;prUkebarai);#EOL#&#x9;cFT100.addValue('QTTORIHIKI',&#x9;KT020_QTTORIHIKI.oldValue * BT010_VLKANZAN.value);#EOL#&#x9;cFT100.addValue('AMTORIHIKI',&#x9;Number(KT020_AMTORIHIKI.oldValue) + Number(KT020_AMTAX.oldValue));#EOL#&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;KT020_NRSOURCE.value);#EOL#&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;KT020_NRTOKUSIIRE.value);#EOL#&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#&#x9;count = cFT100.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;////////////////// 特殊仕入の黒伝処理 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL##EOL#&#x9;//////////////////////////////#EOL#&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;//////////////////////////////#EOL#&#x9;dtNend = session.getFYearOfDate(KT020_DTTORIHIKI.value);#EOL#&#x9;dtMSeq = session.getMSeqOfDate(KT020_DTTORIHIKI.value);#EOL#&#x9;if (KT020_KBTOKUSIIRE.value == '10') {#EOL#&#x9;&#x9;qtSyukko = KT020_QTTORIHIKI.value * BT010_VLKANZAN.value;#EOL#&#x9;&#x9;amSyukko = Number(KT020_AMTORIHIKI.value) + Number(KT020_AMTAX.value);#EOL#&#x9;&#x9;prUkebarai = Math.round(amSyukko / qtSyukko);#EOL#&#x9;&#x9;kbUkebarai = '140'; //仕入返品//#EOL#&#x9;}#EOL#&#x9;if (KT020_KBTOKUSIIRE.value == '20') {#EOL#&#x9;&#x9;qtNyuko = KT020_QTTORIHIKI.value * BT010_VLKANZAN.value;#EOL#&#x9;&#x9;amNyuko = Number(KT020_AMTORIHIKI.value) + Number(KT020_AMTAX.value);#EOL#&#x9;&#x9;prUkebarai = Math.round(amNyuko / qtNyuko);#EOL#&#x9;&#x9;kbUkebarai = '040'; //直入荷//#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////#EOL#&#x9;// 受払実績(ET100)の追加 //#EOL#&#x9;///////////////////////////#EOL#&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;cFT100.addValue('KBUKEBARAI',&#x9;kbUkebarai);#EOL#&#x9;cFT100.addValue('DTTORIHIKI',&#x9;KT020_DTTORIHIKI.value);#EOL#&#x9;cFT100.addValue('IDHINMOKU',&#x9;KT020_IDHINMOKU.value);#EOL#&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;KT020_CDSOUKO.value);#EOL#&#x9;cFT100.addValue('TXAITESAKI',&#x9;AT030_TXKANJI.value);#EOL#&#x9;cFT100.addValue('PRTORIHIKI',&#x9;prUkebarai);#EOL#&#x9;cFT100.addValue('QTTORIHIKI',&#x9;KT020_QTTORIHIKI.value * BT010_VLKANZAN.value);#EOL#&#x9;cFT100.addValue('AMTORIHIKI',&#x9;Number(KT020_AMTORIHIKI.value) + Number(KT020_AMTAX.value));#EOL#&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;KT020_NRSOURCE.value);#EOL#&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;KT020_NRTOKUSIIRE.value);#EOL#&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;count = cFT100.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////////////////////// 残高更新 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#&#x9;rFT010.setSelectFields('QTKISYU, QTNYUKO, QTSYUKKO, AMKISYU, AMNYUKO, AMSYUKKO, UPDCOUNTER');#EOL#&#x9;rFT010.addKeyValue('IDHINMOKU',&#x9;KT020_IDHINMOKU.value);#EOL#&#x9;rFT010.addKeyValue('CDSOUKO',&#x9;KT020_CDSOUKO.value);#EOL#&#x9;if (rFT010.next()) {#EOL#&#x9;&#x9;qtNyukoUpdated = Number(rFT010.getValueOf('QTNYUKO')) + Number(qtNyuko) - Number(qtNyukoOld);#EOL#&#x9;&#x9;amNyukoUpdated = Number(rFT010.getValueOf('AMNYUKO')) + Number(amNyuko) - Number(amNyukoOld);#EOL#&#x9;&#x9;qtSyukkoUpdated = Number(rFT010.getValueOf('QTSYUKKO')) + Number(qtSyukko) - Number(qtSyukkoOld);#EOL#&#x9;&#x9;amSyukkoUpdated = Number(rFT010.getValueOf('AMSYUKKO')) + Number(amSyukko) - Number(amSyukkoOld);#EOL#&#x9;&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;&#x9;uFT010.addValue('AMNYUKO',&#x9;&#x9;&#x9;amNyukoUpdated);#EOL#&#x9;&#x9;uFT010.addValue('QTNYUKO',&#x9;&#x9;&#x9;qtNyukoUpdated);#EOL#&#x9;&#x9;uFT010.addValue('AMSYUKKO',&#x9;&#x9;&#x9;amSyukkoUpdated);#EOL#&#x9;&#x9;uFT010.addValue('QTSYUKKO',&#x9;&#x9;&#x9;qtSyukkoUpdated);#EOL#&#x9;&#x9;uFT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;KT020_IDHINMOKU.value);#EOL#&#x9;&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;KT020_CDSOUKO.value);#EOL#&#x9;&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;count = uFT010.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;&#x9;cFT010.addValue('IDHINMOKU',&#x9;KT020_IDHINMOKU.value);#EOL#&#x9;&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;KT020_CDSOUKO.value);#EOL#&#x9;&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;0);#EOL#&#x9;&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;Number(amNyuko) - Number(amNyukoOld));#EOL#&#x9;&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;Number(amSyukko) - Number(amSyukkoOld));#EOL#&#x9;&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;0);#EOL#&#x9;&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;Number(qtNyuko) - Number(qtNyukoOld));#EOL#&#x9;&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;Number(qtSyukko) - Number(qtSyukkoOld));#EOL#&#x9;&#x9;count = cFT010.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL#"/><Script EventP="AU" EventR="" Function="" Name="更新時の買掛更新" Order="0100" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rDT100; var uDT100; var cDT100; var rDT010; var uDT010;#EOL#var amTorihiki = 0; var amTorihikiOld = 0;#EOL#var amTax = 0; var amTaxOld = 0; var amSiireUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var dtNendOld = 0; var dtMSeqOld = 0;#EOL#var count = 0; var errorMessage = ''; var fgValid = 'F';#EOL##EOL#////////////////////#EOL#// 値変更チェック //#EOL#////////////////////#EOL#if (KT020_QTTORIHIKI.valueChanged || KT020_DTTORIHIKI.valueChanged || KT020_PRTORIHIKI.valueChanged) {#EOL##EOL#&#x9;///////////////////////////////////////#EOL#&#x9;// 関連する仕入実績(DT100)の失効処理 //#EOL#&#x9;///////////////////////////////////////#EOL#&#x9;rDT100 = instance.createTableOperator('Select', 'DT100');#EOL#&#x9;rDT100.setSelectFields('NRKAIKAKE, NRSIHARAI, UPDCOUNTER');#EOL#&#x9;rDT100.addKeyValue('NRSOURCE',&#x9;KT020_NRSOURCE.value);#EOL#&#x9;rDT100.addKeyValue('FGVALID',&#x9;'T');#EOL#&#x9;while (rDT100.next()) {#EOL#&#x9;&#x9;if (rDT100.getValueOf('NRSIHARAI') == '') {#EOL#&#x9;&#x9;&#x9;uDT100 = instance.createTableOperator('Update', 'DT100');#EOL#&#x9;&#x9;&#x9;uDT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;&#x9;uDT100.addValue('UPDCOUNTER',&#x9;Number(rDT100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;uDT100.addKeyValue('NRKAIKAKE',&#x9;&#x9;rDT100.getValueOf('NRKAIKAKE'));#EOL#&#x9;&#x9;&#x9;uDT100.addKeyValue('UPDCOUNTER',&#x9;rDT100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;count = uDT100.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '仕入実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;fgValid = 'T';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;/////////////////////// 入荷仕入の赤伝処理 /////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL##EOL#&#x9;//////////////////////////////#EOL#&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;//////////////////////////////#EOL#&#x9;dtNendOld = session.getFYearOfDate(KT020_DTTORIHIKI.oldValue);#EOL#&#x9;dtMSeqOld = session.getMSeqOfDate(KT020_DTTORIHIKI.oldValue);#EOL#&#x9;if (KT020_KBTOKUSIIRE.value == '10') {#EOL#&#x9;&#x9;kbKaitori = '02'; //仕入返品//#EOL#&#x9;&#x9;amTorihikiOld = KT020_AMTORIHIKI.oldValue * -1;#EOL#&#x9;&#x9;amTaxOld = KT020_AMTAX.oldValue * -1;#EOL#&#x9;}#EOL#&#x9;if (KT020_KBTOKUSIIRE.value == '20') {#EOL#&#x9;&#x9;kbKaitori = '01'; //直入荷仕入//#EOL#&#x9;&#x9;amTorihikiOld = KT020_AMTORIHIKI.oldValue;#EOL#&#x9;&#x9;amTaxOld = KT020_AMTAX.oldValue;#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////#EOL#&#x9;// 仕入実績(DT100)の追加 //#EOL#&#x9;///////////////////////////#EOL#&#x9;cDT100 = instance.createTableOperator('Insert', 'DT100');#EOL#&#x9;cDT100.addValue('NRKAIKAKE',&#x9;session.getNextNumber('NRKAIKAKE'));#EOL#&#x9;cDT100.addValue('IDSIIRESAKI',&#x9;KT020_IDSIIRESAKI.value);#EOL#&#x9;cDT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;cDT100.addValue('FGVALID',&#x9;&#x9;fgValid);#EOL#&#x9;cDT100.addValue('KBKAITORI',&#x9;kbKaitori);#EOL#&#x9;cDT100.addValue('DTTORIHIKI',&#x9;KT020_DTTORIHIKI.oldValue);#EOL#&#x9;cDT100.addValue('IDHINMOKU',&#x9;KT020_IDHINMOKU.value);#EOL#&#x9;cDT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;cDT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;cDT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNITPUR.value);#EOL#&#x9;cDT100.addValue('PRTORIHIKI',&#x9;KT020_PRTORIHIKI.oldValue);#EOL#&#x9;cDT100.addValue('QTTORIHIKI',&#x9;KT020_QTTORIHIKI.oldValue);#EOL#&#x9;cDT100.addValue('AMTORIHIKI',&#x9;KT020_AMTORIHIKI.oldValue);#EOL#&#x9;cDT100.addValue('AMTAX',&#x9;&#x9;KT020_AMTAX.oldValue);#EOL#&#x9;cDT100.addValue('NRSIHARAI',&#x9;'');#EOL#&#x9;cDT100.addValue('NRSOURCE',&#x9;&#x9;KT020_NRSOURCE.value);#EOL#&#x9;cDT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;cDT100.addValue('TXREFNO',&#x9;&#x9;KT020_NRTOKUSIIRE.value);#EOL#&#x9;cDT100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#&#x9;cDT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#&#x9;count = cDT100.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '仕入実績(DT100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;/////////////////////// 入荷仕入の黒伝処理 /////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL##EOL#&#x9;//////////////////////////////#EOL#&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;//////////////////////////////#EOL#&#x9;dtNend = session.getFYearOfDate(KT020_DTTORIHIKI.value);#EOL#&#x9;dtMSeq = session.getMSeqOfDate(KT020_DTTORIHIKI.value);#EOL#&#x9;if (KT020_KBTOKUSIIRE.value == '10') {#EOL#&#x9;&#x9;kbKaitori = '02'; //仕入返品//#EOL#&#x9;&#x9;amTorihiki = KT020_AMTORIHIKI.value * -1;#EOL#&#x9;&#x9;amTax = KT020_AMTAX.value * -1;#EOL#&#x9;}#EOL#&#x9;if (KT020_KBTOKUSIIRE.value == '20') {#EOL#&#x9;&#x9;kbKaitori = '01'; //直入荷仕入//#EOL#&#x9;&#x9;amTorihiki = KT020_AMTORIHIKI.value;#EOL#&#x9;&#x9;amTax = KT020_AMTAX.value;#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////#EOL#&#x9;// 仕入実績(DT100)の追加 //#EOL#&#x9;///////////////////////////#EOL#&#x9;cDT100 = instance.createTableOperator('Insert', 'DT100');#EOL#&#x9;cDT100.addValue('NRKAIKAKE',&#x9;session.getNextNumber('NRKAIKAKE'));#EOL#&#x9;cDT100.addValue('IDSIIRESAKI',&#x9;KT020_IDSIIRESAKI.value);#EOL#&#x9;cDT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;cDT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;cDT100.addValue('KBKAITORI',&#x9;kbKaitori);#EOL#&#x9;cDT100.addValue('DTTORIHIKI',&#x9;KT020_DTTORIHIKI.value);#EOL#&#x9;cDT100.addValue('IDHINMOKU',&#x9;KT020_IDHINMOKU.value);#EOL#&#x9;cDT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;cDT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;cDT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNITPUR.value);#EOL#&#x9;cDT100.addValue('PRTORIHIKI',&#x9;KT020_PRTORIHIKI.value);#EOL#&#x9;cDT100.addValue('QTTORIHIKI',&#x9;KT020_QTTORIHIKI.value);#EOL#&#x9;cDT100.addValue('AMTORIHIKI',&#x9;KT020_AMTORIHIKI.value);#EOL#&#x9;cDT100.addValue('AMTAX',&#x9;&#x9;KT020_AMTAX.value);#EOL#&#x9;cDT100.addValue('NRSIHARAI',&#x9;'');#EOL#&#x9;cDT100.addValue('NRSOURCE',&#x9;&#x9;KT020_NRSOURCE.value);#EOL#&#x9;cDT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;cDT100.addValue('TXREFNO',&#x9;&#x9;KT020_NRTOKUSIIRE.value);#EOL#&#x9;cDT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;cDT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;count = cDT100.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '仕入実績(DT100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////////////////////// 残高更新 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;rDT010 = instance.createTableOperator('Select', 'DT010');#EOL#&#x9;rDT010.setSelectFields('AMSIIRE, UPDCOUNTER');#EOL#&#x9;rDT010.addKeyValue('IDSIIRESAKI',&#x9;KT020_IDSIIRESAKI.value);#EOL#&#x9;if (rDT010.next()) {#EOL#&#x9;&#x9;amSiireUpdated = Number(rDT010.getValueOf('AMSIIRE'))#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; + Number(amTorihiki) + Number(amTax) - Number(amTorihikiOld) - Number(amTaxOld);#EOL#&#x9;&#x9;uDT010 = instance.createTableOperator('Update', 'DT010');#EOL#&#x9;&#x9;uDT010.addValue('AMSIIRE',&#x9;&#x9;&#x9;amSiireUpdated);#EOL#&#x9;&#x9;uDT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rDT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;uDT010.addKeyValue('IDSIIRESAKI',&#x9;KT020_IDSIIRESAKI.value);#EOL#&#x9;&#x9;uDT010.addKeyValue('UPDCOUNTER',&#x9;rDT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;count = uDT010.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '仕入先(DT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;errorMessage = '仕入先(DT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL##EOL#&#x9;////////////////#EOL#&#x9;// エラー処理 //#EOL#&#x9;////////////////#EOL#&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL#}"/><Script EventP="AC" EventR="" Function="" Name="追加時の在庫更新" Order="0060" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rFT100; var uFT100; var cFT100; var rFT010; var cFT010; var uFT010;#EOL#var amNyuko = 0; var qtNyuko = 0; var amSyukko = 0; var qtSyukko = 0;#EOL#var amNyukoUpdated = 0; var amSyukkoUpdated = 0; var qtNyukoUpdated = 0; var qtSyukkoUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var prUkebarai = 0; var kbUkebarai = ''; var count = 0; var errorMessage = '';#EOL##EOL#//////////////////////////////#EOL#// 年度・月度・取引高の設定 //#EOL#//////////////////////////////#EOL#dtNend = session.getFYearOfDate(KT020_DTTORIHIKI.value);#EOL#dtMSeq = session.getMSeqOfDate(KT020_DTTORIHIKI.value);#EOL#if (KT020_KBTOKUSIIRE.value == '10') {#EOL#&#x9;qtSyukko = KT020_QTTORIHIKI.value * BT010_VLKANZAN.value;#EOL#&#x9;amSyukko = Number(KT020_AMTORIHIKI.value) + Number(KT020_AMTAX.value);#EOL#&#x9;prUkebarai = Math.round(amSyukko / qtSyukko);#EOL#&#x9;kbUkebarai = '140'; //仕入返品//#EOL#}#EOL#if (KT020_KBTOKUSIIRE.value == '20') {#EOL#&#x9;qtNyuko = KT020_QTTORIHIKI.value * BT010_VLKANZAN.value;#EOL#&#x9;amNyuko = Number(KT020_AMTORIHIKI.value) + Number(KT020_AMTAX.value);#EOL#&#x9;prUkebarai = Math.round(amNyuko / qtNyuko);#EOL#&#x9;kbUkebarai = '040'; //直入荷//#EOL#}#EOL##EOL#///////////////////////////#EOL#// 受払実績(ET100)の追加 //#EOL#///////////////////////////#EOL#cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#cFT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#cFT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#cFT100.addValue('KBUKEBARAI',&#x9;kbUkebarai);#EOL#cFT100.addValue('DTTORIHIKI',&#x9;KT020_DTTORIHIKI.value);#EOL#cFT100.addValue('IDHINMOKU',&#x9;KT020_IDHINMOKU.value);#EOL#cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#cFT100.addValue('CDSOUKO',&#x9;&#x9;KT020_CDSOUKO.value);#EOL#cFT100.addValue('TXAITESAKI',&#x9;AT030_TXKANJI.value);#EOL#cFT100.addValue('PRTORIHIKI',&#x9;prUkebarai);#EOL#cFT100.addValue('QTTORIHIKI',&#x9;KT020_QTTORIHIKI.value * BT010_VLKANZAN.value);#EOL#cFT100.addValue('AMTORIHIKI',&#x9;Number(KT020_AMTORIHIKI.value) + Number(KT020_AMTAX.value));#EOL#cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#cFT100.addValue('NRSOURCE',&#x9;&#x9;KT020_NRSOURCE.value);#EOL#cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#cFT100.addValue('TXREFNO',&#x9;&#x9;KT020_NRTOKUSIIRE.value);#EOL#cFT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#count = cFT100.execute();#EOL#if (count != 1) {#EOL#&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#//////////////////////////// 残高更新 //////////////////////////////////#EOL#////////////////////////////////////////////////////////////////////////#EOL#rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#rFT010.setSelectFields('QTKISYU, QTNYUKO, QTSYUKKO, AMKISYU, AMNYUKO, AMSYUKKO, UPDCOUNTER');#EOL#rFT010.addKeyValue('IDHINMOKU',&#x9;KT020_IDHINMOKU.value);#EOL#rFT010.addKeyValue('CDSOUKO',&#x9;KT020_CDSOUKO.value);#EOL#if (rFT010.next()) {#EOL#&#x9;qtNyukoUpdated = Number(rFT010.getValueOf('QTNYUKO')) + Number(qtNyuko);#EOL#&#x9;amNyukoUpdated = Number(rFT010.getValueOf('AMNYUKO')) + Number(amNyuko);#EOL#&#x9;qtSyukkoUpdated = Number(rFT010.getValueOf('QTSYUKKO')) + Number(qtSyukko);#EOL#&#x9;amSyukkoUpdated = Number(rFT010.getValueOf('AMSYUKKO')) + Number(amSyukko);#EOL#&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;uFT010.addValue('AMNYUKO',&#x9;&#x9;&#x9;amNyukoUpdated);#EOL#&#x9;uFT010.addValue('QTNYUKO',&#x9;&#x9;&#x9;qtNyukoUpdated);#EOL#&#x9;uFT010.addValue('AMSYUKKO',&#x9;&#x9;&#x9;amSyukkoUpdated);#EOL#&#x9;uFT010.addValue('QTSYUKKO',&#x9;&#x9;&#x9;qtSyukkoUpdated);#EOL#&#x9;uFT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;KT020_IDHINMOKU.value);#EOL#&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;KT020_CDSOUKO.value);#EOL#&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;count = uFT010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#} else {#EOL#&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;cFT010.addValue('IDHINMOKU',&#x9;KT020_IDHINMOKU.value);#EOL#&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;KT020_CDSOUKO.value);#EOL#&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;0);#EOL#&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;Number(amNyuko));#EOL#&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;Number(amSyukko));#EOL#&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;0);#EOL#&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;Number(qtNyuko));#EOL#&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;Number(qtSyukko));#EOL#&#x9;count = cFT010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL#"/><Script EventP="AD" EventR="" Function="" Name="削除時の在庫更新" Order="0080" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rFT100; var uFT100; var cFT100; var rFT010; var cFT010; var uFT010;#EOL#var amNyukoOld = 0; var qtNyukoOld = 0; var amSyukkoOld = 0; var qtSyukkoOld = 0;#EOL#var amNyukoUpdated = 0; var amSyukkoUpdated = 0; var qtNyukoUpdated = 0; var qtSyukkoUpdated = 0;#EOL#var dtNendOld = 0; var dtMSeqOld = 0; var prUkebarai = 0;#EOL#var kbUkebarai = ''; var count = 0; var errorMessage = '';#EOL##EOL#///////////////////////////////////////#EOL#// 関連する受払実績(FT100)の失効処理 //#EOL#///////////////////////////////////////#EOL#rFT100 = instance.createTableOperator('Select', 'FT100');#EOL#rFT100.setSelectFields('NRZAITORI, UPDCOUNTER');#EOL#rFT100.addKeyValue('NRSOURCE', KT020_NRSOURCE.value);#EOL#while (rFT100.next()) {#EOL#&#x9;uFT100 = instance.createTableOperator('Update', 'FT100');#EOL#&#x9;uFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;uFT100.addValue('UPDCOUNTER',&#x9;Number(rFT100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;uFT100.addKeyValue('NRZAITORI',&#x9;rFT100.getValueOf('NRZAITORI'));#EOL#&#x9;uFT100.addKeyValue('UPDCOUNTER',&#x9;rFT100.getValueOf('UPDCOUNTER'));#EOL#&#x9;count = uFT100.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '受払実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;break;#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL##EOL#//////////////////////////////#EOL#// 年度・月度・取引高の設定 //#EOL#//////////////////////////////#EOL#dtNendOld = session.getFYearOfDate(KT020_DTTORIHIKI.oldValue);#EOL#dtMSeqOld = session.getMSeqOfDate(KT020_DTTORIHIKI.oldValue);#EOL#if (KT020_KBTOKUSIIRE.value == '10') {#EOL#&#x9;qtSyukkoOld = KT020_QTTORIHIKI.oldValue * BT010_VLKANZAN.value;#EOL#&#x9;amSyukkoOld = Number(KT020_AMTORIHIKI.oldValue) + Number(KT020_AMTAX.oldValue);#EOL#&#x9;prUkebarai = Math.round(amSyukkoOld / qtSyukkoOld);#EOL#&#x9;kbUkebarai = '140'; //仕入返品//#EOL#}#EOL#if (KT020_KBTOKUSIIRE.value == '20') {#EOL#&#x9;qtNyukoOld = KT020_QTTORIHIKI.oldValue * BT010_VLKANZAN.value;#EOL#&#x9;amNyukoOld = Number(KT020_AMTORIHIKI.oldValue) + Number(KT020_AMTAX.oldValue);#EOL#&#x9;prUkebarai = Math.round(amNyukoOld / qtNyukoOld);#EOL#&#x9;kbUkebarai = '040'; //直入荷//#EOL#}#EOL##EOL#///////////////////////////#EOL#// 受払実績(FT100)の追加 //#EOL#///////////////////////////#EOL#cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#cFT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#cFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#cFT100.addValue('KBUKEBARAI',&#x9;kbUkebarai);#EOL#cFT100.addValue('DTTORIHIKI',&#x9;KT020_DTTORIHIKI.oldValue);#EOL#cFT100.addValue('IDHINMOKU',&#x9;KT020_IDHINMOKU.value);#EOL#cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#cFT100.addValue('CDSOUKO',&#x9;&#x9;KT020_CDSOUKO.value);#EOL#cFT100.addValue('TXAITESAKI',&#x9;AT030_TXKANJI.value);#EOL#cFT100.addValue('PRTORIHIKI',&#x9;prUkebarai);#EOL#cFT100.addValue('QTTORIHIKI',&#x9;KT020_QTTORIHIKI.oldValue * BT010_VLKANZAN.value);#EOL#cFT100.addValue('AMTORIHIKI',&#x9;Number(KT020_AMTORIHIKI.oldValue) + Number(KT020_AMTAX.oldValue));#EOL#cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#cFT100.addValue('NRSOURCE',&#x9;&#x9;KT020_NRSOURCE.value);#EOL#cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#cFT100.addValue('TXREFNO',&#x9;&#x9;KT020_NRTOKUSIIRE.value);#EOL#cFT100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#count = cFT100.execute();#EOL#if (count != 1) {#EOL#&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#//////////////////////////// 残高更新 //////////////////////////////////#EOL#////////////////////////////////////////////////////////////////////////#EOL#rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#rFT010.setSelectFields('QTKISYU, QTNYUKO, QTSYUKKO, AMKISYU, AMNYUKO, AMSYUKKO, UPDCOUNTER');#EOL#rFT010.addKeyValue('IDHINMOKU',&#x9;KT020_IDHINMOKU.value);#EOL#rFT010.addKeyValue('CDSOUKO',&#x9;KT020_CDSOUKO.value);#EOL#if (rFT010.next()) {#EOL#&#x9;qtNyukoUpdated = Number(rFT010.getValueOf('QTNYUKO')) - Number(qtNyukoOld);#EOL#&#x9;amNyukoUpdated = Number(rFT010.getValueOf('AMNYUKO')) - Number(amNyukoOld);#EOL#&#x9;qtSyukkoUpdated = Number(rFT010.getValueOf('QTSYUKKO')) - Number(qtSyukkoOld);#EOL#&#x9;amSyukkoUpdated = Number(rFT010.getValueOf('AMSYUKKO')) - Number(amSyukkoOld);#EOL#&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;uFT010.addValue('AMNYUKO',&#x9;&#x9;&#x9;amNyukoUpdated);#EOL#&#x9;uFT010.addValue('QTNYUKO',&#x9;&#x9;&#x9;qtNyukoUpdated);#EOL#&#x9;uFT010.addValue('AMSYUKKO',&#x9;&#x9;&#x9;amSyukkoUpdated);#EOL#&#x9;uFT010.addValue('QTSYUKKO',&#x9;&#x9;&#x9;qtSyukkoUpdated);#EOL#&#x9;uFT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;KT020_IDHINMOKU.value);#EOL#&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;KT020_CDSOUKO.value);#EOL#&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;count = uFT010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#} else {#EOL#&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;cFT010.addValue('IDHINMOKU',&#x9;KT020_IDHINMOKU.value);#EOL#&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;KT020_CDSOUKO.value);#EOL#&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;0);#EOL#&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;0 - Number(amNyukoOld));#EOL#&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;0 - Number(amSyukkoOld));#EOL#&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;0);#EOL#&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;0 - Number(qtNyukoOld));#EOL#&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;0 - Number(qtSyukkoOld));#EOL#&#x9;count = cFT010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL#"/><Script EventP="AC" EventR="" Function="" Name="追加時の買掛更新" Order="0090" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rDT100; var uDT100; var cDT100; var rDT010; var uDT010;#EOL#var amTorihiki = 0; var amTax = 0; var amSiireUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var count = 0; var errorMessage = '';#EOL##EOL#//////////////////////////////#EOL#// 年度・月度・取引高の設定 //#EOL#//////////////////////////////#EOL#dtNend = session.getFYearOfDate(KT020_DTTORIHIKI.value);#EOL#dtMSeq = session.getMSeqOfDate(KT020_DTTORIHIKI.value);#EOL#if (KT020_KBTOKUSIIRE.value == '10') {#EOL#&#x9;kbKaitori = '02'; //仕入返品//#EOL#&#x9;amTorihiki = KT020_AMTORIHIKI.value * -1;#EOL#&#x9;amTax = KT020_AMTAX.value * -1;#EOL#}#EOL#if (KT020_KBTOKUSIIRE.value == '20') {#EOL#&#x9;kbKaitori = '01'; //直入荷仕入//#EOL#&#x9;amTorihiki = KT020_AMTORIHIKI.value;#EOL#&#x9;amTax = KT020_AMTAX.value;#EOL#}#EOL##EOL#///////////////////////////#EOL#// 仕入実績(DT100)の追加 //#EOL#///////////////////////////#EOL#cDT100 = instance.createTableOperator('Insert', 'DT100');#EOL#cDT100.addValue('NRKAIKAKE',&#x9;session.getNextNumber('NRKAIKAKE'));#EOL#cDT100.addValue('IDSIIRESAKI',&#x9;KT020_IDSIIRESAKI.value);#EOL#cDT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#cDT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#cDT100.addValue('KBKAITORI',&#x9;kbKaitori);#EOL#cDT100.addValue('DTTORIHIKI',&#x9;KT020_DTTORIHIKI.value);#EOL#cDT100.addValue('IDHINMOKU',&#x9;KT020_IDHINMOKU.value);#EOL#cDT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#cDT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#cDT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNITPUR.value);#EOL#cDT100.addValue('PRTORIHIKI',&#x9;KT020_PRTORIHIKI.value);#EOL#cDT100.addValue('QTTORIHIKI',&#x9;KT020_QTTORIHIKI.value);#EOL#cDT100.addValue('AMTORIHIKI',&#x9;KT020_AMTORIHIKI.value);#EOL#cDT100.addValue('AMTAX',&#x9;&#x9;KT020_AMTAX.value);#EOL#cDT100.addValue('NRSIHARAI',&#x9;'');#EOL#cDT100.addValue('NRSOURCE',&#x9;&#x9;KT020_NRSOURCE.value);#EOL#cDT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#cDT100.addValue('TXREFNO',&#x9;&#x9;KT020_NRTOKUSIIRE.value);#EOL#cDT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#cDT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#count = cDT100.execute();#EOL#if (count != 1) {#EOL#&#x9;errorMessage = '仕入実績(DT100)の登録に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#//////////////////////////// 残高更新 //////////////////////////////////#EOL#////////////////////////////////////////////////////////////////////////#EOL#rDT010 = instance.createTableOperator('Select', 'DT010');#EOL#rDT010.setSelectFields('AMSIIRE, UPDCOUNTER');#EOL#rDT010.addKeyValue('IDSIIRESAKI',&#x9;KT020_IDSIIRESAKI.value);#EOL#if (rDT010.next()) {#EOL#&#x9;amSiireUpdated = Number(rDT010.getValueOf('AMSIIRE')) + Number(amTorihiki) + Number(amTax);#EOL#&#x9;uDT010 = instance.createTableOperator('Update', 'DT010');#EOL#&#x9;uDT010.addValue('AMSIIRE',&#x9;&#x9;&#x9;amSiireUpdated);#EOL#&#x9;uDT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rDT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;uDT010.addKeyValue('IDSIIRESAKI',&#x9;KT020_IDSIIRESAKI.value);#EOL#&#x9;uDT010.addKeyValue('UPDCOUNTER',&#x9;rDT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;count = uDT010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '仕入先(DT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#} else {#EOL#&#x9;errorMessage = '仕入先(DT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}"/><Script EventP="AD" EventR="" Function="" Name="削除時の買掛更新" Order="0110" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rDT100; var uDT100; var cDT100; var rDT010; var uDT010;#EOL#var amTorihikiOld = 0; var amTaxOld = 0; var amSiireUpdated = 0; var fgValid = 'F';#EOL#var dtNendOld = 0; var dtMSeqOld = 0; var count = 0; var errorMessage = '';#EOL##EOL#///////////////////////////////////////#EOL#// 関連する仕入実績(DT100)の失効処理 //#EOL#///////////////////////////////////////#EOL#rDT100 = instance.createTableOperator('Select', 'DT100');#EOL#rDT100.setSelectFields('NRKAIKAKE, NRSIHARAI, UPDCOUNTER');#EOL#rDT100.addKeyValue('NRSOURCE',&#x9;KT020_NRSOURCE.value);#EOL#rDT100.addKeyValue('FGVALID',&#x9;'T');#EOL#while (rDT100.next()) {#EOL#&#x9;if (rDT100.getValueOf('NRSIHARAI') == '') {#EOL#&#x9;&#x9;uDT100 = instance.createTableOperator('Update', 'DT100');#EOL#&#x9;&#x9;uDT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;uDT100.addValue('UPDCOUNTER',&#x9;Number(rDT100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;uDT100.addKeyValue('NRKAIKAKE',&#x9;&#x9;rDT100.getValueOf('NRKAIKAKE'));#EOL#&#x9;&#x9;uDT100.addKeyValue('UPDCOUNTER',&#x9;rDT100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;count = uDT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '仕入実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;fgValid = 'T';#EOL#&#x9;}#EOL#}#EOL##EOL#//////////////////////////////#EOL#// 年度・月度・取引高の設定 //#EOL#//////////////////////////////#EOL#dtNendOld = session.getFYearOfDate(KT020_DTTORIHIKI.oldValue);#EOL#dtMSeqOld = session.getMSeqOfDate(KT020_DTTORIHIKI.oldValue);#EOL#if (KT020_KBTOKUSIIRE.value == '10') {#EOL#&#x9;kbKaitori = '02'; //仕入返品//#EOL#&#x9;amTorihikiOld = KT020_AMTORIHIKI.oldValue * -1;#EOL#&#x9;amTaxOld = KT020_AMTAX.oldValue * -1;#EOL#}#EOL#if (KT020_KBTOKUSIIRE.value == '20') {#EOL#&#x9;kbKaitori = '01'; //直入荷仕入//#EOL#&#x9;amTorihikiOld = KT020_AMTORIHIKI.oldValue;#EOL#&#x9;amTaxOld = KT020_AMTAX.oldValue;#EOL#}#EOL##EOL#///////////////////////////#EOL#// 仕入実績(DT100)の追加 //#EOL#///////////////////////////#EOL#cDT100 = instance.createTableOperator('Insert', 'DT100');#EOL#cDT100.addValue('NRKAIKAKE',&#x9;session.getNextNumber('NRKAIKAKE'));#EOL#cDT100.addValue('IDSIIRESAKI',&#x9;KT020_IDSIIRESAKI.value);#EOL#cDT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#cDT100.addValue('FGVALID',&#x9;&#x9;fgValid);#EOL#cDT100.addValue('KBKAITORI',&#x9;kbKaitori);#EOL#cDT100.addValue('DTTORIHIKI',&#x9;KT020_DTTORIHIKI.oldValue);#EOL#cDT100.addValue('IDHINMOKU',&#x9;KT020_IDHINMOKU.value);#EOL#cDT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#cDT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#cDT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNITPUR.value);#EOL#cDT100.addValue('PRTORIHIKI',&#x9;KT020_PRTORIHIKI.oldValue);#EOL#cDT100.addValue('QTTORIHIKI',&#x9;KT020_QTTORIHIKI.oldValue);#EOL#cDT100.addValue('AMTORIHIKI',&#x9;KT020_AMTORIHIKI.oldValue);#EOL#cDT100.addValue('AMTAX',&#x9;&#x9;KT020_AMTAX.oldValue);#EOL#cDT100.addValue('NRSIHARAI',&#x9;'');#EOL#cDT100.addValue('NRSOURCE',&#x9;&#x9;KT020_NRSOURCE.value);#EOL#cDT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#cDT100.addValue('TXREFNO',&#x9;&#x9;KT020_NRTOKUSIIRE.value);#EOL#cDT100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#cDT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#count = cDT100.execute();#EOL#if (count != 1) {#EOL#&#x9;errorMessage = '仕入実績(DT100)の登録に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#//////////////////////////// 残高更新 //////////////////////////////////#EOL#////////////////////////////////////////////////////////////////////////#EOL#rDT010 = instance.createTableOperator('Select', 'DT010');#EOL#rDT010.setSelectFields('AMSIIRE, UPDCOUNTER');#EOL#rDT010.addKeyValue('IDSIIRESAKI',&#x9;KT020_IDSIIRESAKI.value);#EOL#if (rDT010.next()) {#EOL#&#x9;amSiireUpdated = Number(rDT010.getValueOf('AMSIIRE')) - Number(amTorihikiOld) - Number(amTaxOld);#EOL#&#x9;uDT010 = instance.createTableOperator('Update', 'DT010');#EOL#&#x9;uDT010.addValue('AMSIIRE',&#x9;&#x9;&#x9;amSiireUpdated);#EOL#&#x9;uDT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rDT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;uDT010.addKeyValue('IDSIIRESAKI',&#x9;KT020_IDSIIRESAKI.value);#EOL#&#x9;uDT010.addKeyValue('UPDCOUNTER',&#x9;rDT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;count = uDT010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '仕入先(DT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#} else {#EOL#&#x9;errorMessage = '仕入先(DT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}"/><Script EventP="BU;BD;AR" EventR="AR()" Function="" Name="仮想フィールドの設定" Order="0030" Text="////////////////#EOL#// 在庫換算数 //#EOL#////////////////#EOL#KT020_QTZAIKO.value = KT020_QTTORIHIKI.value * BT010_VLKANZAN.value;#EOL#KT020_QTZAIKO.oldValue = KT020_QTTORIHIKI.oldValue * BT010_VLKANZAN.value;#EOL#KT020_QTZAIKO.editable = false;#EOL##EOL#//////////////////////#EOL#// 取引額と消費税額 //#EOL#//////////////////////#EOL#KT020_AMTORIHIKI.value = KT020_QTTORIHIKI.value * KT020_PRTORIHIKI.value;#EOL#KT020_AMTAX.value = session.getTaxAmount(KT020_DTTORIHIKI.value + '', KT020_AMTORIHIKI.value);#EOL#KT020_AMTORIHIKI.oldValue = KT020_QTTORIHIKI.oldValue * KT020_PRTORIHIKI.oldValue;#EOL#KT020_AMTAX.oldValue = session.getTaxAmount(KT020_DTTORIHIKI.oldValue + '', KT020_AMTORIHIKI.oldValue);#EOL#KT020_AMTORIHIKI.editable = false;#EOL#KT020_AMTAX.editable = false;"/><Script EventP="AR" EventR="BR()" Function="" Name="機能キーの無効化(KF023)" Order="0050" Text="if (instance.functionID == 'KF023') {#EOL#&#x9;if (KT020_KBTOKUSIIRE.value == '20') {#EOL#&#x9;&#x9;instance.parmMap.put('DISABLED_BUTTON_LIST', '10'); //F10:返品通知書の発行//#EOL#&#x9;}#EOL#}"/><Field Decimal="" ID="QTZAIKO" Name="在庫換算数" NoUpdate="T" Nullable="F" Order="0141" Remarks="仕入単位での取引数量と在庫換算係数より算出される" Size="7" Type="INTEGER" TypeOptions="VIRTUAL"/><Script EventP="BC;BU;BD" EventR="BR()" Function="" Name="会計日付の妥当性検査" Order="0040" Text="KT020_DTTORIHIKI.error = session.getErrorOfAccountDate(KT020_DTTORIHIKI.value);"/></Table><Table ID="HT010" Name="発注見出し" Remarks="仕入先に対する発注のまとまりを管理するためのテーブル" SubsystemID="H"><Field Decimal="" ID="NRHATTYU" Name="発注№" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRHATTYU)"/><Field Decimal="" ID="IDSIIRESAKI" Name="仕入先ID" NoUpdate="T" Nullable="F" Order="0020" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="DTHATTYU" Name="発注日" NoUpdate="T" Nullable="T" Order="0050" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="" ID="CDSOUKO" Name="倉庫Ｃ" Nullable="F" Order="0060" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Key Fields="NRHATTYU" Type="PK"/><Refer Fields="CDTORIHIKISAKI;TXKANJI" Order="0010" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="HT010.IDSIIRESAKI"/><Refer Fields="TXSOUKO;NRYUBIN;TXJYUSYO1;TXJYUSYO2" Order="0020" OrderBy="" TableAlias="" ToKeyFields="CDSOUKO" ToTable="AT040" WithKeyFields="HT010.CDSOUKO"/><Field Decimal="" ID="STHATTYU" Name="発注状況" NoUpdate="T" Nullable="F" Order="0080" Remarks="" Size="2" Type="CHAR" TypeOptions="VIRTUAL,KUBUN(STHATTYU)"/><Field Decimal="" ID="DTCREATE" Name="登録日" NoUpdate="T" Nullable="F" Order="0030" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="" ID="DTNOUKI" Name="希望納期" NoUpdate="T" Nullable="F" Order="0040" Remarks="発注明細上の希望納期の初期値として扱われる。" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="" ID="TXTEKIYO" Name="摘要" Nullable="T" Order="0070" Remarks="" Size="300" Type="VARCHAR" TypeOptions="KANJI"/><Script EventP="AR" EventR="AR()" Function="" Name="発注状況の設定" Order="0010" Text="if (HT010_DTHATTYU.value == '') {#EOL#&#x9;HT010_STHATTYU.value = '10'; //未発行//#EOL#} else {#EOL#&#x9;HT010_STHATTYU.value = '20'; //発行済//#EOL#}#EOL##EOL#var countOfMeisai = 0;#EOL#var countOfNyukazumi = 0;#EOL#var rHT011 = instance.createTableOperator('Select', 'HT011');#EOL#rHT011.addKeyValue('NRHATTYU',&#x9;HT010_NRHATTYU.value);#EOL#while (rHT011.next()) {#EOL#&#x9;countOfMeisai++;#EOL#&#x9;if (rHT011.getValueOf('NRNYUKA') != '') {#EOL#&#x9;&#x9;countOfNyukazumi++;#EOL#&#x9;}#EOL#}#EOL#if (countOfNyukazumi > 0) {#EOL#&#x9;if (countOfNyukazumi == countOfMeisai) {#EOL#&#x9;&#x9;HT010_STHATTYU.value = '40'; //入荷完了//#EOL#&#x9;} else {#EOL#&#x9;&#x9;HT010_STHATTYU.value = '30'; //一部入荷//#EOL#&#x9;}#EOL#}#EOL##EOL#HT010_STHATTYU.editable = false;#EOL#"/><Script EventP="AC" EventR="" Function="" Name="追加後の関連データ設定" Order="0030" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rBT010; var rHT011; var cHT011;&#x9;var sqHattyu = 1;#EOL##EOL#//////////////////////////////////////////////////#EOL#// マスターを使って明細データをセットアップする //#EOL#//////////////////////////////////////////////////#EOL#if (instance.parmMap.get('NRHATTYU') == null) {#EOL##EOL#&#x9;////////////////////////#EOL#&#x9;// 品目マスターを検索 //#EOL#&#x9;////////////////////////#EOL#&#x9;var sqHattyu = 1;#EOL#&#x9;rBT010 = instance.createTableOperator('Select', 'BT010');#EOL#&#x9;rBT010.addKeyValue('IDSIIRESAKI',&#x9;HT010_IDSIIRESAKI.value);#EOL#&#x9;while (rBT010.next()) {#EOL#&#x9;&#x9;cHT011 = instance.createTableOperator('Insert', 'HT011');#EOL#&#x9;&#x9;cHT011.addValue('NRHATTYU',&#x9;&#x9;HT010_NRHATTYU.value);#EOL#&#x9;&#x9;cHT011.addValue('SQHATTYU',&#x9;&#x9;sqHattyu++);#EOL#&#x9;&#x9;cHT011.addValue('IDHINMOKU',&#x9;rBT010.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;cHT011.addValue('PRHATTYU',&#x9;&#x9;rBT010.getValueOf('PRKOUNYU'));#EOL#&#x9;&#x9;cHT011.addValue('QTHATTYU',&#x9;&#x9;0);#EOL#&#x9;&#x9;cHT011.addValue('DTNOUKI',&#x9;&#x9;HT010_DTNOUKI.value);#EOL#&#x9;&#x9;cHT011.addValue('NRNYUKA',&#x9;&#x9;'');#EOL#&#x9;&#x9;cHT011.addValue('NRSOURCE',&#x9;&#x9;session.getNextNumber('NRSOURCE'));#EOL#&#x9;&#x9;cHT011.execute();#EOL#&#x9;}#EOL##EOL#////////////////////////////////////////#EOL#// 複写元発注№で明細データを複写する //#EOL#////////////////////////////////////////#EOL#} else {#EOL##EOL#&#x9;//////////////////////////#EOL#&#x9;// 発注明細を検索・複写 //#EOL#&#x9;//////////////////////////#EOL#&#x9;rHT011 = instance.createTableOperator('Select', 'HT011');#EOL#&#x9;rHT011.addKeyValue('NRHATTYU',&#x9;instance.parmMap.get('NRHATTYU'));#EOL#&#x9;while (rHT011.next()) {#EOL#&#x9;&#x9;cHT011 = instance.createTableOperator('Insert', 'HT011');#EOL#&#x9;&#x9;cHT011.addValue('NRHATTYU',&#x9;&#x9;HT010_NRHATTYU.value);#EOL#&#x9;&#x9;cHT011.addValue('SQHATTYU',&#x9;&#x9;rHT011.getValueOf('SQHATTYU'));#EOL#&#x9;&#x9;cHT011.addValue('IDHINMOKU',&#x9;rHT011.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;cHT011.addValue('PRHATTYU',&#x9;&#x9;rHT011.getValueOf('PRHATTYU'));#EOL#&#x9;&#x9;cHT011.addValue('QTHATTYU',&#x9;&#x9;rHT011.getValueOf('QTHATTYU'));#EOL#&#x9;&#x9;cHT011.addValue('DTNOUKI',&#x9;&#x9;HT010_DTNOUKI.value);#EOL#&#x9;&#x9;cHT011.addValue('NRNYUKA',&#x9;&#x9;'');#EOL#&#x9;&#x9;cHT011.addValue('NRSOURCE',&#x9;&#x9;session.getNextNumber('NRSOURCE'));#EOL#&#x9;&#x9;cHT011.execute();#EOL#&#x9;}#EOL#}"/><Script EventP="BC" EventR="BR()" Function="" Name="追加前設定" Order="0020" Text="HT010_DTCREATE.value = session.today + '';#EOL#HT010_DTCREATE.editable = false;#EOL#HT010_STHATTYU.editable = false;#EOL#HT010_DTHATTYU.editable = false;"/><Script EventP="BR" EventR="" Function="" Name="指示書発行にともなう更新(HF015)" Order="0050" Text="if (instance.functionID == 'HF015') {#EOL#&#x9;if (HT010_DTHATTYU.value == '') {#EOL#&#x9;&#x9;var uHT010 = instance.createTableOperator('Update', 'HT010');#EOL#&#x9;&#x9;uHT010.addKeyValue('NRHATTYU',&#x9;HT010_NRHATTYU.value);#EOL#&#x9;&#x9;uHT010.addValue('DTHATTYU',&#x9;session.today + '');#EOL#&#x9;&#x9;uHT010.execute();#EOL#&#x9;&#x9;instance.returnMap.put('RETURN_CODE', '20');#EOL#&#x9;}#EOL#}"/></Table><Table ID="FT010" Name="倉庫在庫" Remarks="品目＋倉庫別の在庫を保持するためのテーブル。在庫単位での数量と在庫金額とが管理される。" SubsystemID="F"><Field Decimal="" ID="IDHINMOKU" Name="品目ID" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="CDSOUKO" Name="倉庫Ｃ" Nullable="F" Order="0020" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="AMKISYU" Name="期首在庫額" Nullable="T" Order="0060" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMSYUKKO" Name="期間出庫額" Nullable="T" Order="0080" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMNYUKO" Name="期間入庫額" Nullable="T" Order="0070" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTKISYU" Name="期首在庫数" Nullable="T" Order="0030" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTSYUKKO" Name="期間出庫数" Nullable="T" Order="0050" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTNYUKO" Name="期間入庫数" Nullable="T" Order="0040" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMGENZAIKO" Name="現在庫額" Nullable="T" Order="0100" Remarks="" Size="9" Type="INTEGER" TypeOptions="VIRTUAL"/><Field Decimal="" ID="QTGENZAIKO" Name="現在庫数" Nullable="T" Order="0090" Remarks="" Size="9" Type="INTEGER" TypeOptions="VIRTUAL"/><Key Fields="IDHINMOKU;CDSOUKO" Type="PK"/><Refer Fields="TXHINBAN;TXHINMEI;KBUNIT" Order="0010" OrderBy="" TableAlias="" ToKeyFields="IDHINMOKU" ToTable="BT010" WithKeyFields="FT010.IDHINMOKU"/><Refer Fields="TXSOUKO" Order="0020" OrderBy="" TableAlias="" ToKeyFields="CDSOUKO" ToTable="AT040" WithKeyFields="FT010.CDSOUKO"/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールドの設定" Order="0000" Text="FT010_QTGENZAIKO.value = Number(FT010_QTKISYU.value) + Number(FT010_QTNYUKO.value) - FT010_QTSYUKKO.value;#EOL#FT010_AMGENZAIKO.value = Number(FT010_AMKISYU.value) + Number(FT010_AMNYUKO.value) - FT010_AMSYUKKO.value;#EOL#if (FT010_QTGENZAIKO.value != 0) {#EOL#&#x9;FT010_PRGENZAIKO.value = Math.round(FT010_AMGENZAIKO.value / FT010_QTGENZAIKO.value);#EOL#}"/><Field Decimal="" ID="PRGENZAIKO" Name="現在庫単価" Nullable="T" Order="0110" Remarks="" Size="9" Type="INTEGER" TypeOptions="VIRTUAL"/><Script EventP="BD" EventR="BR()" Function="" Name="削除チェック" Order="0010" Text="if (FT010_AMGENZAIKO.value != 0 || FT010_QTGENZAIKO.value != 0) {#EOL#&#x9;FT010_IDHINMOKU.error = '現在庫数か現在庫額がゼロでないため、削除できません';#EOL#}"/></Table><Table DetailRowNumberAuto="T" ID="HT011" Name="発注明細" Remarks="発注における品目毎の情報を管理するためのテーブル。入荷・検収されることで仕入と受払が計上される。" SubsystemID="H"><Field Decimal="" ID="NRHATTYU" Name="発注№" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="SQHATTYU" Name="発注行番" Nullable="F" Order="0020" Remarks="" Size="3" Type="SMALLINT" TypeOptions=""/><Field Decimal="" ID="IDHINMOKU" Name="品目ID" NoUpdate="T" Nullable="F" Order="0030" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="PRHATTYU" Name="発注単価" Nullable="T" Order="0040" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTHATTYU" Name="発注数" Nullable="T" Order="0050" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="DTNOUKI" Name="希望納期" Nullable="F" Order="0070" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Key Fields="NRHATTYU;SQHATTYU" Type="PK"/><Field Decimal="" ID="NRSOURCE" Name="取引ソース№" NoUpdate="T" Nullable="F" Order="0090" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRSOURCE)"/><Field Decimal="" ID="NRNYUKA" Name="入荷№" NoUpdate="T" Nullable="T" Order="0080" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Refer Fields="TXHINBAN;TXHINMEI;KBUNITPUR;KBUNIT;VLKANZAN" Order="0030" OrderBy="" TableAlias="" ToKeyFields="IDHINMOKU" ToTable="BT010" WithKeyFields="HT011.IDHINMOKU"/><Field Decimal="" ID="QTKANZAN" Name="在庫換算数" NoUpdate="T" Nullable="T" Order="0100" Remarks="入荷数を在庫数に換算した値" Size="7" Type="INTEGER" TypeOptions="VIRTUAL"/><Key Fields="NRSOURCE" Type="SK"/><Script EventP="BC;BU" EventR="AR()" Function="" Name="追加・変更時の設定と検査" Order="0020" Text="if (HT011_PRHATTYU.value == 0) {#EOL#&#x9;HT011_PRHATTYU.error = '何らかの値を入力してください。';#EOL#}#EOL#if (HT011_QTHATTYU.value == 0) {#EOL#&#x9;HT011_QTHATTYU.error = '何らかの値を入力してください。';#EOL#}#EOL#if (HT011_DTNOUKI.value == '') {#EOL#&#x9;HT011_DTNOUKI.value = HT010_DTNOUKI.value;#EOL#}#EOL#if (instance.functionID == 'HF021B') {#EOL#&#x9;HT011_DTNOUKI.editable = false;#EOL#&#x9;HT011_QTHATTYU.editable = false;#EOL#}#EOL#if (instance.functionID == 'HF023') {#EOL#&#x9;HT011_QTHATTYU.editable = false;#EOL#}"/><Refer Fields="IDSIIRESAKI;CDSOUKO;DTNOUKI" Order="0040" OrderBy="" TableAlias="" ToKeyFields="NRHATTYU" ToTable="HT010" WithKeyFields="HT011.NRHATTYU"/><Refer Fields="TXKANJI;CDTORIHIKISAKI" Order="0050" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="HT010.IDSIIRESAKI"/><Refer Fields="TXSOUKO" Order="0060" OrderBy="" TableAlias="" ToKeyFields="CDSOUKO" ToTable="AT040" WithKeyFields="HT010.CDSOUKO"/><Refer Fields="DTNYUKA;DTKENSYU;CDSOUKO" Order="0070" OrderBy="" TableAlias="" ToKeyFields="NRNYUKA" ToTable="HT020" WithKeyFields="HT011.NRNYUKA"/><Field ID="DUMMY" Name="ダミー" Nullable="F" Order="0110" Remarks="倉入指示書用のダミー項目" Size="10" Type="CHAR" TypeOptions="VIRTUAL"/><Script EventP="AU" EventR="" Function="" Name="仕入入庫にともなう在庫更新(HF023)" Order="0040" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rFT100; var uFT100; var cFT100; var rFT010; var cFT010; var uFT010;#EOL#var amUkebarai = 0; var prUkebarai = 0; var amNyuko = 0; var amSyukko = 0;#EOL#var qtUkebarai = 0; var qtNyuko = 0; var qtSyukko = 0;#EOL#var qtUkebaraiOld = 0; var amUkebaraiOld = 0; var prUkebaraiOld = 0;#EOL#var qtUkebaraiSagaku = 0; var amUkebaraiSagaku = 0;#EOL#var amNyukoUpdated = 0; var amSyukkoUpdated = 0;#EOL#var qtNyukoUpdated = 0; var qtSyukkoUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var dtNendOld = 0; var dtMSeqOld = 0;#EOL#var genka = 0; var count = 0; var errorMessage = '';#EOL##EOL#/////////////////////////////////////////////////////#EOL#// 入荷実績エントリー(HF023)で処理された場合に実行 //#EOL#/////////////////////////////////////////////////////#EOL#if (instance.functionID == 'HF023') {#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;////////////////// 仕入入庫の赤伝処理 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;if ((HT011_QTKENSYU.oldValue != 0 &amp;&amp; HT011_QTKENSYU.valueChanged)#EOL#&#x9;&#x9;|| (HT020_DTKENSYU.oldValue != '' &amp;&amp; HT020_DTKENSYU.valueChanged)) {#EOL##EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;// 関連する受払実績(FT100)の失効処理 //#EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;rFT100 = instance.createTableOperator('Select', 'FT100');#EOL#&#x9;&#x9;rFT100.setSelectFields('NRZAITORI, UPDCOUNTER');#EOL#&#x9;&#x9;rFT100.addKeyValue('NRSOURCE', HT011_NRSOURCE.value);#EOL#&#x9;&#x9;while (rFT100.next()) {#EOL#&#x9;&#x9;&#x9;uFT100 = instance.createTableOperator('Update', 'FT100');#EOL#&#x9;&#x9;&#x9;uFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;&#x9;uFT100.addValue('UPDCOUNTER',&#x9;Number(rFT100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;uFT100.addKeyValue('NRZAITORI',&#x9;rFT100.getValueOf('NRZAITORI'));#EOL#&#x9;&#x9;&#x9;uFT100.addKeyValue('UPDCOUNTER',&#x9;rFT100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;count = uFT100.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '受払実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNendOld = session.getFYearOfDate(HT020_DTKENSYU.oldValue);#EOL#&#x9;&#x9;dtMSeqOld = session.getMSeqOfDate(HT020_DTKENSYU.oldValue);#EOL#&#x9;&#x9;qtUkebaraiOld = HT011_QTKENSYU.oldValue * BT010_VLKANZAN.value;#EOL#&#x9;&#x9;amUkebaraiOld = qtUkebaraiOld * HT011_PRHATTYU.value + HT011_AMTAX.oldValue;#EOL#&#x9;&#x9;prUkebaraiOld = Math.round(amUkebaraiOld / qtUkebaraiOld);#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 受払実績(FT100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;cFT100.addValue('KBUKEBARAI',&#x9;'030'); //仕入入庫//#EOL#&#x9;&#x9;cFT100.addValue('KBZAIHURI',&#x9;'');#EOL#&#x9;&#x9;cFT100.addValue('DTTORIHIKI',&#x9;HT020_DTKENSYU.oldValue);#EOL#&#x9;&#x9;cFT100.addValue('IDHINMOKU',&#x9;HT011_IDHINMOKU.value);#EOL#&#x9;&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNITPUR.value);#EOL#&#x9;&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;HT020_CDSOUKO.value);#EOL#&#x9;&#x9;cFT100.addValue('TXAITESAKI',&#x9;AT030_TXKANJI.value);#EOL#&#x9;&#x9;cFT100.addValue('PRTORIHIKI',&#x9;prUkebaraiOld);#EOL#&#x9;&#x9;cFT100.addValue('QTTORIHIKI',&#x9;qtUkebaraiOld);#EOL#&#x9;&#x9;cFT100.addValue('AMTORIHIKI',&#x9;amUkebaraiOld);#EOL#&#x9;&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#&#x9;&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;HT011_NRSOURCE.value);#EOL#&#x9;&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;HT011_NRHATTYU.value + '-' + HT011_SQHATTYU.value);#EOL#&#x9;&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#&#x9;&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#&#x9;&#x9;count = cFT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;////////////////// 仕入入庫の黒伝処理 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;if ((HT011_QTKENSYU.value != 0 &amp;&amp; HT011_QTKENSYU.valueChanged)#EOL#&#x9;&#x9;|| (HT020_DTKENSYU.value != '' &amp;&amp; HT020_DTKENSYU.valueChanged)) {#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNend = session.getFYearOfDate(HT020_DTKENSYU.value);#EOL#&#x9;&#x9;dtMSeq = session.getMSeqOfDate(HT020_DTKENSYU.value);#EOL#&#x9;&#x9;qtUkebarai = HT011_QTKENSYU.value * BT010_VLKANZAN.value;#EOL#&#x9;&#x9;amUkebarai = (qtUkebarai * HT011_PRHATTYU.value) + Number(HT011_AMTAX.value);#EOL#&#x9;&#x9;prUkebarai = Math.round(amUkebarai / qtUkebarai);#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 受払実績(ET100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;&#x9;cFT100.addValue('KBUKEBARAI',&#x9;'030'); //仕入入庫//#EOL#&#x9;&#x9;cFT100.addValue('KBZAIHURI',&#x9;'');#EOL#&#x9;&#x9;cFT100.addValue('DTTORIHIKI',&#x9;HT020_DTKENSYU.value);#EOL#&#x9;&#x9;cFT100.addValue('IDHINMOKU',&#x9;HT011_IDHINMOKU.value);#EOL#&#x9;&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNITPUR.value);#EOL#&#x9;&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;HT020_CDSOUKO.value);#EOL#&#x9;&#x9;cFT100.addValue('TXAITESAKI',&#x9;AT030_TXKANJI.value);#EOL#&#x9;&#x9;cFT100.addValue('PRTORIHIKI',&#x9;prUkebarai);#EOL#&#x9;&#x9;cFT100.addValue('QTTORIHIKI',&#x9;qtUkebarai);#EOL#&#x9;&#x9;cFT100.addValue('AMTORIHIKI',&#x9;amUkebarai);#EOL#&#x9;&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#&#x9;&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;HT011_NRSOURCE.value);#EOL#&#x9;&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;HT011_NRHATTYU.value + '-' + HT011_SQHATTYU.value);#EOL#&#x9;&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;count = cFT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;}#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////////////////////// 残高更新 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;qtUkebaraiSagaku = Number(qtUkebarai) - Number(qtUkebaraiOld);#EOL#&#x9;amUkebaraiSagaku = Number(amUkebarai) - Number(amUkebaraiOld);#EOL#&#x9;if (qtUkebaraiSagaku != 0 || amUkebaraiSagaku != 0) {#EOL##EOL#&#x9;&#x9;rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#&#x9;&#x9;rFT010.setSelectFields('QTKISYU, QTNYUKO, QTSYUKKO, AMKISYU, AMNYUKO, AMSYUKKO, UPDCOUNTER');#EOL#&#x9;&#x9;rFT010.addKeyValue('IDHINMOKU',&#x9;HT011_IDHINMOKU.value);#EOL#&#x9;&#x9;rFT010.addKeyValue('CDSOUKO',&#x9;HT020_CDSOUKO.value);#EOL#&#x9;&#x9;if (rFT010.next()) {#EOL#&#x9;&#x9;&#x9;qtNyukoUpdated = Number(rFT010.getValueOf('QTNYUKO')) + Number(qtUkebaraiSagaku);#EOL#&#x9;&#x9;&#x9;amNyukoUpdated = Number(rFT010.getValueOf('AMNYUKO')) + Number(amUkebaraiSagaku);#EOL#&#x9;&#x9;&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;&#x9;&#x9;uFT010.addValue('AMNYUKO',&#x9;&#x9;&#x9;amNyukoUpdated);#EOL#&#x9;&#x9;&#x9;uFT010.addValue('QTNYUKO',&#x9;&#x9;&#x9;qtNyukoUpdated);#EOL#&#x9;&#x9;&#x9;uFT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + Number(1));#EOL#&#x9;&#x9;&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;HT011_IDHINMOKU.value);#EOL#&#x9;&#x9;&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;HT020_CDSOUKO.value);#EOL#&#x9;&#x9;&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;count = uFT010.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;&#x9;&#x9;cFT010.addValue('IDHINMOKU',&#x9;HT011_IDHINMOKU.value);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;HT020_CDSOUKO.value);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;amUkebaraiSagaku);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;qtUkebaraiSagaku);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;count = cFT010.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////#EOL#&#x9;// エラー処理 //#EOL#&#x9;////////////////#EOL#&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL#}"/><Script EventP="AU" EventR="" Function="" Name="入荷仕入にともなう買掛更新(HF023)" Order="0050" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rDT100; var uDT100; var cDT100; var rDT010; var uDT010;#EOL#var amTorihiki = 0; var amTorihikiOld = 0;#EOL#var amTax = 0; var amTaxOld = 0;#EOL#var amSiireUpdated = 0; var amSiireUpdated = 0; var amSiireSagaku = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var dtNendOld = 0; var dtMSeqOld = 0;#EOL#var count = 0; var errorMessage = ''; var fgValid = 'F';#EOL##EOL#/////////////////////////////////////////////////////#EOL#// 入荷実績エントリー(HF023)で処理された場合に実行 //#EOL#/////////////////////////////////////////////////////#EOL#if (instance.functionID == 'HF023') {#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;/////////////////////// 入荷仕入の赤伝処理 /////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;if ((HT011_QTKENSYU.oldValue != 0 &amp;&amp; HT011_QTKENSYU.valueChanged)#EOL#&#x9;&#x9;|| (HT020_DTKENSYU.oldValue != '' &amp;&amp; HT020_DTKENSYU.valueChanged)#EOL#&#x9;&#x9;|| (HT011_PRHATTYU.oldValue != 0 &amp;&amp; HT011_PRHATTYU.valueChanged)) {#EOL##EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;// 関連する仕入実績(DT100)の失効処理 //#EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;rDT100 = instance.createTableOperator('Select', 'DT100');#EOL#&#x9;&#x9;rDT100.setSelectFields('NRKAIKAKE, NRSIHARAI, UPDCOUNTER');#EOL#&#x9;&#x9;rDT100.addKeyValue('NRSOURCE',&#x9;HT011_NRSOURCE.value);#EOL#&#x9;&#x9;rDT100.addKeyValue('FGVALID',&#x9;'T');#EOL#&#x9;&#x9;while (rDT100.next()) {#EOL#&#x9;&#x9;&#x9;if (rDT100.getValueOf('NRSIHARAI') == '') {#EOL#&#x9;&#x9;&#x9;&#x9;uDT100 = instance.createTableOperator('Update', 'DT100');#EOL#&#x9;&#x9;&#x9;&#x9;uDT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;&#x9;&#x9;uDT100.addValue('UPDCOUNTER',&#x9;Number(rDT100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;&#x9;uDT100.addKeyValue('NRKAIKAKE',&#x9;&#x9;rDT100.getValueOf('NRKAIKAKE'));#EOL#&#x9;&#x9;&#x9;&#x9;uDT100.addKeyValue('UPDCOUNTER',&#x9;rDT100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;&#x9;count = uDT100.execute();#EOL#&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '仕入実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;fgValid = 'T';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNendOld = session.getFYearOfDate(HT020_DTKENSYU.oldValue);#EOL#&#x9;&#x9;dtMSeqOld = session.getMSeqOfDate(HT020_DTKENSYU.oldValue);#EOL#&#x9;&#x9;amTorihikiOld = HT011_QTKENSYU.oldValue * HT011_PRHATTYU.oldValue;#EOL#&#x9;&#x9;amTaxOld = session.getTaxAmount(HT020_DTKENSYU.oldValue + '', amTorihikiOld);#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 仕入実績(DT100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cDT100 = instance.createTableOperator('Insert', 'DT100');#EOL#&#x9;&#x9;cDT100.addValue('NRKAIKAKE',&#x9;session.getNextNumber('NRKAIKAKE'));#EOL#&#x9;&#x9;cDT100.addValue('IDSIIRESAKI',&#x9;HT010_IDSIIRESAKI.value);#EOL#&#x9;&#x9;cDT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;&#x9;cDT100.addValue('FGVALID',&#x9;&#x9;fgValid);#EOL#&#x9;&#x9;cDT100.addValue('KBKAITORI',&#x9;'00'); //入荷仕入//#EOL#&#x9;&#x9;cDT100.addValue('KBKAIHURI',&#x9;'');#EOL#&#x9;&#x9;cDT100.addValue('DTTORIHIKI',&#x9;HT020_DTKENSYU.oldValue);#EOL#&#x9;&#x9;cDT100.addValue('IDHINMOKU',&#x9;HT011_IDHINMOKU.value);#EOL#&#x9;&#x9;cDT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;&#x9;cDT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;&#x9;cDT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNITPUR.value);#EOL#&#x9;&#x9;cDT100.addValue('PRTORIHIKI',&#x9;HT011_PRHATTYU.oldValue);#EOL#&#x9;&#x9;cDT100.addValue('QTTORIHIKI',&#x9;HT011_QTKENSYU.oldValue);#EOL#&#x9;&#x9;cDT100.addValue('AMTORIHIKI',&#x9;amTorihikiOld);#EOL#&#x9;&#x9;cDT100.addValue('AMTAX',&#x9;&#x9;amTaxOld);#EOL#&#x9;&#x9;cDT100.addValue('NRSIHARAI',&#x9;'');#EOL#&#x9;&#x9;cDT100.addValue('NRSOURCE',&#x9;&#x9;HT011_NRSOURCE.value);#EOL#&#x9;&#x9;cDT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cDT100.addValue('TXREFNO',&#x9;&#x9;HT011_NRHATTYU.value + '-' + HT011_SQHATTYU.value);#EOL#&#x9;&#x9;cDT100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#&#x9;&#x9;cDT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#&#x9;&#x9;count = cDT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '仕入実績(DT100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;/////////////////////// 出荷売上の黒伝処理 /////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;if ((HT011_QTKENSYU.value != 0 &amp;&amp; HT011_QTKENSYU.valueChanged)#EOL#&#x9;&#x9;|| (HT020_DTKENSYU.value != '' &amp;&amp; HT020_DTKENSYU.valueChanged)#EOL#&#x9;&#x9;|| (HT011_PRHATTYU.value != 0 &amp;&amp; HT011_PRHATTYU.valueChanged)) {#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNend = session.getFYearOfDate(HT020_DTKENSYU.value);#EOL#&#x9;&#x9;dtMSeq = session.getMSeqOfDate(HT020_DTKENSYU.value);#EOL#&#x9;&#x9;amTorihiki = HT011_QTKENSYU.value * HT011_PRHATTYU.value;#EOL#&#x9;&#x9;amTax = session.getTaxAmount(HT020_DTKENSYU.value + '', amTorihiki);#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 仕入実績(DT100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cDT100 = instance.createTableOperator('Insert', 'DT100');#EOL#&#x9;&#x9;cDT100.addValue('NRKAIKAKE',&#x9;session.getNextNumber('NRKAIKAKE'));#EOL#&#x9;&#x9;cDT100.addValue('IDSIIRESAKI',&#x9;HT010_IDSIIRESAKI.value);#EOL#&#x9;&#x9;cDT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;&#x9;cDT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;&#x9;cDT100.addValue('KBKAITORI',&#x9;'00'); //入荷仕入//#EOL#&#x9;&#x9;cDT100.addValue('KBKAIHURI',&#x9;'');#EOL#&#x9;&#x9;cDT100.addValue('DTTORIHIKI',&#x9;HT020_DTKENSYU.value);#EOL#&#x9;&#x9;cDT100.addValue('IDHINMOKU',&#x9;HT011_IDHINMOKU.value);#EOL#&#x9;&#x9;cDT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;&#x9;cDT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;&#x9;cDT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNITPUR.value);#EOL#&#x9;&#x9;cDT100.addValue('PRTORIHIKI',&#x9;HT011_PRHATTYU.value);#EOL#&#x9;&#x9;cDT100.addValue('QTTORIHIKI',&#x9;HT011_QTKENSYU.value);#EOL#&#x9;&#x9;cDT100.addValue('AMTORIHIKI',&#x9;amTorihiki);#EOL#&#x9;&#x9;cDT100.addValue('AMTAX',&#x9;&#x9;amTax);#EOL#&#x9;&#x9;cDT100.addValue('NRSIHARAI',&#x9;'');#EOL#&#x9;&#x9;cDT100.addValue('NRSOURCE',&#x9;&#x9;HT011_NRSOURCE.value);#EOL#&#x9;&#x9;cDT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cDT100.addValue('TXREFNO',&#x9;&#x9;HT011_NRHATTYU.value + '-' + HT011_SQHATTYU.value);#EOL#&#x9;&#x9;cDT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;cDT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;count = cDT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '仕入実績(DT100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////////////////////// 残高更新 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;amSiireSagaku = Number(amTorihiki) + Number(amTax) - Number(amTorihikiOld) - Number(amTaxOld);#EOL#&#x9;if (amSiireSagaku != 0) {#EOL##EOL#&#x9;&#x9;rDT010 = instance.createTableOperator('Select', 'DT010');#EOL#&#x9;&#x9;rDT010.setSelectFields('AMSIIRE, UPDCOUNTER');#EOL#&#x9;&#x9;rDT010.addKeyValue('IDSIIRESAKI',&#x9;HT020_IDSIIRESAKI.value);#EOL#&#x9;&#x9;if (rDT010.next()) {#EOL#&#x9;&#x9;&#x9;amSiireUpdated = Number(rDT010.getValueOf('AMSIIRE')) + Number(amSiireSagaku);#EOL#&#x9;&#x9;&#x9;uDT010 = instance.createTableOperator('Update', 'DT010');#EOL#&#x9;&#x9;&#x9;uDT010.addValue('AMSIIRE',&#x9;&#x9;&#x9;amSiireUpdated);#EOL#&#x9;&#x9;&#x9;uDT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rDT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;uDT010.addKeyValue('IDSIIRESAKI',&#x9;HT020_IDSIIRESAKI.value);#EOL#&#x9;&#x9;&#x9;uDT010.addKeyValue('UPDCOUNTER',&#x9;rDT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;count = uDT010.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '仕入先(DT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;errorMessage = '仕入先(DT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////#EOL#&#x9;// エラー処理 //#EOL#&#x9;////////////////#EOL#&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL#}"/><Script EventP="BU;AR" EventR="AR()" Function="" Name="仮想フィールドの設定" Order="0010" Text="////////////////#EOL#// 在庫換算数 //#EOL#////////////////#EOL#HT011_QTKANZAN.value = HT011_QTKENSYU.value * BT010_VLKANZAN.value;#EOL#HT011_QTKANZAN.editable = false;#EOL##EOL#//////////////////////#EOL#// 仕入額と消費税額 //#EOL#//////////////////////#EOL#if (HT020_DTKENSYU.value != '') {#EOL#&#x9;HT011_AMSIIRE.value = HT011_QTKENSYU.value * HT011_PRHATTYU.value;#EOL#&#x9;HT011_AMTAX.value = session.getTaxAmount(HT020_DTKENSYU.value + '', HT011_AMSIIRE.value);#EOL##EOL#&#x9;HT011_AMSIIRE.oldValue = HT011_QTKENSYU.oldValue * HT011_PRHATTYU.oldValue;#EOL#&#x9;HT011_AMTAX.oldValue = session.getTaxAmount(HT020_DTKENSYU.oldValue + '', HT011_AMSIIRE.oldValue);#EOL#}#EOL#HT011_AMSIIRE.editable = false;#EOL#HT011_AMTAX.editable = false;"/><Field Decimal="" ID="AMSIIRE" Name="仕入金額" NoUpdate="T" Nullable="T" Order="0102" Remarks="" Size="7" Type="INTEGER" TypeOptions="VIRTUAL"/><Field Decimal="" ID="AMTAX" Name="消費税額" NoUpdate="T" Nullable="T" Order="0103" Remarks="" Size="7" Type="INTEGER" TypeOptions="VIRTUAL"/><Script EventP="AR" EventR="AR()" Function="" Name="入荷数の初期値設定(HF023)" Order="0030" Text="/////////////////////////////////////////////////////#EOL#// 入荷実績エントリー(HF023)で処理された場合に実行 //#EOL#/////////////////////////////////////////////////////#EOL#if (instance.functionID == 'HF023') {#EOL#&#x9;if (HT020_DTKENSYU.oldValue == '' &amp;&amp; HT011_QTKENSYU.value == 0) {#EOL#&#x9;&#x9;HT011_QTKENSYU.value = HT011_QTHATTYU.value;#EOL#&#x9;&#x9;HT011_QTKANZAN.value = HT011_QTKENSYU.value * BT010_VLKANZAN.value;#EOL#&#x9;}#EOL#}"/><Script EventP="BU" EventR="AR()" Function="" Name="入荷取消設定(HF027)" Order="0060" Text="/////////////////////////////////////////////////////#EOL#// 入荷取消エントリー(HF027)で処理された場合に実行 //#EOL#/////////////////////////////////////////////////////#EOL#if (instance.functionID == 'HF027') {#EOL#&#x9;if (HT011_QTKENSYU.value == 0) {#EOL#&#x9;&#x9;HT011_NRNYUKA.value = '';#EOL#&#x9;} else {#EOL#&#x9;&#x9;HT011_QTKENSYU.error = '検収数がゼロでないので、入荷取消できません。';#EOL#&#x9;}#EOL#}"/><Field Decimal="" ID="QTKENSYU" Name="検収数" Nullable="T" Order="0061" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/></Table><Table ID="FT100" Name="在庫増減履歴" Remarks="在庫残高が増減するたびに記録される監査情報。品番や品名等がスナップショット属性として記録される他、受払の相手先が摘要として記録される。" SubsystemID="F"><Field Decimal="" ID="NRZAITORI" Name="在庫取引№" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="DTTORIHIKI" Name="取引日" NoUpdate="T" Nullable="F" Order="0020" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="" ID="KBUKEBARAI" Name="受払区分" NoUpdate="T" Nullable="F" Order="0030" Remarks="" Size="3" Type="CHAR" TypeOptions="KUBUN(KBUKEBARAI)"/><Field Decimal="" ID="KBAKADEN" Name="赤黒" NoUpdate="T" Nullable="F" Order="0050" Remarks="" Size="1" Type="CHAR" TypeOptions="KUBUN(KBAKADEN)"/><Field Decimal="" ID="FGVALID" Name="効区" NoUpdate="T" Nullable="F" Order="0060" Remarks="" Size="1" Type="CHAR" TypeOptions="KUBUN(FGVALID)"/><Field Decimal="" ID="IDHINMOKU" Name="品目ID" NoUpdate="T" Nullable="F" Order="0070" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="CDSOUKO" Name="倉庫Ｃ" NoUpdate="T" Nullable="F" Order="0110" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="TXAITESAKI" Name="相手先名" NoUpdate="T" Nullable="T" Order="0120" Remarks="" Size="20" Type="CHAR" TypeOptions="KANJI"/><Field Decimal="" ID="PRTORIHIKI" Name="取引単価" NoUpdate="T" Nullable="T" Order="0130" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTTORIHIKI" Name="取引数" NoUpdate="T" Nullable="T" Order="0140" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMSAGAKU" Name="取引差額" NoUpdate="T" Nullable="T" Order="0160" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="NRSOURCE" Name="取引ソース№" NoUpdate="T" Nullable="F" Order="0170" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Key Fields="NRZAITORI" Type="PK"/><Field ID="DTCREATE" Name="登録日時" NoUpdate="T" Nullable="F" Order="0180" Size="23" Type="TIMESTAMP" TypeOptions=""/><Field ID="TXREFNO" Name="参照№" NoUpdate="T" Nullable="F" Order="0190" Size="20" Type="CHAR" TypeOptions=""/><Field ID="DTNEND" Name="取引年度" NoUpdate="T" Nullable="F" Order="0200" Size="4" Type="SMALLINT" TypeOptions="FYEAR"/><Field ID="DTMSEQ" Name="取引月序" NoUpdate="T" Nullable="F" Order="0210" Size="2" Type="SMALLINT" TypeOptions="MSEQ"/><Field Decimal="" ID="TXHINBAN" Name="品番" NoUpdate="T" Nullable="F" Order="0080" Remarks="" Size="10" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="TXHINMEI" Name="品名" NoUpdate="T" Nullable="F" Order="0090" Remarks="" Size="30" Type="CHAR" TypeOptions="KANJI"/><Field Decimal="" ID="KBUNIT" Name="単位区分" NoUpdate="T" Nullable="F" Order="0100" Remarks="" Size="3" Type="CHAR" TypeOptions="KUBUN(KBUNIT)"/><Field Decimal="" ID="AMTORIHIKI" Name="取引額" NoUpdate="T" Nullable="T" Order="0150" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Refer Fields="TXSOUKO" Order="0010" OrderBy="" TableAlias="" ToKeyFields="CDSOUKO" ToTable="AT040" WithKeyFields="FT100.CDSOUKO"/><Field Decimal="" ID="KBZAIHURI" Name="振替区分" NoUpdate="T" Nullable="T" Order="0040" Remarks="在庫振替の際に設定される" Size="2" Type="CHAR" TypeOptions="KUBUN(KBZAIHURI)"/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールドと文字色の設定" Order="0020" Text="if (FT100_KBAKADEN.value == '2') {#EOL#&#x9;FT100_KBAKADEN.color = 'red';#EOL#}#EOL#if (FT100_KBUKEBARAI.value == '010' || FT100_KBUKEBARAI.value == '020'#EOL#&#x9;|| FT100_KBUKEBARAI.value == '030' || FT100_KBUKEBARAI.value == '040'#EOL#&#x9;|| FT100_KBUKEBARAI.value == '050' || FT100_KBUKEBARAI.value == '060' || FT100_KBUKEBARAI.value == '070') {#EOL#&#x9;FT100_AMZOUGEN.value = FT100_AMTORIHIKI.value;#EOL#&#x9;FT100_QTZOUGEN.value = FT100_QTTORIHIKI.value;#EOL#} else {#EOL#&#x9;FT100_AMZOUGEN.value = FT100_AMTORIHIKI.value * -1;#EOL#&#x9;FT100_QTZOUGEN.value = FT100_QTTORIHIKI.value * -1;#EOL#}#EOL#if (FT100_KBAKADEN.value == '2') {#EOL#&#x9;FT100_AMZOUGEN.value = FT100_AMZOUGEN.value * -1;#EOL#&#x9;FT100_QTZOUGEN.value = FT100_QTZOUGEN.value * -1;#EOL#}"/><Field Decimal="" ID="AMZOUGEN" Name="残高増減額" NoUpdate="T" Nullable="T" Order="0230" Remarks="取引区分と赤黒区分にしたがって符号設定された取引額" Size="7" Type="INTEGER" TypeOptions="VIRTUAL,ACCEPT_MINUS"/><Field Decimal="" ID="QTZOUGEN" Name="残高増減数" NoUpdate="T" Nullable="T" Order="0220" Remarks="取引区分と赤黒区分にしたがって符号設定された取引数" Size="7" Type="INTEGER" TypeOptions="VIRTUAL,ACCEPT_MINUS"/></Table><Table ID="ET010" Name="得意先" Remarks="得意先に関する属性を保持するためのテーブル。入金方法、締日、請求方法、売掛残高を含む。" SubsystemID="E"><Field Decimal="" ID="IDTOKUISAKI" Name="得意先ID" Nullable="F" Order="0000" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="TXTANTOUBUSYO" Name="客先担当部署" Nullable="F" Order="0010" Remarks="" Size="30" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="TXTANTOUSYA" Name="客先担当名" Nullable="F" Order="0020" Remarks="" Size="40" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="TXTANTOUSYASYOKUI" Name="客先担当職位" Nullable="T" Order="0030" Remarks="" Size="10" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="TXTANTOUSYAEMAIL" Name="客先担当メアド" Nullable="T" Order="0040" Remarks="" Size="40" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="TXTANTOUSYADENWA" Name="客先担当TEL" Nullable="T" Order="0050" Remarks="" Size="20" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="KBSEIKYUHOUSHIKI" Name="請求方式区分" Nullable="F" Order="0060" Remarks="" Size="2" Type="CHAR" TypeOptions="KUBUN(KBSEIKYUHOUSHIKI)"/><Field Decimal="" ID="TXSIMEBI" Name="締め日" Nullable="F" Order="0070" Remarks="" Size="10" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="KBNYUKINHOUHOU" Name="標準入金方法区分" Nullable="F" Order="0080" Remarks="" Size="2" Type="CHAR" TypeOptions="KUBUN(KBNYUKINHOUHOU)"/><Field Decimal="" ID="VLNYUKINSAITO" Name="入金サイト" Nullable="F" Order="0090" Remarks="" Size="3" Type="SMALLINT" TypeOptions=""/><Field Decimal="" ID="AMYOSHIN" Name="与信限度額" Nullable="F" Order="0100" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="NRTANTOUJYUGYOIN" Name="担当営業№" Nullable="T" Order="0110" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="TXTEKIYO" Name="摘要" Nullable="T" Order="0120" Remarks="" Size="300" Type="VARCHAR" TypeOptions=""/><Field Decimal="" ID="AMURIAGE" Name="期間売上額" NoUpdate="T" Nullable="T" Order="0140" Remarks="各種売上取引の管理テーブルの操作にともなって自動更新される" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMJYURYO" Name="期間受領額" NoUpdate="T" Nullable="T" Order="0150" Remarks="受領明細テーブルの操作にともなって自動更新される" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMGENURIKAKE" Name="現売掛残高" NoUpdate="T" Nullable="T" Order="0160" Remarks="期首残高＋期間売上額－期間受領額" Size="9" Type="INTEGER" TypeOptions="VIRTUAL"/><Key Fields="IDTOKUISAKI" Type="PK"/><Refer Fields="TXKANA;TXKANJI;NRYUBIN;TXJYUSYO1;TXJYUSYO2;NRDENWA;NRFAX;TXURL;CDTORIHIKISAKI" Order="0040" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="ET010.IDTOKUISAKI"/><Script EventP="AC" EventR="" Function="" Name="出荷先の自動登録" Order="0000" Text="var cET011 = instance.createTableOperator('Insert', 'ET011');#EOL#cET011.addValue('IDTOKUISAKI',&#x9;ET010_IDTOKUISAKI.value);#EOL#cET011.addValue('SQSYUKKASAKI',&#x9;1);#EOL#cET011.addValue('TXKANJI',&#x9;&#x9;AT030_TXKANJI.value);#EOL#cET011.addValue('NRYUBIN',&#x9;&#x9;AT030_NRYUBIN.value);#EOL#cET011.addValue('TXJYUSYO1',&#x9;AT030_TXJYUSYO1.value);#EOL#cET011.addValue('TXJYUSYO2',&#x9;AT030_TXJYUSYO2.value);#EOL#cET011.addValue('NRDENWA',&#x9;&#x9;AT030_NRDENWA.value);#EOL#cET011.execute();"/><Refer Fields="TXKANJI" Order="0050" OrderBy="" TableAlias="" ToKeyFields="NRJYUGYOIN" ToTable="AT020" WithKeyFields="ET010.NRTANTOUJYUGYOIN"/><Field Decimal="" ID="AMKISYU" Name="期首売掛残高" NoUpdate="T" Nullable="T" Order="0131" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールドの設定" Order="0010" Text="ET010_AMGENURIKAKE.value = Number(ET010_AMKISYU.value) + Number(ET010_AMURIAGE.value) - Number(ET010_AMJYURYO.value);"/><Script EventP="BD" EventR="BR()" Function="" Name="削除チェック" Order="0011" Text="if (ET010_AMGENURIKAKE.value != 0) {#EOL#&#x9;ET010_IDTOKUISAKI.error = '売掛残高がゼロでないため、削除できません';#EOL#}"/></Table><Table ID="ET120" Name="受領明細" Remarks="銀行からの振込通知にもとづく受領情報を記録するためのテーブル。記録されることで売掛残高が控除される。" SubsystemID="E"><Field Decimal="" ID="NRJYURYOU" Name="受領№" Nullable="F" Order="0000" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRJYURYOU)"/><Field Decimal="" ID="IDTOKUISAKI" Name="得意先ID" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="DTJYURYOU" Name="受領日" Nullable="F" Order="0020" Remarks="" Size="8" Type="DATE" TypeOptions=""/><Field Decimal="" ID="KBKINSYU" Name="金種区分" Nullable="F" Order="0030" Remarks="" Size="1" Type="CHAR" TypeOptions="KUBUN(KBKINSYU)"/><Field Decimal="" ID="AMJYURYOU" Name="受領額" Nullable="F" Order="0040" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMTESURYOU" Name="残高控除分手数料" Nullable="T" Order="0050" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="NRSOURCE" Name="取引ソース№" Nullable="F" Order="0060" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRSOURCE)"/><Key Fields="NRJYURYOU" Type="PK"/><Key Fields="NRSOURCE" Type="SK"/><Refer Fields="CDTORIHIKISAKI;TXKANJI" Order="0080" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="ET120.IDTOKUISAKI"/><Script EventP="AU" EventR="" Function="" Name="修正後の売掛更新(EF121)" Order="0030" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rET100; var uET100; var cET100; var rET010; var uET010;#EOL#var amJyuryou = 0; var amJyuryouOld = 0; var amTesuryou = 0; var amTesuryouOld = 0;#EOL#var amJyuryouUpdated = 0; var amJyuryouSagaku = 0; var count = 0; var errorMessage = '';#EOL#var dtNend = 0; var dtMSeq = 0; var dtNendOld = 0; var dtMSeqOld = 0;#EOL##EOL#/////////////////////////////////////////////////#EOL#// 受領明細の保守(EF121)で処理された場合に実行 //#EOL#/////////////////////////////////////////////////#EOL#if (instance.functionID == 'EF121') {#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////// 受領（現預金または手形）の赤伝処理 ////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;if ((ET120_AMJYURYOU.oldValue != 0 &amp;&amp; ET120_AMJYURYOU.valueChanged)#EOL#&#x9;&#x9;|| (ET120_DTJYURYOU.oldValue != '' &amp;&amp; ET120_DTJYURYOU.valueChanged)#EOL#&#x9;&#x9;|| (ET120_KBKINSYU.oldValue != '' &amp;&amp; ET120_KBKINSYU.valueChanged)) {#EOL##EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;// 関連する増減履歴(ET100)の失効処理 //#EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;rET100 = instance.createTableOperator('Select', 'ET100');#EOL#&#x9;&#x9;rET100.setSelectFields('NRURIKAKE, KBURITORI, UPDCOUNTER');#EOL#&#x9;&#x9;rET100.addKeyValue('NRSOURCE', ET120_NRSOURCE.value);#EOL#&#x9;&#x9;while (rET100.next()) {#EOL#&#x9;&#x9;&#x9;if (rET100.getValueOf('KBURITORI') == '90' || rET100.getValueOf('KBURITORI') == '91') {#EOL#&#x9;&#x9;&#x9;&#x9;uET100 = instance.createTableOperator('Update', 'ET100');#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addValue('UPDCOUNTER',&#x9;Number(rET100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addKeyValue('NRURIKAKE',&#x9;&#x9;rET100.getValueOf('NRURIKAKE'));#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addKeyValue('UPDCOUNTER',&#x9;rET100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;&#x9;count = uET100.execute();#EOL#&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '増減履歴(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNendOld = session.getFYearOfDate(ET120_DTJYURYOU.oldValue);#EOL#&#x9;&#x9;dtMSeqOld = session.getMSeqOfDate(ET120_DTJYURYOU.oldValue);#EOL#&#x9;&#x9;amJyuryouOld = ET120_AMJYURYOU.oldValue;#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 増減履歴(ET100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cET100 = instance.createTableOperator('Insert', 'ET100');#EOL#&#x9;&#x9;cET100.addValue('NRURIKAKE',&#x9;session.getNextNumber('NRURIKAKE'));#EOL#&#x9;&#x9;cET100.addValue('IDTOKUISAKI',&#x9;ET120_IDTOKUISAKI.value);#EOL#&#x9;&#x9;cET100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;&#x9;cET100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;if (ET120_KBKINSYU.oldValue == '1') {#EOL#&#x9;&#x9;&#x9;cET100.addValue('KBURITORI',&#x9;'90'); //現預金受領//#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;cET100.addValue('KBURITORI',&#x9;'91'); //手形受領//#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;cET100.addValue('DTTORIHIKI',&#x9;ET120_DTJYURYOU.oldValue);#EOL#&#x9;&#x9;cET100.addValue('IDHINMOKU',&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('TXHINBAN',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('TXHINMEI',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('KBUNIT',&#x9;&#x9;'CNT');#EOL#&#x9;&#x9;cET100.addValue('PRTORIHIKI',&#x9;amJyuryouOld);#EOL#&#x9;&#x9;cET100.addValue('QTTORIHIKI',&#x9;1);#EOL#&#x9;&#x9;cET100.addValue('AMTORIHIKI',&#x9;amJyuryouOld);#EOL#&#x9;&#x9;cET100.addValue('AMTAX',&#x9;&#x9;0);#EOL#&#x9;&#x9;cET100.addValue('AMGENKA',&#x9;&#x9;0);#EOL#&#x9;&#x9;cET100.addValue('NRSEIKYU',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('NRSOURCE',&#x9;&#x9;ET120_NRSOURCE.value);#EOL#&#x9;&#x9;cET100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cET100.addValue('TXREFNO',&#x9;&#x9;ET120_NRJYURYOU.value);#EOL#&#x9;&#x9;cET100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#&#x9;&#x9;cET100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#&#x9;&#x9;count = cET100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;/////////////////////// 売掛控除分手数料の赤伝処理 /////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;if ((ET120_AMTESURYOU.oldValue != 0 &amp;&amp; ET120_AMTESURYOU.valueChanged)#EOL#&#x9;&#x9;|| (ET120_DTJYURYOU.oldValue != '' &amp;&amp; ET120_DTJYURYOU.valueChanged)) {#EOL##EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;// 関連する増減履歴(ET100)の失効処理 //#EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;rET100 = instance.createTableOperator('Select', 'ET100');#EOL#&#x9;&#x9;rET100.setSelectFields('NRURIKAKE, KBURITORI, UPDCOUNTER');#EOL#&#x9;&#x9;rET100.addKeyValue('NRSOURCE', ET120_NRSOURCE.value);#EOL#&#x9;&#x9;while (rET100.next()) {#EOL#&#x9;&#x9;&#x9;if (rET100.getValueOf('KBURITORI') == '92') {#EOL#&#x9;&#x9;&#x9;&#x9;uET100 = instance.createTableOperator('Update', 'ET100');#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addValue('UPDCOUNTER',&#x9;Number(rET100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addKeyValue('NRURIKAKE',&#x9;&#x9;rET100.getValueOf('NRURIKAKE'));#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addKeyValue('UPDCOUNTER',&#x9;rET100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;&#x9;count = uET100.execute();#EOL#&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '増減履歴(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNendOld = session.getFYearOfDate(ET120_DTJYURYOU.oldValue);#EOL#&#x9;&#x9;dtMSeqOld = session.getMSeqOfDate(ET120_DTJYURYOU.oldValue);#EOL#&#x9;&#x9;amTesuryouOld = ET120_AMTESURYOU.oldValue;#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 増減履歴(ET100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cET100 = instance.createTableOperator('Insert', 'ET100');#EOL#&#x9;&#x9;cET100.addValue('NRURIKAKE',&#x9;session.getNextNumber('NRURIKAKE'));#EOL#&#x9;&#x9;cET100.addValue('IDTOKUISAKI',&#x9;ET120_IDTOKUISAKI.value);#EOL#&#x9;&#x9;cET100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;&#x9;cET100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;cET100.addValue('KBURITORI',&#x9;'92'); //控除手数料//#EOL#&#x9;&#x9;cET100.addValue('DTTORIHIKI',&#x9;ET120_DTJYURYOU.oldValue);#EOL#&#x9;&#x9;cET100.addValue('IDHINMOKU',&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('TXHINBAN',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('TXHINMEI',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('KBUNIT',&#x9;&#x9;'CNT');#EOL#&#x9;&#x9;cET100.addValue('PRTORIHIKI',&#x9;amTesuryouOld);#EOL#&#x9;&#x9;cET100.addValue('QTTORIHIKI',&#x9;1);#EOL#&#x9;&#x9;cET100.addValue('AMTORIHIKI',&#x9;amTesuryouOld);#EOL#&#x9;&#x9;cET100.addValue('AMTAX',&#x9;&#x9;0);#EOL#&#x9;&#x9;cET100.addValue('AMGENKA',&#x9;&#x9;0);#EOL#&#x9;&#x9;cET100.addValue('NRSEIKYU',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('NRSOURCE',&#x9;&#x9;ET120_NRSOURCE.value);#EOL#&#x9;&#x9;cET100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cET100.addValue('TXREFNO',&#x9;&#x9;ET120_NRJYURYOU.value);#EOL#&#x9;&#x9;cET100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#&#x9;&#x9;cET100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#&#x9;&#x9;count = cET100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////// 受領（現預金または手形）の黒伝処理 ////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;if ((ET120_AMJYURYOU.value != 0 &amp;&amp; ET120_AMJYURYOU.valueChanged)#EOL#&#x9;&#x9;|| (ET120_DTJYURYOU.value != '' &amp;&amp; ET120_DTJYURYOU.valueChanged)#EOL#&#x9;&#x9;|| (ET120_KBKINSYU.value != '' &amp;&amp; ET120_KBKINSYU.valueChanged)) {#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNend = session.getFYearOfDate(ET120_DTJYURYOU.value);#EOL#&#x9;&#x9;dtMSeq = session.getMSeqOfDate(ET120_DTJYURYOU.value);#EOL#&#x9;&#x9;amJyuryou = ET120_AMJYURYOU.value;#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 増減履歴(ET100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cET100 = instance.createTableOperator('Insert', 'ET100');#EOL#&#x9;&#x9;cET100.addValue('NRURIKAKE',&#x9;session.getNextNumber('NRURIKAKE'));#EOL#&#x9;&#x9;cET100.addValue('IDTOKUISAKI',&#x9;ET120_IDTOKUISAKI.value);#EOL#&#x9;&#x9;cET100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;&#x9;cET100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;&#x9;if (ET120_KBKINSYU.value == '1') {#EOL#&#x9;&#x9;&#x9;cET100.addValue('KBURITORI',&#x9;'90'); //現預金受領//#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;cET100.addValue('KBURITORI',&#x9;'91'); //手形受領//#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;cET100.addValue('DTTORIHIKI',&#x9;ET120_DTJYURYOU.value);#EOL#&#x9;&#x9;cET100.addValue('IDHINMOKU',&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('TXHINBAN',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('TXHINMEI',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('KBUNIT',&#x9;&#x9;'CNT');#EOL#&#x9;&#x9;cET100.addValue('PRTORIHIKI',&#x9;amJyuryou);#EOL#&#x9;&#x9;cET100.addValue('QTTORIHIKI',&#x9;1);#EOL#&#x9;&#x9;cET100.addValue('AMTORIHIKI',&#x9;amJyuryou);#EOL#&#x9;&#x9;cET100.addValue('AMTAX',&#x9;&#x9;0);#EOL#&#x9;&#x9;cET100.addValue('AMGENKA',&#x9;&#x9;0);#EOL#&#x9;&#x9;cET100.addValue('NRSEIKYU',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('NRSOURCE',&#x9;&#x9;ET120_NRSOURCE.value);#EOL#&#x9;&#x9;cET100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cET100.addValue('TXREFNO',&#x9;&#x9;ET120_NRJYURYOU.value);#EOL#&#x9;&#x9;cET100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;cET100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;count = cET100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;/////////////////////// 売掛控除分手数料の黒伝処理 /////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;if ((ET120_AMTESURYOU.value != 0 &amp;&amp; ET120_AMTESURYOU.valueChanged)#EOL#&#x9;&#x9;|| (ET120_DTJYURYOU.value != '' &amp;&amp; ET120_DTJYURYOU.valueChanged)) {#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNend = session.getFYearOfDate(ET120_DTJYURYOU.value);#EOL#&#x9;&#x9;dtMSeq = session.getMSeqOfDate(ET120_DTJYURYOU.value);#EOL#&#x9;&#x9;amTesuryou = ET120_AMTESURYOU.value;#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 増減履歴(ET100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cET100 = instance.createTableOperator('Insert', 'ET100');#EOL#&#x9;&#x9;cET100.addValue('NRURIKAKE',&#x9;session.getNextNumber('NRURIKAKE'));#EOL#&#x9;&#x9;cET100.addValue('IDTOKUISAKI',&#x9;ET120_IDTOKUISAKI.value);#EOL#&#x9;&#x9;cET100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;&#x9;cET100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;&#x9;cET100.addValue('KBURITORI',&#x9;'92'); //控除手数料//#EOL#&#x9;&#x9;cET100.addValue('DTTORIHIKI',&#x9;ET120_DTJYURYOU.value);#EOL#&#x9;&#x9;cET100.addValue('IDHINMOKU',&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('TXHINBAN',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('TXHINMEI',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('KBUNIT',&#x9;&#x9;'CNT');#EOL#&#x9;&#x9;cET100.addValue('PRTORIHIKI',&#x9;amTesuryou);#EOL#&#x9;&#x9;cET100.addValue('QTTORIHIKI',&#x9;1);#EOL#&#x9;&#x9;cET100.addValue('AMTORIHIKI',&#x9;amTesuryou);#EOL#&#x9;&#x9;cET100.addValue('AMTAX',&#x9;&#x9;0);#EOL#&#x9;&#x9;cET100.addValue('AMGENKA',&#x9;&#x9;0);#EOL#&#x9;&#x9;cET100.addValue('NRSEIKYU',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('NRSOURCE',&#x9;&#x9;ET120_NRSOURCE.value);#EOL#&#x9;&#x9;cET100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cET100.addValue('TXREFNO',&#x9;&#x9;ET120_NRJYURYOU.value);#EOL#&#x9;&#x9;cET100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;cET100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;count = cET100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////////////////////// 残高更新 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;amJyuryouSagaku = Number(amJyuryou) + Number(amTesuryou) - Number(amJyuryouOld) - Number(amTesuryouOld);#EOL#&#x9;if (amJyuryouSagaku != 0) {#EOL##EOL#&#x9;&#x9;rET010 = instance.createTableOperator('Select', 'ET010');#EOL#&#x9;&#x9;rET010.setSelectFields('AMJYURYO, UPDCOUNTER');#EOL#&#x9;&#x9;rET010.addKeyValue('IDTOKUISAKI',&#x9;ET120_IDTOKUISAKI.value);#EOL#&#x9;&#x9;if (rET010.next()) {#EOL#&#x9;&#x9;&#x9;amJyuryouUpdated = Number(rET010.getValueOf('AMJYURYO')) + Number(amJyuryouSagaku);#EOL#&#x9;&#x9;&#x9;uET010 = instance.createTableOperator('Update', 'ET010');#EOL#&#x9;&#x9;&#x9;uET010.addValue('AMJYURYO',&#x9;&#x9;&#x9;amJyuryouUpdated);#EOL#&#x9;&#x9;&#x9;uET010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rET010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;uET010.addKeyValue('IDTOKUISAKI',&#x9;ET120_IDTOKUISAKI.value);#EOL#&#x9;&#x9;&#x9;uET010.addKeyValue('UPDCOUNTER',&#x9;rET010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;count = uET010.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////#EOL#&#x9;// エラー処理 //#EOL#&#x9;////////////////#EOL#&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL#}"/><Script EventP="AC" EventR="" Function="" Name="追加後の売掛更新(EF121)" Order="0020" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rET100; var uET100; var cET100; var rET010; var uET010;#EOL#var amJyuryou = 0; var amTesuryou = 0; var amJyuryouUpdated = 0; var amJyuryouSagaku = 0;#EOL#var count = 0; var errorMessage = ''; var dtNend = 0; var dtMSeq = 0;#EOL##EOL#/////////////////////////////////////////////////#EOL#// 受領明細の保守(EF121)で処理された場合に実行 //#EOL#/////////////////////////////////////////////////#EOL#if (instance.functionID == 'EF121') {#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////// 受領（現預金または手形）の黒伝処理 ////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;if (ET120_AMJYURYOU.value != 0) {#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNend = session.getFYearOfDate(ET120_DTJYURYOU.value);#EOL#&#x9;&#x9;dtMSeq = session.getMSeqOfDate(ET120_DTJYURYOU.value);#EOL#&#x9;&#x9;amJyuryou = ET120_AMJYURYOU.value;#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 増減履歴(ET100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cET100 = instance.createTableOperator('Insert', 'ET100');#EOL#&#x9;&#x9;cET100.addValue('NRURIKAKE',&#x9;session.getNextNumber('NRURIKAKE'));#EOL#&#x9;&#x9;cET100.addValue('IDTOKUISAKI',&#x9;ET120_IDTOKUISAKI.value);#EOL#&#x9;&#x9;cET100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;&#x9;cET100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;&#x9;if (ET120_KBKINSYU.value == '1') {#EOL#&#x9;&#x9;&#x9;cET100.addValue('KBURITORI',&#x9;'90'); //現預金受領//#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;cET100.addValue('KBURITORI',&#x9;'91'); //手形受領//#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;cET100.addValue('DTTORIHIKI',&#x9;ET120_DTJYURYOU.value);#EOL#&#x9;&#x9;cET100.addValue('IDHINMOKU',&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('TXHINBAN',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('TXHINMEI',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('KBUNIT',&#x9;&#x9;'CNT');#EOL#&#x9;&#x9;cET100.addValue('PRTORIHIKI',&#x9;amJyuryou);#EOL#&#x9;&#x9;cET100.addValue('QTTORIHIKI',&#x9;1);#EOL#&#x9;&#x9;cET100.addValue('AMTORIHIKI',&#x9;amJyuryou);#EOL#&#x9;&#x9;cET100.addValue('AMTAX',&#x9;&#x9;0);#EOL#&#x9;&#x9;cET100.addValue('AMGENKA',&#x9;&#x9;0);#EOL#&#x9;&#x9;cET100.addValue('NRSEIKYU',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('NRSOURCE',&#x9;&#x9;ET120_NRSOURCE.value);#EOL#&#x9;&#x9;cET100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cET100.addValue('TXREFNO',&#x9;&#x9;ET120_NRJYURYOU.value);#EOL#&#x9;&#x9;cET100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;cET100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;count = cET100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;/////////////////////// 売掛控除分手数料の黒伝処理 /////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;if (ET120_AMTESURYOU.value != 0) {#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNend = session.getFYearOfDate(ET120_DTJYURYOU.value);#EOL#&#x9;&#x9;dtMSeq = session.getMSeqOfDate(ET120_DTJYURYOU.value);#EOL#&#x9;&#x9;amTesuryou = ET120_AMTESURYOU.value;#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 増減履歴(ET100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cET100 = instance.createTableOperator('Insert', 'ET100');#EOL#&#x9;&#x9;cET100.addValue('NRURIKAKE',&#x9;session.getNextNumber('NRURIKAKE'));#EOL#&#x9;&#x9;cET100.addValue('IDTOKUISAKI',&#x9;ET120_IDTOKUISAKI.value);#EOL#&#x9;&#x9;cET100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;&#x9;cET100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;&#x9;cET100.addValue('KBURITORI',&#x9;'92'); //控除手数料//#EOL#&#x9;&#x9;cET100.addValue('DTTORIHIKI',&#x9;ET120_DTJYURYOU.value);#EOL#&#x9;&#x9;cET100.addValue('IDHINMOKU',&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('TXHINBAN',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('TXHINMEI',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('KBUNIT',&#x9;&#x9;'CNT');#EOL#&#x9;&#x9;cET100.addValue('PRTORIHIKI',&#x9;amTesuryou);#EOL#&#x9;&#x9;cET100.addValue('QTTORIHIKI',&#x9;1);#EOL#&#x9;&#x9;cET100.addValue('AMTORIHIKI',&#x9;amTesuryou);#EOL#&#x9;&#x9;cET100.addValue('AMTAX',&#x9;&#x9;0);#EOL#&#x9;&#x9;cET100.addValue('AMGENKA',&#x9;&#x9;0);#EOL#&#x9;&#x9;cET100.addValue('NRSEIKYU',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('NRSOURCE',&#x9;&#x9;ET120_NRSOURCE.value);#EOL#&#x9;&#x9;cET100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cET100.addValue('TXREFNO',&#x9;&#x9;ET120_NRJYURYOU.value);#EOL#&#x9;&#x9;cET100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;cET100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;count = cET100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////////////////////// 残高更新 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;amJyuryouSagaku = Number(amJyuryou) + Number(amTesuryou);#EOL#&#x9;if (amJyuryouSagaku != 0) {#EOL##EOL#&#x9;&#x9;rET010 = instance.createTableOperator('Select', 'ET010');#EOL#&#x9;&#x9;rET010.setSelectFields('AMJYURYO, UPDCOUNTER');#EOL#&#x9;&#x9;rET010.addKeyValue('IDTOKUISAKI',&#x9;ET120_IDTOKUISAKI.value);#EOL#&#x9;&#x9;if (rET010.next()) {#EOL#&#x9;&#x9;&#x9;amJyuryouUpdated = Number(rET010.getValueOf('AMJYURYO')) + Number(amJyuryouSagaku);#EOL#&#x9;&#x9;&#x9;uET010 = instance.createTableOperator('Update', 'ET010');#EOL#&#x9;&#x9;&#x9;uET010.addValue('AMJYURYO',&#x9;&#x9;&#x9;amJyuryouUpdated);#EOL#&#x9;&#x9;&#x9;uET010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rET010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;uET010.addKeyValue('IDTOKUISAKI',&#x9;ET120_IDTOKUISAKI.value);#EOL#&#x9;&#x9;&#x9;uET010.addKeyValue('UPDCOUNTER',&#x9;rET010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;count = uET010.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////#EOL#&#x9;// エラー処理 //#EOL#&#x9;////////////////#EOL#&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL#}"/><Script EventP="AD" EventR="" Function="" Name="削除後の売掛更新(EF121)" Order="0040" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rET100; var uET100; var cET100; var rET010; var uET010;#EOL#var amJyuryou = 0; var amJyuryouOld = 0; var amTesuryou = 0; var amTesuryouOld = 0;#EOL#var amJyuryouUpdated = 0; var amJyuryouSagaku = 0; var count = 0; var errorMessage = '';#EOL#var dtNend = 0; var dtMSeq = 0; var dtNendOld = 0; var dtMSeqOld = 0;#EOL##EOL#/////////////////////////////////////////////////#EOL#// 受領明細の保守(EF121)で処理された場合に実行 //#EOL#/////////////////////////////////////////////////#EOL#if (instance.functionID == 'EF121') {#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////// 受領（現預金または手形）の赤伝処理 ////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;if (ET120_AMJYURYOU.oldValue != 0) {#EOL##EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;// 関連する増減履歴(ET100)の失効処理 //#EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;rET100 = instance.createTableOperator('Select', 'ET100');#EOL#&#x9;&#x9;rET100.setSelectFields('NRURIKAKE, KBURITORI, UPDCOUNTER');#EOL#&#x9;&#x9;rET100.addKeyValue('NRSOURCE', ET120_NRSOURCE.value);#EOL#&#x9;&#x9;while (rET100.next()) {#EOL#&#x9;&#x9;&#x9;if (rET100.getValueOf('KBURITORI') == '90' || rET100.getValueOf('KBURITORI') == '91') {#EOL#&#x9;&#x9;&#x9;&#x9;uET100 = instance.createTableOperator('Update', 'ET100');#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addValue('UPDCOUNTER',&#x9;Number(rET100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addKeyValue('NRURIKAKE',&#x9;&#x9;rET100.getValueOf('NRURIKAKE'));#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addKeyValue('UPDCOUNTER',&#x9;rET100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;&#x9;count = uET100.execute();#EOL#&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '増減履歴(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNendOld = session.getFYearOfDate(ET120_DTJYURYOU.oldValue);#EOL#&#x9;&#x9;dtMSeqOld = session.getMSeqOfDate(ET120_DTJYURYOU.oldValue);#EOL#&#x9;&#x9;amJyuryouOld = ET120_AMJYURYOU.oldValue;#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 増減履歴(ET100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cET100 = instance.createTableOperator('Insert', 'ET100');#EOL#&#x9;&#x9;cET100.addValue('NRURIKAKE',&#x9;session.getNextNumber('NRURIKAKE'));#EOL#&#x9;&#x9;cET100.addValue('IDTOKUISAKI',&#x9;ET120_IDTOKUISAKI.value);#EOL#&#x9;&#x9;cET100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;&#x9;cET100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;if (ET120_KBKINSYU.oldValue == '1') {#EOL#&#x9;&#x9;&#x9;cET100.addValue('KBURITORI',&#x9;'90'); //現預金受領//#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;cET100.addValue('KBURITORI',&#x9;'91'); //手形受領//#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;cET100.addValue('DTTORIHIKI',&#x9;ET120_DTJYURYOU.oldValue);#EOL#&#x9;&#x9;cET100.addValue('IDHINMOKU',&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('TXHINBAN',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('TXHINMEI',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('KBUNIT',&#x9;&#x9;'CNT');#EOL#&#x9;&#x9;cET100.addValue('PRTORIHIKI',&#x9;amJyuryouOld);#EOL#&#x9;&#x9;cET100.addValue('QTTORIHIKI',&#x9;1);#EOL#&#x9;&#x9;cET100.addValue('AMTORIHIKI',&#x9;amJyuryouOld);#EOL#&#x9;&#x9;cET100.addValue('AMTAX',&#x9;&#x9;0);#EOL#&#x9;&#x9;cET100.addValue('AMGENKA',&#x9;&#x9;0);#EOL#&#x9;&#x9;cET100.addValue('NRSEIKYU',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('NRSOURCE',&#x9;&#x9;ET120_NRSOURCE.value);#EOL#&#x9;&#x9;cET100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cET100.addValue('TXREFNO',&#x9;&#x9;ET120_NRJYURYOU.value);#EOL#&#x9;&#x9;cET100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#&#x9;&#x9;cET100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#&#x9;&#x9;count = cET100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;/////////////////////// 売掛控除分手数料の赤伝処理 /////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;if (ET120_AMTESURYOU.oldValue != 0) {#EOL##EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;// 関連する増減履歴(ET100)の失効処理 //#EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;rET100 = instance.createTableOperator('Select', 'ET100');#EOL#&#x9;&#x9;rET100.setSelectFields('NRURIKAKE, KBURITORI, UPDCOUNTER');#EOL#&#x9;&#x9;rET100.addKeyValue('NRSOURCE', ET120_NRSOURCE.value);#EOL#&#x9;&#x9;while (rET100.next()) {#EOL#&#x9;&#x9;&#x9;if (rET100.getValueOf('KBURITORI') == '92') {#EOL#&#x9;&#x9;&#x9;&#x9;uET100 = instance.createTableOperator('Update', 'ET100');#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addValue('UPDCOUNTER',&#x9;Number(rET100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addKeyValue('NRURIKAKE',&#x9;&#x9;rET100.getValueOf('NRURIKAKE'));#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addKeyValue('UPDCOUNTER',&#x9;rET100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;&#x9;count = uET100.execute();#EOL#&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '増減履歴(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNendOld = session.getFYearOfDate(ET120_DTJYURYOU.oldValue);#EOL#&#x9;&#x9;dtMSeqOld = session.getMSeqOfDate(ET120_DTJYURYOU.oldValue);#EOL#&#x9;&#x9;amTesuryouOld = ET120_AMTESURYOU.oldValue;#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 増減履歴(ET100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cET100 = instance.createTableOperator('Insert', 'ET100');#EOL#&#x9;&#x9;cET100.addValue('NRURIKAKE',&#x9;session.getNextNumber('NRURIKAKE'));#EOL#&#x9;&#x9;cET100.addValue('IDTOKUISAKI',&#x9;ET120_IDTOKUISAKI.value);#EOL#&#x9;&#x9;cET100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;&#x9;cET100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;cET100.addValue('KBURITORI',&#x9;'92'); //控除手数料//#EOL#&#x9;&#x9;cET100.addValue('DTTORIHIKI',&#x9;ET120_DTJYURYOU.oldValue);#EOL#&#x9;&#x9;cET100.addValue('IDHINMOKU',&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('TXHINBAN',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('TXHINMEI',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('KBUNIT',&#x9;&#x9;'CNT');#EOL#&#x9;&#x9;cET100.addValue('PRTORIHIKI',&#x9;amTesuryouOld);#EOL#&#x9;&#x9;cET100.addValue('QTTORIHIKI',&#x9;1);#EOL#&#x9;&#x9;cET100.addValue('AMTORIHIKI',&#x9;amTesuryouOld);#EOL#&#x9;&#x9;cET100.addValue('AMTAX',&#x9;&#x9;0);#EOL#&#x9;&#x9;cET100.addValue('AMGENKA',&#x9;&#x9;0);#EOL#&#x9;&#x9;cET100.addValue('NRSEIKYU',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('NRSOURCE',&#x9;&#x9;ET120_NRSOURCE.value);#EOL#&#x9;&#x9;cET100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cET100.addValue('TXREFNO',&#x9;&#x9;ET120_NRJYURYOU.value);#EOL#&#x9;&#x9;cET100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#&#x9;&#x9;cET100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#&#x9;&#x9;count = cET100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////////////////////// 残高更新 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;amJyuryouSagaku = 0 - Number(amJyuryouOld) - Number(amTesuryouOld);#EOL#&#x9;if (amJyuryouSagaku != 0) {#EOL##EOL#&#x9;&#x9;rET010 = instance.createTableOperator('Select', 'ET010');#EOL#&#x9;&#x9;rET010.setSelectFields('AMJYURYO, UPDCOUNTER');#EOL#&#x9;&#x9;rET010.addKeyValue('IDTOKUISAKI',&#x9;ET120_IDTOKUISAKI.value);#EOL#&#x9;&#x9;if (rET010.next()) {#EOL#&#x9;&#x9;&#x9;amJyuryouUpdated = Number(rET010.getValueOf('AMJYURYO')) + Number(amJyuryouSagaku);#EOL#&#x9;&#x9;&#x9;uET010 = instance.createTableOperator('Update', 'ET010');#EOL#&#x9;&#x9;&#x9;uET010.addValue('AMJYURYO',&#x9;&#x9;&#x9;amJyuryouUpdated);#EOL#&#x9;&#x9;&#x9;uET010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rET010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;uET010.addKeyValue('IDTOKUISAKI',&#x9;ET120_IDTOKUISAKI.value);#EOL#&#x9;&#x9;&#x9;uET010.addKeyValue('UPDCOUNTER',&#x9;rET010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;count = uET010.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////#EOL#&#x9;// エラー処理 //#EOL#&#x9;////////////////#EOL#&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL#}"/><Script EventP="BC" EventR="AR()" Function="" Name="追加前の初期値設定" Order="0010" Text="if (ET120_DTJYURYOU.value == '') {#EOL#&#x9;ET120_DTJYURYOU.value = session.today + '';#EOL#}#EOL#if (ET120_KBKINSYU.value == '') {#EOL#&#x9;ET120_KBKINSYU.value = ET010_KBNYUKINHOUHOU.value;#EOL#}#EOL#"/><Refer Fields="KBNYUKINHOUHOU" Order="0090" OrderBy="" TableAlias="" ToKeyFields="IDTOKUISAKI" ToTable="ET010" WithKeyFields="ET120.IDTOKUISAKI"/><Script EventP="BC;BU;BD" EventR="BR()" Function="" Name="会計日付の妥当性検査" Order="0011" Text="ET120_DTJYURYOU.error = session.getErrorOfAccountDate(ET120_DTJYURYOU.value);"/></Table><Table ID="ET100" Name="売掛増減履歴" Remarks="売掛残高が増減するたびに記録される監査情報。品番や品名等がスナップショット属性として記録される。" SubsystemID="E"><Field Decimal="" ID="NRURIKAKE" Name="売掛取引№" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRURIKAKE)"/><Field Decimal="" ID="IDTOKUISAKI" Name="得意先ID" NoUpdate="T" Nullable="F" Order="0020" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="DTTORIHIKI" Name="取引日" NoUpdate="T" Nullable="F" Order="0030" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="" ID="KBURITORI" Name="取引区分" NoUpdate="T" Nullable="F" Order="0040" Remarks="" Size="2" Type="CHAR" TypeOptions="KUBUN(KBURITORI)"/><Field Decimal="" ID="KBAKADEN" Name="赤黒" NoUpdate="T" Nullable="F" Order="0050" Remarks="" Size="1" Type="CHAR" TypeOptions="KUBUN(KBAKADEN)"/><Field Decimal="" ID="FGVALID" Name="効区" NoUpdate="T" Nullable="F" Order="0060" Remarks="" Size="1" Type="CHAR" TypeOptions="KUBUN(FGVALID)"/><Field Decimal="" ID="IDHINMOKU" Name="品目ID" NoUpdate="T" Nullable="T" Order="0070" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="PRTORIHIKI" Name="取引単価" NoUpdate="T" Nullable="F" Order="0110" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTTORIHIKI" Name="取引数" NoUpdate="T" Nullable="F" Order="0120" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMTAX" Name="消費税額" NoUpdate="T" Nullable="T" Order="0140" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="NRSOURCE" Name="取引ソース№" NoUpdate="T" Nullable="F" Order="0160" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="NRSEIKYU" Name="請求№" NoUpdate="T" Nullable="T" Order="0170" Remarks="請求エントリーによって自動更新される" Size="7" Type="CHAR" TypeOptions=""/><Key Fields="NRURIKAKE" Type="PK"/><Refer Fields="TXSIMEBI;NRTANTOUJYUGYOIN" Order="0050" OrderBy="" TableAlias="" ToKeyFields="IDTOKUISAKI" ToTable="ET010" WithKeyFields="ET100.IDTOKUISAKI"/><Refer Fields="TXKANJI;CDTORIHIKISAKI" Order="0060" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="ET100.IDTOKUISAKI"/><Field Decimal="" ID="AMTORIHIKI" Name="税抜取引額" NoUpdate="T" Nullable="F" Order="0130" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="TXHINBAN" Name="品番" NoUpdate="T" Nullable="T" Order="0080" Remarks="" Size="10" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="TXHINMEI" Name="品名／摘要" NoUpdate="F" Nullable="F" Order="0090" Remarks="" Size="30" Type="CHAR" TypeOptions="KANJI"/><Field Decimal="" ID="KBUNIT" Name="単位区分" NoUpdate="T" Nullable="F" Order="0100" Remarks="" Size="3" Type="CHAR" TypeOptions="KUBUN(KBUNIT)"/><Field ID="DTCREATE" Name="登録日時" NoUpdate="T" Nullable="F" Order="0180" Size="23" Type="TIMESTAMP" TypeOptions=""/><Field ID="TXREFNO" Name="参照№" NoUpdate="T" Nullable="F" Order="0190" Size="20" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="AMGENKA" Name="売上原価" NoUpdate="T" Nullable="T" Order="0150" Remarks="在庫品であれば出庫額。受注生産品であれば実勢原価額" Size="7" Type="INTEGER" TypeOptions=""/><Field ID="DTNEND" Name="取引年度" NoUpdate="T" Nullable="F" Order="0200" Size="4" Type="SMALLINT" TypeOptions="FYEAR"/><Field ID="DTMSEQ" Name="取引月序" NoUpdate="T" Nullable="F" Order="0210" Size="2" Type="SMALLINT" TypeOptions="MSEQ"/><Field Decimal="" ID="AMARARI" Name="粗利額" NoUpdate="T" Nullable="F" Order="0220" Remarks="取引額から販売原価を引いた値。出荷売上、直出荷売上、売上返品のみで設定される" Size="7" Type="INTEGER" TypeOptions="VIRTUAL,ACCEPT_MINUS"/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールドと文字色の設定" Order="0000" Text="if (ET100_KBURITORI.value == '00' || ET100_KBURITORI.value == '01' || ET100_KBURITORI.value == '02') {#EOL#&#x9;ET100_AMARARI.value = Number(ET100_AMTORIHIKI.value) - Number(ET100_AMGENKA.value);#EOL#}#EOL#if (ET100_KBAKADEN.value == '2') {#EOL#&#x9;ET100_KBAKADEN.color = 'red';#EOL#}#EOL#if (ET100_KBURITORI.value == '00' || ET100_KBURITORI.value == '01' || ET100_KBURITORI.value == '11') {#EOL#&#x9;ET100_AMZOUGEN.value = Number(ET100_AMTORIHIKI.value) + Number(ET100_AMTAX.value);#EOL#&#x9;ET100_AMTORIHIKISIGN.value = ET100_AMTORIHIKI.value;#EOL#&#x9;ET100_AMTAXSIGN.value = ET100_AMTAX.value;#EOL#} else {#EOL#&#x9;ET100_AMZOUGEN.value = 0 - Number(ET100_AMTORIHIKI.value) - Number(ET100_AMTAX.value);#EOL#&#x9;ET100_AMTORIHIKISIGN.value = ET100_AMTORIHIKI.value * -1;#EOL#&#x9;ET100_AMTAXSIGN.value = ET100_AMTAX.value * -1;#EOL#}#EOL#if (ET100_KBAKADEN.value == '2') {#EOL#&#x9;ET100_AMZOUGEN.value = 0 - ET100_AMZOUGEN.value;#EOL#&#x9;ET100_AMTORIHIKISIGN.value = ET100_AMTORIHIKISIGN.value * -1;#EOL#&#x9;ET100_AMTAXSIGN.value = ET100_AMTAXSIGN.value * -1;#EOL#}"/><Refer Fields="DTSEIKYU" Order="0070" OrderBy="" TableAlias="" ToKeyFields="NRSEIKYU" ToTable="ET110" WithKeyFields="ET100.NRSEIKYU"/><Field Decimal="" ID="KBURIHURI" Name="振替区分" NoUpdate="T" Nullable="T" Order="0041" Remarks="売掛振替の際に設定される" Size="2" Type="CHAR" TypeOptions="KUBUN(KBURIHURI)"/><Field Decimal="" ID="AMZOUGEN" Name="残高増減額" NoUpdate="T" Nullable="F" Order="0221" Remarks="取引区分と赤黒区分にしたがって符号設定された取引額と税額の合計" Size="7" Type="INTEGER" TypeOptions="VIRTUAL,ACCEPT_MINUS"/><Field Decimal="" ID="AMTORIHIKISIGN" Name="符号付税抜取引額" NoUpdate="T" Nullable="F" Order="0222" Remarks="取引区分と赤黒区分にしたがって符号設定された取引額" Size="7" Type="INTEGER" TypeOptions="VIRTUAL,ACCEPT_MINUS"/><Field Decimal="" ID="AMTAXSIGN" Name="符号付消費税額" NoUpdate="T" Nullable="F" Order="0223" Remarks="取引区分と赤黒区分にしたがって符号設定された税額" Size="7" Type="INTEGER" TypeOptions="VIRTUAL,ACCEPT_MINUS"/></Table><Table DetailRowNumberAuto="T" ID="ET011" Name="出荷先" Remarks="得意先毎の出荷先の一覧を保持するためのテーブル" SubsystemID="E"><Field Decimal="" ID="IDTOKUISAKI" Name="得意先ID" Nullable="F" Order="0000" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="SQSYUKKASAKI" Name="出荷先行番" Nullable="F" Order="0010" Remarks="" Size="3" Type="SMALLINT" TypeOptions=""/><Field Decimal="" ID="TXKANJI" Name="漢字名" Nullable="F" Order="0020" Remarks="" Size="40" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="NRYUBIN" Name="郵便番号" Nullable="F" Order="0030" Remarks="" Size="8" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="TXJYUSYO1" Name="住所１" Nullable="F" Order="0040" Remarks="" Size="30" Type="CHAR" TypeOptions="ZIPADRS"/><Field Decimal="" ID="TXJYUSYO2" Name="住所２" Nullable="T" Order="0050" Remarks="" Size="30" Type="CHAR" TypeOptions="KANJI"/><Field Decimal="" ID="NRDENWA" Name="電話番号" Nullable="F" Order="0060" Remarks="" Size="14" Type="CHAR" TypeOptions=""/><Key Fields="IDTOKUISAKI;SQSYUKKASAKI" Type="PK"/><Refer Fields="TXKANJI;NRYUBIN;TXJYUSYO1;TXJYUSYO2;NRDENWA;NRFAX;CDTORIHIKISAKI" Order="0070" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="ET011.IDTOKUISAKI"/></Table><Table ID="DT110" Name="支払依頼" Remarks="仕入実績にもとづく支払を管理するためのテーブル。承認することで支払されたとみなされ、買掛残高が控除される。" SubsystemID="D"><Field Decimal="" ID="NRSIHARAI" Name="支払依頼№" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRSIHARAI)"/><Field Decimal="" ID="IDSIIRESAKI" Name="仕入先ID" NoUpdate="T" Nullable="F" Order="0020" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="DTSIHARAI" Name="支払依頼日" NoUpdate="T" Nullable="F" Order="0030" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="" ID="DTSYONIN" Name="支払承認日" NoUpdate="T" Nullable="T" Order="0040" Remarks="支払承認エントリーによって自動更新される" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="" ID="NRSOURCE" Name="取引ソース№" NoUpdate="T" Nullable="F" Order="0080" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRSOURCE)"/><Key Fields="NRSIHARAI" Type="PK"/><Key Fields="NRSOURCE" Type="SK"/><Field Decimal="" ID="AMSIHARAI" Name="支払依頼額" NoUpdate="T" Nullable="T" Order="0100" Remarks="関連する買掛増減履歴より自動集計される" Size="7" Type="INTEGER" TypeOptions="VIRTUAL"/><Field ID="TXSEIKYU" Name="相手先請求番号" Nullable="T" Order="0050" Size="20" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="STSIHARAI" Name="承認状況" NoUpdate="T" Nullable="F" Order="0090" Remarks="" Size="2" Type="CHAR" TypeOptions="VIRTUAL,KUBUN(STSIHARAI)"/><Refer Fields="TXHURIKOMI;TXTEKIYO;KBSIHARAI" Order="0020" OrderBy="" TableAlias="" ToKeyFields="IDSIIRESAKI" ToTable="DT010" WithKeyFields="DT110.IDSIIRESAKI"/><Refer Fields="CDTORIHIKISAKI;TXKANJI" Order="0010" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="DT110.IDSIIRESAKI"/><Field Decimal="" ID="KBSIHARAI" Name="支払方法区分" NoUpdate="T" Nullable="F" Order="0060" Remarks="支払依頼エントリーでの登録の際に、仕入先の支払方法区分を初期値として変更可" Size="2" Type="CHAR" TypeOptions="KUBUN(KBSIHARAI)"/><Script EventP="BC" EventR="BR()" Function="" Name="追加前設定(DF111B)" Order="0010" Text="if (instance.functionID == 'DF111B') {#EOL##EOL#&#x9;//////////////////////////#EOL#&#x9;// 支払額集計値の初期化 //#EOL#&#x9;//////////////////////////#EOL#&#x9;DT110_AMSIHARAI.editable = false;#EOL#&#x9;DT110_AMSIHARAI.value = DT110_AMWORK.value;#EOL#&#x9;DT110_AMWORK.value = 0;#EOL##EOL#&#x9;///////////////////////////////////////////#EOL#&#x9;// 依頼日,支払方法区分のデフォルト値設定 //#EOL#&#x9;///////////////////////////////////////////#EOL#&#x9;if (DT110_DTSIHARAI.value == '') {#EOL#&#x9;&#x9;DT110_DTSIHARAI.value = session.today + '';#EOL#&#x9;}#EOL#&#x9;if (DT110_KBSIHARAI.value == '') {#EOL#&#x9;&#x9;DT110_KBSIHARAI.value = DT010_KBSIHARAI.value;#EOL#&#x9;}#EOL#}"/><Field Decimal="" ID="AMWORK" Name="支払依頼額集計用ワーク" Nullable="T" Order="0110" Remarks="" Size="7" Type="INTEGER" TypeOptions="VIRTUAL"/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールド設定" Order="0020" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rDT100; var amSiharai = 0;#EOL##EOL#//////////////////////#EOL#// 支払依頼額の集計 //#EOL#//////////////////////#EOL#rDT100 = instance.createTableOperator('Select', 'DT100');#EOL#rDT100.setSelectFields('KBKAITORI, AMTORIHIKI, AMTAX, KBAKADEN');#EOL#rDT100.addKeyValue('NRSIHARAI',&#x9;DT110_NRSIHARAI.value);#EOL#while (rDT100.next()) {#EOL#&#x9;if (rDT100.getValueOf('KBAKADEN') == '1') {#EOL#&#x9;&#x9;if (rDT100.getValueOf('KBKAITORI') == '00' || rDT100.getValueOf('KBKAITORI') == '00' || rDT100.getValueOf('KBKAITORI') == '11') {#EOL#&#x9;&#x9;&#x9;amSiharai = Number(amSiharai) + Number(rDT100.getValueOf('AMTORIHIKI')) + Number(rDT100.getValueOf('AMTAX'));#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;if (rDT100.getValueOf('KBKAITORI') == '02' || rDT100.getValueOf('KBKAITORI') == '10') {#EOL#&#x9;&#x9;&#x9;amSiharai = Number(amSiharai) - Number(rDT100.getValueOf('AMTORIHIKI')) - Number(rDT100.getValueOf('AMTAX'));#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;if (rDT100.getValueOf('KBKAITORI') == '00' || rDT100.getValueOf('KBKAITORI') == '00' || rDT100.getValueOf('KBKAITORI') == '11') {#EOL#&#x9;&#x9;&#x9;amSiharai = Number(amSiharai) - Number(rDT100.getValueOf('AMTORIHIKI')) - Number(rDT100.getValueOf('AMTAX'));#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;if (rDT100.getValueOf('KBKAITORI') == '02' || rDT100.getValueOf('KBKAITORI') == '10') {#EOL#&#x9;&#x9;&#x9;amSiharai = Number(amSiharai) + Number(rDT100.getValueOf('AMTORIHIKI')) + Number(rDT100.getValueOf('AMTAX'));#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL#DT110_AMSIHARAI.value = amSiharai;#EOL##EOL#////////////////////////#EOL#// 支払依頼の承認状況 //#EOL#////////////////////////#EOL#if (instance.functionID != 'DF121') {#EOL#&#x9;if (DT110_DTSYONIN.value == '') {#EOL#&#x9;&#x9;DT110_STSIHARAI.value = '10'; //未承認//#EOL#&#x9;} else {#EOL#&#x9;&#x9;DT110_STSIHARAI.value = '20'; //承認済//#EOL#&#x9;}#EOL#}"/><Script EventP="BU" EventR="BR()" Function="" Name="承認エントリーでの更新前設定(DF121)" Order="0050" Text="if (instance.functionID == 'DF121') {#EOL#&#x9;if (DT110_STSIHARAI.value == '10') {#EOL#&#x9;&#x9;DT110_DTSYONIN.value = '';#EOL#&#x9;} else {#EOL#&#x9;&#x9;DT110_DTSYONIN.value = session.today + '';#EOL#&#x9;}#EOL#}#EOL#"/><Script EventP="BU" EventR="BR()" Function="" Name="条件付き変更不可設定" Order="0030" Text="if (instance.functionID != 'DF121') {#EOL#&#x9;DT110_STSIHARAI.editable = false;#EOL#}#EOL#if (instance.functionID != 'DF114') {#EOL#&#x9;DT110_TXSEIKYU.editable = false;#EOL#}"/><Field Decimal="" ID="TXTEKIYO" Name="摘要" Nullable="T" Order="0070" Remarks="" Size="300" Type="VARCHAR" TypeOptions="KANJI"/><Script EventP="BR" EventR="" Function="" Name="承認エントリーでの初期値設定(DF121)" Order="0040" Text="if (instance.functionID == 'DF121') {#EOL#&#x9;DT110_STSIHARAI.value = '20';#EOL#}"/><Script EventP="AU" EventR="" Function="" Name="承認エントリーでの更新後処理(DF121)" Order="0060" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rDT100; var uDT100; var cDT100; var rDT010; var uDT010;#EOL#var amTorihiki = 0; var amTorihikiOld = 0;#EOL#var amSiharaiUpdated = 0; var amSiharaiUpdated = 0; var amSiharai = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var dtNendOld = 0; var dtMSeqOld = 0;#EOL#var count = 0; var errorMessage = '';#EOL##EOL#/////////////////////////////////////////////////////#EOL#// 支払承認エントリー(DF121)で処理された場合に実行 //#EOL#/////////////////////////////////////////////////////#EOL#if (instance.functionID == 'DF121') {#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;/////////////////////// 支払の赤伝処理 /////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;if (DT110_DTSYONIN.oldValue != '' &amp;&amp; DT110_DTSYONIN.value == '') {#EOL##EOL#&#x9;&#x9;///////////////////////////////////////////////#EOL#&#x9;&#x9;// 関連する支払分の増減明細(DT100)の失効処理 //#EOL#&#x9;&#x9;///////////////////////////////////////////////#EOL#&#x9;&#x9;rDT100 = instance.createTableOperator('Select', 'DT100');#EOL#&#x9;&#x9;rDT100.setSelectFields('NRKAIKAKE, KBKAITORI, UPDCOUNTER');#EOL#&#x9;&#x9;rDT100.addKeyValue('NRSOURCE', DT110_NRSOURCE.value);#EOL#&#x9;&#x9;while (rDT100.next()) {#EOL#&#x9;&#x9;&#x9;if (rDT100.getValueOf('KBKAITORI') == '90') {#EOL#&#x9;&#x9;&#x9;&#x9;uDT100 = instance.createTableOperator('Update', 'DT100');#EOL#&#x9;&#x9;&#x9;&#x9;uDT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;&#x9;&#x9;uDT100.addValue('UPDCOUNTER',&#x9;Number(rDT100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;&#x9;uDT100.addKeyValue('NRKAIKAKE',&#x9;&#x9;rDT100.getValueOf('NRKAIKAKE'));#EOL#&#x9;&#x9;&#x9;&#x9;uDT100.addKeyValue('UPDCOUNTER',&#x9;rDT100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;&#x9;count = uDT100.execute();#EOL#&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '仕入実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNendOld = session.getFYearOfDate(DT110_DTSYONIN.oldValue);#EOL#&#x9;&#x9;dtMSeqOld = session.getMSeqOfDate(DT110_DTSYONIN.oldValue);#EOL#&#x9;&#x9;amTorihikiOld = DT110_AMSIHARAI.oldValue;#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 仕入実績(DT100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cDT100 = instance.createTableOperator('Insert', 'DT100');#EOL#&#x9;&#x9;cDT100.addValue('NRKAIKAKE',&#x9;session.getNextNumber('NRKAIKAKE'));#EOL#&#x9;&#x9;cDT100.addValue('IDSIIRESAKI',&#x9;DT110_IDSIIRESAKI.value);#EOL#&#x9;&#x9;cDT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;&#x9;cDT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;cDT100.addValue('KBKAITORI',&#x9;'90'); //支払//#EOL#&#x9;&#x9;cDT100.addValue('KBKAIHURI',&#x9;'');#EOL#&#x9;&#x9;cDT100.addValue('DTTORIHIKI',&#x9;DT110_DTSYONIN.oldValue);#EOL#&#x9;&#x9;cDT100.addValue('IDHINMOKU',&#x9;'');#EOL#&#x9;&#x9;cDT100.addValue('TXHINBAN',&#x9;&#x9;'');#EOL#&#x9;&#x9;cDT100.addValue('TXHINMEI',&#x9;&#x9;DT110_TXTEKIYO.oldValue);#EOL#&#x9;&#x9;cDT100.addValue('KBUNIT',&#x9;&#x9;'CNT');#EOL#&#x9;&#x9;cDT100.addValue('PRTORIHIKI',&#x9;DT110_AMSIHARAI.oldValue);#EOL#&#x9;&#x9;cDT100.addValue('QTTORIHIKI',&#x9;1);#EOL#&#x9;&#x9;cDT100.addValue('AMTORIHIKI',&#x9;DT110_AMSIHARAI.oldValue);#EOL#&#x9;&#x9;cDT100.addValue('AMTAX',&#x9;&#x9;0);#EOL#&#x9;&#x9;cDT100.addValue('NRSIHARAI',&#x9;'');#EOL#&#x9;&#x9;cDT100.addValue('NRSOURCE',&#x9;&#x9;DT110_NRSOURCE.value);#EOL#&#x9;&#x9;cDT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cDT100.addValue('TXREFNO',&#x9;&#x9;DT110_NRSIHARAI.value);#EOL#&#x9;&#x9;cDT100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#&#x9;&#x9;cDT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#&#x9;&#x9;count = cDT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '仕入実績(DT100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;/////////////////////// 支払の黒伝処理 /////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////#EOL#&#x9;if (DT110_DTSYONIN.oldValue == '' &amp;&amp; DT110_DTSYONIN.value != '') {#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNend = session.getFYearOfDate(DT110_DTSYONIN.value);#EOL#&#x9;&#x9;dtMSeq = session.getMSeqOfDate(DT110_DTSYONIN.value);#EOL#&#x9;&#x9;amTorihiki = DT110_AMSIHARAI.value;#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 仕入実績(DT100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cDT100 = instance.createTableOperator('Insert', 'DT100');#EOL#&#x9;&#x9;cDT100.addValue('NRKAIKAKE',&#x9;session.getNextNumber('NRKAIKAKE'));#EOL#&#x9;&#x9;cDT100.addValue('IDSIIRESAKI',&#x9;DT110_IDSIIRESAKI.value);#EOL#&#x9;&#x9;cDT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;&#x9;cDT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;&#x9;cDT100.addValue('KBKAITORI',&#x9;'90'); //支払//#EOL#&#x9;&#x9;cDT100.addValue('KBKAIHURI',&#x9;'');#EOL#&#x9;&#x9;cDT100.addValue('DTTORIHIKI',&#x9;DT110_DTSYONIN.value);#EOL#&#x9;&#x9;cDT100.addValue('IDHINMOKU',&#x9;'');#EOL#&#x9;&#x9;cDT100.addValue('TXHINBAN',&#x9;&#x9;'');#EOL#&#x9;&#x9;cDT100.addValue('TXHINMEI',&#x9;&#x9;DT110_TXTEKIYO.value);#EOL#&#x9;&#x9;cDT100.addValue('KBUNIT',&#x9;&#x9;'CNT');#EOL#&#x9;&#x9;cDT100.addValue('PRTORIHIKI',&#x9;DT110_AMSIHARAI.value);#EOL#&#x9;&#x9;cDT100.addValue('QTTORIHIKI',&#x9;1);#EOL#&#x9;&#x9;cDT100.addValue('AMTORIHIKI',&#x9;DT110_AMSIHARAI.value);#EOL#&#x9;&#x9;cDT100.addValue('AMTAX',&#x9;&#x9;0);#EOL#&#x9;&#x9;cDT100.addValue('NRSIHARAI',&#x9;'');#EOL#&#x9;&#x9;cDT100.addValue('NRSOURCE',&#x9;&#x9;DT110_NRSOURCE.value);#EOL#&#x9;&#x9;cDT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cDT100.addValue('TXREFNO',&#x9;&#x9;DT110_NRSIHARAI.value);#EOL#&#x9;&#x9;cDT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;cDT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;count = cDT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '仕入実績(DT100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////////////////////// 残高更新 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;amSiharai = Number(amTorihiki) - Number(amTorihikiOld);#EOL#&#x9;if (amSiharai != 0) {#EOL##EOL#&#x9;&#x9;rDT010 = instance.createTableOperator('Select', 'DT010');#EOL#&#x9;&#x9;rDT010.setSelectFields('AMSIHARAI, UPDCOUNTER');#EOL#&#x9;&#x9;rDT010.addKeyValue('IDSIIRESAKI',&#x9;DT110_IDSIIRESAKI.value);#EOL#&#x9;&#x9;if (rDT010.next()) {#EOL#&#x9;&#x9;&#x9;amSiharaiUpdated = Number(rDT010.getValueOf('AMSIHARAI')) + Number(amSiharai);#EOL#&#x9;&#x9;&#x9;uDT010 = instance.createTableOperator('Update', 'DT010');#EOL#&#x9;&#x9;&#x9;uDT010.addValue('AMSIHARAI',&#x9;&#x9;amSiharai);#EOL#&#x9;&#x9;&#x9;uDT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rDT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;uDT010.addKeyValue('IDSIIRESAKI',&#x9;DT110_IDSIIRESAKI.value);#EOL#&#x9;&#x9;&#x9;uDT010.addKeyValue('UPDCOUNTER',&#x9;rDT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;count = uDT010.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '仕入先(DT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;errorMessage = '仕入先(DT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////#EOL#&#x9;// エラー処理 //#EOL#&#x9;////////////////#EOL#&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL#}"/><Script EventP="BC;BU;BD" EventR="BR()" Function="" Name="会計日付の妥当性検査" Order="0031" Text="DT110_DTSIHARAI.error = session.getErrorOfAccountDate(DT110_DTSIHARAI.value);"/></Table><Table ID="DT010" Name="仕入先" Remarks="仕入先に関する属性を保持するためのテーブル。支払方法、銀行口座、買掛残高を含む。" SubsystemID="D"><Field Decimal="" ID="IDSIIRESAKI" Name="仕入先ID" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="TXHURIKOMI" Name="振込銀行口座" Nullable="F" Order="0030" Remarks="" Size="40" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="AMSIIRE" Name="期間仕入額" NoUpdate="T" Nullable="T" Order="0060" Remarks="各種仕入取引の管理テーブルの操作にともなって自動更新される" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMSIHARAI" Name="期間支払額" NoUpdate="T" Nullable="T" Order="0070" Remarks="支払依頼テーブルの操作にともなって自動更新される" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMGENKAIKAKE" Name="現買掛残高" NoUpdate="T" Nullable="T" Order="0080" Remarks="期首残高＋期間仕入額－期間支払額" Size="9" Type="INTEGER" TypeOptions="VIRTUAL"/><Field Decimal="" ID="TXTEKIYO" Name="摘要" Nullable="T" Order="0040" Remarks="" Size="300" Type="VARCHAR" TypeOptions=""/><Key Fields="IDSIIRESAKI" Type="PK"/><Refer Fields="CDTORIHIKISAKI;TXKANA;TXKANJI;NRYUBIN;TXJYUSYO1;TXJYUSYO2;NRDENWA;NRFAX;TXURL" Order="0030" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="DT010.IDSIIRESAKI"/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールドの設定" Order="0000" Text="DT010_AMGENKAIKAKE.value = Number(DT010_AMKISYU.value) + Number(DT010_AMSIIRE.value) - Number(DT010_AMSIHARAI.value);"/><Field Decimal="" ID="AMKISYU" Name="期首買掛残高" NoUpdate="T" Nullable="T" Order="0051" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="KBSIHARAI" Name="支払方法区分" Nullable="F" Order="0021" Remarks="" Size="2" Type="CHAR" TypeOptions="KUBUN(KBSIHARAI)"/><Script EventP="BD" EventR="BR()" Function="" Name="削除チェック" Order="0001" Text="if (DT010_AMGENKAIKAKE.value != 0) {#EOL#&#x9;DT010_IDSIIRESAKI.error = '買掛残高がゼロでないため、削除できません';#EOL#}"/></Table><Table ID="HT020" Name="入荷見出し" Remarks="仕入先からの入荷のまとまりを管理するためのテーブル" SubsystemID="H"><Field Decimal="" ID="NRNYUKA" Name="入荷№" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRNYUKA)"/><Field Decimal="" ID="IDSIIRESAKI" Name="仕入先ID" Nullable="F" Order="0020" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="DTNYUKA" Name="入荷日" NoUpdate="T" Nullable="F" Order="0030" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="" ID="CDSOUKO" Name="倉庫Ｃ" Nullable="F" Order="0040" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Key Fields="NRNYUKA" Type="PK"/><Refer Fields="CDTORIHIKISAKI;TXKANJI" Order="0010" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="HT020.IDSIIRESAKI"/><Refer Fields="TXSOUKO" Order="0020" OrderBy="" TableAlias="" ToKeyFields="CDSOUKO" ToTable="AT040" WithKeyFields="HT020.CDSOUKO"/><Field Decimal="" ID="STNYUKA" Name="入荷状況" NoUpdate="T" Nullable="F" Order="0050" Remarks="" Size="2" Type="CHAR" TypeOptions="VIRTUAL,KUBUN(STNYUKA)"/><Field Decimal="" ID="DTKENSYU" Name="検収日" Nullable="T" Order="0031" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Script EventP="BC" EventR="BR()" Function="" Name="追加前設定" Order="0010" Text="if (HT020_DTNYUKA.value == '') {#EOL#&#x9;HT020_DTNYUKA.value = session.today + '';#EOL#}"/><Script EventP="AR" EventR="AR()" Function="" Name="仮想フィールドの設定" Order="0030" Text="//////////////#EOL#// 入荷状況 //#EOL#//////////////#EOL#var rHT011 = instance.createTableOperator('Count', 'HT011');#EOL#rHT011.addKeyValue('NRNYUKA',&#x9;HT020_NRNYUKA.value);#EOL#if (rHT011.execute() == 0) {#EOL#&#x9;HT020_STNYUKA.value = '90'; //取消済//#EOL#} else {#EOL#&#x9;if (HT020_DTKENSYU.value == '' || HT020_DTKENSYU.oldValue == '') {#EOL#&#x9;&#x9;HT020_STNYUKA.value = '10'; //未検収//#EOL#&#x9;} else {#EOL#&#x9;&#x9;HT020_STNYUKA.value = '20'; //検収済//#EOL#&#x9;}#EOL#}#EOL#HT020_STNYUKA.editable = false;#EOL#"/><Script EventP="BU" EventR="BR()" Function="" Name="更新前設定" Order="0020" Text="if (HT020_DTKENSYU.value == '') {#EOL#&#x9;HT020_DTKENSYU.value = session.today + '';#EOL#}"/><Script EventP="BC;BU;BD" EventR="BR()" Function="" Name="会計日付の妥当性検査" Order="0031" Text="HT020_DTKENSYU.error = session.getErrorOfAccountDate(HT020_DTKENSYU.value);"/></Table><Table ID="DT100" Name="買掛増減履歴" Remarks="買掛残高が増減するたびに記録される監査情報。品番や品名等がスナップショット属性として記録される。" SubsystemID="D"><Field Decimal="" ID="NRKAIKAKE" Name="買掛取引№" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRKAIKAKE)"/><Field Decimal="" ID="IDSIIRESAKI" Name="仕入先ID" NoUpdate="T" Nullable="F" Order="0020" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="DTTORIHIKI" Name="取引日" NoUpdate="T" Nullable="F" Order="0030" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="" ID="KBAKADEN" Name="赤黒" NoUpdate="T" Nullable="F" Order="0050" Remarks="" Size="1" Type="CHAR" TypeOptions="KUBUN(KBAKADEN)"/><Field Decimal="" ID="FGVALID" Name="効区" NoUpdate="T" Nullable="F" Order="0060" Remarks="" Size="1" Type="CHAR" TypeOptions="KUBUN(FGVALID)"/><Field Decimal="" ID="IDHINMOKU" Name="品目ID" NoUpdate="T" Nullable="T" Order="0070" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="PRTORIHIKI" Name="取引単価" NoUpdate="T" Nullable="F" Order="0110" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTTORIHIKI" Name="取引数" NoUpdate="T" Nullable="F" Order="0120" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMTAX" Name="消費税額" NoUpdate="T" Nullable="T" Order="0140" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="NRSOURCE" Name="取引ソース№" NoUpdate="T" Nullable="F" Order="0150" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="NRSIHARAI" Name="支払依頼№" NoUpdate="T" Nullable="T" Order="0160" Remarks="支払依頼エントリーによって自動更新される" Size="7" Type="CHAR" TypeOptions=""/><Key Fields="NRKAIKAKE" Type="PK"/><Refer Fields="" Order="0030" OrderBy="" TableAlias="" ToKeyFields="IDSIIRESAKI" ToTable="DT010" WithKeyFields="DT100.IDSIIRESAKI"/><Refer Fields="TXKANJI;CDTORIHIKISAKI" Order="0040" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="DT100.IDSIIRESAKI"/><Field Decimal="" ID="AMTORIHIKI" Name="税抜取引額" NoUpdate="T" Nullable="F" Order="0130" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="KBUNIT" Name="単位区分" NoUpdate="T" Nullable="F" Order="0100" Remarks="発注単位" Size="3" Type="CHAR" TypeOptions="KUBUN(KBUNIT)"/><Field Decimal="" ID="TXHINBAN" Name="品番" NoUpdate="T" Nullable="T" Order="0080" Remarks="" Size="10" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="TXHINMEI" Name="品名／摘要" NoUpdate="T" Nullable="T" Order="0090" Remarks="" Size="30" Type="CHAR" TypeOptions="KANJI"/><Field ID="DTCREATE" Name="登録日時" NoUpdate="T" Nullable="F" Order="0170" Size="23" Type="TIMESTAMP" TypeOptions=""/><Field ID="TXREFNO" Name="参照番号" NoUpdate="T" Nullable="F" Order="0180" Size="20" Type="CHAR" TypeOptions=""/><Field ID="DTNEND" Name="取引年度" NoUpdate="T" Nullable="F" Order="0190" Size="4" Type="SMALLINT" TypeOptions="FYEAR"/><Field ID="DTMSEQ" Name="取引月序" NoUpdate="T" Nullable="F" Order="0200" Size="2" Type="SMALLINT" TypeOptions="MSEQ"/><Field Decimal="" ID="KBKAITORI" Name="取引区分" NoUpdate="T" Nullable="F" Order="0040" Remarks="" Size="2" Type="CHAR" TypeOptions="KUBUN(KBKAITORI)"/><Refer Fields="AMSIHARAI;DTSYONIN" Order="0050" OrderBy="" TableAlias="" ToKeyFields="NRSIHARAI" ToTable="DT110" WithKeyFields="DT100.NRSIHARAI"/><Script EventP="BU" EventR="AR()" Function="" Name="支払依頼更新時の設定(DF111B)" Order="0000" Text="if (instance.functionID == 'DF111B') {#EOL#&#x9;if (DT100_KBKAITORI.value == '00' || DT100_KBKAITORI.value == '00' || DT100_KBKAITORI.value == '11') {#EOL#&#x9;&#x9;DT110_AMWORK.value = Number(DT110_AMWORK.value) + Number(DT100_AMTORIHIKI.value) + Number(DT100_AMTAX.value);#EOL#&#x9;}#EOL#&#x9;if (DT100_KBKAITORI.value == '02' || DT100_KBKAITORI.value == '10') {#EOL#&#x9;&#x9;DT110_AMWORK.value = Number(DT110_AMWORK.value) - Number(DT100_AMTORIHIKI.value) - Number(DT100_AMTAX.value);#EOL#&#x9;}#EOL#}"/><Field Decimal="" ID="NRSIHARAIWORK" Name="支払依頼№WORK" NoUpdate="T" Nullable="T" Order="0201" Remarks="" Size="7" Type="CHAR" TypeOptions="VIRTUAL"/><Field Decimal="" ID="KBKAIHURI" Name="振替区分" NoUpdate="T" Nullable="T" Order="0041" Remarks="買掛振替の際に設定される" Size="2" Type="CHAR" TypeOptions="KUBUN(KBKAIHURI)"/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールドと文字色の設定" Order="0011" Text="if (DT100_KBAKADEN.value == '2') {#EOL#&#x9;DT100_KBAKADEN.color = 'red';#EOL#}#EOL#if (DT100_KBKAITORI.value == '00' || DT100_KBKAITORI.value == '01' || DT100_KBKAITORI.value == '11') {#EOL#&#x9;DT100_AMZOUGEN.value = Number(DT100_AMTORIHIKI.value) + Number(DT100_AMTAX.value);#EOL#&#x9;DT100_AMTORIHIKISIGN.value = DT100_AMTORIHIKI.value;#EOL#&#x9;DT100_AMTAXSIGN.value = DT100_AMTAX.value;#EOL#} else {#EOL#&#x9;DT100_AMZOUGEN.value = 0 - Number(DT100_AMTORIHIKI.value) - Number(DT100_AMTAX.value);#EOL#&#x9;DT100_AMTORIHIKISIGN.value = DT100_AMTORIHIKI.value * -1;#EOL#&#x9;DT100_AMTAXSIGN.value = DT100_AMTAX.value * -1;#EOL#}#EOL#if (DT100_KBAKADEN.value == '2') {#EOL#&#x9;DT100_AMZOUGEN.value = DT100_AMZOUGEN.value * -1;#EOL#&#x9;DT100_AMTORIHIKISIGN.value = DT100_AMTORIHIKISIGN.value * -1;#EOL#&#x9;DT100_AMTAXSIGN.value = DT100_AMTAXSIGN.value * -1;#EOL#}"/><Field Decimal="" ID="AMZOUGEN" Name="残高増減額" NoUpdate="T" Nullable="F" Order="0202" Remarks="取引区分と赤黒区分にしたがって符号設定された取引額と税額の合計" Size="7" Type="INTEGER" TypeOptions="VIRTUAL,ACCEPT_MINUS"/><Field Decimal="" ID="AMTORIHIKISIGN" Name="符号付税抜取引額" NoUpdate="T" Nullable="F" Order="0203" Remarks="取引区分と赤黒区分にしたがって符号設定された取引額" Size="7" Type="INTEGER" TypeOptions="VIRTUAL,ACCEPT_MINUS"/><Field Decimal="" ID="AMTAXSIGN" Name="符号付消費税額" NoUpdate="T" Nullable="F" Order="0204" Remarks="取引区分と赤黒区分にしたがって符号設定された取引額" Size="7" Type="INTEGER" TypeOptions="VIRTUAL,ACCEPT_MINUS"/></Table><Table ID="ET110" Name="請求見出し" Remarks="売上実績にもとづく請求を管理するためのテーブル。都度請求の得意先の場合は売上計上のたびに請求データが追加され、締め請求の場合には締めの度に追加される。" SubsystemID="E"><Field Decimal="" ID="NRSEIKYU" Name="請求№" Nullable="F" Order="0000" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRSEIKYU)"/><Field Decimal="" ID="IDTOKUISAKI" Name="得意先ID" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="DTSEIKYU" Name="請求日" Nullable="F" Order="0020" Remarks="" Size="8" Type="DATE" TypeOptions=""/><Field Decimal="" ID="TXTEKIYO" Name="摘要" Nullable="T" Order="0030" Remarks="" Size="300" Type="VARCHAR" TypeOptions=""/><Field Decimal="" ID="AMSEIKYU" Name="請求額" NoUpdate="T" Nullable="T" Order="0040" Remarks="関連する売掛増減履歴にもとづいて集計される、請求対象分の売上計上額" Size="9" Type="INTEGER" TypeOptions="VIRTUAL"/><Field Decimal="" ID="AMNYUKIN" Name="前回以降入金額" NoUpdate="T" Nullable="T" Order="0050" Remarks="関連する売掛増減履歴にもとづいて集計される、前回請求時以降の受領額" Size="9" Type="INTEGER" TypeOptions="VIRTUAL"/><Key Fields="NRSEIKYU" Type="PK"/><Refer Fields="TXKANJI;NRYUBIN;TXJYUSYO1;TXJYUSYO2;NRDENWA;CDTORIHIKISAKI" Order="0060" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="ET110.IDTOKUISAKI"/><Refer Fields="TXTANTOUSYA;TXTANTOUSYASYOKUI;TXTANTOUSYAEMAIL;KBSEIKYUHOUSHIKI;NRTANTOUJYUGYOIN;AMKISYU;AMURIAGE;AMJYURYO;AMGENURIKAKE" Order="0070" OrderBy="" TableAlias="" ToKeyFields="IDTOKUISAKI" ToTable="ET010" WithKeyFields="ET110.IDTOKUISAKI"/><Refer Fields="TXKANJI" Order="0080" OrderBy="" TableAlias="" ToKeyFields="NRJYUGYOIN" ToTable="AT020" WithKeyFields="ET010.NRTANTOUJYUGYOIN"/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールド設定" Order="0000" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rET100; var amSeikyu = 0; var amNyukin = 0;#EOL##EOL#//////////////////////////#EOL#// 請求額・入金額の集計 //#EOL#//////////////////////////#EOL#rET100 = instance.createTableOperator('Select', 'ET100');#EOL#rET100.setSelectFields('KBURITORI, AMTORIHIKI, AMTAX, KBAKADEN');#EOL#rET100.addKeyValue('NRSEIKYU',&#x9;ET110_NRSEIKYU.value);#EOL#while (rET100.next()) {#EOL#&#x9;if (rET100.getValueOf('KBAKADEN') == '1') {#EOL#&#x9;&#x9;if (rET100.getValueOf('KBURITORI') == '90' || rET100.getValueOf('KBURITORI') == '91' || rET100.getValueOf('KBURITORI') == '92') {#EOL#&#x9;&#x9;&#x9; amNyukin = Number(amNyukin) + Number(rET100.getValueOf('AMTORIHIKI')) + Number(rET100.getValueOf('AMTAX'));#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;if (rET100.getValueOf('KBURITORI') == '00' || rET100.getValueOf('KBURITORI') == '01' || rET100.getValueOf('KBURITORI') == '11') {#EOL#&#x9;&#x9;&#x9; amSeikyu = Number(amSeikyu) + Number(rET100.getValueOf('AMTORIHIKI')) + Number(rET100.getValueOf('AMTAX'));#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;if (rET100.getValueOf('KBURITORI') == '02' || rET100.getValueOf('KBURITORI') == '10') {#EOL#&#x9;&#x9;&#x9; amSeikyu = Number(amSeikyu) - Number(rET100.getValueOf('AMTORIHIKI')) - Number(rET100.getValueOf('AMTAX'));#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;if (rET100.getValueOf('KBURITORI') == '90' || rET100.getValueOf('KBURITORI') == '91' || rET100.getValueOf('KBURITORI') == '92') {#EOL#&#x9;&#x9;&#x9; amNyukin = Number(amNyukin) - Number(rET100.getValueOf('AMTORIHIKI')) - Number(rET100.getValueOf('AMTAX'));#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;if (rET100.getValueOf('KBURITORI') == '00' || rET100.getValueOf('KBURITORI') == '01' || rET100.getValueOf('KBURITORI') == '11') {#EOL#&#x9;&#x9;&#x9; amSeikyu = Number(amSeikyu) - Number(rET100.getValueOf('AMTORIHIKI')) - Number(rET100.getValueOf('AMTAX'));#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;if (rET100.getValueOf('KBURITORI') == '02' || rET100.getValueOf('KBURITORI') == '10') {#EOL#&#x9;&#x9;&#x9; amSeikyu = Number(amSeikyu) + Number(rET100.getValueOf('AMTORIHIKI')) + Number(rET100.getValueOf('AMTAX'));#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL#ET110_AMSEIKYU.value = amSeikyu;#EOL#ET110_AMNYUKIN.value = amNyukin;"/><Script EventP="AC" EventR="" Function="" Name="追加後の更新処理" Order="0010" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rET100; var uET100; var count = 0; var errorMessage = '';#EOL##EOL#//////////////////////////////////////#EOL#// 受領分の売掛増減履歴の検索と更新 //#EOL#//////////////////////////////////////#EOL#rET100 = instance.createTableOperator('Select', 'ET100');#EOL#rET100.setSelectFields('NRURIKAKE');#EOL#rET100.addKeyValue('IDTOKUISAKI',&#x9;ET110_IDTOKUISAKI.value);#EOL#rET100.addKeyValue('NRSEIKYU',&#x9;&#x9;'       ');#EOL#rET100.addKeyValue('FGVALID',&#x9;&#x9;'T');#EOL#rET100.addKeyValue('KBURITORI',&#x9;&#x9;'90');#EOL#while (rET100.next()) {#EOL#&#x9;uET100 = instance.createTableOperator('Update', 'ET100');#EOL#&#x9;uET100.addValue('NRSEIKYU',&#x9;ET110_NRSEIKYU.value);#EOL#&#x9;uET100.addKeyValue('NRURIKAKE',&#x9;rET100.getValueOf('NRURIKAKE'));#EOL#&#x9;count = uET100.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '受領分の売掛増減履歴(ET100)の更新に失敗しました。処理は取り消されます。';#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL#"/><Script EventP="BC" EventR="BR()" Function="" Name="追加前の初期値設定" Order="0020" Text="if (ET110_DTSEIKYU.value == '') {#EOL#&#x9;ET110_DTSEIKYU.value = session.today + '';#EOL#}"/></Table><Table DetailRowNumberAuto="T" ID="BT040" Name="製造品材料明細" Remarks="製造品の材料構成を保持するためのテーブル。部品表のこと。" SubsystemID="B"><Field Decimal="" ID="IDSEIZOHIN" Name="製造品目ID" Nullable="F" Order="0000" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="SQZAIRYO" Name="材料行番" Nullable="F" Order="0010" Remarks="" Size="3" Type="SMALLINT" TypeOptions=""/><Field Decimal="" ID="IDHINCHILD" Name="材料品目ID" Nullable="F" Order="0020" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="VLKOUSEI" Name="構成数" Nullable="F" Order="0030" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="SQKOUTEI" Name="投入工程行番" Nullable="F" Order="0040" Remarks="" Size="3" Type="SMALLINT" TypeOptions=""/><Field Decimal="" ID="SQLIST" Name="一覧順" Nullable="T" Order="0050" Remarks="" Size="4" Type="SMALLINT" TypeOptions="NO_EDIT"/><Key Fields="IDSEIZOHIN;SQZAIRYO" Type="PK"/><Refer Fields="TXHINBAN;TXHINMEI;KBUNIT;IDHINMOKU" Order="0090" OrderBy="" TableAlias="BT010P" ToKeyFields="IDHINMOKU" ToTable="BT010" WithKeyFields="BT040.IDSEIZOHIN"/><Refer Fields="TXHINBAN;TXHINMEI;KBUNIT" Order="0100" OrderBy="" TableAlias="BT010C" ToKeyFields="IDHINMOKU" ToTable="BT010" WithKeyFields="BT040.IDHINCHILD"/><Refer Fields="CDKOUTEI" Order="0110" OrderBy="" TableAlias="" ToKeyFields="IDSEIZOHIN;SQKOUTEI" ToTable="BT030" WithKeyFields="BT040.IDSEIZOHIN;BT040.SQKOUTEI"/><Refer Fields="TXNAME" Order="0120" OrderBy="" TableAlias="" ToKeyFields="CDKOUTEI" ToTable="BT050" WithKeyFields="BT030.CDKOUTEI"/><Script EventP="BC" EventR="BR()" Function="" Name="追加時の初期値設定" Order="0000" Text="if (BT040_SQLIST.value == 0) {#EOL#&#x9;BT040_SQLIST.value = BT040_SQKOUTEI.value * 10;#EOL#}"/></Table><Table DetailRowNumberAuto="T" ID="BT030" Name="製造品工程明細" Remarks="製造品の工程の一覧やその順序を保持するためのテーブル。リードタイムや加工レート、標準作業場といった属性を含む。" SubsystemID="B"><Field Decimal="" ID="IDSEIZOHIN" Name="製造品目ID" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="SQKOUTEI" Name="工程行番" Nullable="F" Order="0020" Remarks="" Size="3" Type="SMALLINT" TypeOptions=""/><Field Decimal="" ID="CDKOUTEI" Name="工程C" Nullable="F" Order="0030" Remarks="１製品について、計画工程は１個であること。" Size="3" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="SQLIST" Name="工程順序" Nullable="T" Order="0080" Remarks="" Size="4" Type="SMALLINT" TypeOptions="NO_EDIT"/><Field Decimal="" ID="VLLTFIX" Name="標準固定LT" Nullable="T" Order="0040" Remarks="製造指示数の多寡に関係なく必要なリードタイム" Size="3" Type="SMALLINT" TypeOptions=""/><Field Decimal="" ID="VLLTQTY" Name="標準従量LT" Nullable="T" Order="0050" Remarks="製造指示数１単位あたりのリードタイム" Size="3" Type="SMALLINT" TypeOptions=""/><Key Fields="IDSEIZOHIN;SQKOUTEI" Type="PK"/><Field Decimal="" ID="SQCENTER" Name="標準作業場行番" Nullable="F" Order="0070" Remarks="" Size="2" Type="SMALLINT" TypeOptions=""/><Refer Fields="TXNAME;FGPLANNING" Order="0030" OrderBy="" TableAlias="" ToKeyFields="CDKOUTEI" ToTable="BT050" WithKeyFields="BT030.CDKOUTEI"/><Refer Fields="TXCENTER" Order="0040" OrderBy="" TableAlias="" ToKeyFields="CDKOUTEI;SQCENTER" ToTable="BT060" WithKeyFields="BT030.CDKOUTEI;BT030.SQCENTER"/><Script EventP="BC" EventR="BR()" Function="" Name="追加時の初期値設定" Order="0000" Text="if (BT030_SQLIST.value == 0) {#EOL#&#x9;BT030_SQLIST.value = BT030_SQKOUTEI.value * 10;#EOL#}"/><Script EventP="BC;BU" EventR="AR()" Function="" Name="関連する計画工程の件数チェック" Order="0001" Text="if (instance.functionID == 'BF030') {#EOL#&#x9;if (BT050_FGPLANNING.value == 'T') {#EOL#&#x9;&#x9;BT010_CTWORK.value = Number(BT010_CTWORK.value) + 1;#EOL#&#x9;}#EOL#}"/></Table><Table DetailRowNumberAuto="T" ID="BT020" Name="製造品仕様明細" Remarks="製造品の仕様構成を保持するためのテーブル。属性である仕様区分は、ユーザ定義区分として定義される。" SubsystemID="B"><Field Decimal="" ID="IDSEIZOHIN" Name="製造品目ID" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="SQSPEC" Name="仕様行番" Nullable="F" Order="0020" Remarks="" Size="3" Type="SMALLINT" TypeOptions=""/><Field Decimal="" ID="SQLIST" Name="一覧順序" Nullable="T" Order="0050" Remarks="" Size="4" Type="SMALLINT" TypeOptions="NO_EDIT"/><Key Fields="IDSEIZOHIN;SQSPEC" Type="PK"/><Field ID="KBSPEC" Name="仕様区分" Nullable="F" Order="0030" Size="3" Type="CHAR" TypeOptions="KUBUN(KBSPEC)"/><Key Fields="IDSEIZOHIN;KBSPEC" Type="SK"/><Field ID="TXTEKIYO" Name="摘要" Nullable="T" Order="0040" Size="300" Type="VARCHAR" TypeOptions=""/></Table><Table DetailRowNumberAuto="T" ID="JT040" Name="製造指示材料明細" Remarks="受注生産品の材料内訳情報を保持するためのテーブル。製造品材料明細マスターによって展開される。" SubsystemID="J"><Field Decimal="" ID="NRSEIZO" Name="製造指示№" Nullable="F" Order="0000" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="SQZAIRYO" Name="材料行番" Nullable="F" Order="0010" Remarks="" Size="3" Type="SMALLINT" TypeOptions=""/><Field Decimal="" ID="IDHINMOKU" Name="材料品目ID" Nullable="F" Order="0020" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="QTTOUNYU" Name="投入数" Nullable="T" Order="0030" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="SQKOUTEI" Name="投入工程行番" Nullable="F" Order="0040" Remarks="" Size="3" Type="SMALLINT" TypeOptions=""/><Field Decimal="" ID="SQLIST" Name="一覧順序" Nullable="F" Order="0060" Remarks="" Size="4" Type="SMALLINT" TypeOptions=""/><Key Fields="NRSEIZO;SQZAIRYO" Type="PK"/><Refer Fields="CDKOUTEI" Order="0030" OrderBy="" TableAlias="" ToKeyFields="NRSEIZO;SQKOUTEI" ToTable="JT030" WithKeyFields="JT040.NRSEIZO;JT040.SQKOUTEI"/><Refer Fields="TXNAME" Order="0040" OrderBy="" TableAlias="" ToKeyFields="CDKOUTEI" ToTable="BT050" WithKeyFields="JT030.CDKOUTEI"/><Refer Fields="IDSEIZOHIN;NRSOURCE" Optional="T" Order="0050" OrderBy="" TableAlias="" ToKeyFields="NRSEIZO" ToTable="JT010" WithKeyFields="JT040.NRSEIZO"/><Field Decimal="" ID="PRSYUKKO" Name="出庫単価" NoUpdate="T" Nullable="T" Order="0053" Remarks="出庫時に移動平均単価が設定されるまではゼロ" Size="7" Type="INTEGER" TypeOptions=""/><Script EventP="AU" EventR="" Function="" Name="材料出庫にともなう在庫更新(JF042)" Order="0030" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rFT100; var uFT100; var cFT100;#EOL#var rFT010; var cFT010; var uFT010; var rJT030; var rJT040;#EOL#var amUkebarai = 0; var amNyuko = 0; var amSyukko = 0;#EOL#var qtUkebarai = 0; var qtNyuko = 0; var qtSyukko = 0;#EOL#var qtUkebaraiOld = 0; var amUkebaraiOld = 0;#EOL#var amSyukkoUpdated = 0; var qtSyukkoUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var dtNendOld = 0; var dtMSeqOld = 0;#EOL#var genka = 0; var count = 0; var errorMessage = '';#EOL##EOL#/////////////////////////////////////////////////////#EOL#// 材料出庫エントリー(JF041)で処理された場合に実行 //#EOL#/////////////////////////////////////////////////////#EOL#if (instance.functionID == 'JF041') {#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////////////////////// 赤伝処理 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;if (JT010_DTSYUKKO.oldValue != null &amp;&amp; JT010_DTSYUKKO.oldValue != '') {#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNendOld = session.getFYearOfDate(JT010_DTSYUKKO.oldValue);#EOL#&#x9;&#x9;dtMSeqOld = session.getMSeqOfDate(JT010_DTSYUKKO.oldValue);#EOL#&#x9;&#x9;qtUkebaraiOld = JT040_QTTOUNYU.oldValue;#EOL#&#x9;&#x9;amUkebaraiOld = qtUkebaraiOld * JT040_PRSYUKKO.oldValue;#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 受払実績(FT100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;cFT100.addValue('KBUKEBARAI',&#x9;'160'); //材料出庫//#EOL#&#x9;&#x9;cFT100.addValue('DTTORIHIKI',&#x9;JT010_DTSYUKKO.oldValue);#EOL#&#x9;&#x9;cFT100.addValue('IDHINMOKU',&#x9;JT040_IDHINMOKU.value);#EOL#&#x9;&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010ZAI_TXHINBAN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010ZAI_TXHINMEI.value);#EOL#&#x9;&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;BT010ZAI_KBUNIT.value);#EOL#&#x9;&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;JT010_CDSOUKOZAI.oldValue);#EOL#&#x9;&#x9;cFT100.addValue('TXAITESAKI',&#x9;'製造現場');#EOL#&#x9;&#x9;cFT100.addValue('PRTORIHIKI',&#x9;JT040_PRSYUKKO.oldValue);#EOL#&#x9;&#x9;cFT100.addValue('QTTORIHIKI',&#x9;qtUkebaraiOld);#EOL#&#x9;&#x9;cFT100.addValue('AMTORIHIKI',&#x9;amUkebaraiOld);#EOL#&#x9;&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#&#x9;&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;JT010_NRSOURCE.value);#EOL#&#x9;&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;JT010_NRSEIZO.value + '-' + JT040_SQZAIRYO.value);#EOL#&#x9;&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#&#x9;&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#&#x9;&#x9;count = cFT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////////////////////// 黒伝処理 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL##EOL#&#x9;//////////////////////////////#EOL#&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;//////////////////////////////#EOL#&#x9;dtNend = session.getFYearOfDate(JT010_DTSYUKKO.value);#EOL#&#x9;dtMSeq = session.getMSeqOfDate(JT010_DTSYUKKO.value);#EOL#&#x9;qtUkebarai = JT040_QTTOUNYU.value;#EOL#&#x9;amUkebarai = qtUkebarai * JT040_PRSYUKKO.value;#EOL##EOL#&#x9;///////////////////////////#EOL#&#x9;// 受払実績(ET100)の追加 //#EOL#&#x9;///////////////////////////#EOL#&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;cFT100.addValue('KBUKEBARAI',&#x9;'160'); //材料出庫//#EOL#&#x9;cFT100.addValue('DTTORIHIKI',&#x9;JT010_DTSYUKKO.value);#EOL#&#x9;cFT100.addValue('IDHINMOKU',&#x9;JT040_IDHINMOKU.value);#EOL#&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010ZAI_TXHINBAN.value);#EOL#&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010ZAI_TXHINMEI.value);#EOL#&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;BT010ZAI_KBUNIT.value);#EOL#&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;JT010_CDSOUKOZAI.value);#EOL#&#x9;cFT100.addValue('TXAITESAKI',&#x9;'製造現場');#EOL#&#x9;cFT100.addValue('PRTORIHIKI',&#x9;JT040_PRSYUKKO.value);#EOL#&#x9;cFT100.addValue('QTTORIHIKI',&#x9;qtUkebarai);#EOL#&#x9;cFT100.addValue('AMTORIHIKI',&#x9;amUkebarai);#EOL#&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;JT010_NRSOURCE.value);#EOL#&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;JT010_NRSEIZO.value + '-' + JT040_SQZAIRYO.value);#EOL#&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;count = cFT100.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////////////////////// 残高更新 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL##EOL#&#x9;///////////////////////////#EOL#&#x9;// 倉庫在庫(FT010)の更新 //#EOL#&#x9;///////////////////////////#EOL#&#x9;rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#&#x9;rFT010.setSelectFields('QTKISYU, QTNYUKO, QTSYUKKO, AMKISYU, AMNYUKO, AMSYUKKO, UPDCOUNTER');#EOL#&#x9;rFT010.addKeyValue('IDHINMOKU',&#x9;JT040_IDHINMOKU.value);#EOL#&#x9;rFT010.addKeyValue('CDSOUKO',&#x9;JT010_CDSOUKOZAI.value);#EOL#&#x9;if (rFT010.next()) {#EOL#&#x9;&#x9;qtSyukkoUpdated = Number(rFT010.getValueOf('QTSYUKKO')) + Number(qtUkebarai) - Number(qtUkebaraiOld);#EOL#&#x9;&#x9;amSyukkoUpdated = Number(rFT010.getValueOf('AMSYUKKO')) + Number(amUkebarai) - Number(amUkebaraiOld);#EOL#&#x9;&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;&#x9;uFT010.addValue('AMSYUKKO',&#x9;&#x9;&#x9;amSyukkoUpdated);#EOL#&#x9;&#x9;uFT010.addValue('QTSYUKKO',&#x9;&#x9;&#x9;qtSyukkoUpdated);#EOL#&#x9;&#x9;uFT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;JT040_IDHINMOKU.value);#EOL#&#x9;&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;JT010_CDSOUKOZAI.value);#EOL#&#x9;&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;count = uFT010.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;qtSyukkoUpdated = Number(qtUkebarai) - Number(qtUkebaraiOld);#EOL#&#x9;&#x9;amSyukkoUpdated = Number(amUkebarai) - Number(amUkebaraiOld);#EOL#&#x9;&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;&#x9;cFT010.addValue('IDHINMOKU',&#x9;JT040_IDHINMOKU.value);#EOL#&#x9;&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;JT010_CDSOUKOZAI.value);#EOL#&#x9;&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;0);#EOL#&#x9;&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;0);#EOL#&#x9;&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;amSyukkoUpdated);#EOL#&#x9;&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;0);#EOL#&#x9;&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;0);#EOL#&#x9;&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;qtSyukkoUpdated);#EOL#&#x9;&#x9;count = cFT010.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////#EOL#&#x9;// エラー処理 //#EOL#&#x9;////////////////#EOL#&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL#}"/><Script EventP="BU" EventR="BR()" Function="" Name="材料出庫にともなう出庫単価設定(JF041)" Order="0020" Text="/////////////////////////////////////////////////////#EOL#// 材料出庫エントリー(JF041)で処理された場合に実行 //#EOL#/////////////////////////////////////////////////////#EOL#if (instance.functionID == 'JF041') {#EOL##EOL#&#x9;///////////////////////////////////////////#EOL#&#x9;// 倉庫在庫(FT010)にもとづく出庫単価設定 //#EOL#&#x9;///////////////////////////////////////////#EOL#&#x9;var rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#&#x9;rFT010.setSelectFields('QTKISYU, QTNYUKO, QTSYUKKO, AMKISYU, AMNYUKO, AMSYUKKO, UPDCOUNTER');#EOL#&#x9;rFT010.addKeyValue('IDHINMOKU',&#x9;JT040_IDHINMOKU.value);#EOL#&#x9;rFT010.addKeyValue('CDSOUKO',&#x9;JT010_CDSOUKOZAI.value);#EOL#&#x9;if (rFT010.next()) {#EOL#&#x9;&#x9;var qtGenzaiko = Number(rFT010.getValueOf('QTKISYU')) + Number(rFT010.getValueOf('QTNYUKO')) - Number(rFT010.getValueOf('QTSYUKKO'));#EOL#&#x9;&#x9;var amGenzaiko = Number(rFT010.getValueOf('AMKISYU')) + Number(rFT010.getValueOf('AMNYUKO')) - Number(rFT010.getValueOf('AMSYUKKO'));#EOL#&#x9;&#x9;if (qtGenzaiko &lt;= 0) {#EOL#&#x9;&#x9;&#x9;JT040_PRSYUKKO.value = 0;#EOL#&#x9;&#x9;&#x9;JT040_PRSYUKKO.error = '在庫が存在しないため、出庫単価を設定できません。';#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;JT040_PRSYUKKO.value = Math.round(amGenzaiko / qtGenzaiko);#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;JT040_PRSYUKKO.value = 0;#EOL#&#x9;&#x9;JT040_PRSYUKKO.error = '在庫が存在しないため、出庫単価を設定できません。';#EOL#&#x9;}#EOL#}"/><Field Decimal="" ID="PRYOTEI" Name="予定単価" Nullable="T" Order="0041" Remarks="製造指示が追加された際の標準原価が設定される。" Size="7" Type="INTEGER" TypeOptions=""/><Refer Fields="TXHINBAN;TXHINMEI;KBUNIT" Order="0020" OrderBy="" TableAlias="BT010ZAI" ToKeyFields="IDHINMOKU" ToTable="BT010" WithKeyFields="JT040.IDHINMOKU"/></Table><Table DetailRowNumberAuto="T" ID="JT020" Name="製造指示仕様明細" Remarks="受注生産品の仕様内訳情報を保持するためのテーブル。製造品仕様明細マスターによって展開される。" SubsystemID="J"><Field Decimal="" ID="NRSEIZO" Name="製造指示№" Nullable="F" Order="0000" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="SQSPEC" Name="仕様行番" Nullable="F" Order="0010" Remarks="" Size="3" Type="SMALLINT" TypeOptions=""/><Field Decimal="" ID="TXVALUE" Name="仕様値" Nullable="F" Order="0020" Remarks="入力値や入力可／不可はBT020の設定式に制約される" Size="50" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="SQLIST" Name="一覧順序" Nullable="F" Order="0030" Remarks="" Size="4" Type="SMALLINT" TypeOptions=""/><Key Fields="NRSEIZO;SQSPEC" Type="PK"/><Refer Fields="IDSEIZOHIN" Optional="T" Order="0010" OrderBy="" TableAlias="" ToKeyFields="NRSEIZO" ToTable="JT010" WithKeyFields="JT020.NRSEIZO"/><Script EventP="BU" EventR="AR()" Function="" Name="仕様値の設定と評価" Order="0000" Text="/////////////////////////////////////////////////#EOL#// 素材(010)：木材, アルミ, 超合金Ｚのいずれか //#EOL#/////////////////////////////////////////////////#EOL#if (BT020_KBSPEC.value == '010') {#EOL#&#x9;JT020_TXVALUE.valueList = ['木材', 'アルミ', '超合金Ｚ']; //選択肢//#EOL#&#x9;if (JT020_TXVALUE.value == '') {#EOL#&#x9;&#x9;JT020_TXVALUE.value = '木材'; //初期値//#EOL#&#x9;}#EOL#&#x9;instance.setVariant('010', JT020_TXVALUE.value); //仕様変数登録//#EOL#}#EOL##EOL#//////////////////////////////////////////#EOL#// 全長(020)：1000～50000の範囲内が有効 //#EOL#//////////////////////////////////////////#EOL#if (BT020_KBSPEC.value == '020') {#EOL#&#x9;var length = 0;#EOL#&#x9;if (JT020_TXVALUE.value == '' || JT020_TXVALUE.value == '0') {#EOL#&#x9;&#x9;JT020_TXVALUE.value = '1,000'; //初期値//#EOL#&#x9;&#x9;length = new String('1000');#EOL#&#x9;} else {#EOL#&#x9;&#x9;length = new String(JT020_TXVALUE.value).replace(/,/g, '');#EOL#&#x9;&#x9;if (isFinite(length)) {#EOL#&#x9;&#x9;&#x9;if (length &lt; 1000 || length > 50000) {#EOL#&#x9;&#x9;&#x9;&#x9;length = 0;#EOL#&#x9;&#x9;&#x9;&#x9;JT020_TXVALUE.error = '1000～50000の範囲内で指定してください。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;length = new String('0');#EOL#&#x9;&#x9;&#x9;JT020_TXVALUE.error = '1000～50000の範囲内で指定してください。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#&#x9;instance.setVariant('020', length); //仕様変数登録//#EOL##EOL#&#x9;////////////////////////#EOL#&#x9;// 全長値のコンマ編集 //#EOL#&#x9;////////////////////////#EOL#&#x9;while (length != (length = length.replace( /^(-?\d+)(\d{3})/, &quot;$1,$2&quot; )));#EOL#&#x9;JT020_TXVALUE.value = length;#EOL#}#EOL##EOL#/////////////////////////////////////////////#EOL#// 重量(030)：素材の単重と全長から自動計算 //#EOL#/////////////////////////////////////////////#EOL#if (BT020_KBSPEC.value == '030') {#EOL#&#x9;JT020_TXVALUE.editable = false; //入力不可設定//#EOL##EOL#&#x9;//////////////#EOL#&#x9;// 重量計算 //#EOL#&#x9;//////////////#EOL#&#x9;JT020_TXVALUE.value = 0;#EOL#&#x9;var sozai = instance.getVariant('010');#EOL#&#x9;var length = new String(instance.getVariant('020')).replace(',', '');#EOL#&#x9;if (sozai == '木材') {#EOL#&#x9;&#x9;  JT020_TXVALUE.value = 10 * length;#EOL#&#x9;}#EOL#&#x9;if (sozai == 'アルミ') {#EOL#&#x9;&#x9;  JT020_TXVALUE.value = 20 * length;#EOL#&#x9;}#EOL#&#x9;if (sozai == '超合金Ｚ') {#EOL#&#x9;&#x9;  JT020_TXVALUE.value = 30 * length;#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////#EOL#&#x9;// 重量値のコンマ編集 //#EOL#&#x9;////////////////////////#EOL#&#x9;var weight = new String(JT020_TXVALUE.value).replace('.0', '');#EOL#&#x9;while (weight != (weight = weight.replace( /^(-?\d+)(\d{3})/, &quot;$1,$2&quot; )));#EOL#&#x9;JT020_TXVALUE.value = weight;#EOL#}"/><Refer Fields="KBSPEC;TXTEKIYO" Order="0020" OrderBy="" TableAlias="" ToKeyFields="IDSEIZOHIN;SQSPEC" ToTable="BT020" WithKeyFields="JT010.IDSEIZOHIN;JT020.SQSPEC"/></Table><Table DetailRowNumberAuto="T" ID="BT060" Name="作業場" Remarks="工程を実際に担う場所についての情報を保持するテーブル。日々の開始時刻や終了時刻を属性として含む。" SubsystemID="B"><Field Decimal="" ID="TXCENTER" Name="作業場名" Nullable="F" Order="0040" Remarks="" Size="10" Type="CHAR" TypeOptions="KANJI"/><Field Decimal="" ID="CDKOUTEI" Name="工程C" Nullable="F" Order="0010" Remarks="" Size="3" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="KBCALENDAR" Name="カレンダー区分" Nullable="F" Order="0050" Remarks="" Size="2" Type="CHAR" TypeOptions="KUBUN(KBCALENDAR)"/><Field Decimal="" ID="TMFROM" Name="稼働開始時刻" Nullable="T" Order="0060" Remarks="" Size="4" Type="SMALLINT" TypeOptions="HH_MM"/><Field Decimal="" ID="TMTHRU" Name="稼働終了時刻" Nullable="T" Order="0070" Remarks="" Size="4" Type="SMALLINT" TypeOptions="HH_MM"/><Key Fields="CDKOUTEI;SQCENTER" Type="PK"/><Field ID="SQCENTER" Name="作業場行番" Nullable="F" Order="0030" Size="2" Type="SMALLINT" TypeOptions="NO_EDIT"/><Refer Fields="TXNAME;FGPLANNING" Order="0020" OrderBy="" TableAlias="" ToKeyFields="CDKOUTEI" ToTable="BT050" WithKeyFields="BT060.CDKOUTEI"/><Field Decimal="" ID="RTKAKOU" Name="加工レート" Nullable="T" Order="0071" Remarks="１時間あたりの労務費" Size="7" Type="INTEGER" TypeOptions=""/></Table><Table ID="BT050" Name="工程" Remarks="概念上の工程の定義情報を保持するためのテーブル。計画対象であるような工程であれば、製造指示毎にその工程の前後に手番ずらしがなされる。" SubsystemID="B"><Field Decimal="" ID="CDKOUTEI" Name="工程C" Nullable="F" Order="0000" Remarks="" Size="3" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="TXNAME" Name="工程名" Nullable="F" Order="0010" Remarks="" Size="10" Type="CHAR" TypeOptions="KANJI"/><Field Decimal="" ID="FGPLANNING" Name="計画対象フラグ" Nullable="F" Order="0020" Remarks="" Size="1" Type="CHAR" TypeOptions="BOOLEAN(T;F)"/><Key Fields="CDKOUTEI" Type="PK"/></Table><Table DetailRowNumberAuto="F" ID="JT030W" Name="製造指示工程明細ワーク" Remarks="JF030用の明細ワークテーブル。特定作業場向けの未完成分の製造指示工程明細レコードが格納される。" SubsystemID="J"><Field Decimal="" ID="NRSEIZO" Name="製造指示№" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="SQKOUTEI" Name="工程行番" Nullable="F" Order="0020" Remarks="" Size="3" Type="SMALLINT" TypeOptions=""/><Field ID="TXSAGYOYOTEI" Name="作業予定日時" NoUpdate="T" Nullable="T" Order="0110" Remarks="開始・完了予定日時から 12/25 12:30～12/25 18:00 のように設定される" Size="24" Type="CHAR" TypeOptions="VIRTUAL"/><Field Decimal="" ID="NRSEIZO2" Name="製造指示№２" Nullable="F" Order="0021" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="SQKOUTEI2" Name="工程行番２" Nullable="F" Order="0022" Remarks="" Size="3" Type="SMALLINT" TypeOptions=""/><Key Fields="NRSEIZO;SQKOUTEI;NRSEIZO2;SQKOUTEI2" Type="PK"/><Refer Fields="IDSEIZOHIN;QTSEIZO" Optional="T" Order="0010" OrderBy="" TableAlias="" ToKeyFields="NRSEIZO" ToTable="JT010" WithKeyFields="JT030W.NRSEIZO2"/><Refer Fields="TXHINBAN;TXHINMEI;KBUNIT" Order="0020" OrderBy="" TableAlias="" ToKeyFields="IDHINMOKU" ToTable="BT010" WithKeyFields="JT010.IDSEIZOHIN"/><Script EventP="BU;AR" EventR="AR()" Function="" Name="仮想フィールドの設定" Order="0020" Text="//////////////////#EOL#// 作業予定日時 //#EOL#//////////////////#EOL#var wrkStr = '';#EOL#var fromDateTime = '00/00 00:00';#EOL#var thruDateTime = '00/00 00:00';#EOL#if (JT030W_DTFROM.value != null &amp;&amp; JT030W_DTFROM.value != '') {#EOL#&#x9;wrkStr = JT030W_DTFROM.value + '';#EOL#&#x9;fromDateTime = wrkStr.substr(5,5) + ' ' + session.formatTime(JT030W_TMFROM.value);#EOL#&#x9;fromDateTime = fromDateTime.replace(/-/g, '/');#EOL#}#EOL#if (JT030W_DTTHRU.value != null &amp;&amp; JT030W_DTTHRU.value != '') {#EOL#&#x9;wrkStr = JT030W_DTTHRU.value + '';#EOL#&#x9;thruDateTime = wrkStr.substr(5,5) + ' ' + session.formatTime(JT030W_TMTHRU.value);#EOL#&#x9;thruDateTime = thruDateTime.replace(/-/g, '/');#EOL#}#EOL#JT030W_TXSAGYOYOTEI.value = fromDateTime + '～' + thruDateTime;"/><Field Decimal="" ID="DTFROM" Name="開始予定日" Nullable="T" Order="0023" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="" ID="TMFROM" Name="開始予定時刻" Nullable="T" Order="0024" Remarks="" Size="4" Type="SMALLINT" TypeOptions="HH_MM"/><Field Decimal="" ID="DTTHRU" Name="完了予定日" Nullable="T" Order="0025" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="" ID="TMTHRU" Name="完了予定時刻" Nullable="T" Order="0026" Remarks="" Size="4" Type="SMALLINT" TypeOptions="HH_MM"/><Script EventP="BR" EventR="" Function="" Hold="F" Name="読込前のレコード設定" Order="0010" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rJT010; var rJT030; var dJT030W; var cJT030W;#EOL##EOL#/////////////////////////////////////////#EOL#// 親レコードの工程Cと作業場行番の読込 //#EOL#/////////////////////////////////////////#EOL#rJT030 = instance.createTableOperator('Select', 'JT030');#EOL#rJT030.addKeyValue('NRSEIZO',&#x9;instance.parmMap.get('NRSEIZO'));#EOL#rJT030.addKeyValue('SQKOUTEI',&#x9;instance.parmMap.get('SQKOUTEI'));#EOL#if (rJT030.next()) {#EOL##EOL#&#x9;var cdKoutei = rJT030.getValueOf('CDKOUTEI');#EOL#&#x9;var sqCenter = rJT030.getValueOf('SQCENTER');#EOL##EOL#&#x9;////////////////////////////#EOL#&#x9;// 工程明細ワークのクリア //#EOL#&#x9;////////////////////////////#EOL#&#x9;dJT030W = instance.createTableOperator('Delete', 'JT030W');#EOL#&#x9;dJT030W.addKeyValue('NRSEIZO',&#x9;instance.parmMap.get('NRSEIZO'));#EOL#&#x9;dJT030W.addKeyValue('SQKOUTEI',&#x9;instance.parmMap.get('SQKOUTEI'));#EOL#&#x9;dJT030W.execute();#EOL##EOL#&#x9;//////////////////////////#EOL#&#x9;// 工程明細ワークの登録 //#EOL#&#x9;//////////////////////////#EOL#&#x9;rJT030 = instance.createTableOperator('Select', 'JT030');#EOL#&#x9;rJT030.addKeyValue('CDKOUTEI',&#x9;cdKoutei);#EOL#&#x9;rJT030.addKeyValue('SQCENTER',&#x9;sqCenter);#EOL#&#x9;while (rJT030.next()) {#EOL#&#x9;&#x9;if (rJT030.getValueOf('NRSEIZO') != instance.parmMap.get('NRSEIZO') &amp;&amp; rJT030.getValueOf('DTFROM') != '') {#EOL#&#x9;&#x9;&#x9;rJT010 = instance.createTableOperator('Select', 'JT010');#EOL#&#x9;&#x9;&#x9;rJT010.addKeyValue('NRSEIZO',&#x9;rJT030.getValueOf('NRSEIZO'));#EOL#&#x9;&#x9;&#x9;if (rJT010.next()) {#EOL#&#x9;&#x9;&#x9;&#x9;if (rJT010.getValueOf('DTKANSEI') == '' &amp;&amp; rJT010.getValueOf('DTCANCEL') == '') {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT030W = instance.createTableOperator('Insert', 'JT030W');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT030W.addValue('NRSEIZO',&#x9;&#x9;instance.parmMap.get('NRSEIZO'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT030W.addValue('SQKOUTEI',&#x9;instance.parmMap.get('SQKOUTEI'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT030W.addValue('NRSEIZO2',&#x9;rJT030.getValueOf('NRSEIZO'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT030W.addValue('SQKOUTEI2',&#x9;rJT030.getValueOf('SQKOUTEI'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT030W.addValue('DTFROM',&#x9;&#x9;rJT030.getValueOf('DTFROM'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT030W.addValue('TMFROM',&#x9;&#x9;rJT030.getValueOf('TMFROM'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT030W.addValue('DTTHRU',&#x9;&#x9;rJT030.getValueOf('DTTHRU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT030W.addValue('TMTHRU',&#x9;&#x9;rJT030.getValueOf('TMTHRU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT030W.execute();#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}"/></Table><Table DetailRowNumberAuto="T" ID="JT030" Name="製造指示工程明細" Remarks="受注生産品の工程内訳情報を保持するためのテーブル。製造品工程明細マスターによって展開される。" SubsystemID="J"><Field Decimal="" ID="NRSEIZO" Name="製造指示№" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="SQKOUTEI" Name="工程行番" Nullable="F" Order="0020" Remarks="" Size="3" Type="SMALLINT" TypeOptions=""/><Field Decimal="" ID="CDKOUTEI" Name="工程C" Nullable="F" Order="0030" Remarks="" Size="3" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="SQLIST" Name="工程順序" Nullable="F" Order="0100" Remarks="" Size="4" Type="SMALLINT" TypeOptions=""/><Field Decimal="" ID="SQCENTER" Name="作業場行番" Nullable="F" Order="0040" Remarks="" Size="2" Type="SMALLINT" TypeOptions=""/><Field ID="TXSAGYOYOTEI" Name="作業予定日時" NoUpdate="T" Nullable="T" Order="0110" Remarks="開始・完了予定日時から 12/25 12:30～12/25 18:00 のように設定される" Size="24" Type="CHAR" TypeOptions="VIRTUAL"/><Field Decimal="" ID="DTFROM" Name="開始予定日" Nullable="T" Order="0060" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="" ID="DTTHRU" Name="完了予定日" Nullable="T" Order="0080" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="" ID="TMFROM" Name="開始予定時刻" Nullable="T" Order="0070" Remarks="" Size="4" Type="SMALLINT" TypeOptions="HH_MM"/><Field Decimal="" ID="TMTHRU" Name="完了予定時刻" Nullable="T" Order="0090" Remarks="" Size="4" Type="SMALLINT" TypeOptions="HH_MM"/><Key Fields="NRSEIZO;SQKOUTEI" Type="PK"/><Refer Fields="IDSEIZOHIN;QTSEIZO" Optional="T" Order="0070" OrderBy="" TableAlias="" ToKeyFields="NRSEIZO" ToTable="JT010" WithKeyFields="JT030.NRSEIZO"/><Refer Fields="TXHINBAN;TXHINMEI;KBUNIT" Order="0080" OrderBy="" TableAlias="" ToKeyFields="IDHINMOKU" ToTable="BT010" WithKeyFields="JT010.IDSEIZOHIN"/><Refer Fields="TXNAME;FGPLANNING" Order="0090" OrderBy="" TableAlias="" ToKeyFields="CDKOUTEI" ToTable="BT050" WithKeyFields="JT030.CDKOUTEI"/><Refer Fields="TXCENTER;KBCALENDAR;TMFROM;TMTHRU;RTKAKOU" Order="0100" OrderBy="" TableAlias="" ToKeyFields="CDKOUTEI;SQCENTER" ToTable="BT060" WithKeyFields="JT030.CDKOUTEI;JT030.SQCENTER"/><Script EventP="BU;AR" EventR="AR()" Function="" Name="仮想フィールドの設定" Order="0000" Text="//////////////////#EOL#// 作業予定日時 //#EOL#//////////////////#EOL#var wrkStr = '';#EOL#var fromDateTime = '00/00 00:00';#EOL#var thruDateTime = '00/00 00:00';#EOL#if (JT030_DTFROM.value != null &amp;&amp; JT030_DTFROM.value != '') {#EOL#&#x9;wrkStr = JT030_DTFROM.value + '';#EOL#&#x9;fromDateTime = wrkStr.substr(5,5) + ' ' + session.formatTime(JT030_TMFROM.value);#EOL#&#x9;fromDateTime = fromDateTime.replace(/-/g, '/');#EOL#}#EOL#if (JT030_DTTHRU.value != null &amp;&amp; JT030_DTTHRU.value != '') {#EOL#&#x9;wrkStr = JT030_DTTHRU.value + '';#EOL#&#x9;thruDateTime = wrkStr.substr(5,5) + ' ' + session.formatTime(JT030_TMTHRU.value);#EOL#&#x9;thruDateTime = thruDateTime.replace(/-/g, '/');#EOL#}#EOL#JT030_TXSAGYOYOTEI.value = fromDateTime + '～' + thruDateTime;#EOL##EOL#////////////#EOL#// 加工費 //#EOL#////////////#EOL#JT030_AMKAKOU.value = Math.round(BT060_RTKAKOU.value * JT030_LTSEIZO.value / 60);"/><Field ID="LTSEIZO" Name="製造LT" NoUpdate="T" Nullable="T" Order="0050" Remarks="製造指示の追加時に、工程表上の固定・従量LTと製造数に応じて設定される。単位は分。原価を計算しやすくするために実フィールドとして置かれている。" Size="5" Type="INTEGER" TypeOptions=""/><Refer Fields="VLLTFIX;VLLTQTY" Order="0110" OrderBy="" TableAlias="" ToKeyFields="IDSEIZOHIN;SQKOUTEI" ToTable="BT030" WithKeyFields="JT010.IDSEIZOHIN;JT030.SQKOUTEI"/><Script EventP="BU" EventR="AR()" Function="" Name="作業期間の初期値設定と妥当性検査(JF032)" Order="0020" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var stringDate; var stringTime;#EOL#var dateTimeFrom; var dateTimeThru;#EOL#var isError = false; var rJT030W;#EOL#var workDateTimeFrom; var workDateTimeFrom;#EOL##EOL#if (instance.functionID == 'JF032') {#EOL##EOL#&#x9;//////////////////////////#EOL#&#x9;// 作業期間の初期値設定 //#EOL#&#x9;//////////////////////////#EOL#&#x9;if (JT030_DTFROM.value == '') {#EOL#&#x9;&#x9;JT030_DTFROM.value = session.getAttribute('Tomorrow') + '';#EOL#&#x9;&#x9;JT030_TMFROM.value = BT060_TMFROM.value;#EOL#&#x9;}#EOL#&#x9;if (JT030_DTTHRU.value == '') {#EOL#&#x9;&#x9;var offsetDateTime = session.getOffsetDateTime(JT030_DTFROM.value+'', JT030_TMFROM.value, JT030_LTSEIZO.value, 1, BT060_KBCALENDAR.value);#EOL#&#x9;&#x9;JT030_DTTHRU.value = offsetDateTime.substr(0, 10) + '';#EOL#&#x9;&#x9;JT030_TMTHRU.value = offsetDateTime.substr(11, 5).replace(':', '');#EOL#&#x9;}#EOL##EOL#&#x9;stringDate = JT030_DTFROM.value + ''; // 9999-99-99 //#EOL#&#x9;stringTime = session.formatTime(JT030_TMFROM.value); // 99:99 //#EOL#&#x9;dateTimeFrom = new Date(stringDate.substr(0,4), stringDate.substr(5,2), stringDate.substr(8,2), stringTime.substr(0,2), stringTime.substr(3,2), 0, 0);#EOL##EOL#&#x9;stringDate = JT030_DTTHRU.value + ''; // 9999-99-99 //#EOL#&#x9;stringTime = session.formatTime(JT030_TMTHRU.value); // 99:99 //#EOL#&#x9;dateTimeThru = new Date(stringDate.substr(0,4), stringDate.substr(5,2), stringDate.substr(8,2), stringTime.substr(0,2), stringTime.substr(3,2), 0, 0);#EOL##EOL#&#x9;////////////////////////////#EOL#&#x9;// 日時の前後関係チェック //#EOL#&#x9;////////////////////////////#EOL#&#x9;if (dateTimeFrom.getTime() > dateTimeThru.getTime()) {#EOL#&#x9;&#x9;JT030_DTFROM.error = '作業日時の前後関係が正しくありません。完了日をクリアすれば、製造LTにもとづいて完了日時が自動設定されます。';#EOL#&#x9;} else {#EOL##EOL#&#x9;&#x9;//////////////////////////////////#EOL#&#x9;&#x9;// 既存製造予定との重複チェック //#EOL#&#x9;&#x9;//////////////////////////////////#EOL#&#x9;&#x9;rJT030W = instance.createTableOperator('Select', 'JT030W');#EOL#&#x9;&#x9;rJT030W.addKeyValue('NRSEIZO',&#x9;JT030_NRSEIZO.value);#EOL#&#x9;&#x9;rJT030W.addKeyValue('SQKOUTEI',&#x9;JT030_SQKOUTEI.value);#EOL#&#x9;&#x9;while (rJT030W.next()) {#EOL##EOL#&#x9;&#x9;&#x9;stringDate = rJT030W.getValueOf('DTFROM') + ''; // 9999-99-99 //#EOL#&#x9;&#x9;&#x9;stringTime = session.formatTime(rJT030W.getValueOf('TMFROM')); // 99:99 //#EOL#&#x9;&#x9;&#x9;workDateTimeFrom = new Date(stringDate.substr(0,4), stringDate.substr(5,2), stringDate.substr(8,2), stringTime.substr(0,2), stringTime.substr(3,2), 0, 0);#EOL##EOL#&#x9;&#x9;&#x9;stringDate = rJT030W.getValueOf('DTTHRU') + ''; // 9999-99-99 //#EOL#&#x9;&#x9;&#x9;stringTime = session.formatTime(rJT030W.getValueOf('TMTHRU')); // 99:99 //#EOL#&#x9;&#x9;&#x9;workDateTimeThru = new Date(stringDate.substr(0,4), stringDate.substr(5,2), stringDate.substr(8,2), stringTime.substr(0,2), stringTime.substr(3,2), 0, 0);#EOL##EOL#&#x9;&#x9;&#x9;if (workDateTimeFrom.getTime() &lt;= dateTimeFrom.getTime() &amp;&amp; workDateTimeThru.getTime() >= dateTimeThru.getTime()) {#EOL#&#x9;&#x9;&#x9;&#x9;isError = true;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;if (workDateTimeFrom.getTime() >= dateTimeFrom.getTime() &amp;&amp; workDateTimeThru.getTime() &lt;= dateTimeThru.getTime()) {#EOL#&#x9;&#x9;&#x9;&#x9;isError = true;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;if (workDateTimeFrom.getTime() &lt;= dateTimeFrom.getTime() &amp;&amp; workDateTimeThru.getTime() > dateTimeFrom.getTime()) {#EOL#&#x9;&#x9;&#x9;&#x9;isError = true;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;if (workDateTimeFrom.getTime() &lt; dateTimeThru.getTime() &amp;&amp; workDateTimeThru.getTime() >= dateTimeThru.getTime()) {#EOL#&#x9;&#x9;&#x9;&#x9;isError = true;#EOL#&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;if (isError) {#EOL#&#x9;&#x9;&#x9;&#x9;JT030_DTFROM.error = '既存の製造日程と重複しています。開始日時を変更して完了日をクリアすれば、製造LTにもとづいて完了日時が自動設定されます。';#EOL#&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL#"/><Script EventP="AU" EventR="" Function="" Name="計画期間にもとづく自動日程化(JF032)" Order="0031" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rJT030; var uJT030; var rBT030; var rBT060;#EOL#var date = ''; var time = 0; var offsetDateTime = ''; var ltSeizo = 0; var kbCalendar = ''; var count = 0;#EOL##EOL#if (instance.functionID == 'JF032' &amp;&amp; BT050_FGPLANNING.value == 'T') {#EOL#&#x9;#EOL#&#x9;////////////////////////////////#EOL#&#x9;// 計画工程以降の工程を日程化 //#EOL#&#x9;////////////////////////////////#EOL#&#x9;date = JT030_DTTHRU.value;#EOL#&#x9;time = JT030_TMTHRU.value;#EOL#&#x9;rJT030 = instance.createTableOperator('Select', 'JT030');#EOL#&#x9;rJT030.addKeyValue('NRSEIZO',&#x9;JT030_NRSEIZO.value);#EOL#&#x9;rJT030.setOrderBy('SQLIST');#EOL#&#x9;while (rJT030.next()) {#EOL#&#x9;&#x9;if (rJT030.getValueOf('SQKOUTEI') != JT030_SQKOUTEI.value &amp;&amp; rJT030.getValueOf('SQLIST') >= JT030_SQLIST.value) {#EOL#&#x9;&#x9;&#x9;updateSchedule(1);#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////#EOL#&#x9;// 計画工程以前の工程を日程化 //#EOL#&#x9;////////////////////////////////#EOL#&#x9;date = JT030_DTFROM.value;#EOL#&#x9;time = JT030_TMFROM.value;#EOL#&#x9;rJT030 = instance.createTableOperator('Select', 'JT030');#EOL#&#x9;rJT030.addKeyValue('NRSEIZO',&#x9;JT030_NRSEIZO.value);#EOL#&#x9;rJT030.setOrderBy('SQLIST DESC');#EOL#&#x9;while (rJT030.next()) {#EOL#&#x9;&#x9;if (rJT030.getValueOf('SQKOUTEI') != JT030_SQKOUTEI.value &amp;&amp; rJT030.getValueOf('SQLIST') &lt;= JT030_SQLIST.value) {#EOL#&#x9;&#x9;&#x9;updateSchedule(-1);#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#//////////////////////#EOL#// 工程明細の日程化 //#EOL#//////////////////////#EOL#function updateSchedule(direction) {#EOL##EOL#&#x9;//////////////////#EOL#&#x9;// 製造LTの計算 //#EOL#&#x9;//////////////////#EOL#&#x9;rBT030 = instance.createTableOperator('Select', 'BT030');#EOL#&#x9;rBT030.addKeyValue('IDSEIZOHIN',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;rBT030.addKeyValue('SQKOUTEI',&#x9;rJT030.getValueOf('SQKOUTEI'));#EOL#&#x9;if (rBT030.next()) {#EOL#&#x9;&#x9;ltSeizo = Number(rBT030.getValueOf('VLLTFIX')) + Number(JT010_QTSEIZO.value * rBT030.getValueOf('VLLTQTY'));#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////////////#EOL#&#x9;// 稼働カレンダーの検索 //#EOL#&#x9;//////////////////////////#EOL#&#x9;rBT060 = instance.createTableOperator('Select', 'BT060');#EOL#&#x9;rBT060.addKeyValue('CDKOUTEI',&#x9;rJT030.getValueOf('CDKOUTEI'));#EOL#&#x9;rBT060.addKeyValue('SQCENTER',&#x9;rJT030.getValueOf('SQCENTER'));#EOL#&#x9;if (rBT060.next()) {#EOL#&#x9;&#x9;kbCalendar = rBT060.getValueOf('KBCALENDAR');#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////#EOL#&#x9;// 工程明細の更新 //#EOL#&#x9;////////////////////#EOL#&#x9;uJT030 = instance.createTableOperator('Update', 'JT030');#EOL#&#x9;uJT030.addKeyValue('NRSEIZO',&#x9;rJT030.getValueOf('NRSEIZO'));#EOL#&#x9;uJT030.addKeyValue('SQKOUTEI',&#x9;rJT030.getValueOf('SQKOUTEI'));#EOL#&#x9;if (direction == 1) {#EOL#&#x9;&#x9;uJT030.addValue('DTFROM',&#x9;date);#EOL#&#x9;&#x9;uJT030.addValue('TMFROM',&#x9;time);#EOL#&#x9;&#x9;offsetDateTime = session.getOffsetDateTime(date + '', time, ltSeizo * direction, 1, kbCalendar);#EOL#&#x9;&#x9;date = offsetDateTime.substr(0, 10) + '';#EOL#&#x9;&#x9;time = offsetDateTime.substr(11, 5).replace(':', '');#EOL#&#x9;&#x9;uJT030.addValue('DTTHRU',&#x9;date);#EOL#&#x9;&#x9;uJT030.addValue('TMTHRU',&#x9;time);#EOL#&#x9;}#EOL#&#x9;if (direction == -1) {#EOL#&#x9;&#x9;uJT030.addValue('DTTHRU',&#x9;date);#EOL#&#x9;&#x9;uJT030.addValue('TMTHRU',&#x9;time);#EOL#&#x9;&#x9;offsetDateTime = session.getOffsetDateTime(date + '', time, ltSeizo * direction, 1, kbCalendar);#EOL#&#x9;&#x9;date = offsetDateTime.substr(0, 10) + '';#EOL#&#x9;&#x9;time = offsetDateTime.substr(11, 5).replace(':', '');#EOL#&#x9;&#x9;uJT030.addValue('DTFROM',&#x9;date);#EOL#&#x9;&#x9;uJT030.addValue('TMFROM',&#x9;time);#EOL#&#x9;}#EOL#&#x9;count = uJT030.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;instance.cancelWithMessage('工程明細(JT030)の更新に失敗しました。処理はキャンセルされます。');#EOL#&#x9;}#EOL#}"/><Script EventP="AU" EventR="" Function="" Hold="F" Name="処理後の明細ワークのクリア(JF032)" Order="0032" Text="if (instance.functionID == 'JF032') {#EOL#&#x9;////////////////////////////#EOL#&#x9;// 工程明細ワークのクリア //#EOL#&#x9;////////////////////////////#EOL#&#x9;var dJT030W = instance.createTableOperator('Delete', 'JT030W');#EOL#&#x9;dJT030W.addKeyValue('NRSEIZO',&#x9;instance.parmMap.get('NRSEIZO'));#EOL#&#x9;dJT030W.addKeyValue('SQKOUTEI',&#x9;instance.parmMap.get('SQKOUTEI'));#EOL#&#x9;dJT030W.execute();#EOL#}"/><Field ID="AMKAKOU" Name="加工費" NoUpdate="T" Nullable="T" Order="0120" Remarks="製造LT×作業場の加工レート÷６０" Size="7" Type="INTEGER" TypeOptions="VIRTUAL"/></Table><Table DeleteOperation="" ID="JT010" Name="製造指示" Remarks="得意先から受注された製造品に対する製造指示を管理するためのテーブル。これに対して出庫報告することで材料の出庫受払が、完成報告することで製品の入庫受払と売上が計上される。" SubsystemID="J"><Field Decimal="" ID="NRSEIZO" Name="製造指示№" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRSEIZO)"/><Field Decimal="" ID="IDSEIZOHIN" Name="製造品目ID" NoUpdate="T" Nullable="F" Order="0060" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="QTKANSEI" Name="良品数" Nullable="T" Order="0100" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTHURYO" Name="不良数" Nullable="T" Order="0110" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTSYUKKA" Name="出荷数" Nullable="T" Order="0080" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="CDSOUKOKAN" Name="完成入庫倉庫Ｃ" NoUpdate="T" Nullable="F" Order="0170" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="CDSOUKOZAI" Name="材料出庫倉庫Ｃ" NoUpdate="T" Nullable="F" Order="0180" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="NRSOURCE" Name="取引ソース№" NoUpdate="T" Nullable="F" Order="0250" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRSOURCE)"/><Field Decimal="" ID="STSEIZO" Name="製造状況" NoUpdate="T" Nullable="F" Order="0260" Remarks="" Size="2" Type="CHAR" TypeOptions="VIRTUAL,KUBUN(STSEIZO)"/><Field Decimal="" ID="PRGENKA" Name="実勢原価" NoUpdate="T" Nullable="T" Order="0280" Remarks="実勢原価額÷完成数" Size="7" Type="INTEGER" TypeOptions="VIRTUAL"/><Key Fields="NRSEIZO" Type="PK"/><Key Fields="NRSOURCE" Type="SK"/><Field Decimal="" ID="TXTEKIYO" Name="摘要" Nullable="T" Order="0160" Remarks="" Size="300" Type="VARCHAR" TypeOptions="KANJI"/><Field Decimal="" ID="QTJYUTYU" Name="受注数" Nullable="T" Order="0070" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Script EventP="AC" EventR="" Function="" Name="追加後の関連データ設定" Order="0020" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rBT010; var rBT020; var rBT030; var rBT040; var rJT010;#EOL#var rJT020; var cJT020; var rJT030; var cJT030; var rJT040; var cJT040;#EOL#var txValue = '';#EOL##EOL#//////////////////////////////////////////////////#EOL#// マスターを使って明細データをセットアップする //#EOL#//////////////////////////////////////////////////#EOL#if (instance.parmMap.get('NRSEIZO') == null) {#EOL##EOL#&#x9;//////////////////////////#EOL#&#x9;// 仕様明細を検索・複写 //#EOL#&#x9;//////////////////////////#EOL#&#x9;rBT020 = instance.createTableOperator('Select', 'BT020');#EOL#&#x9;rBT020.addKeyValue('IDSEIZOHIN',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;while (rBT020.next()) {#EOL##EOL#&#x9;&#x9;if (rBT020.getValueOf('KBSPEC') == '010') {#EOL#&#x9;&#x9;&#x9;txValue = '木材'; //素材初期値//#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;if (rBT020.getValueOf('KBSPEC') == '020') {#EOL#&#x9;&#x9;&#x9;txValue = '1,000'; //全長初期値//#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;if (rBT020.getValueOf('KBSPEC') == '030') {#EOL#&#x9;&#x9;&#x9;txValue = '10,000';  //重量初期値//#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;cJT020 = instance.createTableOperator('Insert', 'JT020');#EOL#&#x9;&#x9;cJT020.addValue('NRSEIZO',&#x9;&#x9;JT010_NRSEIZO.value);#EOL#&#x9;&#x9;cJT020.addValue('SQSPEC',&#x9;&#x9;rBT020.getValueOf('SQSPEC'));#EOL#&#x9;&#x9;cJT020.addValue('TXVALUE',&#x9;&#x9;txValue);#EOL#&#x9;&#x9;cJT020.addValue('SQLIST',&#x9;&#x9;rBT020.getValueOf('SQLIST'));#EOL#&#x9;&#x9;cJT020.execute();#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////////////#EOL#&#x9;// 工程明細を検索・複写 //#EOL#&#x9;//////////////////////////#EOL#&#x9;rBT030 = instance.createTableOperator('Select', 'BT030');#EOL#&#x9;rBT030.addKeyValue('IDSEIZOHIN',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;while (rBT030.next()) {#EOL#&#x9;&#x9;cJT030 = instance.createTableOperator('Insert', 'JT030');#EOL#&#x9;&#x9;cJT030.addValue('NRSEIZO',&#x9;&#x9;JT010_NRSEIZO.value);#EOL#&#x9;&#x9;cJT030.addValue('SQKOUTEI',&#x9;&#x9;rBT030.getValueOf('SQKOUTEI'));#EOL#&#x9;&#x9;cJT030.addValue('CDKOUTEI',&#x9;&#x9;rBT030.getValueOf('CDKOUTEI'));#EOL#&#x9;&#x9;cJT030.addValue('SQLIST',&#x9;&#x9;rBT030.getValueOf('SQLIST'));#EOL#&#x9;&#x9;cJT030.addValue('SQCENTER',&#x9;&#x9;rBT030.getValueOf('SQCENTER'));#EOL#&#x9;&#x9;cJT030.addValue('LTSEIZO',&#x9;&#x9;Number(rBT030.getValueOf('VLLTFIX')) + Number(JT010_QTSEIZO.value * rBT030.getValueOf('VLLTQTY')));#EOL#&#x9;&#x9;cJT030.execute();#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////////////#EOL#&#x9;// 材料明細を検索・複写 //#EOL#&#x9;//////////////////////////#EOL#&#x9;rBT040 = instance.createTableOperator('Select', 'BT040');#EOL#&#x9;rBT040.addKeyValue('IDSEIZOHIN',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;while (rBT040.next()) {#EOL#&#x9;&#x9;rBT010 = instance.createTableOperator('Select', 'BT010');#EOL#&#x9;&#x9;rBT010.addKeyValue('IDHINMOKU',&#x9;rBT040.getValueOf('IDHINCHILD'));#EOL#&#x9;&#x9;if (rBT010.next()) {#EOL#&#x9;&#x9;&#x9;cJT040 = instance.createTableOperator('Insert', 'JT040');#EOL#&#x9;&#x9;&#x9;cJT040.addValue('NRSEIZO',&#x9;&#x9;JT010_NRSEIZO.value);#EOL#&#x9;&#x9;&#x9;cJT040.addValue('SQZAIRYO',&#x9;&#x9;rBT040.getValueOf('SQZAIRYO'));#EOL#&#x9;&#x9;&#x9;cJT040.addValue('IDHINMOKU',&#x9;rBT040.getValueOf('IDHINCHILD'));#EOL#&#x9;&#x9;&#x9;cJT040.addValue('QTTOUNYU',&#x9;&#x9;rBT040.getValueOf('VLKOUSEI') * JT010_QTSEIZO.value);#EOL#&#x9;&#x9;&#x9;cJT040.addValue('SQKOUTEI',&#x9;&#x9;rBT040.getValueOf('SQKOUTEI'));#EOL#&#x9;&#x9;&#x9;cJT040.addValue('PRYOTEI',&#x9;&#x9;rBT010.getValueOf('PRGENKA'));#EOL#&#x9;&#x9;&#x9;cJT040.addValue('PRSYUKKO',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;cJT040.addValue('SQLIST',&#x9;&#x9;rBT040.getValueOf('SQLIST'));#EOL#&#x9;&#x9;&#x9;cJT040.execute();#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#////////////////////////////////////////#EOL#// 複写元製造№で明細データを複写する //#EOL#////////////////////////////////////////#EOL#} else {#EOL##EOL#&#x9;//////////////////////////#EOL#&#x9;// 仕様明細を検索・複写 //#EOL#&#x9;//////////////////////////#EOL#&#x9;rJT020 = instance.createTableOperator('Select', 'JT020');#EOL#&#x9;rJT020.addKeyValue('NRSEIZO',&#x9;instance.parmMap.get('NRSEIZO'));#EOL#&#x9;while (rJT020.next()) {#EOL#&#x9;&#x9;cJT020 = instance.createTableOperator('Insert', 'JT020');#EOL#&#x9;&#x9;cJT020.addValue('NRSEIZO',&#x9;&#x9;JT010_NRSEIZO.value);#EOL#&#x9;&#x9;cJT020.addValue('SQSPEC',&#x9;&#x9;rJT020.getValueOf('SQSPEC'));#EOL#&#x9;&#x9;cJT020.addValue('TXVALUE',&#x9;&#x9;rJT020.getValueOf('TXVALUE'));#EOL#&#x9;&#x9;cJT020.addValue('SQLIST',&#x9;&#x9;rJT020.getValueOf('SQLIST'));#EOL#&#x9;&#x9;cJT020.execute();#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////////////#EOL#&#x9;// 工程明細を検索・複写 //#EOL#&#x9;//////////////////////////#EOL#//&#x9;rJT030 = instance.createTableOperator('Select', 'JT030');#EOL#//&#x9;rJT030.addKeyValue('NRSEIZO',&#x9;instance.parmMap.get('NRSEIZO'));#EOL#//&#x9;while (rJT030.next()) {#EOL#//&#x9;&#x9;cJT030 = instance.createTableOperator('Insert', 'JT030');#EOL#//&#x9;&#x9;cJT030.addValue('NRSEIZO',&#x9;&#x9;JT010_NRSEIZO.value);#EOL#//&#x9;&#x9;cJT030.addValue('SQKOUTEI',&#x9;&#x9;rJT030.getValueOf('SQKOUTEI'));#EOL#//&#x9;&#x9;cJT030.addValue('CDKOUTEI',&#x9;&#x9;rJT030.getValueOf('CDKOUTEI'));#EOL#//&#x9;&#x9;cJT030.addValue('SQLIST',&#x9;&#x9;rJT030.getValueOf('SQLIST'));#EOL#//&#x9;&#x9;cJT030.addValue('SQCENTER',&#x9;&#x9;rJT030.getValueOf('SQCENTER'));#EOL#//&#x9;&#x9;cJT030.execute();#EOL#//&#x9;}#EOL#&#x9;rBT030 = instance.createTableOperator('Select', 'BT030');#EOL#&#x9;rBT030.addKeyValue('IDSEIZOHIN',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;while (rBT030.next()) {#EOL#&#x9;&#x9;cJT030 = instance.createTableOperator('Insert', 'JT030');#EOL#&#x9;&#x9;cJT030.addValue('NRSEIZO',&#x9;&#x9;JT010_NRSEIZO.value);#EOL#&#x9;&#x9;cJT030.addValue('SQKOUTEI',&#x9;&#x9;rBT030.getValueOf('SQKOUTEI'));#EOL#&#x9;&#x9;cJT030.addValue('CDKOUTEI',&#x9;&#x9;rBT030.getValueOf('CDKOUTEI'));#EOL#&#x9;&#x9;cJT030.addValue('SQLIST',&#x9;&#x9;rBT030.getValueOf('SQLIST'));#EOL#&#x9;&#x9;cJT030.addValue('SQCENTER',&#x9;&#x9;rBT030.getValueOf('SQCENTER'));#EOL#&#x9;&#x9;cJT030.addValue('LTSEIZO',&#x9;&#x9;Number(rBT030.getValueOf('VLLTFIX')) + Number(JT010_QTSEIZO.value * rBT030.getValueOf('VLLTQTY')));#EOL#&#x9;&#x9;cJT030.execute();#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////////////#EOL#&#x9;// 材料明細を検索・複写 //#EOL#&#x9;//////////////////////////#EOL#&#x9;rJT040 = instance.createTableOperator('Select', 'JT040');#EOL#&#x9;rJT040.addKeyValue('NRSEIZO',&#x9;instance.parmMap.get('NRSEIZO'));#EOL#&#x9;while (rJT040.next()) {#EOL#&#x9;&#x9;rBT010 = instance.createTableOperator('Select', 'BT010');#EOL#&#x9;&#x9;rBT010.addKeyValue('IDHINMOKU',&#x9;rBT040.getValueOf('IDHINCHILD'));#EOL#&#x9;&#x9;if (rBT010.next()) {#EOL#&#x9;&#x9;&#x9;cJT040 = instance.createTableOperator('Insert', 'JT040');#EOL#&#x9;&#x9;&#x9;cJT040.addValue('NRSEIZO',&#x9;&#x9;JT010_NRSEIZO.value);#EOL#&#x9;&#x9;&#x9;cJT040.addValue('SQZAIRYO',&#x9;&#x9;rJT040.getValueOf('SQZAIRYO'));#EOL#&#x9;&#x9;&#x9;cJT040.addValue('IDHINMOKU',&#x9;rJT040.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;cJT040.addValue('QTTOUNYU',&#x9;&#x9;rJT040.getValueOf('QTTOUNYU'));#EOL#&#x9;&#x9;&#x9;cJT040.addValue('SQKOUTEI',&#x9;&#x9;rJT040.getValueOf('SQKOUTEI'));#EOL#&#x9;&#x9;&#x9;cJT040.addValue('PRYOTEI',&#x9;&#x9;rBT010.getValueOf('PRGENKA'));#EOL#&#x9;&#x9;&#x9;cJT040.addValue('PRSYUKKO',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;cJT040.addValue('SQLIST',&#x9;&#x9;rJT040.getValueOf('SQLIST'));#EOL#&#x9;&#x9;&#x9;cJT040.execute();#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}"/><Field Decimal="" ID="QTSEIZO" Name="製造指示数" Nullable="F" Order="0090" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Refer Fields="TXHINBAN;TXHINMEI;KBUNIT;PRGENKA" Order="0010" OrderBy="" TableAlias="" ToKeyFields="IDHINMOKU" ToTable="BT010" WithKeyFields="JT010.IDSEIZOHIN"/><Field Decimal="" ID="DTCREATE" Name="登録日" NoUpdate="T" Nullable="F" Order="0190" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Refer Fields="TXSOUKO" Order="0020" OrderBy="" TableAlias="AT040KAN" ToKeyFields="CDSOUKO" ToTable="AT040" WithKeyFields="JT010.CDSOUKOKAN"/><Refer Fields="TXSOUKO" Order="0030" OrderBy="" TableAlias="AT040ZAI" ToKeyFields="CDSOUKO" ToTable="AT040" WithKeyFields="JT010.CDSOUKOZAI"/><Script EventP="BC" EventR="BR()" Function="" Name="追加前の各種設定と妥当性検査" Order="0010" Text="JT010_DTCREATE.value = session.today + '';#EOL##EOL#JT010_DTCREATE.editable = false;#EOL#JT010_DTHAKKO.editable = false;#EOL#JT010_DTSYUKKO.editable = false;#EOL#JT010_DTKANSEI.editable = false;#EOL#JT010_QTKANSEI.editable = false;#EOL#JT010_QTHURYO.editable = false;#EOL#JT010_QTSYUKKA.editable = false;#EOL#JT010_PRYOTEIGEN.editable = false;#EOL#JT010_PRGENKA.editable = false;#EOL#JT010_STSEIZO.editable = false;#EOL#JT010_TXSEIZOYOTEI.editable = false;#EOL##EOL#////////////////////////////////////////#EOL#// 顧客指定時の初期値設定と妥当性検査 //#EOL#////////////////////////////////////////#EOL#if (JT010_IDTOKUISAKI.value != '') {#EOL#&#x9;if (JT010_SQSYUKKASAKI.value == 0) {#EOL#&#x9;&#x9;ET011_TXKANJI.error = 'いずれかの値を選択してください。';#EOL#&#x9;}#EOL#&#x9;if (JT010_DTNOUKI.value == '') {#EOL#&#x9;&#x9;JT010_DTNOUKI.error = '何らかの値を入力してください。';#EOL#&#x9;}#EOL#&#x9;if (JT010_QTJYUTYU.value == 0) {#EOL#&#x9;&#x9;JT010_QTJYUTYU.error = '何らかの値を入力してください。';#EOL#&#x9;}#EOL#}"/><Script EventP="BU" EventR="AR()" Function="" Name="更新前の各種設定と妥当性検査(JF011,JF013,JF041)" Order="0050" Text="//////////////////#EOL#// 入力不可設定 //#EOL#//////////////////#EOL#JT010_SQSYUKKASAKI.editable = false;#EOL#JT010_TXTYUMONBANGO.editable = false;#EOL#JT010_DTNOUKI.editable = false;#EOL#JT010_QTJYUTYU.editable = false;#EOL#JT010_QTSYUKKA.editable = false;#EOL#JT010_QTSEIZO.editable = false;#EOL#JT010_QTKANSEI.editable = false;#EOL#JT010_QTHURYO.editable = false;#EOL#JT010_QTHAIKI.editable = false;#EOL#JT010_PRMITSUMORI.editable = false;#EOL#JT010_PRJYUTYU.editable = false;#EOL#JT010_DTSYUKKO.editable = false;#EOL#JT010_DTKANSEI.editable = false;#EOL#JT010_DTSYUKKA.editable = false;#EOL##EOL#////////////////////////////#EOL#// 製造指示の保守での設定 //#EOL#////////////////////////////#EOL#if (instance.functionID == 'JF011') {#EOL##EOL#&#x9;////////////////#EOL#&#x9;// 入力可設定 //#EOL#&#x9;////////////////#EOL#&#x9;JT010_SQSYUKKASAKI.editable = true;#EOL#&#x9;JT010_TXTYUMONBANGO.editable = true;#EOL#&#x9;JT010_DTNOUKI.editable = true;#EOL#&#x9;JT010_QTSEIZO.editable = true;#EOL#&#x9;JT010_QTJYUTYU.editable = true;#EOL#&#x9;JT010_PRMITSUMORI.editable = true;#EOL#&#x9;JT010_PRJYUTYU.editable = true;#EOL#&#x9;JT010_TXTEKIYO.editable = true;#EOL##EOL#&#x9;if (JT010_SQSYUKKASAKI.value == 0) {#EOL#&#x9;&#x9;ET011_TXKANJI.error = 'いずれかの値を選択してください。';#EOL#&#x9;}#EOL#&#x9;if (JT010_DTNOUKI.value == '') {#EOL#&#x9;&#x9;JT010_DTNOUKI.error = '何らかの値を入力してください。';#EOL#&#x9;}#EOL#&#x9;if (JT010_QTJYUTYU.value == 0) {#EOL#&#x9;&#x9;JT010_QTJYUTYU.error = '何らかの値を入力してください。';#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////////////////#EOL#// 材料出庫エントリーでの設定 //#EOL#////////////////////////////////#EOL#if (instance.functionID == 'JF041') {#EOL##EOL#&#x9;////////////////#EOL#&#x9;// 入力可設定 //#EOL#&#x9;////////////////#EOL#&#x9;JT010_DTSYUKKO.editable = true;#EOL##EOL#&#x9;////////////////////////#EOL#&#x9;// ステータスチェック //#EOL#&#x9;////////////////////////#EOL#&#x9;if (JT010_STSEIZO.value == '90') {#EOL#&#x9;&#x9;JT010_NRSEIZO.error = '既に取消されているため、この処理を実行できません。';#EOL#&#x9;} else {#EOL##EOL#&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;// 完成数チェック //#EOL#&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;if (JT010_QTKANSEI.value > 0) {#EOL#&#x9;&#x9;&#x9;JT010_NRSEIZO.error = '完成数＞０として報告されているため、材料明細の更新は許されません。';#EOL#&#x9;&#x9;} else {#EOL##EOL#&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;// 出庫日の初期値設定 //#EOL#&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;if (JT010_DTSYUKKO.value =='') {#EOL#&#x9;&#x9;&#x9;&#x9;JT010_DTSYUKKO.value = session.today + '';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////////////////#EOL#// 製造完了エントリーでの設定 //#EOL#////////////////////////////////#EOL#if (instance.functionID == 'JF013') {#EOL##EOL#&#x9;////////////////#EOL#&#x9;// 入力可設定 //#EOL#&#x9;////////////////#EOL#&#x9;if (JT010_IDTOKUISAKI.value != '') {#EOL#&#x9;&#x9;JT010_DTSYUKKA.editable = true;#EOL#&#x9;&#x9;JT010_QTSYUKKA.editable = true;#EOL#&#x9;&#x9;JT010_QTHAIKI.editable = true;#EOL#&#x9;&#x9;JT010_PRJYUTYU.editable = true;#EOL#&#x9;}#EOL#&#x9;JT010_DTKANSEI.editable = true;#EOL#&#x9;JT010_QTKANSEI.editable = true;#EOL#&#x9;JT010_QTHURYO.editable = true;#EOL##EOL#&#x9;////////////////////////#EOL#&#x9;// ステータスチェック //#EOL#&#x9;////////////////////////#EOL#&#x9;if (JT010_STSEIZO.value == '90') {#EOL#&#x9;&#x9;JT010_NRSEIZO.error = '既に取消されているため、この処理を実行できません。';#EOL#&#x9;} else {#EOL##EOL#&#x9;&#x9;////////////////////////////#EOL#&#x9;&#x9;// 材料出庫の完了チェック //#EOL#&#x9;&#x9;////////////////////////////#EOL#&#x9;&#x9;if (JT010_DTSYUKKO.value =='') {#EOL#&#x9;&#x9;&#x9;JT010_NRSEIZO.error = '材料出庫エントリーが済んでいないため、この処理を実行できません。';#EOL#&#x9;&#x9;} else {#EOL##EOL#&#x9;&#x9;&#x9;////////////////////////////////#EOL#&#x9;&#x9;&#x9;// 完成日と完成数の初期値設定 //#EOL#&#x9;&#x9;&#x9;////////////////////////////////#EOL#&#x9;&#x9;&#x9;if (JT010_DTKANSEI.value =='') {#EOL#&#x9;&#x9;&#x9;&#x9;JT010_DTKANSEI.value = session.today + '';#EOL#&#x9;&#x9;&#x9;&#x9;JT010_QTKANSEI.value = JT010_QTSEIZO.value;#EOL#&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;//////////////////////////////////////////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;// 実勢原価 ＝ (工程Σ(加工レート×製造時間数) ＋ 材料Σ(出庫単価×出庫数)) //#EOL#&#x9;&#x9;&#x9;//////////////////////////////////////////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;genka = 0; var JT030; var rBT060;#EOL#&#x9;&#x9;&#x9;rJT030 = instance.createTableOperator('Select', 'JT030');#EOL#&#x9;&#x9;&#x9;rJT030.addKeyValue('NRSEIZO',&#x9;JT010_NRSEIZO.value);#EOL#&#x9;&#x9;&#x9;while (rJT030.next()) {#EOL#&#x9;&#x9;&#x9;&#x9;rBT060 = instance.createTableOperator('Select', 'BT060');#EOL#&#x9;&#x9;&#x9;&#x9;rBT060.addKeyValue('SQCENTER',&#x9;rJT030.getValueOf('SQCENTER'));#EOL#&#x9;&#x9;&#x9;&#x9;if (rBT060.next()) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;genka = Number(genka) + Math.round(rBT060.getValueOf('RTKAKOU') * rJT030.getValueOf('LTSEIZO') / 60);#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;rJT040 = instance.createTableOperator('Select', 'JT040');#EOL#&#x9;&#x9;&#x9;rJT040.addKeyValue('NRSEIZO',&#x9;JT010_NRSEIZO.value);#EOL#&#x9;&#x9;&#x9;while (rJT040.next()) {#EOL#&#x9;&#x9;&#x9;&#x9;genka = Number(genka) + Number(rJT040.getValueOf('PRSYUKKO') * rJT040.getValueOf('QTTOUNYU'));#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;JT010_AMGENKA.value = genka;#EOL##EOL#&#x9;&#x9;&#x9;////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;// 出荷日の初期値設定と確定単価の検査 //#EOL#&#x9;&#x9;&#x9;////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;if (JT010_IDTOKUISAKI.value != '') {#EOL#&#x9;&#x9;&#x9;&#x9;if (JT010_QTSYUKKA.value > 0 || JT010_QTHAIKI.value > 0) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (JT010_DTSYUKKA.value == '') {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;JT010_DTSYUKKA.value = session.today + '';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (JT010_PRJYUTYU.value == 0) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;JT010_PRJYUTYU.error = '何らかの値を入力してください。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;//////////////////////////#EOL#&#x9;&#x9;&#x9;// 出荷数＋廃棄数の検査 //#EOL#&#x9;&#x9;&#x9;//////////////////////////#EOL#&#x9;&#x9;&#x9;if (JT010_IDTOKUISAKI.value != '') {#EOL#&#x9;&#x9;&#x9;&#x9;if (JT010_QTSYUKKA.value > 0 || JT010_QTHAIKI.value > 0) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;var qtSyukkaAndHaiki = Number(JT010_QTSYUKKA.value) + Number(JT010_QTHAIKI.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (qtSyukkaAndHaiki != JT010_QTKANSEI.value) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;JT010_QTSYUKKA.error = '出荷数と廃棄数の合計が良品数と異なります。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (JT010_DTSYUKKA.value != '') {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;JT010_QTSYUKKA.error = '何らかの値を入力してください。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL#"/><Script EventP="BU;AR" EventR="AR()" Function="" Hold="F" Name="仮想フィールドの設定" Order="0030" Text="//////////////////#EOL#// 製造予定日時 //#EOL#//////////////////#EOL#var wrkStr = '';#EOL#var fromDateTime = '00/00 00:00';#EOL#var thruDateTime = '00/00 00:00';#EOL#var rJT030 = instance.createTableOperator('Select', 'JT030');#EOL#rJT030.addKeyValue('NRSEIZO',&#x9;JT010_NRSEIZO.value);#EOL#rJT030.setOrderBy('SQLIST');#EOL#while (rJT030.next()) {#EOL#&#x9;if (fromDateTime == '00/00 00:00' &amp;&amp; rJT030.getValueOf('DTFROM') != null &amp;&amp; rJT030.getValueOf('DTFROM') != '') {#EOL#&#x9;&#x9;wrkStr = rJT030.getValueOf('DTFROM') + '';#EOL#&#x9;&#x9;fromDateTime = wrkStr.substr(5,5) + ' ' + session.formatTime(rJT030.getValueOf('TMFROM'));#EOL#&#x9;&#x9;fromDateTime = fromDateTime.replace(/-/g, '/');#EOL#&#x9;}#EOL#&#x9;if (rJT030.getValueOf('DTTHRU') != null &amp;&amp; rJT030.getValueOf('DTTHRU') != '') {#EOL#&#x9;&#x9;wrkStr = rJT030.getValueOf('DTTHRU') + '';#EOL#&#x9;&#x9;thruDateTime = wrkStr.substr(5,5) + ' ' + session.formatTime(rJT030.getValueOf('TMTHRU'));#EOL#&#x9;&#x9;thruDateTime = thruDateTime.replace(/-/g, '/');#EOL#&#x9;}#EOL#}#EOL#JT010_TXSEIZOYOTEI.value = fromDateTime + '～' + thruDateTime;#EOL##EOL#///////////////////////////////////////////////////////////////////////////////////////////#EOL#// 予定原価 ＝ (工程Σ(加工レート×製造時間数) ＋ 材料Σ(予定単価×出庫数)) / 製造指示数 //#EOL#///////////////////////////////////////////////////////////////////////////////////////////#EOL#var rJT030; var rJT040; var rBT060; var genka = 0;#EOL#rJT030 = instance.createTableOperator('Select', 'JT030');#EOL#rJT030.addKeyValue('NRSEIZO',&#x9;JT010_NRSEIZO.value);#EOL#while (rJT030.next()) {#EOL#&#x9;rBT060 = instance.createTableOperator('Select', 'BT060');#EOL#&#x9;rBT060.addKeyValue('SQCENTER',&#x9;rJT030.getValueOf('SQCENTER'));#EOL#&#x9;if (rBT060.next()) {#EOL#&#x9;&#x9;genka = Number(genka) + Math.round(rBT060.getValueOf('RTKAKOU') * rJT030.getValueOf('LTSEIZO') / 60);#EOL#&#x9;}#EOL#}#EOL#rJT040 = instance.createTableOperator('Select', 'JT040');#EOL#rJT040.addKeyValue('NRSEIZO',&#x9;JT010_NRSEIZO.value);#EOL#while (rJT040.next()) {#EOL#&#x9;genka = Number(genka) + Number(rJT040.getValueOf('PRYOTEI') * rJT040.getValueOf('QTTOUNYU'));#EOL#}#EOL#JT010_PRYOTEIGEN.value = Math.round(genka / JT010_QTSEIZO.value);#EOL##EOL#//////////////////////////////#EOL#// 実勢原価・販売額・粗利額 //#EOL#//////////////////////////////#EOL#if (JT010_QTKANSEI.value != 0) {#EOL#&#x9;JT010_PRGENKA.value = Math.round(JT010_AMGENKA.value / JT010_QTKANSEI.value);#EOL#}#EOL#if (JT010_QTKANSEI.oldValue != 0) {#EOL#&#x9;JT010_PRGENKA.oldValue = Math.round(JT010_AMGENKA.oldValue / JT010_QTKANSEI.oldValue);#EOL#}#EOL#JT010_AMHANBAI.value = JT010_QTSYUKKA.value * JT010_PRJYUTYU.value;#EOL#JT010_AMHANBAI.oldValue = JT010_QTSYUKKA.oldValue * JT010_PRJYUTYU.oldValue;#EOL#JT010_AMARARI.value = JT010_AMHANBAI.value - JT010_AMGENKA.value;#EOL#JT010_AMARARI.oldValue = JT010_AMHANBAI.oldValue - JT010_AMGENKA.oldValue;#EOL##EOL#//////////////#EOL#// 製造状況 //#EOL#//////////////#EOL#if (JT010_DTCANCEL.value == '') {#EOL#&#x9;if (JT010_DTHAKKO.value == '') {#EOL#&#x9;&#x9;JT010_STSEIZO.value = '10'; //未発行//#EOL#&#x9;} else {#EOL#&#x9;&#x9;JT010_STSEIZO.value = '20'; //発行済//#EOL#&#x9;}#EOL#&#x9;if (JT010_DTSYUKKO.value != '') {#EOL#&#x9;&#x9;JT010_STSEIZO.value = '30'; //材料出庫済//#EOL#&#x9;}#EOL#&#x9;if (JT010_DTKANSEI.value != '') {#EOL#&#x9;&#x9;JT010_STSEIZO.value = '40'; //製造完了//#EOL#&#x9;}#EOL#&#x9;if (JT010_DTSYUKKA.value != '') {#EOL#&#x9;&#x9;JT010_STSEIZO.value = '50'; //出荷済//#EOL#&#x9;}#EOL#} else {#EOL#&#x9;JT010_STSEIZO.value = '90'; //取消済//#EOL#}"/><Field Decimal="" ID="DTSYUKKO" Name="材料出庫日" Nullable="T" Order="0210" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="" ID="DTKANSEI" Name="製造完了日" Nullable="T" Order="0220" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="" ID="DTHAKKO" Name="発行日" NoUpdate="T" Nullable="T" Order="0200" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field ID="TXSEIZOYOTEI" Name="製造予定日時" NoUpdate="T" Nullable="T" Order="0310" Remarks="開始・完了予定日時から 12/25 12:30～12/25 18:00 のように設定される" Size="24" Type="CHAR" TypeOptions="VIRTUAL"/><Script EventP="AR" EventR="BR()" Function="" Name="指示書発行にともなう更新(JF022)" Order="0040" Text="if (instance.functionID == 'JF022') {#EOL#&#x9;if (JT010_DTHAKKO.value == '') {#EOL#&#x9;&#x9;var uJT010 = instance.createTableOperator('Update', 'JT010');#EOL#&#x9;&#x9;uJT010.addKeyValue('NRSEIZO',&#x9;JT010_NRSEIZO.value);#EOL#&#x9;&#x9;uJT010.addValue('DTHAKKO',&#x9;session.today + '');#EOL#&#x9;&#x9;uJT010.execute();#EOL#&#x9;&#x9;instance.returnMap.put('RETURN_CODE', '20');#EOL#&#x9;}#EOL#}"/><Script EventP="AU" EventR="" Function="" Name="材料出庫にともなう受払失効処理(JF041)" Order="0060" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rFT100; var uFT100;#EOL##EOL#/////////////////////////////////////////////////////#EOL#// 材料出庫エントリー(JF041)で処理された場合に実行 //#EOL#/////////////////////////////////////////////////////#EOL#if (instance.functionID == 'JF041') {#EOL##EOL#&#x9;/////////////////////////////////////////////////////////#EOL#&#x9;// 赤伝処理にともなう関連する受払実績(FT100)の失効処理 //#EOL#&#x9;/////////////////////////////////////////////////////////#EOL#&#x9;if (JT010_DTSYUKKO.oldValue != null &amp;&amp; JT010_DTSYUKKO.oldValue != '') {#EOL##EOL#&#x9;&#x9;rFT100 = instance.createTableOperator('Select', 'FT100');#EOL#&#x9;&#x9;rFT100.setSelectFields('NRUZAITORI, UPDCOUNTER');#EOL#&#x9;&#x9;rFT100.addKeyValue('NRSOURCE', JT010_NRSOURCE.value);#EOL#&#x9;&#x9;rFT100.addKeyValue('KBUKEBARAI', '160');#EOL#&#x9;&#x9;while (rFT100.next()) {#EOL#&#x9;&#x9;&#x9;uFT100 = instance.createTableOperator('Update', 'FT100');#EOL#&#x9;&#x9;&#x9;uFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;&#x9;uFT100.addValue('UPDCOUNTER',&#x9;Number(rFT100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;uFT100.addKeyValue('NRZAITORI',&#x9;&#x9;rFT100.getValueOf('NRZAITORI'));#EOL#&#x9;&#x9;&#x9;uFT100.addKeyValue('UPDCOUNTER',&#x9;rFT100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;count = uFT100.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '在庫増減履歴(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}"/><Script EventP="AU" EventR="" Function="" Name="完成入庫にともなう在庫更新(JF013)" Order="0070" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rFT100; var uFT100; var cFT100;#EOL#var rFT010; var cFT010; var uFT010; var rJT030; var rJT040;#EOL#var amUkebarai = 0; var amNyuko = 0; var amSyukko = 0;#EOL#var qtUkebarai = 0; var qtNyuko = 0; var qtSyukko = 0;#EOL#var qtUkebaraiOld = 0; var amUkebaraiOld = 0;#EOL#var qtUkebaraiSagaku = 0; var amUkebaraiSagaku = 0;#EOL#var amNyukoUpdated = 0; var amSyukkoUpdated = 0;#EOL#var qtNyukoUpdated = 0; var qtSyukkoUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var dtNendOld = 0; var dtMSeqOld = 0;#EOL#var genka = 0; var count = 0; var errorMessage = '';#EOL##EOL#/////////////////////////////////////////////////////#EOL#// 製造完了エントリー(JF013)で処理された場合に実行 //#EOL#/////////////////////////////////////////////////////#EOL#if (instance.functionID == 'JF013') {#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;////////////////// 完成入庫の赤伝処理 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;if ((JT010_QTKANSEI.oldValue != 0 &amp;&amp; JT010_QTKANSEI.valueChanged)#EOL#&#x9;&#x9;|| (JT010_DTKANSEI.oldValue != '' &amp;&amp; JT010_DTKANSEI.valueChanged)) {#EOL##EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;// 関連する受払実績(FT100)の失効処理 //#EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;rFT100 = instance.createTableOperator('Select', 'FT100');#EOL#&#x9;&#x9;rFT100.setSelectFields('NRZAITORI, UPDCOUNTER');#EOL#&#x9;&#x9;rFT100.addKeyValue('NRSOURCE', JT010_NRSOURCE.value);#EOL#&#x9;&#x9;rFT100.addKeyValue('KBUKEBARAI', '060'); //完成入庫//#EOL#&#x9;&#x9;while (rFT100.next()) {#EOL#&#x9;&#x9;&#x9;uFT100 = instance.createTableOperator('Update', 'FT100');#EOL#&#x9;&#x9;&#x9;uFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;&#x9;uFT100.addValue('UPDCOUNTER',&#x9;Number(rFT100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;uFT100.addKeyValue('NRZAITORI',&#x9;rFT100.getValueOf('NRZAITORI'));#EOL#&#x9;&#x9;&#x9;uFT100.addKeyValue('UPDCOUNTER',&#x9;rFT100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;count = uFT100.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '受払実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNendOld = session.getFYearOfDate(JT010_DTKANSEI.oldValue);#EOL#&#x9;&#x9;dtMSeqOld = session.getMSeqOfDate(JT010_DTKANSEI.oldValue);#EOL#&#x9;&#x9;qtUkebaraiOld = JT010_QTKANSEI.oldValue;#EOL#&#x9;&#x9;amUkebaraiOld = JT010_AMGENKA.value;#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 受払実績(FT100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;cFT100.addValue('KBUKEBARAI',&#x9;'060'); //完成入庫//#EOL#&#x9;&#x9;cFT100.addValue('KBZAIHURI',&#x9;'');#EOL#&#x9;&#x9;cFT100.addValue('DTTORIHIKI',&#x9;JT010_DTKANSEI.oldValue);#EOL#&#x9;&#x9;cFT100.addValue('IDHINMOKU',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#&#x9;&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;JT010_CDSOUKOKAN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXAITESAKI',&#x9;'製造現場');#EOL#&#x9;&#x9;cFT100.addValue('PRTORIHIKI',&#x9;JT010_PRGENKA.value);#EOL#&#x9;&#x9;cFT100.addValue('QTTORIHIKI',&#x9;qtUkebaraiOld);#EOL#&#x9;&#x9;cFT100.addValue('AMTORIHIKI',&#x9;amUkebaraiOld);#EOL#&#x9;&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#&#x9;&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;JT010_NRSOURCE.value);#EOL#&#x9;&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;JT010_NRSEIZO.value);#EOL#&#x9;&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#&#x9;&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#&#x9;&#x9;count = cFT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;////////////////// 完成入庫の黒伝処理 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;if ((JT010_QTKANSEI.value != 0 &amp;&amp; JT010_QTKANSEI.valueChanged)#EOL#&#x9;&#x9;|| (JT010_DTKANSEI.value != '' &amp;&amp; JT010_DTKANSEI.valueChanged)) {#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNend = session.getFYearOfDate(JT010_DTKANSEI.value);#EOL#&#x9;&#x9;dtMSeq = session.getMSeqOfDate(JT010_DTKANSEI.value);#EOL#&#x9;&#x9;qtUkebarai = JT010_QTKANSEI.value;#EOL#&#x9;&#x9;amUkebarai = JT010_AMGENKA.value;#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 受払実績(ET100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;&#x9;cFT100.addValue('KBUKEBARAI',&#x9;'060'); //完成入庫//#EOL#&#x9;&#x9;cFT100.addValue('KBZAIHURI',&#x9;'');#EOL#&#x9;&#x9;cFT100.addValue('DTTORIHIKI',&#x9;JT010_DTKANSEI.value);#EOL#&#x9;&#x9;cFT100.addValue('IDHINMOKU',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#&#x9;&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;JT010_CDSOUKOKAN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXAITESAKI',&#x9;'製造現場');#EOL#&#x9;&#x9;cFT100.addValue('PRTORIHIKI',&#x9;JT010_PRGENKA.value);#EOL#&#x9;&#x9;cFT100.addValue('QTTORIHIKI',&#x9;qtUkebarai);#EOL#&#x9;&#x9;cFT100.addValue('AMTORIHIKI',&#x9;amUkebarai);#EOL#&#x9;&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#&#x9;&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;JT010_NRSOURCE.value);#EOL#&#x9;&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;JT010_NRSEIZO.value);#EOL#&#x9;&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;count = cFT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;}#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////////////////////// 残高更新 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;qtUkebaraiSagaku = Number(qtUkebarai) - Number(qtUkebaraiOld);#EOL#&#x9;amUkebaraiSagaku = Number(amUkebarai) - Number(amUkebaraiOld);#EOL#&#x9;if (qtUkebaraiSagaku != 0 || amUkebaraiSagaku != 0) {#EOL##EOL#&#x9;&#x9;rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#&#x9;&#x9;rFT010.setSelectFields('QTKISYU, QTNYUKO, QTSYUKKO, AMKISYU, AMNYUKO, AMSYUKKO, UPDCOUNTER');#EOL#&#x9;&#x9;rFT010.addKeyValue('IDHINMOKU',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;&#x9;rFT010.addKeyValue('CDSOUKO',&#x9;JT010_CDSOUKOKAN.value);#EOL#&#x9;&#x9;if (rFT010.next()) {#EOL#&#x9;&#x9;&#x9;qtNyukoUpdated = Number(rFT010.getValueOf('QTNYUKO')) + Number(qtUkebaraiSagaku);#EOL#&#x9;&#x9;&#x9;amNyukoUpdated = Number(rFT010.getValueOf('AMNYUKO')) + Number(amUkebaraiSagaku);#EOL#&#x9;&#x9;&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;&#x9;&#x9;uFT010.addValue('AMNYUKO',&#x9;&#x9;&#x9;amNyukoUpdated);#EOL#&#x9;&#x9;&#x9;uFT010.addValue('QTNYUKO',&#x9;&#x9;&#x9;qtNyukoUpdated);#EOL#&#x9;&#x9;&#x9;uFT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;&#x9;&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;JT010_CDSOUKOKAN.value);#EOL#&#x9;&#x9;&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;count = uFT010.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;&#x9;&#x9;cFT010.addValue('IDHINMOKU',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;JT010_CDSOUKOKAN.value);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;amUkebaraiSagaku);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;qtUkebaraiSagaku);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;count = cFT010.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////#EOL#&#x9;// エラー処理 //#EOL#&#x9;////////////////#EOL#&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL#}"/><Field Decimal="" ID="DTCANCEL" Name="取消日" NoUpdate="T" Nullable="T" Order="0240" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Script EventP="BD" EventR="BR()" Function="" Name="削除前の妥当性検査" Order="0080" Text="if (JT010_DTSYUKKO.value != '' &amp;&amp; JT010_DTCANCEL.value == '') {#EOL#&#x9;JT010_NRSEIZO.error = '削除する前に製造指示を取り消す必要があります。';#EOL#}"/><Field Decimal="" ID="IDTOKUISAKI" Name="得意先ID" NoUpdate="T" Nullable="T" Order="0020" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="SQSYUKKASAKI" Name="出荷先行番" Nullable="T" Order="0030" Remarks="" Size="3" Type="SMALLINT" TypeOptions=""/><Field Decimal="" ID="TXTYUMONBANGO" Name="相手注文番号" Nullable="T" Order="0040" Remarks="" Size="10" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="PRMITSUMORI" Name="見積売価" Nullable="T" Order="0140" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="PRJYUTYU" Name="確定売価" Nullable="T" Order="0150" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTHAIKI" Name="廃棄数" Nullable="T" Order="0120" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Refer Fields="TXKANJI;CDTORIHIKISAKI" Order="0040" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="JT010.IDTOKUISAKI"/><Refer Fields="NRTANTOUJYUGYOIN;KBSEIKYUHOUSHIKI" Order="0050" OrderBy="" TableAlias="" ToKeyFields="IDTOKUISAKI" ToTable="ET010" WithKeyFields="JT010.IDTOKUISAKI"/><Refer Fields="TXKANJI;NRYUBIN;TXJYUSYO1;TXJYUSYO2" Order="0070" OrderBy="" TableAlias="" ToKeyFields="IDTOKUISAKI;SQSYUKKASAKI" ToTable="ET011" WithKeyFields="JT010.IDTOKUISAKI;JT010.SQSYUKKASAKI"/><Field Decimal="" ID="PRYOTEIGEN" Name="予定原価" NoUpdate="T" Nullable="T" Order="0270" Remarks="(工程Σ(加工レート×製造時間数) ＋ 材料Σ(予定単価×出庫数)) / 製造指示数" Size="7" Type="INTEGER" TypeOptions="VIRTUAL"/><Field Decimal="" ID="DTNOUKI" Name="納期" Nullable="T" Order="0050" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="" ID="DTSYUKKA" Name="出荷日" Nullable="T" Order="0230" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Refer Fields="TXKANJI" Order="0060" OrderBy="" TableAlias="" ToKeyFields="NRJYUGYOIN" ToTable="AT020" WithKeyFields="ET010.NRTANTOUJYUGYOIN"/><Script EventP="AU" EventR="" Function="" Name="更新後の関連データ設定" Order="0051" Text="//////////////////////////#EOL#// Javaパッケージの導入 //#EOL#//////////////////////////#EOL#var importedPackage = new JavaImporter(javax.swing);#EOL#with (importedPackage) {#EOL##EOL#&#x9;//////////////#EOL#&#x9;// 変数定義 //#EOL#&#x9;//////////////#EOL#&#x9;var rBT010; var rBT040; var dJT040; var cJT040;#EOL##EOL#&#x9;////////////////////////////////////////////////////////#EOL#&#x9;// 製造指示数が変更された場合に、材料明細を再設定する //#EOL#&#x9;////////////////////////////////////////////////////////#EOL#&#x9;if (JT010_QTSEIZO.valueChanged) {#EOL##EOL#&#x9;&#x9;ans = JOptionPane.showConfirmDialog(null, '製造指示数が変更されました。材料明細を再設定しますか？', '材料明細の再設定', JOptionPane.OK_CANCEL_OPTION);#EOL#&#x9;&#x9;if (ans == JOptionPane.OK_OPTION) {#EOL##EOL#&#x9;&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;&#x9;// 材料明細を削除 //#EOL#&#x9;&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;&#x9;dJT040 = instance.createTableOperator('Delete', 'JT040');#EOL#&#x9;&#x9;&#x9;dJT040.addKeyValue('NRSEIZO',&#x9;JT010_NRSEIZO.value);#EOL#&#x9;&#x9;&#x9;dJT040.execute();#EOL##EOL#&#x9;&#x9;&#x9;//////////////////////////#EOL#&#x9;&#x9;&#x9;// 材料明細を検索・複写 //#EOL#&#x9;&#x9;&#x9;//////////////////////////#EOL#&#x9;&#x9;&#x9;rBT040 = instance.createTableOperator('Select', 'BT040');#EOL#&#x9;&#x9;&#x9;rBT040.addKeyValue('IDSEIZOHIN',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;&#x9;&#x9;while (rBT040.next()) {#EOL#&#x9;&#x9;&#x9;&#x9;rBT010 = instance.createTableOperator('Select', 'BT010');#EOL#&#x9;&#x9;&#x9;&#x9;rBT010.addKeyValue('IDHINMOKU',&#x9;rBT040.getValueOf('IDHINCHILD'));#EOL#&#x9;&#x9;&#x9;&#x9;if (rBT010.next()) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT040 = instance.createTableOperator('Insert', 'JT040');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT040.addValue('NRSEIZO',&#x9;&#x9;JT010_NRSEIZO.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT040.addValue('SQZAIRYO',&#x9;&#x9;rBT040.getValueOf('SQZAIRYO'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT040.addValue('IDHINMOKU',&#x9;rBT040.getValueOf('IDHINCHILD'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT040.addValue('QTTOUNYU',&#x9;&#x9;rBT040.getValueOf('VLKOUSEI') * JT010_QTSEIZO.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT040.addValue('SQKOUTEI',&#x9;&#x9;rBT040.getValueOf('SQKOUTEI'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT040.addValue('PRYOTEI',&#x9;&#x9;rBT010.getValueOf('PRGENKA'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT040.addValue('PRSYUKKO',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT040.addValue('SQLIST',&#x9;&#x9;rBT040.getValueOf('SQLIST'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cJT040.execute();#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}"/><Script EventP="AU" EventR="" Function="" Name="廃棄出庫にともなう在庫更新(JF013)" Order="0071" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rFT100; var uFT100; var cFT100;#EOL#var rFT010; var cFT010; var uFT010; var rJT030; var rJT040;#EOL#var amUkebarai = 0; var amNyuko = 0; var amSyukko = 0;#EOL#var qtUkebarai = 0; var qtNyuko = 0; var qtSyukko = 0;#EOL#var qtUkebaraiOld = 0; var amUkebaraiOld = 0;#EOL#var qtUkebaraiSagaku = 0; var amUkebaraiSagaku = 0;#EOL#var amSyukkoUpdated = 0; var qtSyukkoUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var dtNendOld = 0; var dtMSeqOld = 0;#EOL#var genka = 0; var count = 0; var errorMessage = '';#EOL##EOL#/////////////////////////////////////////////////////#EOL#// 製造完了エントリー(JF013)で処理された場合に実行 //#EOL#/////////////////////////////////////////////////////#EOL#if (instance.functionID == 'JF013' &amp;&amp; JT010_IDTOKUISAKI.value != '') {#EOL##EOL#&#x9;////////////////////#EOL#&#x9;// 廃棄額の初期化 //#EOL#&#x9;////////////////////#EOL#&#x9;JT010_AMHAIKI.value = 0;#EOL#&#x9;JT010_AMHAIKI.oldValue = 0;#EOL##EOL#&#x9;//////////////////////////////////////////////////////////////////#EOL#&#x9;////////////////// 廃棄出庫の赤伝処理 ////////////////////////////#EOL#&#x9;//////////////////////////////////////////////////////////////////#EOL#&#x9;if ((JT010_QTHAIKI.oldValue != 0 &amp;&amp; JT010_QTHAIKI.valueChanged)#EOL#&#x9;&#x9;|| (JT010_DTSYUKKA.oldValue != '' &amp;&amp; JT010_DTSYUKKA.valueChanged)) {#EOL##EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;// 関連する受払実績(FT100)の失効処理 //#EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;rFT100 = instance.createTableOperator('Select', 'FT100');#EOL#&#x9;&#x9;rFT100.setSelectFields('NRZAITORI, UPDCOUNTER');#EOL#&#x9;&#x9;rFT100.addKeyValue('NRSOURCE', JT010_NRSOURCE.value);#EOL#&#x9;&#x9;rFT100.addKeyValue('KBUKEBARAI', '120'); //振替出庫//#EOL#&#x9;&#x9;while (rFT100.next()) {#EOL#&#x9;&#x9;&#x9;uFT100 = instance.createTableOperator('Update', 'FT100');#EOL#&#x9;&#x9;&#x9;uFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;&#x9;uFT100.addValue('UPDCOUNTER',&#x9;Number(rFT100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;uFT100.addKeyValue('NRZAITORI',&#x9;rFT100.getValueOf('NRZAITORI'));#EOL#&#x9;&#x9;&#x9;uFT100.addKeyValue('UPDCOUNTER',&#x9;rFT100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;count = uFT100.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '受払実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNendOld = session.getFYearOfDate(JT010_DTSYUKKA.oldValue);#EOL#&#x9;&#x9;dtMSeqOld = session.getMSeqOfDate(JT010_DTSYUKKA.oldValue);#EOL#&#x9;&#x9;qtUkebaraiOld = JT010_QTHAIKI.oldValue;#EOL#&#x9;&#x9;amUkebaraiOld = Math.round(JT010_AMGENKA.oldValue * JT010_QTHAIKI.oldValue / JT010_QTKANSEI.oldValue);#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 受払実績(FT100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;cFT100.addValue('KBUKEBARAI',&#x9;'120'); //振替出庫//#EOL#&#x9;&#x9;cFT100.addValue('KBZAIHURI',&#x9;'11'); //雑損振替//#EOL#&#x9;&#x9;cFT100.addValue('DTTORIHIKI',&#x9;JT010_DTSYUKKA.oldValue);#EOL#&#x9;&#x9;cFT100.addValue('IDHINMOKU',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#&#x9;&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;JT010_CDSOUKOKAN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXAITESAKI',&#x9;'廃棄品置場他');#EOL#&#x9;&#x9;cFT100.addValue('PRTORIHIKI',&#x9;JT010_PRGENKA.value);#EOL#&#x9;&#x9;cFT100.addValue('QTTORIHIKI',&#x9;qtUkebaraiOld);#EOL#&#x9;&#x9;cFT100.addValue('AMTORIHIKI',&#x9;amUkebaraiOld);#EOL#&#x9;&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#&#x9;&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;JT010_NRSOURCE.value);#EOL#&#x9;&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;JT010_NRSEIZO.value);#EOL#&#x9;&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#&#x9;&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#&#x9;&#x9;count = cFT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////////////////////////////////////////////////////#EOL#&#x9;////////////////// 廃棄出庫の黒伝処理 ////////////////////////////#EOL#&#x9;//////////////////////////////////////////////////////////////////#EOL#&#x9;if ((JT010_QTHAIKI.value != 0 &amp;&amp; JT010_QTHAIKI.valueChanged)#EOL#&#x9;&#x9;|| (JT010_DTSYUKKA.value != '' &amp;&amp; JT010_DTSYUKKA.valueChanged)) {#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNend = session.getFYearOfDate(JT010_DTSYUKKA.value);#EOL#&#x9;&#x9;dtMSeq = session.getMSeqOfDate(JT010_DTSYUKKA.value);#EOL#&#x9;&#x9;qtUkebarai = JT010_QTHAIKI.value;#EOL#&#x9;&#x9;amUkebarai = Math.round(JT010_AMGENKA.value * JT010_QTHAIKI.value / JT010_QTKANSEI.value);#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 受払実績(ET100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;&#x9;cFT100.addValue('KBUKEBARAI',&#x9;'120'); //振替出庫//#EOL#&#x9;&#x9;cFT100.addValue('KBZAIHURI',&#x9;'11'); //雑損振替//#EOL#&#x9;&#x9;cFT100.addValue('DTTORIHIKI',&#x9;JT010_DTSYUKKA.value);#EOL#&#x9;&#x9;cFT100.addValue('IDHINMOKU',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#&#x9;&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;JT010_CDSOUKOKAN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXAITESAKI',&#x9;'廃棄品置場他');#EOL#&#x9;&#x9;cFT100.addValue('PRTORIHIKI',&#x9;JT010_PRGENKA.value);#EOL#&#x9;&#x9;cFT100.addValue('QTTORIHIKI',&#x9;qtUkebarai);#EOL#&#x9;&#x9;cFT100.addValue('AMTORIHIKI',&#x9;amUkebarai);#EOL#&#x9;&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#&#x9;&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;JT010_NRSOURCE.value);#EOL#&#x9;&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;JT010_NRSEIZO.value);#EOL#&#x9;&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;count = cFT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////#EOL#&#x9;// 廃棄額の設定 //#EOL#&#x9;//////////////////#EOL#&#x9;JT010_AMHAIKI.value = amUkebarai;#EOL#&#x9;JT010_AMHAIKI.oldValue = amUkebaraiOld;#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////////////////////// 残高更新 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;qtUkebaraiSagaku = Number(qtUkebarai) - Number(qtUkebaraiOld);#EOL#&#x9;amUkebaraiSagaku = Number(amUkebarai) - Number(amUkebaraiOld);#EOL#&#x9;if (qtUkebaraiSagaku != 0 || amUkebaraiSagaku != 0) {#EOL##EOL#&#x9;&#x9;rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#&#x9;&#x9;rFT010.setSelectFields('QTKISYU, QTNYUKO, QTSYUKKO, AMKISYU, AMNYUKO, AMSYUKKO, UPDCOUNTER');#EOL#&#x9;&#x9;rFT010.addKeyValue('IDHINMOKU',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;&#x9;rFT010.addKeyValue('CDSOUKO',&#x9;JT010_CDSOUKOKAN.value);#EOL#&#x9;&#x9;if (rFT010.next()) {#EOL#&#x9;&#x9;&#x9;qtSyukkoUpdated = Number(rFT010.getValueOf('QTSYUKKO')) + Number(qtUkebaraiSagaku);#EOL#&#x9;&#x9;&#x9;amSyukkoUpdated = Number(rFT010.getValueOf('AMSYUKKO')) + Number(amUkebaraiSagaku);#EOL#&#x9;&#x9;&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;&#x9;&#x9;uFT010.addValue('AMSYUKKO',&#x9;&#x9;&#x9;amSyukkoUpdated);#EOL#&#x9;&#x9;&#x9;uFT010.addValue('QTSYUKKO',&#x9;&#x9;&#x9;qtSyukkoUpdated);#EOL#&#x9;&#x9;&#x9;uFT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;&#x9;&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;JT010_CDSOUKOKAN.value);#EOL#&#x9;&#x9;&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;count = uFT010.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;&#x9;&#x9;cFT010.addValue('IDHINMOKU',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;JT010_CDSOUKOKAN.value);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;amUkebaraiSagaku);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;qtUkebaraiSagaku);#EOL#&#x9;&#x9;&#x9;count = cFT010.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////#EOL#&#x9;// エラー処理 //#EOL#&#x9;////////////////#EOL#&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL#}"/><Script EventP="AU" EventR="" Function="" Name="販売出庫にともなう在庫更新(JF013)" Order="0072" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rFT100; var uFT100; var cFT100;#EOL#var rFT010; var cFT010; var uFT010; var rJT030; var rJT040;#EOL#var amUkebarai = 0; var amNyuko = 0; var amSyukko = 0;#EOL#var qtUkebarai = 0; var qtNyuko = 0; var qtSyukko = 0;#EOL#var qtUkebaraiOld = 0; var amUkebaraiOld = 0;#EOL#var qtUkebaraiSagaku = 0; var amUkebaraiSagaku = 0;#EOL#var amSagaku = 0; var amSagakuOld = 0;#EOL#var amNyukoUpdated = 0; var amSyukkoUpdated = 0;#EOL#var qtNyukoUpdated = 0; var qtSyukkoUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var dtNendOld = 0; var dtMSeqOld = 0;#EOL#var count = 0; var errorMessage = '';#EOL##EOL#/////////////////////////////////////////////////////#EOL#// 製造完了エントリー(JF013)で処理された場合に実行 //#EOL#/////////////////////////////////////////////////////#EOL#if (instance.functionID == 'JF013' &amp;&amp; JT010_IDTOKUISAKI.value != '') {#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;////////////////// 販売出庫の赤伝処理 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;if ((JT010_QTSYUKKA.oldValue != 0 &amp;&amp; JT010_QTSYUKKA.valueChanged)#EOL#&#x9;&#x9;|| (JT010_DTSYUKKA.oldValue != '' &amp;&amp; JT010_DTSYUKKA.valueChanged)#EOL#&#x9;&#x9;|| JT010_PRJYUTYU.valueChanged) {#EOL##EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;// 関連する受払実績(FT100)の失効処理 //#EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;rFT100 = instance.createTableOperator('Select', 'FT100');#EOL#&#x9;&#x9;rFT100.setSelectFields('NRZAITORI, UPDCOUNTER');#EOL#&#x9;&#x9;rFT100.addKeyValue('NRSOURCE', JT010_NRSOURCE.value);#EOL#&#x9;&#x9;rFT100.addKeyValue('KBUKEBARAI', '130'); //販売出庫//#EOL#&#x9;&#x9;while (rFT100.next()) {#EOL#&#x9;&#x9;&#x9;uFT100 = instance.createTableOperator('Update', 'FT100');#EOL#&#x9;&#x9;&#x9;uFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;&#x9;uFT100.addValue('UPDCOUNTER',&#x9;Number(rFT100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;uFT100.addKeyValue('NRZAITORI',&#x9;rFT100.getValueOf('NRZAITORI'));#EOL#&#x9;&#x9;&#x9;uFT100.addKeyValue('UPDCOUNTER',&#x9;rFT100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;count = uFT100.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '受払実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNendOld = session.getFYearOfDate(JT010_DTSYUKKA.oldValue);#EOL#&#x9;&#x9;dtMSeqOld = session.getMSeqOfDate(JT010_DTSYUKKA.oldValue);#EOL#&#x9;&#x9;qtUkebaraiOld = JT010_QTSYUKKA.oldValue;#EOL#&#x9;&#x9;amUkebaraiOld = JT010_AMGENKA.oldValue - JT010_AMHAIKI.oldValue;#EOL#&#x9;&#x9;amSagakuOld = (qtUkebaraiOld * JT010_PRJYUTYU.oldValue) - JT010_AMGENKA.oldValue;#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 受払実績(FT100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;cFT100.addValue('KBUKEBARAI',&#x9;'130'); //販売出庫//#EOL#&#x9;&#x9;cFT100.addValue('KBZAIHURI',&#x9;'');#EOL#&#x9;&#x9;cFT100.addValue('DTTORIHIKI',&#x9;JT010_DTSYUKKA.oldValue);#EOL#&#x9;&#x9;cFT100.addValue('IDHINMOKU',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#&#x9;&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;JT010_CDSOUKOKAN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXAITESAKI',&#x9;ET011_TXKANJI.value);#EOL#&#x9;&#x9;cFT100.addValue('PRTORIHIKI',&#x9;JT010_PRGENKA.value);#EOL#&#x9;&#x9;cFT100.addValue('QTTORIHIKI',&#x9;qtUkebaraiOld);#EOL#&#x9;&#x9;cFT100.addValue('AMTORIHIKI',&#x9;amUkebaraiOld);#EOL#&#x9;&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;amSagakuOld);#EOL#&#x9;&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;JT010_NRSOURCE.value);#EOL#&#x9;&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;JT010_NRSEIZO.value);#EOL#&#x9;&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#&#x9;&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#&#x9;&#x9;count = cFT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;////////////////// 完成入庫の黒伝処理 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;if ((JT010_QTSYUKKA.value != 0 &amp;&amp; JT010_QTSYUKKA.valueChanged)#EOL#&#x9;&#x9;|| (JT010_DTSYUKKA.value != '' &amp;&amp; JT010_DTSYUKKA.valueChanged)#EOL#&#x9;&#x9;|| JT010_PRJYUTYU.valueChanged) {#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNend = session.getFYearOfDate(JT010_DTSYUKKA.value);#EOL#&#x9;&#x9;dtMSeq = session.getMSeqOfDate(JT010_DTSYUKKA.value);#EOL#&#x9;&#x9;qtUkebarai = JT010_QTSYUKKA.value;#EOL#&#x9;&#x9;amUkebarai = JT010_AMGENKA.value - JT010_AMHAIKI.value;#EOL#&#x9;&#x9;amSagaku = (qtUkebarai * JT010_PRJYUTYU.value) - JT010_AMGENKA.value;#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 受払実績(ET100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;&#x9;cFT100.addValue('KBUKEBARAI',&#x9;'130'); //販売出庫//#EOL#&#x9;&#x9;cFT100.addValue('KBZAIHURI',&#x9;'');#EOL#&#x9;&#x9;cFT100.addValue('DTTORIHIKI',&#x9;JT010_DTSYUKKA.value);#EOL#&#x9;&#x9;cFT100.addValue('IDHINMOKU',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#&#x9;&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;JT010_CDSOUKOKAN.value);#EOL#&#x9;&#x9;cFT100.addValue('TXAITESAKI',&#x9;ET011_TXKANJI.value);#EOL#&#x9;&#x9;cFT100.addValue('PRTORIHIKI',&#x9;JT010_PRGENKA.value);#EOL#&#x9;&#x9;cFT100.addValue('QTTORIHIKI',&#x9;qtUkebarai);#EOL#&#x9;&#x9;cFT100.addValue('AMTORIHIKI',&#x9;amUkebarai);#EOL#&#x9;&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;amSagaku);#EOL#&#x9;&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;JT010_NRSOURCE.value);#EOL#&#x9;&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;JT010_NRSEIZO.value);#EOL#&#x9;&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;count = cFT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '在庫増減履歴(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////////////////////// 残高更新 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;qtUkebaraiSagaku = Number(qtUkebarai) - Number(qtUkebaraiOld);#EOL#&#x9;amUkebaraiSagaku = Number(amUkebarai) - Number(amUkebaraiOld);#EOL#&#x9;if (qtUkebaraiSagaku != 0 || amUkebaraiSagaku != 0) {#EOL##EOL#&#x9;&#x9;rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#&#x9;&#x9;rFT010.setSelectFields('QTKISYU, QTNYUKO, QTSYUKKO, AMKISYU, AMNYUKO, AMSYUKKO, UPDCOUNTER');#EOL#&#x9;&#x9;rFT010.addKeyValue('IDHINMOKU',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;&#x9;rFT010.addKeyValue('CDSOUKO',&#x9;JT010_CDSOUKOKAN.value);#EOL#&#x9;&#x9;if (rFT010.next()) {#EOL#&#x9;&#x9;&#x9;qtSyukkoUpdated = Number(rFT010.getValueOf('QTSYUKKO')) + Number(qtUkebaraiSagaku);#EOL#&#x9;&#x9;&#x9;amSyukkoUpdated = Number(rFT010.getValueOf('AMSYUKKO')) + Number(amUkebaraiSagaku);#EOL#&#x9;&#x9;&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;&#x9;&#x9;uFT010.addValue('AMSYUKKO',&#x9;&#x9;&#x9;amSyukkoUpdated);#EOL#&#x9;&#x9;&#x9;uFT010.addValue('QTSYUKKO',&#x9;&#x9;&#x9;qtSyukkoUpdated);#EOL#&#x9;&#x9;&#x9;uFT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;&#x9;&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;JT010_CDSOUKOKAN.value);#EOL#&#x9;&#x9;&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;count = uFT010.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;&#x9;&#x9;cFT010.addValue('IDHINMOKU',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;JT010_CDSOUKOKAN.value);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;qtUkebaraiSagaku);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;amUkebaraiSagaku);#EOL#&#x9;&#x9;&#x9;count = cFT010.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////#EOL#&#x9;// エラー処理 //#EOL#&#x9;////////////////#EOL#&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL#}"/><Script EventP="AU" EventR="" Function="" Name="出荷売上にともなう売掛更新(JF013)" Order="0073" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rET100; var uET100; var cET100; var rET010; var uET010;#EOL#var amTorihiki = 0; var amTorihikiOld = 0; var amTax = 0; var amTaxOld = 0;#EOL#var amUriageUpdated = 0; var amUriageUpdated = 0; var amUriageSagaku = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var dtNendOld = 0; var dtMSeqOld = 0;#EOL#var count = 0; var errorMessage = ''; var fgValid = 'F';#EOL##EOL#/////////////////////////////////////////////////////#EOL#// 製造完了エントリー(JF013)で処理された場合に実行 //#EOL#/////////////////////////////////////////////////////#EOL#if (instance.functionID == 'JF013' &amp;&amp; JT010_IDTOKUISAKI.value != '') {#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;/////////////////////// 出荷売上の赤伝処理 /////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;if ((JT010_QTSYUKKA.oldValue != 0 &amp;&amp; JT010_QTSYUKKA.valueChanged)#EOL#&#x9;&#x9;|| (JT010_DTSYUKKA.oldValue != '' &amp;&amp; JT010_DTSYUKKA.valueChanged)#EOL#&#x9;&#x9;|| (JT010_PRJYUTYU.oldValue != 0 &amp;&amp; JT010_PRJYUTYU.valueChanged)) {#EOL##EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;// 関連する売上実績(ET100)の失効処理 //#EOL#&#x9;&#x9;///////////////////////////////////////#EOL#&#x9;&#x9;rET100 = instance.createTableOperator('Select', 'ET100');#EOL#&#x9;&#x9;rET100.setSelectFields('NRURIKAKE, NRSEIKYU, UPDCOUNTER');#EOL#&#x9;&#x9;rET100.addKeyValue('NRSOURCE',&#x9;JT010_NRSOURCE.value);#EOL#&#x9;&#x9;rET100.addKeyValue('FGVALID',&#x9;'T');#EOL#&#x9;&#x9;while (rET100.next()) {#EOL#&#x9;&#x9;&#x9;if (rET100.getValueOf('NRSEIKYU') == '') {#EOL#&#x9;&#x9;&#x9;&#x9;uET100 = instance.createTableOperator('Update', 'ET100');#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addValue('UPDCOUNTER',&#x9;Number(rET100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addKeyValue('NRURIKAKE',&#x9;&#x9;rET100.getValueOf('NRURIKAKE'));#EOL#&#x9;&#x9;&#x9;&#x9;uET100.addKeyValue('UPDCOUNTER',&#x9;rET100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;&#x9;count = uET100.execute();#EOL#&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '売上実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;fgValid = 'T';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNendOld = session.getFYearOfDate(JT010_DTSYUKKA.oldValue);#EOL#&#x9;&#x9;dtMSeqOld = session.getMSeqOfDate(JT010_DTSYUKKA.oldValue);#EOL#&#x9;&#x9;amTorihikiOld = JT010_QTSYUKKA.oldValue * JT010_PRJYUTYU.oldValue;#EOL#&#x9;&#x9;amTaxOld = session.getTaxAmount(JT010_DTSYUKKA.oldValue + '', amTorihikiOld);#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 売上実績(ET100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;cET100 = instance.createTableOperator('Insert', 'ET100');#EOL#&#x9;&#x9;cET100.addValue('NRURIKAKE',&#x9;session.getNextNumber('NRURIKAKE'));#EOL#&#x9;&#x9;cET100.addValue('IDTOKUISAKI',&#x9;JT010_IDTOKUISAKI.value);#EOL#&#x9;&#x9;cET100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;&#x9;cET100.addValue('FGVALID',&#x9;&#x9;fgValid);#EOL#&#x9;&#x9;cET100.addValue('KBURITORI',&#x9;'00'); //出荷売上//#EOL#&#x9;&#x9;cET100.addValue('DTTORIHIKI',&#x9;JT010_DTSYUKKA.oldValue);#EOL#&#x9;&#x9;cET100.addValue('IDHINMOKU',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;&#x9;cET100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;&#x9;cET100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;&#x9;cET100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#&#x9;&#x9;cET100.addValue('PRTORIHIKI',&#x9;JT010_PRJYUTYU.oldValue);#EOL#&#x9;&#x9;cET100.addValue('QTTORIHIKI',&#x9;JT010_QTSYUKKA.oldValue);#EOL#&#x9;&#x9;cET100.addValue('AMTORIHIKI',&#x9;amTorihikiOld);#EOL#&#x9;&#x9;cET100.addValue('AMTAX',&#x9;&#x9;amTaxOld);#EOL#&#x9;&#x9;cET100.addValue('AMGENKA',&#x9;&#x9;JT010_AMGENKA.oldValue);#EOL#&#x9;&#x9;cET100.addValue('NRSEIKYU',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('NRSOURCE',&#x9;&#x9;JT010_NRSOURCE.value);#EOL#&#x9;&#x9;cET100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cET100.addValue('TXREFNO',&#x9;&#x9;JT010_NRSEIZO.value);#EOL#&#x9;&#x9;cET100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#&#x9;&#x9;cET100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#&#x9;&#x9;count = cET100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '売上実績(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;/////////////////////// 出荷売上の黒伝処理 /////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;if ((JT010_QTSYUKKA.value != 0 &amp;&amp; JT010_QTSYUKKA.valueChanged)#EOL#&#x9;&#x9;|| (JT010_DTSYUKKA.value != '' &amp;&amp; JT010_DTSYUKKA.valueChanged)#EOL#&#x9;&#x9;|| (JT010_PRJYUTYU.value != 0 &amp;&amp; JT010_PRJYUTYU.valueChanged)) {#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・取引高の設定 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;dtNend = session.getFYearOfDate(JT010_DTSYUKKA.value);#EOL#&#x9;&#x9;dtMSeq = session.getMSeqOfDate(JT010_DTSYUKKA.value);#EOL#&#x9;&#x9;amTorihiki = JT010_QTSYUKKA.value * JT010_PRJYUTYU.value;#EOL#&#x9;&#x9;amTax = session.getTaxAmount(JT010_DTSYUKKA.value + '', amTorihiki);#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 売上実績(ET100)の追加 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;var nrUrikake = session.getNextNumber('NRURIKAKE');#EOL#&#x9;&#x9;cET100 = instance.createTableOperator('Insert', 'ET100');#EOL#&#x9;&#x9;cET100.addValue('NRURIKAKE',&#x9;nrUrikake);#EOL#&#x9;&#x9;cET100.addValue('IDTOKUISAKI',&#x9;JT010_IDTOKUISAKI.value);#EOL#&#x9;&#x9;cET100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;&#x9;cET100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;&#x9;cET100.addValue('KBURITORI',&#x9;'00'); //出荷売上//#EOL#&#x9;&#x9;cET100.addValue('DTTORIHIKI',&#x9;JT010_DTSYUKKA.value);#EOL#&#x9;&#x9;cET100.addValue('IDHINMOKU',&#x9;JT010_IDSEIZOHIN.value);#EOL#&#x9;&#x9;cET100.addValue('TXHINBAN',&#x9;&#x9;BT010_TXHINBAN.value);#EOL#&#x9;&#x9;cET100.addValue('TXHINMEI',&#x9;&#x9;BT010_TXHINMEI.value);#EOL#&#x9;&#x9;cET100.addValue('KBUNIT',&#x9;&#x9;BT010_KBUNIT.value);#EOL#&#x9;&#x9;cET100.addValue('PRTORIHIKI',&#x9;JT010_PRJYUTYU.value);#EOL#&#x9;&#x9;cET100.addValue('QTTORIHIKI',&#x9;JT010_QTSYUKKA.value);#EOL#&#x9;&#x9;cET100.addValue('AMTORIHIKI',&#x9;amTorihiki);#EOL#&#x9;&#x9;cET100.addValue('AMTAX',&#x9;&#x9;amTax);#EOL#&#x9;&#x9;cET100.addValue('AMGENKA',&#x9;&#x9;JT010_AMGENKA.value);#EOL#&#x9;&#x9;cET100.addValue('NRSEIKYU',&#x9;&#x9;'');#EOL#&#x9;&#x9;cET100.addValue('NRSOURCE',&#x9;&#x9;JT010_NRSOURCE.value);#EOL#&#x9;&#x9;cET100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;cET100.addValue('TXREFNO',&#x9;&#x9;JT010_NRSEIZO.value);#EOL#&#x9;&#x9;cET100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;cET100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;count = cET100.execute();#EOL#&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;if (ET010_KBSEIKYUHOUSHIKI.value == '20') {#EOL#&#x9;&#x9;&#x9;&#x9;instance.parmMap.put('NRURIKAKE',&#x9;nrUrikake);#EOL#&#x9;&#x9;&#x9;&#x9;instance.callFunction('EF112'); //都度請求処理//#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;errorMessage = '売上実績(ET100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;//////////////////////////// 残高更新 //////////////////////////////////#EOL#&#x9;////////////////////////////////////////////////////////////////////////#EOL#&#x9;amUriageSagaku = Number(amTorihiki) + Number(amTax) - Number(amTorihikiOld) - Number(amTaxOld);#EOL#&#x9;if (amUriageSagaku != 0) {#EOL##EOL#&#x9;&#x9;rET010 = instance.createTableOperator('Select', 'ET010');#EOL#&#x9;&#x9;rET010.setSelectFields('AMURIAGE, UPDCOUNTER');#EOL#&#x9;&#x9;rET010.addKeyValue('IDTOKUISAKI',&#x9;JT010_IDTOKUISAKI.value);#EOL#&#x9;&#x9;if (rET010.next()) {#EOL#&#x9;&#x9;&#x9;amUriageUpdated = Number(rET010.getValueOf('AMURIAGE')) + Number(amUriageSagaku);#EOL#&#x9;&#x9;&#x9;uET010 = instance.createTableOperator('Update', 'ET010');#EOL#&#x9;&#x9;&#x9;uET010.addValue('AMURIAGE',&#x9;&#x9;&#x9;amUriageUpdated);#EOL#&#x9;&#x9;&#x9;uET010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rET010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;uET010.addKeyValue('IDTOKUISAKI',&#x9;JT010_IDTOKUISAKI.value);#EOL#&#x9;&#x9;&#x9;uET010.addKeyValue('UPDCOUNTER',&#x9;rET010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;count = uET010.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;errorMessage = '得意先(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////#EOL#&#x9;// エラー処理 //#EOL#&#x9;////////////////#EOL#&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL#}"/><Field Decimal="" ID="AMGENKA" Name="実勢原価額" NoUpdate="T" Nullable="T" Order="0130" Remarks="(工程Σ(加工レート×製造時間数) ＋ 材料Σ(出庫単価×出庫数)) / 完成数" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMHANBAI" Name="販売額" Nullable="T" Order="0290" Remarks="" Size="7" Type="INTEGER" TypeOptions="VIRTUAL"/><Field Decimal="" ID="AMARARI" Name="粗利額" NoUpdate="T" Nullable="T" Order="0300" Remarks="" Size="7" Type="INTEGER" TypeOptions="VIRTUAL,ACCEPT_MINUS"/><Script EventP="BC;BU;BD" EventR="BR()" Function="" Name="会計日付の妥当性検査" Order="0031" Text="JT010_DTSYUKKO.error = session.getErrorOfAccountDate(JT010_DTSYUKKO.value);#EOL#JT010_DTKANSEI.error = session.getErrorOfAccountDate(JT010_DTKANSEI.value);#EOL#JT010_DTSYUKKA.error = session.getErrorOfAccountDate(JT010_DTSYUKKA.value);#EOL#JT010_DTCANCEL.error = session.getErrorOfAccountDate(JT010_DTCANCEL.value);#EOL#"/><Field Decimal="" ID="AMHAIKI" Name="廃棄額" Nullable="T" Order="0291" Remarks="" Size="7" Type="INTEGER" TypeOptions="VIRTUAL"/></Table><Table ID="MT031" Name="在庫移動指示明細" Remarks="在庫移動の対象品目の一覧が保持されるテーブル" SubsystemID="M"><Field Decimal="" ID="NRZAIIDOU" Name="在庫移動№" Nullable="F" Order="0000" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="PRZAIIDOU" Name="移動単価" NoUpdate="T" Nullable="F" Order="0020" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTZAIIDOU" Name="移動数量" Nullable="F" Order="0030" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Key Fields="NRZAIIDOU;IDHINMOKU" Type="PK"/><Field Decimal="" ID="IDHINMOKU" Name="品目ID" Nullable="F" Order="0011" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Refer Fields="TXHINBAN;TXHINMEI;KBUNIT" Order="0070" OrderBy="" TableAlias="" ToKeyFields="IDHINMOKU" ToTable="BT010" WithKeyFields="MT031.IDHINMOKU"/><Script EventP="BC" EventR="AR()" Function="" Name="追加時設定" Order="0000" Text="//////////////////////////////////////////#EOL#// 移動平均単価を移動単価として設定する //#EOL#//////////////////////////////////////////#EOL#if (MT031_PRZAIIDOU.value == 0) {#EOL#&#x9;var qtZaiko = Number(FT010_QTKISYU.value) + Number(FT010_QTNYUKO.value) - Number(FT010_QTSYUKKO.value);#EOL#&#x9;var amZaiko = Number(FT010_AMKISYU.value) + Number(FT010_AMNYUKO.value) - Number(FT010_AMSYUKKO.value);#EOL#&#x9;if (qtZaiko != 0) {#EOL#&#x9;&#x9;MT031_PRZAIIDOU.value = Math.round(amZaiko / qtZaiko);#EOL#&#x9;}#EOL#}"/><Refer Fields="CDSOUKOFROM" Order="0080" OrderBy="" TableAlias="" ToKeyFields="NRZAIIDOU" ToTable="MT030" WithKeyFields="MT031.NRZAIIDOU"/><Refer Fields="AMKISYU;AMSYUKKO;AMNYUKO;QTKISYU;QTSYUKKO;QTNYUKO" Optional="T" Order="0090" OrderBy="" TableAlias="" ToKeyFields="IDHINMOKU;CDSOUKO" ToTable="FT010" WithKeyFields="MT031.IDHINMOKU;MT030.CDSOUKOFROM"/><Script EventP="BU" EventR="BR()" Function="" Name="更新時設定" Order="0010" Text="if (instance.functionID != 'MF033') {#EOL#&#x9;MT031_QTZAIIDOU.editable = false;#EOL#}"/></Table><Table ID="MT021" Name="棚卸指示明細" Remarks="棚卸の対象品目の一覧が保持されるテーブル。棚卸開始日時時点での帳簿在庫の一覧が複写される。" SubsystemID="M"><Field Decimal="" ID="NRTANAOROSI" Name="棚卸№" Nullable="F" Order="0000" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="IDHINMOKU" Name="品目ID" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="PRJITSUTANA" Name="実棚単価" Nullable="T" Order="0040" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTJITSUTANA" Name="実棚数量" Nullable="T" Order="0050" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Key Fields="NRTANAOROSI;IDHINMOKU" Type="PK"/><Field Decimal="" ID="PRKIJYUN" Name="基準単価" Nullable="T" Order="0021" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTKIJYUN" Name="基準数量" Nullable="T" Order="0031" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Refer Fields="TXHINBAN;TXHINMEI;KBUNIT;PRGENKA" Order="0020" OrderBy="" TableAlias="" ToKeyFields="IDHINMOKU" ToTable="BT010" WithKeyFields="MT021.IDHINMOKU"/><Field Decimal="" ID="QTDIFF" Name="実棚差数" NoUpdate="T" Nullable="T" Order="0051" Remarks="" Size="7" Type="INTEGER" TypeOptions="VIRTUAL,ACCEPT_MINUS"/><Field Decimal="" ID="AMDIFF" Name="実棚差額" NoUpdate="T" Nullable="T" Order="0052" Remarks="" Size="7" Type="INTEGER" TypeOptions="VIRTUAL,ACCEPT_MINUS"/><Refer Fields="CDSOUKO" Order="0030" OrderBy="" TableAlias="" ToKeyFields="NRTANAOROSI" ToTable="MT020" WithKeyFields="MT021.NRTANAOROSI"/><Refer Fields="TXSOUKO" Order="0040" OrderBy="" TableAlias="" ToKeyFields="CDSOUKO" ToTable="AT040" WithKeyFields="MT020.CDSOUKO"/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールドの設定" Order="0000" Text="MT021_QTDIFF.editable = false;#EOL#MT021_AMDIFF.editable = false;#EOL##EOL#MT021_QTDIFF.value = MT021_QTJITSUTANA.value - MT021_QTKIJYUN.value;#EOL#MT021_AMDIFF.value = (MT021_QTJITSUTANA.value * MT021_PRJITSUTANA.value) - (MT021_QTKIJYUN.value * MT021_PRKIJYUN.value);"/></Table><Table ID="MT030" Name="在庫移動指示" Remarks="在庫移動のまとまりを管理するためのテーブル。移動元倉庫、移動先倉庫等の属性を含む。" SubsystemID="M"><Field Decimal="" ID="NRZAIIDOU" Name="在庫移動№" Nullable="F" Order="0000" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRZAIIDOU)"/><Field Decimal="" ID="CDSOUKOFROM" Name="元倉庫Ｃ" Nullable="F" Order="0010" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="CDSOUKOTHRU" Name="先倉庫Ｃ" Nullable="F" Order="0020" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="DTSHIJI" Name="指示日" NoUpdate="T" Nullable="F" Order="0030" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="" ID="TXTEKIYO" Name="摘要" Nullable="T" Order="0050" Remarks="" Size="300" Type="VARCHAR" TypeOptions=""/><Field Decimal="" ID="NRSOURCE" Name="取引ソース№" NoUpdate="T" Nullable="F" Order="0060" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRSOURCE)"/><Key Fields="NRZAIIDOU" Type="PK"/><Key Fields="NRSOURCE" Type="SK"/><Refer Fields="TXSOUKO" Order="0050" OrderBy="" TableAlias="AT040F" ToKeyFields="CDSOUKO" ToTable="AT040" WithKeyFields="MT030.CDSOUKOFROM"/><Refer Fields="TXSOUKO" Order="0060" OrderBy="" TableAlias="AT040T" ToKeyFields="CDSOUKO" ToTable="AT040" WithKeyFields="MT030.CDSOUKOTHRU"/><Field ID="STZAIIDOU" Name="移動状況" NoUpdate="T" Nullable="F" Order="0070" Size="2" Type="CHAR" TypeOptions="VIRTUAL,KUBUN(STZAIIDOU)"/><Script EventP="BC" EventR="BR()" Function="" Name="追加前設定" Order="0010" Text="//////////////////#EOL#// 入力不可設定 //#EOL#//////////////////#EOL#MT030_DTKANRYO.editable = false;#EOL##EOL#////////////////////////#EOL#// 指示日の初期値設定 //#EOL#////////////////////////#EOL#if (MT030_DTSHIJI.value == '') {#EOL#&#x9;MT030_DTSHIJI.value = session.today + '';#EOL#}#EOL##EOL#//////////////////#EOL#// 移動先の検査 //#EOL#//////////////////#EOL#if (MT030_CDSOUKOTHRU.value == MT030_CDSOUKOFROM.value) {#EOL#&#x9;MT030_CDSOUKOTHRU.error = '同一倉庫へは移動できません。';#EOL#}"/><Field Decimal="" ID="DTKANRYO" Name="完了日" NoUpdate="T" Nullable="T" Order="0041" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Script EventP="BU" EventR="BR()" Function="" Name="更新前設定" Order="0020" Text="//////////////////////////#EOL#// 明細保守の妥当性検査 //#EOL#//////////////////////////#EOL#if (instance.functionID == 'MF033') {#EOL#&#x9;if (MT030_DTKANRYO.value != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage('完了済の移動指示については変更できません。');#EOL#&#x9;}#EOL#}#EOL##EOL#//////////////////////////////#EOL#// 完了報告時の完了日の設定 //#EOL#//////////////////////////////#EOL#if (instance.functionID == 'MF035A') {#EOL#&#x9;MT030_DTKANRYO.value = session.today + '';#EOL#}#EOL##EOL#////////////////////////////////#EOL#// 完了取消時の完了日のクリア //#EOL#////////////////////////////////#EOL#if (instance.functionID == 'MF035B') {#EOL#&#x9;MT030_DTKANRYO.value = '';#EOL#}#EOL#"/><Script EventP="AU" EventR="" Function="" Name="完了報告後の関連テーブル処理" Order="0050" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rMT031; var uMT031; var rBT010; var cFT100;#EOL#var rFT010; var uFT010; var cFT010;#EOL#var amNyukoUpdated = 0; var amSyukkoUpdated = 0;#EOL#var qtNyukoUpdated = 0; var qtSyukkoUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var kbUkebarai = '';#EOL#var count = 0; var errorMessage = ''; var dtUkebarai = '';#EOL##EOL#//////////////////////////////#EOL#// 完了更新されたことの検査 //#EOL#//////////////////////////////#EOL#if (MT030_DTKANRYO.oldValue == '' &amp;&amp; MT030_DTKANRYO.value != '') {#EOL##EOL#&#x9;//////////////////////////////////#EOL#&#x9;// 年度・月度・日付・区分の設定 //#EOL#&#x9;//////////////////////////////////#EOL#&#x9;dtNend = session.getFYearOfDate(MT030_DTKANRYO.value);#EOL#&#x9;dtMSeq = session.getMSeqOfDate(MT030_DTKANRYO.value);#EOL#&#x9;dtUkebarai = MT030_DTKANRYO.value + '';#EOL##EOL#&#x9;///////////////////////////////#EOL#&#x9;// 移動指示明細(MT031)の検索 //#EOL#&#x9;///////////////////////////////#EOL#&#x9;rMT031 = instance.createTableOperator('Select', 'MT031');#EOL#&#x9;rMT031.addKeyValue('NRZAIIDOU',&#x9;MT030_NRZAIIDOU.value);#EOL#&#x9;while (rMT031.next()) {#EOL##EOL#&#x9;&#x9;///////////////////////#EOL#&#x9;&#x9;// 品目(BT010)の検索 //#EOL#&#x9;&#x9;///////////////////////#EOL#&#x9;&#x9;rBT010 = instance.createTableOperator('Select', 'BT010');#EOL#&#x9;&#x9;rBT010.setSelectFields('TXHINBAN, TXHINMEI, KBUNIT');#EOL#&#x9;&#x9;rBT010.addKeyValue('IDHINMOKU',&#x9;rMT031.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;if (rBT010.next()) {#EOL##EOL#&#x9;&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;// 移動出庫分の在庫増減履歴(FT100)の追加 //#EOL#&#x9;&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;&#x9;&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;&#x9;&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;&#x9;&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;&#x9;&#x9;cFT100.addValue('KBUKEBARAI',&#x9;'110'); //移動出庫//#EOL#&#x9;&#x9;&#x9;cFT100.addValue('KBZAIHURI',&#x9;'');#EOL#&#x9;&#x9;&#x9;cFT100.addValue('DTTORIHIKI',&#x9;dtUkebarai);#EOL#&#x9;&#x9;&#x9;cFT100.addValue('IDHINMOKU',&#x9;rMT031.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;rBT010.getValueOf('TXHINBAN'));#EOL#&#x9;&#x9;&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;rBT010.getValueOf('TXHINMEI'));#EOL#&#x9;&#x9;&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;rBT010.getValueOf('KBUNIT'));#EOL#&#x9;&#x9;&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;MT030_CDSOUKOFROM.value);#EOL#&#x9;&#x9;&#x9;cFT100.addValue('TXAITESAKI',&#x9;AT040T_TXSOUKO.value);#EOL#&#x9;&#x9;&#x9;cFT100.addValue('PRTORIHIKI',&#x9;rMT031.getValueOf('PRZAIIDOU'));#EOL#&#x9;&#x9;&#x9;cFT100.addValue('QTTORIHIKI',&#x9;rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;cFT100.addValue('AMTORIHIKI',&#x9;rMT031.getValueOf('PRZAIIDOU') * rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;cFT100.addValue('KBZAIHURI',&#x9;'');#EOL#&#x9;&#x9;&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;MT030_NRSOURCE.value);#EOL#&#x9;&#x9;&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;MT030_NRZAIIDOU.value);#EOL#&#x9;&#x9;&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;&#x9;count = cFT100.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '受払実績(FT100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;/////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;// 移動元倉庫在庫(FT010)の在庫残高更新 //#EOL#&#x9;&#x9;&#x9;/////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;if (errorMessage == '') {#EOL#&#x9;&#x9;&#x9;&#x9;rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#&#x9;&#x9;&#x9;&#x9;rFT010.setSelectFields('QTSYUKKO, AMSYUKKO, UPDCOUNTER');#EOL#&#x9;&#x9;&#x9;&#x9;rFT010.addKeyValue('IDHINMOKU',&#x9;rMT031.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;rFT010.addKeyValue('CDSOUKO',&#x9;MT030_CDSOUKOFROM.value);#EOL#&#x9;&#x9;&#x9;&#x9;if (rFT010.next()) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;qtSyukkoUpdated = Number(rFT010.getValueOf('QTSYUKKO')) + Number(rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amSyukkoUpdated = Number(rFT010.getValueOf('AMSYUKKO')) + Number(rMT031.getValueOf('PRZAIIDOU') * rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('AMSYUKKO',&#x9;&#x9;amSyukkoUpdated);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('QTSYUKKO',&#x9;&#x9;qtSyukkoUpdated);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('UPDCOUNTER',&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;rMT031.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;MT030_CDSOUKOFROM.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;count = uFT010.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('IDHINMOKU',&#x9;&#x9;rMT031.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;&#x9;MT030_CDSOUKOFROM.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;&#x9;rMT031.getValueOf('PRZAIIDOU') * rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;&#x9;rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;count = cFT010.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;// 移動入庫分の在庫増減履歴(FT100)の追加 //#EOL#&#x9;&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;&#x9;&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;&#x9;&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;&#x9;&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;&#x9;&#x9;cFT100.addValue('KBUKEBARAI',&#x9;'010'); //移動入庫//#EOL#&#x9;&#x9;&#x9;cFT100.addValue('DTTORIHIKI',&#x9;dtUkebarai);#EOL#&#x9;&#x9;&#x9;cFT100.addValue('IDHINMOKU',&#x9;rMT031.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;rBT010.getValueOf('TXHINBAN'));#EOL#&#x9;&#x9;&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;rBT010.getValueOf('TXHINMEI'));#EOL#&#x9;&#x9;&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;rBT010.getValueOf('KBUNIT'));#EOL#&#x9;&#x9;&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;MT030_CDSOUKOTHRU.value);#EOL#&#x9;&#x9;&#x9;cFT100.addValue('TXAITESAKI',&#x9;AT040F_TXSOUKO.value);#EOL#&#x9;&#x9;&#x9;cFT100.addValue('PRTORIHIKI',&#x9;rMT031.getValueOf('PRZAIIDOU'));#EOL#&#x9;&#x9;&#x9;cFT100.addValue('QTTORIHIKI',&#x9;rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;cFT100.addValue('AMTORIHIKI',&#x9;rMT031.getValueOf('PRZAIIDOU') * rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;cFT100.addValue('KBZAIHURI',&#x9;'');#EOL#&#x9;&#x9;&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;MT030_NRSOURCE.value);#EOL#&#x9;&#x9;&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;MT030_NRZAIIDOU.value);#EOL#&#x9;&#x9;&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;&#x9;count = cFT100.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '受払実績(FT100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;/////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;// 移動先倉庫在庫(FT010)の在庫残高更新 //#EOL#&#x9;&#x9;&#x9;/////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;if (errorMessage == '') {#EOL#&#x9;&#x9;&#x9;&#x9;rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#&#x9;&#x9;&#x9;&#x9;rFT010.setSelectFields('QTNYUKO, AMNYUKO, UPDCOUNTER');#EOL#&#x9;&#x9;&#x9;&#x9;rFT010.addKeyValue('IDHINMOKU',&#x9;rMT031.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;rFT010.addKeyValue('CDSOUKO',&#x9;MT030_CDSOUKOTHRU.value);#EOL#&#x9;&#x9;&#x9;&#x9;if (rFT010.next()) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;qtNyukoUpdated = Number(rFT010.getValueOf('QTNYUKO')) + Number(rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amNyukoUpdated = Number(rFT010.getValueOf('AMNYUKO')) + Number(rMT031.getValueOf('PRZAIIDOU') * rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('AMNYUKO',&#x9;&#x9;amNyukoUpdated);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('QTNYUKO',&#x9;&#x9;qtNyukoUpdated);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('UPDCOUNTER',&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;rMT031.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;MT030_CDSOUKOTHRU.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;count = uFT010.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('IDHINMOKU',&#x9;&#x9;rMT031.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;&#x9;MT030_CDSOUKOTHRU.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;&#x9;rMT031.getValueOf('PRZAIIDOU') * rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;&#x9;rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;count = cFT010.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////#EOL#&#x9;// エラー処理 //#EOL#&#x9;////////////////#EOL#&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL#}"/><Script EventP="AU" EventR="" Function="" Name="完了取消後の関連テーブル処理" Order="0060" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rMT031; var uMT031; var rBT010; var cFT100;#EOL#var rFT010; var uFT010; var cFT010;#EOL#var amNyukoUpdated = 0; var amSyukkoUpdated = 0;#EOL#var qtNyukoUpdated = 0; var qtSyukkoUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var kbUkebarai = '';#EOL#var count = 0; var errorMessage = ''; var dtUkebarai = '';#EOL##EOL#//////////////////////////////#EOL#// 完了取消されたことの検査 //#EOL#//////////////////////////////#EOL#if (MT030_DTKANRYO.oldValue != '' &amp;&amp; MT030_DTKANRYO.value == '') {#EOL##EOL#&#x9;///////////////////////////////////////#EOL#&#x9;// 関連する受払実績(FT100)の失効処理 //#EOL#&#x9;///////////////////////////////////////#EOL#&#x9;rFT100 = instance.createTableOperator('Select', 'FT100');#EOL#&#x9;rFT100.setSelectFields('NRZAITORI, UPDCOUNTER');#EOL#&#x9;rFT100.addKeyValue('NRSOURCE', MT030_NRSOURCE.value);#EOL#&#x9;while (rFT100.next()) {#EOL#&#x9;&#x9;uFT100 = instance.createTableOperator('Update', 'FT100');#EOL#&#x9;&#x9;uFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;uFT100.addValue('UPDCOUNTER',&#x9;Number(rFT100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;uFT100.addKeyValue('NRZAITORI',&#x9;&#x9;rFT100.getValueOf('NRZAITORI'));#EOL#&#x9;&#x9;uFT100.addKeyValue('UPDCOUNTER',&#x9;rFT100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;count = uFT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '受払実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;if (errorMessage == '') {#EOL##EOL#&#x9;&#x9;//////////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・日付・区分の設定 //#EOL#&#x9;&#x9;//////////////////////////////////#EOL#&#x9;&#x9;dtNend = session.getFYearOfDate(MT030_DTKANRYO.oldValue);#EOL#&#x9;&#x9;dtMSeq = session.getMSeqOfDate(MT030_DTKANRYO.oldValue);#EOL#&#x9;&#x9;dtUkebarai = MT030_DTKANRYO.oldValue + '';#EOL##EOL#&#x9;&#x9;///////////////////////////////#EOL#&#x9;&#x9;// 移動指示明細(MT031)の検索 //#EOL#&#x9;&#x9;///////////////////////////////#EOL#&#x9;&#x9;rMT031 = instance.createTableOperator('Select', 'MT031');#EOL#&#x9;&#x9;rMT031.addKeyValue('NRZAIIDOU',&#x9;MT030_NRZAIIDOU.value);#EOL#&#x9;&#x9;while (rMT031.next()) {#EOL##EOL#&#x9;&#x9;&#x9;///////////////////////#EOL#&#x9;&#x9;&#x9;// 品目(BT010)の検索 //#EOL#&#x9;&#x9;&#x9;///////////////////////#EOL#&#x9;&#x9;&#x9;rBT010 = instance.createTableOperator('Select', 'BT010');#EOL#&#x9;&#x9;&#x9;rBT010.setSelectFields('TXHINBAN, TXHINMEI, KBUNIT');#EOL#&#x9;&#x9;&#x9;rBT010.addKeyValue('IDHINMOKU',&#x9;rMT031.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;if (rBT010.next()) {#EOL##EOL#&#x9;&#x9;&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;// 移動出庫分の在庫増減履歴(FT100)の追加 //#EOL#&#x9;&#x9;&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('KBUKEBARAI',&#x9;'110'); //移動出庫//#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('KBZAIHURI',&#x9;'');#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('DTTORIHIKI',&#x9;dtUkebarai);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('IDHINMOKU',&#x9;rMT031.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;rBT010.getValueOf('TXHINBAN'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;rBT010.getValueOf('TXHINMEI'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;rBT010.getValueOf('KBUNIT'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;MT030_CDSOUKOFROM.value);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('TXAITESAKI',&#x9;AT040T_TXSOUKO.value);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('PRTORIHIKI',&#x9;rMT031.getValueOf('PRZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('QTTORIHIKI',&#x9;rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('AMTORIHIKI',&#x9;rMT031.getValueOf('PRZAIIDOU') * rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('KBZAIHURI',&#x9;'');#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;MT030_NRSOURCE.value);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;MT030_NRZAIIDOU.value);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;&#x9;&#x9;count = cFT100.execute();#EOL#&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '受払実績(FT100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;&#x9;/////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;// 移動元倉庫在庫(FT010)の在庫残高更新 //#EOL#&#x9;&#x9;&#x9;&#x9;/////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;if (errorMessage == '') {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rFT010.setSelectFields('QTSYUKKO, AMSYUKKO, UPDCOUNTER');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rFT010.addKeyValue('IDHINMOKU',&#x9;rMT031.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rFT010.addKeyValue('CDSOUKO',&#x9;MT030_CDSOUKOFROM.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (rFT010.next()) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;qtSyukkoUpdated = Number(rFT010.getValueOf('QTSYUKKO')) - Number(rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;amSyukkoUpdated = Number(rFT010.getValueOf('AMSYUKKO')) - Number(rMT031.getValueOf('PRZAIIDOU') * rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('AMSYUKKO',&#x9;&#x9;amSyukkoUpdated);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('QTSYUKKO',&#x9;&#x9;qtSyukkoUpdated);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('UPDCOUNTER',&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;rMT031.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;MT030_CDSOUKOFROM.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;count = uFT010.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('IDHINMOKU',&#x9;&#x9;rMT031.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;&#x9;MT030_CDSOUKOFROM.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;&#x9;-1 * rMT031.getValueOf('PRZAIIDOU') * rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;&#x9;-1 * rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;count = cFT010.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;// 移動入庫分の在庫増減履歴(FT100)の追加 //#EOL#&#x9;&#x9;&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('KBUKEBARAI',&#x9;'010'); //移動入庫//#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('DTTORIHIKI',&#x9;dtUkebarai);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('IDHINMOKU',&#x9;rMT031.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;rBT010.getValueOf('TXHINBAN'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;rBT010.getValueOf('TXHINMEI'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;rBT010.getValueOf('KBUNIT'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;MT030_CDSOUKOTHRU.value);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('TXAITESAKI',&#x9;AT040F_TXSOUKO.value);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('PRTORIHIKI',&#x9;rMT031.getValueOf('PRZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('QTTORIHIKI',&#x9;rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('AMTORIHIKI',&#x9;rMT031.getValueOf('PRZAIIDOU') * rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('KBZAIHURI',&#x9;'');#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;MT030_NRSOURCE.value);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;MT030_NRZAIIDOU.value);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;&#x9;&#x9;count = cFT100.execute();#EOL#&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '受払実績(FT100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;&#x9;/////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;// 移動先倉庫在庫(FT010)の在庫残高更新 //#EOL#&#x9;&#x9;&#x9;&#x9;/////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;if (errorMessage == '') {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rFT010.setSelectFields('QTNYUKO, AMNYUKO, UPDCOUNTER');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rFT010.addKeyValue('IDHINMOKU',&#x9;rMT031.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rFT010.addKeyValue('CDSOUKO',&#x9;MT030_CDSOUKOTHRU.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (rFT010.next()) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;qtNyukoUpdated = Number(rFT010.getValueOf('QTNYUKO')) - Number(rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;amNyukoUpdated = Number(rFT010.getValueOf('AMNYUKO')) - Number(rMT031.getValueOf('PRZAIIDOU') * rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('AMNYUKO',&#x9;&#x9;amNyukoUpdated);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('QTNYUKO',&#x9;&#x9;qtNyukoUpdated);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('UPDCOUNTER',&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;rMT031.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;MT030_CDSOUKOTHRU.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;count = uFT010.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('IDHINMOKU',&#x9;&#x9;rMT031.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;&#x9;MT030_CDSOUKOTHRU.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;&#x9;-1 * rMT031.getValueOf('PRZAIIDOU') * rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;&#x9;-1 * rMT031.getValueOf('QTZAIIDOU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;count = cFT010.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;////////////////#EOL#&#x9;&#x9;// エラー処理 //#EOL#&#x9;&#x9;////////////////#EOL#&#x9;&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}"/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールドの設定" Order="0030" Text="////////////////////#EOL#// 状況区分の設定 //#EOL#////////////////////#EOL#if (MT030_DTKANRYO.value == '') {#EOL#&#x9;MT030_STZAIIDOU.value = '10'; //未確定//#EOL#} else {#EOL#&#x9;MT030_STZAIIDOU.value = '20'; //確定済//#EOL#}"/><Script EventP="BC;BU;BD" EventR="BR()" Function="" Name="会計日付の妥当性検査" Order="0040" Text="MT030_DTKANRYO.error = session.getErrorOfAccountDate(MT030_DTKANRYO.value);"/></Table><Table ID="MT020" Name="棚卸指示" Remarks="棚卸のまとまりを管理するためのテーブル。棚卸の対象倉庫や、開始日時、確定日時が保持される。" SubsystemID="M"><Field Decimal="" ID="NRTANAOROSI" Name="棚卸№" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRTANAOROSI)"/><Field Decimal="" ID="CDSOUKO" Name="倉庫Ｃ" NoUpdate="T" Nullable="F" Order="0020" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="DTKAKUTEI" Name="確定日時" NoUpdate="T" Nullable="T" Order="0040" Remarks="" Size="23" Type="TIMESTAMP" TypeOptions=""/><Field Decimal="" ID="NRSOURCE" Name="取引ソース№" NoUpdate="T" Nullable="F" Order="0050" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRSOURCE)"/><Key Fields="NRTANAOROSI" Type="PK"/><Key Fields="NRSOURCE" Type="SK"/><Refer Fields="TXSOUKO" Order="0010" OrderBy="" TableAlias="" ToKeyFields="CDSOUKO" ToTable="AT040" WithKeyFields="MT020.CDSOUKO"/><Field ID="STTANAOROSI" Name="棚卸状況" NoUpdate="T" Nullable="F" Order="0070" Size="2" Type="CHAR" TypeOptions="VIRTUAL,KUBUN(STTANAOROSI)"/><Field Decimal="" ID="DTKIJYUN" Name="基準日時" NoUpdate="T" Nullable="F" Order="0030" Remarks="" Size="23" Type="TIMESTAMP" TypeOptions=""/><Field Decimal="" ID="DTKIJYUNWORK" Name="基準日" NoUpdate="T" Nullable="F" Order="0061" Remarks="基準日時の日付部分" Size="10" Type="DATE" TypeOptions="VIRTUAL"/><Field Decimal="" ID="TXTEKIYO" Name="摘要" Nullable="T" Order="0041" Remarks="" Size="300" Type="VARCHAR" TypeOptions=""/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールドの設定" Order="0000" Text="////////////////////#EOL#// 状況区分の設定 //#EOL#////////////////////#EOL#if (MT020_DTKAKUTEI.value == '') {#EOL#&#x9;MT020_STTANAOROSI.value = '10'; //未確定//#EOL#} else {#EOL#&#x9;MT020_STTANAOROSI.value = '20'; //確定済//#EOL#}#EOL##EOL#//////////////////#EOL#// 指示日の設定 //#EOL#//////////////////#EOL#var work = MT020_DTKIJYUN.value;#EOL#MT020_DTKIJYUNWORK.value = work.substring(0, 10) + '';"/><Script EventP="BC" EventR="BR()" Function="" Name="追加前設定" Order="0010" Text="//////////////////#EOL#// 入力不可設定 //#EOL#//////////////////#EOL#MT020_DTKIJYUN.editable = false;#EOL#MT020_DTKAKUTEI.editable = false;#EOL##EOL#//////////////////////////#EOL#// 基準日時の初期値設定 //#EOL#//////////////////////////#EOL#MT020_DTKIJYUN.value = session.getTimeStamp() + '';#EOL#"/><Script EventP="BU;AR" EventR="BR()" Function="" Name="更新前設定" Order="0020" Text="////////////////////#EOL#// 結果更新時設定 //#EOL#////////////////////#EOL#if (instance.functionID == 'MF026') {#EOL#&#x9;if (MT020_DTKAKUTEI.value != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage('確定済の棚卸指示に対する結果報告はできません。');#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////#EOL#// 確定更新時設定 //#EOL#////////////////////#EOL#if (instance.functionID == 'MF027A') {#EOL#&#x9;if (MT020_DTKAKUTEI.value == '') {#EOL#&#x9;&#x9;MT020_DTKAKUTEI.value = session.getTimeStamp() + '';#EOL#&#x9;}#EOL#&#x9;MT020_DTKAKUTEI.error = session.getErrorOfAccountDate(MT020_DTKAKUTEI.value);#EOL#}#EOL##EOL#////////////////////#EOL#// 確定解除時設定 //#EOL#////////////////////#EOL#if (instance.functionID == 'MF027B') {#EOL#&#x9;MT020_DTKAKUTEI.error = session.getErrorOfAccountDate(MT020_DTKAKUTEI.value);#EOL#&#x9;if (MT020_DTKAKUTEI.error == '') {#EOL#&#x9;&#x9;MT020_DTKAKUTEI.value = '';#EOL#&#x9;}#EOL#}#EOL#"/><Script EventP="AC" EventR="" Function="" Name="追加時の明細レコード追加" Order="0030" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rFT010; var cMT021;#EOL#var qtGenzaiko = 0; var amGenzaiko = 0; var prGenzaiko = 0;#EOL#var count = 0; var errorMessage = '';#EOL##EOL#///////////////////////////////////////////////////////#EOL#// 関連する倉庫在庫(FT010)の検索と棚卸指示明細の追加 //#EOL#///////////////////////////////////////////////////////#EOL#rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#rFT010.addKeyValue('CDSOUKO',&#x9;MT020_CDSOUKO.value);#EOL#while (rFT010.next()) {#EOL#&#x9;amGenzaiko = Number(rFT010.getValueOf('AMKISYU')) + Number(rFT010.getValueOf('AMNYUKO')) - Number(rFT010.getValueOf('AMSYUKKO'));#EOL#&#x9;qtGenzaiko = Number(rFT010.getValueOf('QTKISYU')) + Number(rFT010.getValueOf('QTNYUKO')) - Number(rFT010.getValueOf('QTSYUKKO'));#EOL#&#x9;if (amGenzaiko > 0 &amp;&amp; qtGenzaiko > 0) {#EOL#&#x9;&#x9;prGenzaiko = Math.round(amGenzaiko / qtGenzaiko);#EOL#&#x9;&#x9;cMT021 = instance.createTableOperator('Insert', 'MT021');#EOL#&#x9;&#x9;cMT021.addValue('NRTANAOROSI',&#x9;&#x9;MT020_NRTANAOROSI.value);#EOL#&#x9;&#x9;cMT021.addValue('IDHINMOKU',&#x9;&#x9;rFT010.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;cMT021.addValue('PRKIJYUN',&#x9;&#x9;&#x9;prGenzaiko);#EOL#&#x9;&#x9;cMT021.addValue('QTKIJYUN',&#x9;&#x9;&#x9;qtGenzaiko);#EOL#&#x9;&#x9;cMT021.addValue('PRJITSUTANA',&#x9;&#x9;prGenzaiko);#EOL#&#x9;&#x9;cMT021.addValue('QTJITSUTANA',&#x9;&#x9;0);#EOL#&#x9;&#x9;count = cMT021.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '棚卸指示明細(MT021)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}"/><Script EventP="AU" EventR="" Function="" Name="確定更新後の関連テーブル処理" Order="0040" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rMT021; var uMT021; var rBT010; var cFT100;#EOL#var rFT010; var uFT010; var cFT010;#EOL#var amUkebarai = 0; var amNyuko = 0; var amSyukko = 0;#EOL#var qtUkebarai = 0; var qtNyuko = 0; var qtSyukko = 0;#EOL#var amNyukoUpdated = 0; var amSyukkoUpdated = 0;#EOL#var qtNyukoUpdated = 0; var qtSyukkoUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var kbUkebarai = '';#EOL#var count = 0; var errorMessage = ''; var dtUkebarai = '';#EOL##EOL#//////////////////////////////#EOL#// 確定更新されたことの検査 //#EOL#//////////////////////////////#EOL#if (MT020_DTKAKUTEI.oldValue == '' &amp;&amp; MT020_DTKAKUTEI.value != '') {#EOL##EOL#&#x9;//////////////////////////////////#EOL#&#x9;// 年度・月度・日付・区分の設定 //#EOL#&#x9;//////////////////////////////////#EOL#&#x9;dtNend = session.getFYearOfDate(MT020_DTKAKUTEI.value);#EOL#&#x9;dtMSeq = session.getMSeqOfDate(MT020_DTKAKUTEI.value);#EOL#&#x9;dtUkebarai = MT020_DTKAKUTEI.value + '';#EOL#&#x9;dtUkebarai = dtUkebarai.substring(0, 10);#EOL##EOL#&#x9;///////////////////////////#EOL#&#x9;// 棚卸明細(MT021)の検索 //#EOL#&#x9;///////////////////////////#EOL#&#x9;rMT021 = instance.createTableOperator('Select', 'MT021');#EOL#&#x9;rMT021.addKeyValue('NRTANAOROSI',&#x9;MT020_NRTANAOROSI.value);#EOL#&#x9;while (rMT021.next()) {#EOL##EOL#&#x9;&#x9;///////////////////////#EOL#&#x9;&#x9;// 品目(BT010)の検索 //#EOL#&#x9;&#x9;///////////////////////#EOL#&#x9;&#x9;rBT010 = instance.createTableOperator('Select', 'BT010');#EOL#&#x9;&#x9;rBT010.setSelectFields('TXHINBAN, TXHINMEI, KBUNIT');#EOL#&#x9;&#x9;rBT010.addKeyValue('IDHINMOKU',&#x9;rMT021.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;if (rBT010.next()) {#EOL##EOL#&#x9;&#x9;&#x9;//////////////////#EOL#&#x9;&#x9;&#x9;// 受払高の計算 //#EOL#&#x9;&#x9;&#x9;//////////////////#EOL#&#x9;&#x9;&#x9;qtUkebarai = rMT021.getValueOf('QTJITSUTANA') - rMT021.getValueOf('QTKIJYUN');#EOL#&#x9;&#x9;&#x9;amUkebarai = qtUkebarai * rMT021.getValueOf('PRJITSUTANA');#EOL#&#x9;&#x9;&#x9;if (qtUkebarai != 0) {#EOL##EOL#&#x9;&#x9;&#x9;&#x9;////////////////////////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;// 受払高の符号にもとづいて、受払区分と入出庫高を設定する //#EOL#&#x9;&#x9;&#x9;&#x9;////////////////////////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;if (qtUkebarai > 0) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;kbUkebarai = '070'; //棚卸増//#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;qtNyuko = qtUkebarai;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;qtSyukko = 0;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amNyuko = amUkebarai;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amSyukko = 0;#EOL#&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;kbUkebarai = '170'; //棚卸減//#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;qtUkebarai = qtUkebarai * -1;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amUkebarai = amUkebarai * -1;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;qtNyuko = 0;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;qtSyukko = qtUkebarai;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amNyuko = 0;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amSyukko = amUkebarai;#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;&#x9;///////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;// 在庫増減履歴(FT100)の追加 //#EOL#&#x9;&#x9;&#x9;&#x9;///////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('KBUKEBARAI',&#x9;kbUkebarai);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('KBZAIHURI',&#x9;'');#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('DTTORIHIKI',&#x9;dtUkebarai);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('IDHINMOKU',&#x9;rMT021.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;rBT010.getValueOf('TXHINBAN'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;rBT010.getValueOf('TXHINMEI'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;rBT010.getValueOf('KBUNIT'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;MT020_CDSOUKO.value);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('TXAITESAKI',&#x9;'');#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('PRTORIHIKI',&#x9;rMT021.getValueOf('PRJITSUTANA'));#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('QTTORIHIKI',&#x9;qtUkebarai);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('AMTORIHIKI',&#x9;amUkebarai);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('KBZAIHURI',&#x9;'');#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;MT020_NRSOURCE.value);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;MT020_NRTANAOROSI.value);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;&#x9;&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;&#x9;&#x9;count = cFT100.execute();#EOL#&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '受払実績(FT100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;// 関連する倉庫在庫(FT010)の在庫残高更新 //#EOL#&#x9;&#x9;&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;if (errorMessage == '') {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rFT010.setSelectFields('QTNYUKO, QTSYUKKO, AMNYUKO, AMSYUKKO, UPDCOUNTER');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rFT010.addKeyValue('IDHINMOKU',&#x9;rMT021.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rFT010.addKeyValue('CDSOUKO',&#x9;MT020_CDSOUKO.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (rFT010.next()) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;qtNyukoUpdated = Number(rFT010.getValueOf('QTNYUKO')) + Number(qtNyuko);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;amNyukoUpdated = Number(rFT010.getValueOf('AMNYUKO')) + Number(amNyuko);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;qtSyukkoUpdated = Number(rFT010.getValueOf('QTSYUKKO')) + Number(qtSyukko);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;amSyukkoUpdated = Number(rFT010.getValueOf('AMSYUKKO')) + Number(amSyukko);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('AMNYUKO',&#x9;&#x9;amNyukoUpdated);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('QTNYUKO',&#x9;&#x9;qtNyukoUpdated);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('AMSYUKKO',&#x9;&#x9;amSyukkoUpdated);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('QTSYUKKO',&#x9;&#x9;qtSyukkoUpdated);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('UPDCOUNTER',&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;rMT021.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;MT020_CDSOUKO.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;count = uFT010.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('IDHINMOKU',&#x9;&#x9;rMT021.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;&#x9;MT020_CDSOUKO.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;&#x9;amNyuko);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;&#x9;amSyukko);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;&#x9;qtNyuko);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;&#x9;qtSyukko);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;count = cFT010.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////#EOL#&#x9;// エラー処理 //#EOL#&#x9;////////////////#EOL#&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL#}"/><Script EventP="AU" EventR="" Function="" Name="確定解除後の関連テーブル処理" Order="0041" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rMT021; var uMT021; var rBT010; var cFT100;#EOL#var rFT010; var uFT010; var cFT010;#EOL#var amUkebarai = 0; var amNyuko = 0; var amSyukko = 0;#EOL#var qtUkebarai = 0; var qtNyuko = 0; var qtSyukko = 0;#EOL#var amNyukoUpdated = 0; var amSyukkoUpdated = 0;#EOL#var qtNyukoUpdated = 0; var qtSyukkoUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var kbUkebarai = '';#EOL#var count = 0; var errorMessage = ''; var dtUkebarai = '';#EOL##EOL#//////////////////////////////#EOL#// 確定解除されたことの検査 //#EOL#//////////////////////////////#EOL#if (MT020_DTKAKUTEI.oldValue != '' &amp;&amp; MT020_DTKAKUTEI.value == '') {#EOL##EOL#&#x9;///////////////////////////////////////#EOL#&#x9;// 関連する受払実績(FT100)の失効処理 //#EOL#&#x9;///////////////////////////////////////#EOL#&#x9;rFT100 = instance.createTableOperator('Select', 'FT100');#EOL#&#x9;rFT100.setSelectFields('NRZAITORI, UPDCOUNTER');#EOL#&#x9;rFT100.addKeyValue('NRSOURCE', MT020_NRSOURCE.value);#EOL#&#x9;while (rFT100.next()) {#EOL#&#x9;&#x9;uFT100 = instance.createTableOperator('Update', 'FT100');#EOL#&#x9;&#x9;uFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;uFT100.addValue('UPDCOUNTER',&#x9;Number(rFT100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;uFT100.addKeyValue('NRZAITORI',&#x9;&#x9;rFT100.getValueOf('NRZAITORI'));#EOL#&#x9;&#x9;uFT100.addKeyValue('UPDCOUNTER',&#x9;rFT100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;count = uFT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '受払実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;if (errorMessage == '') {#EOL##EOL#&#x9;&#x9;//////////////////////////////////#EOL#&#x9;&#x9;// 年度・月度・日付・区分の設定 //#EOL#&#x9;&#x9;//////////////////////////////////#EOL#&#x9;&#x9;dtNend = session.getFYearOfDate(MT020_DTKAKUTEI.oldValue);#EOL#&#x9;&#x9;dtMSeq = session.getMSeqOfDate(MT020_DTKAKUTEI.oldValue);#EOL#&#x9;&#x9;dtUkebarai = MT020_DTKAKUTEI.oldValue + '';#EOL#&#x9;&#x9;dtUkebarai = dtUkebarai.substring(0, 10);#EOL##EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;// 棚卸明細(MT021)の検索 //#EOL#&#x9;&#x9;///////////////////////////#EOL#&#x9;&#x9;rMT021 = instance.createTableOperator('Select', 'MT021');#EOL#&#x9;&#x9;rMT021.addKeyValue('NRTANAOROSI',&#x9;MT020_NRTANAOROSI.value);#EOL#&#x9;&#x9;while (rMT021.next()) {#EOL##EOL#&#x9;&#x9;&#x9;///////////////////////#EOL#&#x9;&#x9;&#x9;// 品目(BT010)の検索 //#EOL#&#x9;&#x9;&#x9;///////////////////////#EOL#&#x9;&#x9;&#x9;rBT010 = instance.createTableOperator('Select', 'BT010');#EOL#&#x9;&#x9;&#x9;rBT010.setSelectFields('TXHINBAN, TXHINMEI, KBUNIT');#EOL#&#x9;&#x9;&#x9;rBT010.addKeyValue('IDHINMOKU',&#x9;rMT021.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;if (rBT010.next()) {#EOL##EOL#&#x9;&#x9;&#x9;&#x9;//////////////////#EOL#&#x9;&#x9;&#x9;&#x9;// 受払高の計算 //#EOL#&#x9;&#x9;&#x9;&#x9;//////////////////#EOL#&#x9;&#x9;&#x9;&#x9;qtUkebarai = rMT021.getValueOf('QTJITSUTANA') - rMT021.getValueOf('QTKIJYUN');#EOL#&#x9;&#x9;&#x9;&#x9;amUkebarai = qtUkebarai * rMT021.getValueOf('PRJITSUTANA');#EOL#&#x9;&#x9;&#x9;&#x9;if (qtUkebarai != 0) {#EOL##EOL#&#x9;&#x9;&#x9;&#x9;&#x9;////////////////////////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;// 受払高の符号にもとづいて、受払区分と入出庫高を設定する //#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;////////////////////////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (qtUkebarai > 0) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;kbUkebarai = '070'; //棚卸増//#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;qtNyuko = qtUkebarai;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;qtSyukko = 0;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;amNyuko = amUkebarai;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;amSyukko = 0;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;kbUkebarai = '170'; //棚卸減//#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;qtUkebarai = qtUkebarai * -1;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;amUkebarai = amUkebarai * -1;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;qtNyuko = 0;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;qtSyukko = qtUkebarai;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;amNyuko = 0;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;amSyukko = amUkebarai;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;&#x9;&#x9;///////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;// 在庫増減履歴(FT100)の追加 //#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;///////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100 = instance.createTableOperator('Insert', 'FT100');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('NRZAITORI',&#x9;session.getNextNumber('NRZAITORI'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('KBUKEBARAI',&#x9;kbUkebarai);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('KBZAIHURI',&#x9;'');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('DTTORIHIKI',&#x9;dtUkebarai);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('IDHINMOKU',&#x9;rMT021.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('TXHINBAN',&#x9;&#x9;rBT010.getValueOf('TXHINBAN'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('TXHINMEI',&#x9;&#x9;rBT010.getValueOf('TXHINMEI'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('KBUNIT',&#x9;&#x9;rBT010.getValueOf('KBUNIT'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('CDSOUKO',&#x9;&#x9;MT020_CDSOUKO.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('TXAITESAKI',&#x9;'');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('PRTORIHIKI',&#x9;rMT021.getValueOf('PRJITSUTANA'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('QTTORIHIKI',&#x9;qtUkebarai);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('AMTORIHIKI',&#x9;amUkebarai);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('AMSAGAKU',&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('KBZAIHURI',&#x9;'');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('NRSOURCE',&#x9;&#x9;MT020_NRSOURCE.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('TXREFNO',&#x9;&#x9;MT020_NRTANAOROSI.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cFT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;count = cFT100.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '受払実績(FT100)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;// 関連する倉庫在庫(FT010)の在庫残高更新 //#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (errorMessage == '') {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;rFT010.setSelectFields('QTNYUKO, QTSYUKKO, AMNYUKO, AMSYUKKO, UPDCOUNTER');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;rFT010.addKeyValue('IDHINMOKU',&#x9;rMT021.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;rFT010.addKeyValue('CDSOUKO',&#x9;MT020_CDSOUKO.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if (rFT010.next()) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;qtNyukoUpdated = Number(rFT010.getValueOf('QTNYUKO')) - Number(qtNyuko);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;amNyukoUpdated = Number(rFT010.getValueOf('AMNYUKO')) - Number(amNyuko);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;qtSyukkoUpdated = Number(rFT010.getValueOf('QTSYUKKO')) - Number(qtSyukko);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;amSyukkoUpdated = Number(rFT010.getValueOf('AMSYUKKO')) - Number(amSyukko);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('AMNYUKO',&#x9;&#x9;amNyukoUpdated);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('QTNYUKO',&#x9;&#x9;qtNyukoUpdated);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('AMSYUKKO',&#x9;&#x9;amSyukkoUpdated);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('QTSYUKKO',&#x9;&#x9;qtSyukkoUpdated);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addValue('UPDCOUNTER',&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;rMT021.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;MT020_CDSOUKO.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;count = uFT010.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010 = instance.createTableOperator('Insert', 'FT010');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('IDHINMOKU',&#x9;&#x9;rMT021.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('CDSOUKO',&#x9;&#x9;&#x9;MT020_CDSOUKO.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('AMKISYU',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('AMNYUKO',&#x9;&#x9;&#x9;amNyuko * -1);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('AMSYUKKO',&#x9;&#x9;&#x9;amSyukko * -1);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('QTKISYU',&#x9;&#x9;&#x9;0);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('QTNYUKO',&#x9;&#x9;&#x9;qtNyuko * -1);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cFT010.addValue('QTSYUKKO',&#x9;&#x9;&#x9;qtSyukko * -1);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;count = cFT010.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////#EOL#&#x9;// エラー処理 //#EOL#&#x9;////////////////#EOL#&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL#}"/><Script EventP="BC;BU;BD" EventR="BR()" Function="" Name="会計日付の妥当性検査" Order="0021" Text="MT020_DTKAKUTEI.error = session.getErrorOfAccountDate(MT020_DTKAKUTEI.value);"/></Table><Table ID="KT010" Name="買掛振替" Remarks="買掛に関連する勘定科目との振替指示情報を保持するためのテーブル" SubsystemID="K"><Field Decimal="" ID="IDSIIRESAKI" Name="仕入先ID" NoUpdate="T" Nullable="F" Order="0050" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="TXTEKIYO" Name="摘要" Nullable="F" Order="0070" Remarks="" Size="30" Type="CHAR" TypeOptions="KANJI"/><Field Decimal="" ID="NRSOURCE" Name="取引ソース№" NoUpdate="T" Nullable="F" Order="0080" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRSOURCE)"/><Field Decimal="" ID="NRKAIHURI" Name="買掛振替№" Nullable="F" Order="0010" Remarks="" Size="7" Type="CHAR" TypeOptions="AUTO_NUMBER(NRKAIHURI)"/><Field Decimal="" ID="KBKAIHURI" Name="振替区分" NoUpdate="T" Nullable="F" Order="0030" Remarks="" Size="2" Type="CHAR" TypeOptions="KUBUN(KBKAIHURI)"/><Field Decimal="" ID="DTHURIKAE" Name="振替日" Nullable="F" Order="0040" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="" ID="AMHURIKAE" Name="振替額" Nullable="F" Order="0060" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Key Fields="NRKAIHURI" Type="PK"/><Key Fields="NRSOURCE" Type="SK"/><Refer Fields="CDTORIHIKISAKI;TXKANJI" Order="0030" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="KT010.IDSIIRESAKI"/><Refer Fields="" Order="0020" OrderBy="" TableAlias="" ToKeyFields="IDSIIRESAKI" ToTable="DT010" WithKeyFields="KT010.IDSIIRESAKI"/><Script EventP="BC" EventR="BR()" Function="" Name="追加前の初期値設定" Order="0010" Text="if (KT010_DTHURIKAE.value == '') {#EOL#&#x9;KT010_DTHURIKAE.value = session.today + '';#EOL#&#x9;KT010_KBZOUGEN.value = '0';#EOL#&#x9;KT010_KBKAIHURI.value = '10';#EOL#}#EOL#"/><Script EventP="AC" EventR="" Function="" Name="追加時の買掛更新" Order="0030" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rDT100; var uDT100; var cDT100; var rDT010; var uDT010;#EOL#var amTorihiki = 0; var kbKaritori = ''; var amSiireUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var count = 0; var errorMessage = '';#EOL##EOL#//////////////////////////////#EOL#// 年度・月度・取引額の設定 //#EOL#//////////////////////////////#EOL#dtNend = session.getFYearOfDate(KT010_DTHURIKAE.value);#EOL#dtMSeq = session.getMSeqOfDate(KT010_DTHURIKAE.value);#EOL#amTorihiki = KT010_AMHURIKAE.value;#EOL#if (KT010_KBZOUGEN.value == '1') {#EOL#&#x9;kbKaitori = '11'; //振替計上//#EOL#&#x9;amTorihiki = amTorihiki; //残高増//#EOL#} else {#EOL#&#x9;kbKaitori = '10'; //振替控除//#EOL#&#x9;amTorihiki = amTorihiki * -1; //残高減//#EOL#}#EOL##EOL#///////////////////////////#EOL#// 仕入実績(DT100)の追加 //#EOL#///////////////////////////#EOL#cDT100 = instance.createTableOperator('Insert', 'DT100');#EOL#cDT100.addValue('NRKAIKAKE',&#x9;session.getNextNumber('NRKAIKAKE'));#EOL#cDT100.addValue('IDSIIRESAKI',&#x9;KT010_IDSIIRESAKI.value);#EOL#cDT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#cDT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#cDT100.addValue('KBKAITORI',&#x9;kbKaitori);#EOL#cDT100.addValue('KBKAIHURI',&#x9;KT010_KBKAIHURI.value);#EOL#cDT100.addValue('DTTORIHIKI',&#x9;KT010_DTHURIKAE.value);#EOL#cDT100.addValue('IDHINMOKU',&#x9;'');#EOL#cDT100.addValue('TXHINBAN',&#x9;&#x9;'');#EOL#cDT100.addValue('TXHINMEI',&#x9;&#x9;KT010_TXTEKIYO.value);#EOL#cDT100.addValue('KBUNIT',&#x9;&#x9;'CNT');#EOL#cDT100.addValue('PRTORIHIKI',&#x9;KT010_AMHURIKAE.value);#EOL#cDT100.addValue('QTTORIHIKI',&#x9;1);#EOL#cDT100.addValue('AMTORIHIKI',&#x9;KT010_AMHURIKAE.value);#EOL#cDT100.addValue('AMTAX',&#x9;&#x9;0);#EOL#cDT100.addValue('NRSIHARAI',&#x9;'');#EOL#cDT100.addValue('NRSOURCE',&#x9;&#x9;KT010_NRSOURCE.value);#EOL#cDT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#cDT100.addValue('TXREFNO',&#x9;&#x9;KT010_NRKAIHURI.value);#EOL#cDT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#cDT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#count = cDT100.execute();#EOL#if (count != 1) {#EOL#&#x9;errorMessage = '仕入実績(DT100)の登録に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#//////////////////////////// 残高更新 //////////////////////////////////#EOL#////////////////////////////////////////////////////////////////////////#EOL#rDT010 = instance.createTableOperator('Select', 'DT010');#EOL#rDT010.setSelectFields('AMSIIRE, UPDCOUNTER');#EOL#rDT010.addKeyValue('IDSIIRESAKI',&#x9;KT010_IDSIIRESAKI.value);#EOL#if (rDT010.next()) {#EOL#&#x9;amSiireUpdated = Number(rDT010.getValueOf('AMSIIRE')) + Number(amTorihiki);#EOL#&#x9;uDT010 = instance.createTableOperator('Update', 'DT010');#EOL#&#x9;uDT010.addValue('AMSIIRE',&#x9;&#x9;&#x9;amSiireUpdated);#EOL#&#x9;uDT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rDT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;uDT010.addKeyValue('IDSIIRESAKI',&#x9;KT010_IDSIIRESAKI.value);#EOL#&#x9;uDT010.addKeyValue('UPDCOUNTER',&#x9;rDT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;count = uDT010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '仕入先(DT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#} else {#EOL#&#x9;errorMessage = '仕入先(DT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}"/><Script EventP="AD" EventR="" Function="" Name="削除時の買掛更新" Order="0050" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rDT100; var uDT100; var cDT100; var rDT010; var uDT010;#EOL#var amTorihiki = 0; var kbKaritori = ''; var amSiireUpdated = 0; var fgValid = 'F';#EOL#var dtNend = 0; var dtMSeq = 0; var count = 0; var errorMessage = '';#EOL##EOL#///////////////////////////////////////#EOL#// 関連する仕入実績(DT100)の失効処理 //#EOL#///////////////////////////////////////#EOL#rDT100 = instance.createTableOperator('Select', 'DT100');#EOL#rDT100.setSelectFields('NRKAIKAKE, NRSIHARAI, UPDCOUNTER');#EOL#rDT100.addKeyValue('NRSOURCE',&#x9;KT010_NRSOURCE.value);#EOL#rDT100.addKeyValue('FGVALID',&#x9;'T');#EOL#while (rDT100.next()) {#EOL#&#x9;if (rDT100.getValueOf('NRSIHARAI') == '') {#EOL#&#x9;&#x9;uDT100 = instance.createTableOperator('Update', 'DT100');#EOL#&#x9;&#x9;uDT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;uDT100.addValue('UPDCOUNTER',&#x9;Number(rDT100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;uDT100.addKeyValue('NRKAIKAKE',&#x9;&#x9;rDT100.getValueOf('NRKAIKAKE'));#EOL#&#x9;&#x9;uDT100.addKeyValue('UPDCOUNTER',&#x9;rDT100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;count = uDT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '仕入実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;fgValid = 'T';#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL##EOL#////////////////////////////////////////#EOL#// 年度・月度・取引区分・取引額の設定 //#EOL#////////////////////////////////////////#EOL#dtNend = session.getFYearOfDate(KT010_DTHURIKAE.oldValue);#EOL#dtMSeq = session.getMSeqOfDate(KT010_DTHURIKAE.oldValue);#EOL#if (KT010_KBZOUGEN.value == '1') {#EOL#&#x9;kbKaitori = '11'; //振替計上//#EOL#&#x9;amTorihiki = KT010_AMHURIKAE.oldValue * -1; //残高減//#EOL#} else {#EOL#&#x9;kbKaitori = '10'; //振替控除//#EOL#&#x9;amTorihiki = KT010_AMHURIKAE.oldValue; //残高増//#EOL#}#EOL##EOL#///////////////////////////////#EOL#// 仕入実績(DT100)の赤伝追加 //#EOL#///////////////////////////////#EOL#cDT100 = instance.createTableOperator('Insert', 'DT100');#EOL#cDT100.addValue('NRKAIKAKE',&#x9;session.getNextNumber('NRKAIKAKE'));#EOL#cDT100.addValue('IDSIIRESAKI',&#x9;KT010_IDSIIRESAKI.value);#EOL#cDT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#cDT100.addValue('FGVALID',&#x9;&#x9;fgValid);#EOL#cDT100.addValue('KBKAITORI',&#x9;kbKaitori);#EOL#cDT100.addValue('KBKAIHURI',&#x9;KT010_KBKAIHURI.value);#EOL#cDT100.addValue('DTTORIHIKI',&#x9;KT010_DTHURIKAE.oldValue);#EOL#cDT100.addValue('IDHINMOKU',&#x9;'');#EOL#cDT100.addValue('TXHINBAN',&#x9;&#x9;'');#EOL#cDT100.addValue('TXHINMEI',&#x9;&#x9;KT010_TXTEKIYO.oldValue);#EOL#cDT100.addValue('KBUNIT',&#x9;&#x9;'CNT');#EOL#cDT100.addValue('PRTORIHIKI',&#x9;KT010_AMHURIKAE.oldValue);#EOL#cDT100.addValue('QTTORIHIKI',&#x9;1);#EOL#cDT100.addValue('AMTORIHIKI',&#x9;KT010_AMHURIKAE.oldValue);#EOL#cDT100.addValue('AMTAX',&#x9;&#x9;0);#EOL#cDT100.addValue('NRSIHARAI',&#x9;'');#EOL#cDT100.addValue('NRSOURCE',&#x9;&#x9;KT010_NRSOURCE.value);#EOL#cDT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#cDT100.addValue('TXREFNO',&#x9;&#x9;KT010_NRKAIHURI.value);#EOL#cDT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#cDT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#count = cDT100.execute();#EOL#if (count != 1) {#EOL#&#x9;errorMessage = '仕入実績(DT100)の登録に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#//////////////////////////// 残高更新 //////////////////////////////////#EOL#////////////////////////////////////////////////////////////////////////#EOL#rDT010 = instance.createTableOperator('Select', 'DT010');#EOL#rDT010.setSelectFields('AMSIIRE, UPDCOUNTER');#EOL#rDT010.addKeyValue('IDSIIRESAKI',&#x9;KT010_IDSIIRESAKI.value);#EOL#if (rDT010.next()) {#EOL#&#x9;amSiireUpdated = Number(rDT010.getValueOf('AMSIIRE')) + Number(amTorihiki);#EOL#&#x9;uDT010 = instance.createTableOperator('Update', 'DT010');#EOL#&#x9;uDT010.addValue('AMSIIRE',&#x9;&#x9;&#x9;amSiireUpdated);#EOL#&#x9;uDT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rDT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;uDT010.addKeyValue('IDSIIRESAKI',&#x9;KT010_IDSIIRESAKI.value);#EOL#&#x9;uDT010.addKeyValue('UPDCOUNTER',&#x9;rDT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;count = uDT010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '仕入先(DT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#} else {#EOL#&#x9;errorMessage = '仕入先(DT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}"/><Script EventP="AU" EventR="" Function="" Name="更新時の買掛更新" Order="0040" Text="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rDT100; var uDT100; var cDT100; var rDT010; var uDT010;#EOL#var amTorihiki = 0; var amTorihikiOld = 0; var kbKaritori = ''; var amSiireUpdated = 0;#EOL#var dtNend = 0; var dtMSeq = 0; var dtNendOld = 0; var dtMSeqOld = 0;#EOL#var count = 0; var errorMessage = ''; var fgValid = 'F';#EOL##EOL#///////////////////////////////////////#EOL#// 関連する仕入実績(DT100)の失効処理 //#EOL#///////////////////////////////////////#EOL#rDT100 = instance.createTableOperator('Select', 'DT100');#EOL#rDT100.setSelectFields('NRKAIKAKE, NRSIHARAI, UPDCOUNTER');#EOL#rDT100.addKeyValue('NRSOURCE',&#x9;KT010_NRSOURCE.value);#EOL#rDT100.addKeyValue('FGVALID',&#x9;'T');#EOL#while (rDT100.next()) {#EOL#&#x9;if (rDT100.getValueOf('NRSIHARAI') == '') {#EOL#&#x9;&#x9;uDT100 = instance.createTableOperator('Update', 'DT100');#EOL#&#x9;&#x9;uDT100.addValue('FGVALID',&#x9;&#x9;'F');#EOL#&#x9;&#x9;uDT100.addValue('UPDCOUNTER',&#x9;Number(rDT100.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;uDT100.addKeyValue('NRKAIKAKE',&#x9;&#x9;rDT100.getValueOf('NRKAIKAKE'));#EOL#&#x9;&#x9;uDT100.addKeyValue('UPDCOUNTER',&#x9;rDT100.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;count = uDT100.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '仕入実績(FT100)の失効処理に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;fgValid = 'T';#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL##EOL#////////////////////////////////////#EOL#// 赤伝：年度・月度・取引額の設定 //#EOL#////////////////////////////////////#EOL#dtNendOld = session.getFYearOfDate(KT010_DTHURIKAE.oldValue);#EOL#dtMSeqOld = session.getMSeqOfDate(KT010_DTHURIKAE.oldValue);#EOL#if (KT010_KBZOUGEN.value == '1') {#EOL#&#x9;kbKaitori = '11'; //振替計上//#EOL#&#x9;amTorihikiOld = KT010_AMHURIKAE.oldValue * -1; //残高減//#EOL#} else {#EOL#&#x9;kbKaitori = '10'; //振替控除//#EOL#&#x9;amTorihikiOld = KT010_AMHURIKAE.oldValue; //残高増//#EOL#}#EOL##EOL#///////////////////////////////#EOL#// 仕入実績(DT100)の赤伝追加 //#EOL#///////////////////////////////#EOL#cDT100 = instance.createTableOperator('Insert', 'DT100');#EOL#cDT100.addValue('NRKAIKAKE',&#x9;session.getNextNumber('NRKAIKAKE'));#EOL#cDT100.addValue('IDSIIRESAKI',&#x9;KT010_IDSIIRESAKI.value);#EOL#cDT100.addValue('KBAKADEN',&#x9;&#x9;'2');#EOL#cDT100.addValue('FGVALID',&#x9;&#x9;fgValid);#EOL#cDT100.addValue('KBKAITORI',&#x9;kbKaitori);#EOL#cDT100.addValue('KBKAIHURI',&#x9;KT010_KBKAIHURI.value);#EOL#cDT100.addValue('DTTORIHIKI',&#x9;KT010_DTHURIKAE.oldValue);#EOL#cDT100.addValue('IDHINMOKU',&#x9;'');#EOL#cDT100.addValue('TXHINBAN',&#x9;&#x9;'');#EOL#cDT100.addValue('TXHINMEI',&#x9;&#x9;KT010_TXTEKIYO.oldValue);#EOL#cDT100.addValue('KBUNIT',&#x9;&#x9;'CNT');#EOL#cDT100.addValue('PRTORIHIKI',&#x9;KT010_AMHURIKAE.oldValue);#EOL#cDT100.addValue('QTTORIHIKI',&#x9;1);#EOL#cDT100.addValue('AMTORIHIKI',&#x9;KT010_AMHURIKAE.oldValue);#EOL#cDT100.addValue('AMTAX',&#x9;&#x9;0);#EOL#cDT100.addValue('NRSIHARAI',&#x9;'');#EOL#cDT100.addValue('NRSOURCE',&#x9;&#x9;KT010_NRSOURCE.value);#EOL#cDT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#cDT100.addValue('TXREFNO',&#x9;&#x9;KT010_NRKAIHURI.value);#EOL#cDT100.addValue('DTNEND',&#x9;&#x9;dtNendOld);#EOL#cDT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeqOld);#EOL#count = cDT100.execute();#EOL#if (count != 1) {#EOL#&#x9;errorMessage = '仕入実績(DT100)の登録に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////////////////////////#EOL#// 黒伝：年度・月度・取引額の設定 //#EOL#////////////////////////////////////#EOL#dtNend = session.getFYearOfDate(KT010_DTHURIKAE.value);#EOL#dtMSeq = session.getMSeqOfDate(KT010_DTHURIKAE.value);#EOL#if (KT010_KBZOUGEN.value == '1') {#EOL#&#x9;kbKaitori = '11'; //振替計上//#EOL#&#x9;amTorihiki = KT010_AMHURIKAE.value; //残高増//#EOL#} else {#EOL#&#x9;kbKaitori = '10'; //振替控除//#EOL#&#x9;amTorihiki = KT010_AMHURIKAE.value * -1; //残高減//#EOL#}#EOL##EOL#///////////////////////////////#EOL#// 仕入実績(DT100)の黒伝追加 //#EOL#///////////////////////////////#EOL#cDT100 = instance.createTableOperator('Insert', 'DT100');#EOL#cDT100.addValue('NRKAIKAKE',&#x9;session.getNextNumber('NRKAIKAKE'));#EOL#cDT100.addValue('IDSIIRESAKI',&#x9;KT010_IDSIIRESAKI.value);#EOL#cDT100.addValue('KBAKADEN',&#x9;&#x9;'1');#EOL#cDT100.addValue('FGVALID',&#x9;&#x9;'T');#EOL#cDT100.addValue('KBKAITORI',&#x9;kbKaitori);#EOL#cDT100.addValue('KBKAIHURI',&#x9;KT010_KBKAIHURI.value);#EOL#cDT100.addValue('DTTORIHIKI',&#x9;KT010_DTHURIKAE.value);#EOL#cDT100.addValue('IDHINMOKU',&#x9;'');#EOL#cDT100.addValue('TXHINBAN',&#x9;&#x9;'');#EOL#cDT100.addValue('TXHINMEI',&#x9;&#x9;KT010_TXTEKIYO.value);#EOL#cDT100.addValue('KBUNIT',&#x9;&#x9;'CNT');#EOL#cDT100.addValue('PRTORIHIKI',&#x9;KT010_AMHURIKAE.value);#EOL#cDT100.addValue('QTTORIHIKI',&#x9;1);#EOL#cDT100.addValue('AMTORIHIKI',&#x9;KT010_AMHURIKAE.value);#EOL#cDT100.addValue('AMTAX',&#x9;&#x9;0);#EOL#cDT100.addValue('NRSIHARAI',&#x9;'');#EOL#cDT100.addValue('NRSOURCE',&#x9;&#x9;KT010_NRSOURCE.value);#EOL#cDT100.addValue('DTCREATE',&#x9;&#x9;'CURRENT_TIMESTAMP');#EOL#cDT100.addValue('TXREFNO',&#x9;&#x9;KT010_NRKAIHURI.value);#EOL#cDT100.addValue('DTNEND',&#x9;&#x9;dtNend);#EOL#cDT100.addValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#count = cDT100.execute();#EOL#if (count != 1) {#EOL#&#x9;errorMessage = '仕入実績(DT100)の登録に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#//////////////////////////// 残高更新 //////////////////////////////////#EOL#////////////////////////////////////////////////////////////////////////#EOL#rDT010 = instance.createTableOperator('Select', 'DT010');#EOL#rDT010.setSelectFields('AMSIIRE, UPDCOUNTER');#EOL#rDT010.addKeyValue('IDSIIRESAKI',&#x9;KT010_IDSIIRESAKI.value);#EOL#if (rDT010.next()) {#EOL#&#x9;amSiireUpdated = Number(rDT010.getValueOf('AMSIIRE')) + Number(amTorihikiOld) + Number(amTorihiki);#EOL#&#x9;uDT010 = instance.createTableOperator('Update', 'DT010');#EOL#&#x9;uDT010.addValue('AMSIIRE',&#x9;&#x9;&#x9;amSiireUpdated);#EOL#&#x9;uDT010.addValue('UPDCOUNTER',&#x9;&#x9;Number(rDT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;uDT010.addKeyValue('IDSIIRESAKI',&#x9;KT010_IDSIIRESAKI.value);#EOL#&#x9;uDT010.addKeyValue('UPDCOUNTER',&#x9;rDT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;count = uDT010.execute();#EOL#&#x9;if (count != 1) {#EOL#&#x9;&#x9;errorMessage = '仕入先(DT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;}#EOL#} else {#EOL#&#x9;errorMessage = '仕入先(DT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}"/><Field Decimal="" ID="KBZOUGEN" Name="増減区分" NoUpdate="T" Nullable="F" Order="0020" Remarks="" Size="1" Type="CHAR" TypeOptions="KUBUN(KBZOUGEN)"/><Script EventP="BC;BU;BD" EventR="BR()" Function="" Name="会計日付の妥当性検査" Order="0021" Text="KT010_DTHURIKAE.error = session.getErrorOfAccountDate(KT010_DTHURIKAE.value);"/></Table><Table ID="YT310" Name="月次在庫取引サマリ" Remarks="月次での品目・受払区分別の在庫取引を集計した結果を記録するためのテーブル" SubsystemID="Y"><Field Decimal="" ID="DTNEND" Name="年度" Nullable="F" Order="0010" Remarks="" Size="4" Type="SMALLINT" TypeOptions="FYEAR"/><Field Decimal="" ID="DTMSEQ" Name="月序" Nullable="F" Order="0020" Remarks="" Size="2" Type="SMALLINT" TypeOptions="MSEQ"/><Field Decimal="" ID="IDHINMOKU" Name="品目ID" Nullable="F" Order="0030" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="KBUKEBARAI" Name="受払区分" Nullable="F" Order="0040" Remarks="" Size="3" Type="CHAR" TypeOptions="KUBUN(KBUKEBARAI)"/><Field Decimal="" ID="KBZAIHURI" Name="振替区分" Nullable="F" Order="0050" Remarks="振替取引の際に設定される。それ以外の場合は２桁のスペースが設定される（ＮＵＬＬ不可ゆえ）" Size="2" Type="CHAR" TypeOptions="KUBUN(KBZAIHURI)"/><Field Decimal="" ID="AMTORIHIKI" Name="取引額" Nullable="T" Order="0070" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Key Fields="DTNEND;DTMSEQ;IDHINMOKU;KBUKEBARAI;KBZAIHURI" Type="PK"/><Refer Fields="TXHINBAN;TXHINMEI;KBUNIT" Order="0140" OrderBy="" TableAlias="" ToKeyFields="IDHINMOKU" ToTable="BT010" WithKeyFields="YT310.IDHINMOKU"/><Field Decimal="" ID="QTTORIHIKI" Name="取引数" Nullable="T" Order="0060" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/></Table><Table ID="YT110" Name="月次売掛取引サマリ" Remarks="月次での得意先・取引区分別の売上取引を集計した結果を記録するためのテーブル" SubsystemID="Y"><Field Decimal="" ID="DTNEND" Name="年度" Nullable="F" Order="0000" Remarks="" Size="4" Type="SMALLINT" TypeOptions="FYEAR"/><Field Decimal="" ID="DTMSEQ" Name="月序" Nullable="F" Order="0010" Remarks="" Size="2" Type="SMALLINT" TypeOptions="MSEQ"/><Field Decimal="" ID="IDTOKUISAKI" Name="得意先ID" Nullable="F" Order="0020" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="KBURITORI" Name="取引区分" Nullable="F" Order="0030" Remarks="" Size="2" Type="CHAR" TypeOptions="KUBUN(KBURITORI)"/><Field Decimal="" ID="KBURIHURI" Name="振替区分" Nullable="F" Order="0040" Remarks="振替取引の際に設定される。それ以外の場合は２桁のスペースが設定される（ＮＵＬＬ不可ゆえ）" Size="2" Type="CHAR" TypeOptions="KUBUN(KBURIHURI)"/><Field Decimal="" ID="AMTORIHIKI" Name="税抜取引額" Nullable="T" Order="0050" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMTAX" Name="消費税額" Nullable="T" Order="0060" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Key Fields="DTNEND;DTMSEQ;IDTOKUISAKI;KBURITORI;KBURIHURI" Type="PK"/><Refer Fields="CDTORIHIKISAKI;TXKANJI" Order="0100" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="YT110.IDTOKUISAKI"/></Table><Table ID="YT020" Name="月次取引サマリ" Remarks="月次での売上、仕入、在庫の取引を集計した結果を記録するためのテーブル" SubsystemID="Y"><Field Decimal="" ID="DTNEND" Name="年度" Nullable="F" Order="0000" Remarks="" Size="4" Type="SMALLINT" TypeOptions="FYEAR"/><Field Decimal="" ID="DTMSEQ" Name="月序" Nullable="F" Order="0010" Remarks="" Size="2" Type="SMALLINT" TypeOptions="MSEQ"/><Field Decimal="" ID="AMKISYUURI" Name="期首売掛残高" Nullable="T" Order="0020" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANURI" Name="期間売上額" Nullable="T" Order="0030" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANJYU" Name="期間受領額" Nullable="T" Order="0040" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKISYUKAI" Name="期首買掛残高" Nullable="T" Order="0060" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANSIHA" Name="期間支払額" Nullable="T" Order="0080" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKISYUZAI" Name="期首在庫残高" Nullable="T" Order="0090" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANNYUKO" Name="期間入庫額" Nullable="T" Order="0100" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANSYUKKO" Name="期間出庫額" Nullable="T" Order="0110" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMURIKAKE" Name="期末売掛残高" Nullable="T" Order="0120" Remarks="" Size="9" Type="INTEGER" TypeOptions="VIRTUAL"/><Field Decimal="" ID="AMKAIKAKE" Name="期末買掛残高" Nullable="T" Order="0130" Remarks="" Size="9" Type="INTEGER" TypeOptions="VIRTUAL"/><Field Decimal="" ID="AMZAIKO" Name="期末在庫残高" Nullable="T" Order="0140" Remarks="" Size="9" Type="INTEGER" TypeOptions="VIRTUAL"/><Key Fields="DTNEND;DTMSEQ" Type="PK"/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールドの設定" Order="0000" Text="YT020_AMURIKAKE.value = Number(YT020_AMKISYUURI.value) + Number(YT020_AMKIKANURI.value) - Number(YT020_AMKIKANJYU.value);#EOL#YT020_AMKAIKAKE.value = Number(YT020_AMKISYUKAI.value) + Number(YT020_AMKIKANKAI.value) - Number(YT020_AMKIKANSIHA.value);#EOL#YT020_AMZAIKO.value = Number(YT020_AMKISYUZAI.value) + Number(YT020_AMKIKANNYUKO.value) - Number(YT020_AMKIKANSYUKKO.value);#EOL#YT020_AMKIKANARARI.value = Number(YT020_AMKIKANURI.value) - Number(YT020_AMKIKANGENKA.value);#EOL#"/><Field Decimal="" ID="AMKIKANKAI" Name="期間仕入額" Nullable="T" Order="0071" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANGENKA" Name="期間販売原価" Nullable="T" Order="0051" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANARARI" Name="期間粗利額" Nullable="T" Order="0151" Remarks="" Size="7" Type="INTEGER" TypeOptions="VIRTUAL"/><Field Decimal="" ID="AMKIKANSEI" Name="期間製造額" Nullable="T" Order="0111" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/></Table><Table ID="YT210" Name="月次買掛取引サマリ" Remarks="月次での仕入先・取引区分別の仕入取引を集計した結果を記録するためのテーブル" SubsystemID="Y"><Field Decimal="" ID="DTNEND" Name="年度" Nullable="F" Order="0000" Remarks="" Size="4" Type="SMALLINT" TypeOptions="FYEAR"/><Field Decimal="" ID="DTMSEQ" Name="月序" Nullable="F" Order="0010" Remarks="" Size="2" Type="SMALLINT" TypeOptions="MSEQ"/><Field Decimal="" ID="IDSIIRESAKI" Name="仕入先ID" Nullable="F" Order="0020" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="KBKAITORI" Name="取引区分" Nullable="F" Order="0030" Remarks="" Size="2" Type="CHAR" TypeOptions="KUBUN(KBKAITORI)"/><Field Decimal="" ID="KBKAIHURI" Name="振替区分" Nullable="F" Order="0040" Remarks="振替取引の際に設定される。それ以外の場合は２桁のスペースが設定される（ＮＵＬＬ不可ゆえ）" Size="2" Type="CHAR" TypeOptions="KUBUN(KBKAIHURI)"/><Field Decimal="" ID="AMTORIHIKI" Name="税抜取引額" Nullable="T" Order="0050" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMTAX" Name="消費税額" Nullable="T" Order="0060" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Key Fields="DTNEND;DTMSEQ;IDSIIRESAKI;KBKAITORI;KBKAIHURI" Type="PK"/><Refer Fields="CDTORIHIKISAKI;TXKANJI" Order="0120" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="YT210.IDSIIRESAKI"/></Table><Table ID="YT300" Name="月次在庫品別サマリ" Remarks="月次での品目別の在庫取引を集計した結果を記録するためのテーブル" SubsystemID="Y"><Field Decimal="" ID="DTNEND" Name="年度" Nullable="F" Order="0010" Remarks="" Size="4" Type="SMALLINT" TypeOptions="FYEAR"/><Field Decimal="" ID="DTMSEQ" Name="月序" Nullable="F" Order="0020" Remarks="" Size="2" Type="SMALLINT" TypeOptions="MSEQ"/><Field Decimal="" ID="IDHINMOKU" Name="品目ID" Nullable="F" Order="0030" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="AMKISYUZAI" Name="期首在庫額" Nullable="T" Order="0040" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANNYUKO" Name="期間入庫額" Nullable="T" Order="0050" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANSYUKKO" Name="期間出庫額" Nullable="T" Order="0060" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMZAIKO" Name="期末在庫額" Nullable="T" Order="0180" Remarks="" Size="9" Type="INTEGER" TypeOptions="VIRTUAL"/><Key Fields="DTNEND;DTMSEQ;IDHINMOKU" Type="PK"/><Refer Fields="TXHINBAN;TXHINMEI;KBUNIT" Order="0130" OrderBy="" TableAlias="" ToKeyFields="IDHINMOKU" ToTable="BT010" WithKeyFields="YT300.IDHINMOKU"/><Field Decimal="" ID="QTKISYUZAI" Name="期首在庫数" Nullable="T" Order="0070" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTKIKANNYUKO" Name="期間入庫数" Nullable="T" Order="0080" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTKIKANSYUKKO" Name="期間出庫数" Nullable="T" Order="0090" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTZAIKO" Name="期末在庫数" Nullable="T" Order="0190" Remarks="" Size="9" Type="INTEGER" TypeOptions="VIRTUAL"/><Field Decimal="" ID="AMKIKANURI" Name="期間出荷額" Nullable="T" Order="0150" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANARARI" Name="期間粗利額" Nullable="T" Order="0160" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTKIKANURI" Name="期間出荷数" Nullable="T" Order="0140" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールドの設定" Order="0000" Text="YT300_AMZAIKO.value = Number(YT300_AMKISYUZAI.value) + Number(YT300_AMKIKANNYUKO.value) - Number(YT300_AMKIKANSYUKKO.value);"/><Field Decimal="" ID="QTKIKANKAI" Name="期間入荷数" Nullable="T" Order="0100" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANKAI" Name="期間入荷額" Nullable="T" Order="0110" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="QTKIKANSEI" Name="期間製造数" Nullable="T" Order="0120" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANSEI" Name="期間製造額" Nullable="T" Order="0130" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/></Table><Table ID="YT100" Name="月次得意先別サマリ" Remarks="月次での得意先別の売上取引を集計した結果を記録するためのテーブル" SubsystemID="Y"><Field Decimal="" ID="DTNEND" Name="年度" Nullable="F" Order="0000" Remarks="" Size="4" Type="SMALLINT" TypeOptions="FYEAR"/><Field Decimal="" ID="DTMSEQ" Name="月序" Nullable="F" Order="0010" Remarks="" Size="2" Type="SMALLINT" TypeOptions="MSEQ"/><Field Decimal="" ID="IDTOKUISAKI" Name="得意先ID" Nullable="F" Order="0020" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="AMKISYUURI" Name="期首売掛残高" Nullable="T" Order="0030" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANURI" Name="期間売上額" Nullable="T" Order="0040" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANJYU" Name="期間受領額" Nullable="T" Order="0050" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMURIKAKE" Name="期末売掛残高" Nullable="T" Order="0070" Remarks="" Size="9" Type="INTEGER" TypeOptions="VIRTUAL"/><Key Fields="DTNEND;DTMSEQ;IDTOKUISAKI" Type="PK"/><Refer Fields="CDTORIHIKISAKI;TXKANJI" Order="0090" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="YT100.IDTOKUISAKI"/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールドの設定" Order="0000" Text="YT100_AMURIKAKE.value = Number(YT100_AMKISYUURI.value) + Number(YT100_AMKIKANURI.value) - Number(YT100_AMKIKANJYU.value);#EOL#YT100_AMKIKANARARI.value = Number(YT100_AMKIKANURI.value) - Number(YT100_AMKIKANGENKA.value);#EOL#"/><Field Decimal="" ID="AMKIKANGENKA" Name="期間販売原価" Nullable="T" Order="0061" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANARARI" Name="期間粗利額" Nullable="T" Order="0081" Remarks="" Size="7" Type="INTEGER" TypeOptions="VIRTUAL"/></Table><Table ID="YT200" Name="月次仕入先別サマリ" Remarks="月次での仕入先別の仕入取引を集計した結果を記録するためのテーブル" SubsystemID="Y"><Field Decimal="" ID="DTNEND" Name="年度" Nullable="F" Order="0000" Remarks="" Size="4" Type="SMALLINT" TypeOptions="FYEAR"/><Field Decimal="" ID="DTMSEQ" Name="月序" Nullable="F" Order="0010" Remarks="" Size="2" Type="SMALLINT" TypeOptions="MSEQ"/><Field Decimal="" ID="IDSIIRESAKI" Name="仕入先ID" Nullable="F" Order="0020" Remarks="" Size="7" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="AMKISYUKAI" Name="期首買掛残高" Nullable="T" Order="0030" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANSIHA" Name="期間支払額" Nullable="T" Order="0050" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKAIKAKE" Name="期末買掛残高" Nullable="T" Order="0060" Remarks="" Size="9" Type="INTEGER" TypeOptions="VIRTUAL"/><Key Fields="DTNEND;DTMSEQ;IDSIIRESAKI" Type="PK"/><Refer Fields="CDTORIHIKISAKI;TXKANJI" Order="0110" OrderBy="" TableAlias="" ToKeyFields="IDTORIHIKISAKI" ToTable="AT030" WithKeyFields="YT200.IDSIIRESAKI"/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールドの設定" Order="0000" Text="YT200_AMKAIKAKE.value = Number(YT200_AMKISYUKAI.value) + Number(YT200_AMKIKANKAI.value) - Number(YT200_AMKIKANSIHA.value);"/><Field Decimal="" ID="AMKIKANKAI" Name="期間仕入額" Nullable="T" Order="0041" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/></Table><Table ID="YT010" Name="年次取引サマリ" Remarks="年次での売上、仕入、在庫の取引を集計した結果を記録するためのテーブル" SubsystemID="Y"><Field Decimal="" ID="DTNEND" Name="年度" Nullable="F" Order="0000" Remarks="" Size="4" Type="SMALLINT" TypeOptions="FYEAR"/><Field Decimal="" ID="AMKISYUURI" Name="期首売掛残高" Nullable="T" Order="0010" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANURI" Name="期間売上額" Nullable="T" Order="0020" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANJYU" Name="期間受領額" Nullable="T" Order="0030" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKISYUKAI" Name="期首買掛残高" Nullable="T" Order="0050" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANSIHA" Name="期間支払額" Nullable="T" Order="0070" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKISYUZAI" Name="期首在庫残高" Nullable="T" Order="0080" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANNYUKO" Name="期間入庫額" Nullable="T" Order="0090" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANSYUKKO" Name="期間出庫額" Nullable="T" Order="0100" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMURIKAKE" Name="期末売掛残高" Nullable="T" Order="0110" Remarks="" Size="9" Type="INTEGER" TypeOptions="VIRTUAL"/><Field Decimal="" ID="AMKAIKAKE" Name="期末買掛残高" Nullable="T" Order="0120" Remarks="" Size="9" Type="INTEGER" TypeOptions="VIRTUAL"/><Field Decimal="" ID="AMZAIKO" Name="期末在庫残高" Nullable="T" Order="0130" Remarks="" Size="9" Type="INTEGER" TypeOptions="VIRTUAL"/><Key Fields="DTNEND" Type="PK"/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールドの設定" Order="0000" Text="YT010_AMURIKAKE.value = Number(YT010_AMKISYUURI.value) + Number(YT010_AMKIKANURI.value) - Number(YT010_AMKIKANJYU.value);#EOL#YT010_AMKAIKAKE.value = Number(YT010_AMKISYUKAI.value) + Number(YT010_AMKIKANKAI.value) - Number(YT010_AMKIKANSIHA.value);#EOL#YT010_AMZAIKO.value = Number(YT010_AMKISYUZAI.value) + Number(YT010_AMKIKANNYUKO.value) - Number(YT010_AMKIKANSYUKKO.value);#EOL#YT010_AMKIKANARARI.value = Number(YT010_AMKIKANURI.value) - Number(YT010_AMKIKANGENKA.value);#EOL#"/><Field Decimal="" ID="AMKIKANGENKA" Name="期間販売原価" Nullable="T" Order="0041" Remarks="" Size="7" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANKAI" Name="期間仕入額" Nullable="T" Order="0061" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/><Field Decimal="" ID="AMKIKANARARI" Name="期間粗利額" Nullable="T" Order="0141" Remarks="" Size="7" Type="INTEGER" TypeOptions="VIRTUAL"/><Field Decimal="" ID="AMKIKANSEI" Name="期間製造額" Nullable="T" Order="0101" Remarks="" Size="9" Type="INTEGER" TypeOptions=""/></Table><Table ActiveWhere="" ID="ZT030" Name="採番テーブル" RangeKey="" Remarks="キーフィールド（レコード識別用フィールド）の自動採番を管理するためのテーブル" SubsystemID="Z"><Field ID="IDNUMBER" Name="番号ＩＤ" Nullable="F" Order="0" Size="20" Type="CHAR" TypeOptions=""/><Field ID="TXPREFIX" Name="冒頭文字" Nullable="T" Order="1" Size="4" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="NRNUMDIGIT" Name="数字部桁" Nullable="F" Order="2" Size="2" Type="SMALLINT" TypeOptions=""/><Field ID="NRCURRENT" Name="現在番号値" Nullable="F" Order="3" Size="9" Type="INTEGER" TypeOptions=""/><Field ID="FGWITHCD" Name="チェックデジット" Nullable="F" Order="4" Remarks="値がT(真)であれば、採番値の末尾にチェックデジット（モジュラス１０）を付加する。したがって冒頭文字を１文字指定して、チェックデジットを指定すれば、採番値は数字部桁に２を足した長さになる。" Size="1" Type="CHAR" TypeOptions="KUBUN(KBFLAG1)"/><Key Fields="IDNUMBER" Type="PK"/></Table><Function DetailFunction="AF011" ID="AF010" InitialListing="T" InitialMsg="" KeyFields="" Name="部門マスターの一覧・保守" OrderBy="AT010.CDBUMON" PrimaryTable="AT010" Size="AUTO" SubsystemID="A" Type="XF100"><Filter DataSource="AT010.TXBUMON" FieldOptions="SCAN,CAPTION(部門名SCAN)" Order="0"/><Column DataSource="AT010.TXBUMON" FieldOptions="" Order="1"/><Column DataSource="AT010.NRKANRISYA" FieldOptions="" Order="2"/><Column DataSource="AT020.TXKANJI" FieldOptions="CAPTION(管理者名)" Order="3"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(AF012)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function HeaderFunction="AF012" HeaderKeyFields="" HeaderTable="AT010" ID="AF011" Name="部門と関連情報の確認" Size="AUTO" SubsystemID="A" Type="XF300"><Field DataSource="AT010.CDBUMON" FieldOptions="" Order="0010"/><Field DataSource="AT010.TXBUMON" FieldOptions="" Order="0020"/><Field DataSource="AT010.NRKANRISYA" FieldOptions="" Order="0030"/><Field DataSource="AT020.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Detail Caption="上位部門" DetailFunction="AF013" InitialMsg="" KeyFields="" Order="0" OrderBy="" Table="AT011"><Column DataSource="AT011.DTHAKKOUNENGETSU" FieldOptions="" Order="0010"/><Column DataSource="AT011.CDJYOUIBUMON" FieldOptions="" Order="0030"/><Column DataSource="AT011.DTSIKKOUNENGETSU" FieldOptions="" Order="0060"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="HEADER" Caption="部門情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="AT010A2.TXBUMON" FieldOptions="CAPTION(上位部門名)" Order="0040"/></Detail><Detail Caption="所属メンバー" DetailFunction="AF024" HeaderKeyFields="CDBUMON" InitialMsg="" KeyFields="CDBUMON;NRJYUGYOIN;DTSYOZOKUNENGETSU" Order="1" Table="AT021"><Column DataSource="AT021.DTSYOZOKUNENGETSU" FieldOptions="" Order="0020"/><Column DataSource="AT021.DTSIKKONENGETSU" FieldOptions="" Order="0050"/><Column DataSource="AT020.TXKANJI" FieldOptions="CAPTION(メンバー名)" Order="0070"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="部門情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Detail><Field DataSource="AT010.TXTEKIYO" FieldOptions="" Order="0050"/></Function><Function DataName="部門情報" ID="AF012" InitialMsg="" KeyFields="" Name="部門情報の保守" PrimaryTable="AT010" Size="AUTO" SubsystemID="A" Type="XF200"><Field DataSource="AT010.CDBUMON" FieldOptions="" Order="0010"/><Field DataSource="AT010.TXBUMON" FieldOptions="" Order="0020"/><Field DataSource="AT010.NRKANRISYA" FieldOptions="" Order="0030"/><Field DataSource="AT020.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="複写" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="AT010.TXTEKIYO" FieldOptions="" Order="0050"/></Function><Function DataName="上位部門" ID="AF013" InitialMsg="" KeyFields="" Name="上位部門の保守" PrimaryTable="AT011" Size="AUTO" SubsystemID="A" Type="XF200"><Field DataSource="AT011.CDBUMON" FieldOptions="" Order="0010"/><Field DataSource="AT010A1.TXBUMON" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Field DataSource="AT011.CDJYOUIBUMON" FieldOptions="" Order="0030"/><Field DataSource="AT010A2.TXBUMON" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Field DataSource="AT011.DTHAKKOUNENGETSU" FieldOptions="" Order="0050"/><Field DataSource="AT011.DTSIKKOUNENGETSU" FieldOptions="HORIZONTAL" Order="0060"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="複写" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DetailFunction="AF021" ID="AF020" InitialListing="T" InitialMsg="" KeyFields="" Name="従業員マスターの一覧・保守" OrderBy="AT020.TXKANA" PrimaryTable="AT020" Size="AUTO" SubsystemID="A" Type="XF100"><Filter DataSource="AT020.TXKANJI" FieldOptions="SCAN,CAPTION(漢字名SCAN)" Order="0"/><Filter DataSource="AT020.TXKANA" FieldOptions="SCAN,CAPTION(カナ名SCAN)" Order="1"/><Filter DataSource="AT020.KBKOYOU" FieldOptions="PROMPT_LIST1" Order="2"/><Column DataSource="AT020.NRJYUGYOIN" FieldOptions="" Order="0"/><Column DataSource="AT020.TXKANJI" FieldOptions="" Order="1"/><Column DataSource="AT020.TXKANA" FieldOptions="" Order="2"/><Column DataSource="AT020.KBKOYOU" FieldOptions="" Order="3"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(AF022)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function HeaderFunction="AF022" HeaderKeyFields="" HeaderTable="AT020" ID="AF021" Name="従業員と関連情報の確認" Size="AUTO" SubsystemID="A" Type="XF300"><Field DataSource="AT020.NRJYUGYOIN" FieldOptions="" Order="0"/><Field DataSource="AT020.TXKANA" FieldOptions="" Order="1"/><Field DataSource="AT020.TXKANJI" FieldOptions="" Order="2"/><Field DataSource="AT020.KBKOYOU" FieldOptions="" Order="3"/><Field DataSource="AT020.DTNYUSYA" FieldOptions="HORIZONTAL" Order="4"/><Field DataSource="AT020.DTTAISYA" FieldOptions="HORIZONTAL" Order="5"/><Detail Caption="所属部門" DetailFunction="AF023" InitialMsg="" KeyFields="" Order="0" OrderBy="" Table="AT021"><Column DataSource="AT021.DTSYOZOKUNENGETSU" FieldOptions="" Order="0"/><Column DataSource="AT021.CDBUMON" FieldOptions="" Order="1"/><Column DataSource="AT010.TXBUMON" FieldOptions="CAPTION(所属部門名)" Order="2"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="HEADER" Caption="従業員情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Detail></Function><Function DataName="従業員" ID="AF022" InitialMsg="" KeyFields="" Name="従業員情報の保守" PrimaryTable="AT020" Size="AUTO" SubsystemID="A" Type="XF200"><Field DataSource="AT020.NRJYUGYOIN" FieldOptions="" Order="0"/><Field DataSource="AT020.TXKANA" FieldOptions="" Order="1"/><Field DataSource="AT020.TXKANJI" FieldOptions="" Order="2"/><Field DataSource="AT020.KBKOYOU" FieldOptions="" Order="3"/><Field DataSource="AT020.DTNYUSYA" FieldOptions="" Order="4"/><Field DataSource="AT020.DTTAISYA" FieldOptions="" Order="5"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="複写" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DataName="所属情報" ID="AF023" InitialMsg="" KeyFields="" Name="従業員所属情報の保守" PrimaryTable="AT021" Size="AUTO" SubsystemID="A" Type="XF200"><Field DataSource="AT021.NRJYUGYOIN" FieldOptions="" Order="0"/><Field DataSource="AT020.TXKANJI" FieldOptions="" Order="1"/><Field DataSource="AT021.DTSYOZOKUNENGETSU" FieldOptions="" Order="2"/><Field DataSource="AT021.CDBUMON" FieldOptions="PROMPT_CALL(AF100),PROMPT_CALL_TO_GET(AT010.CDBUMON;AT010.TXBUMON),PROMPT_CALL_TO_GET_TO(AT021.CDBUMON;AT010.TXBUMON)" Order="3"/><Field DataSource="AT010.TXBUMON" FieldOptions="NO_CAPTION,HORIZONTAL" Order="4"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="複写" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DataName="所属情報" ID="AF024" InitialMsg="" KeyFields="" Name="従業員所属情報の表示" PrimaryTable="AT021" Size="AUTO" SubsystemID="A" Type="XF200"><Field DataSource="AT021.NRJYUGYOIN" FieldOptions="" Order="0"/><Field DataSource="AT020.TXKANJI" FieldOptions="" Order="1"/><Field DataSource="AT021.DTSYOZOKUNENGETSU" FieldOptions="" Order="2"/><Field DataSource="AT021.CDBUMON" FieldOptions="" Order="3"/><Field DataSource="AT010.TXBUMON" FieldOptions="NO_CAPTION,HORIZONTAL" Order="4"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DetailFunction="" ID="AF100" InitialListing="T" InitialMsg="" KeyFields="" Name="部門検索関数" OrderBy="AT010.CDBUMON" ParmType="COLUMNS" PrimaryTable="AT010" Size="AUTO" SubsystemID="A" Type="XF100"><Filter DataSource="AT010.TXBUMON" FieldOptions="SCAN,CAPTION(部門名SCAN)" Order="0"/><Column DataSource="AT010.CDBUMON" FieldOptions="" Order="0"/><Column DataSource="AT010.TXBUMON" FieldOptions="" Order="1"/><Column DataSource="AT010.NRKANRISYA" FieldOptions="" Order="2"/><Column DataSource="AT020.TXKANJI" FieldOptions="CAPTION(管理者名)" Order="3"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/></Function><Function DetailFunction="" ID="AF110" InitialListing="T" InitialMsg="" KeyFields="" Name="従業員検索関数" OrderBy="AT020.TXKANA" ParmType="COLUMNS" PrimaryTable="AT020" Size="AUTO" SubsystemID="A" Type="XF100"><Filter DataSource="AT020.TXKANJI" FieldOptions="SCAN,CAPTION(漢字名SCAN)" Order="0"/><Filter DataSource="AT020.TXKANA" FieldOptions="SCAN,CAPTION(カナ名SCAN)" Order="1"/><Filter DataSource="AT020.KBKOYOU" FieldOptions="PROMPT_LIST1" Order="2"/><Column DataSource="AT020.NRJYUGYOIN" FieldOptions="" Order="0"/><Column DataSource="AT020.TXKANJI" FieldOptions="" Order="1"/><Column DataSource="AT020.TXKANA" FieldOptions="" Order="2"/><Column DataSource="AT020.KBKOYOU" FieldOptions="" Order="3"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/></Function><Function DetailFunction="ZF011" ID="ZF010" InitialListing="T" InitialMsg="" KeyFields="" Name="システム変数の一覧・保守" OrderBy="ZT010.IDVARIANT" PrimaryTable="ZT010" Size="AUTO" SubsystemID="Z" Type="XF100"><Column DataSource="ZT010.IDVARIANT" FieldOptions="" Order="0010"/><Column DataSource="ZT010.TXTYPE" FieldOptions="" Order="0040"/><Column DataSource="ZT010.TXVALUE" FieldOptions="" Order="0050"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Filter DataSource="ZT010.TXNAME" FieldOptions="SCAN,CAPTION(変数名SCAN)" Order="0010"/><Column DataSource="ZT010.TXNAME" FieldOptions="" Order="0030"/></Function><Function DataName="システム変数" ID="ZF011" InitialMsg="" KeyFields="" Name="システム変数の保守" PrimaryTable="ZT010" Size="AUTO" SubsystemID="Z" Type="XF200"><Field DataSource="ZT010.IDVARIANT" FieldOptions="" Order="0010"/><Field DataSource="ZT010.TXTYPE" FieldOptions="" Order="0030"/><Field DataSource="ZT010.TXVALUE" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="複写" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="ZT010.TXNAME" FieldOptions="" Order="0020"/><Field DataSource="ZT010.TXREMARKS" FieldOptions="" Order="0050"/></Function><Function DetailFunction="ZF021" ID="ZF020" InitialListing="T" InitialMsg="" KeyFields="" Name="ユーザの一覧・保守" OrderBy="ZT020.IDUSER" PrimaryTable="ZT020" Size="AUTO" SubsystemID="Z" Type="XF100"><Column DataSource="ZT020.IDUSER" FieldOptions="" Order="0010"/><Column DataSource="ZT020.TXMENUS" FieldOptions="" Order="0050"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Filter DataSource="ZT020.TXNAME" FieldOptions="SCAN,CAPTION(ユーザ名SCAN)" Order="0010"/><Column DataSource="ZT020.TXNAME" FieldOptions="" Order="0020"/><Column DataSource="ZT020.TXEMAIL" FieldOptions="" Order="0030"/><Column DataSource="ZT020.NREMPLOYEE" FieldOptions="" Order="0040"/></Function><Function DataName="" ID="ZF021" InitialMsg="" KeyFields="" Name="ユーザの保守" PrimaryTable="ZT020" Size="AUTO" SubsystemID="Z" Type="XF200"><Field DataSource="ZT020.IDUSER" FieldOptions="" Order="0010"/><Field DataSource="ZT020.TXPASSWORD" FieldOptions="COMMENT(デフォルトは0000000000のハッシュ値。セッション中でユーザ自身がF12で変更できます。)" Order="0040"/><Field DataSource="ZT020.DTVALID" FieldOptions="" Order="0050"/><Field DataSource="ZT020.DTEXPIRE" FieldOptions="" Order="0060"/><Field DataSource="ZT020.TXMENUS" FieldOptions="COMMENT(メニューＩＤをコンマで区切って指定するか、ALLを指定してください。)" Order="0080"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="複写" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="ZT020.NREMPLOYEE" FieldOptions="" Order="0020"/><Field DataSource="ZT020.TXNAME" FieldOptions="" Order="0030"/><Field DataSource="ZT020.TXEMAIL" FieldOptions="" Order="0070"/></Function><Function DetailFunction="ZF031" ID="ZF030" InitialListing="T" InitialMsg="" KeyFields="" Name="採番定義の一覧・保守" OrderBy="ZT030.IDNUMBER" PrimaryTable="ZT030" Size="AUTO" SubsystemID="Z" Type="XF100"><Filter DataSource="ZT030.IDNUMBER" FieldOptions="SCAN,CAPTION(番号ＩＤ SCAN)" Order="0"/><Column DataSource="ZT030.IDNUMBER" FieldOptions="" Order="0"/><Column DataSource="ZT030.TXPREFIX" FieldOptions="" Order="1"/><Column DataSource="ZT030.NRNUMDIGIT" FieldOptions="" Order="2"/><Column DataSource="ZT030.NRCURRENT" FieldOptions="" Order="3"/><Column DataSource="ZT030.FGWITHCD" FieldOptions="CAPTION(C/D)" Order="4"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DataName="採番定義" ID="ZF031" InitialMsg="" KeyFields="" Name="採番定義の保守" PrimaryTable="ZT030" Size="AUTO" SubsystemID="Z" Type="XF200"><Field DataSource="ZT030.IDNUMBER" FieldOptions="" Order="0"/><Field DataSource="ZT030.TXPREFIX" FieldOptions="" Order="1"/><Field DataSource="ZT030.NRNUMDIGIT" FieldOptions="" Order="2"/><Field DataSource="ZT030.NRCURRENT" FieldOptions="" Order="3"/><Field DataSource="ZT030.FGWITHCD" FieldOptions="" Order="4"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="複写" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DetailFunction="ZF041" ID="ZF040" InitialListing="T" InitialMsg="" KeyFields="" Name="ユーザ定義区分の一覧・保守" OrderBy="ZT040.IDUSERKUBUN;ZT040.SQLIST" PrimaryTable="ZT040" Size="AUTO" SubsystemID="Z" Type="XF100"><Filter DataSource="ZT040.IDUSERKUBUN" FieldOptions="SCAN,CAPTION(区分ＩＤ SCAN)" Order="0"/><Column DataSource="ZT040.IDUSERKUBUN" FieldOptions="" Order="0"/><Column DataSource="ZT040.SQLIST" FieldOptions="" Order="1"/><Column DataSource="ZT040.KBUSERKUBUN" FieldOptions="" Order="2"/><Column DataSource="ZT040.TXUSERKUBUN" FieldOptions="" Order="3"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DataName="ユーザ定義区分" ID="ZF041" InitialMsg="" KeyFields="" Name="ユーザ定義区分の保守" PrimaryTable="ZT040" Size="AUTO" SubsystemID="Z" Type="XF200"><Field DataSource="ZT040.IDUSERKUBUN" FieldOptions="" Order="0"/><Field DataSource="ZT040.KBUSERKUBUN" FieldOptions="" Order="1"/><Field DataSource="ZT040.TXUSERKUBUN" FieldOptions="" Order="2"/><Field DataSource="ZT040.SQLIST" FieldOptions="" Order="3"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="複写" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DetailFunction="ZF051" ID="ZF050" InitialMsg="" KeyFields="" Name="セッション状況の一覧" OrderBy="ZT050.NRSESSION(D)" PrimaryTable="ZT050" Size="AUTO" SubsystemID="Z" Type="XF100"><Filter DataSource="ZT050.DTLOGIN" FieldOptions="GENERIC,CAPTION(ログイン日時)" Order="0"/><Filter DataSource="ZT050.KBSESSIONSTATUS" FieldOptions="PROMPT_LIST1" Order="2"/><Column DataSource="ZT050.NRSESSION" FieldOptions="CAPTION(Session)" Order="0010"/><Column DataSource="ZT050.DTLOGIN" FieldOptions="" Order="0020"/><Column DataSource="ZT050.DTLOGOUT" FieldOptions="" Order="0030"/><Column DataSource="ZT050.IDUSER" FieldOptions="CAPTION(User)" Order="0040"/><Column DataSource="ZT050.TXIPADDRESS" FieldOptions="" Order="0060"/><Column DataSource="ZT050.KBSESSIONSTATUS" FieldOptions="" Order="0080"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(ZF053)" Caption="LOGIN制御" Number="8" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Filter DataSource="ZT020.TXNAME" FieldOptions="SCAN,CAPTION(ユーザ名SCAN)" Order="0012"/><Column DataSource="ZT020.TXNAME" FieldOptions="WIDTH(150)" Order="0050"/><Column DataSource="ZT050.VLVERSION" FieldOptions="CAPTION(処理系)" Order="0070"/></Function><Function HeaderFunction="" HeaderKeyFields="" HeaderTable="ZT050" ID="ZF051" Name="セッションと関連情報の確認" Size="AUTO" SubsystemID="Z" Type="XF300"><Field DataSource="ZT050.NRSESSION" FieldOptions="" Order="0010"/><Field DataSource="ZT050.DTLOGIN" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="ZT050.DTLOGOUT" FieldOptions="HORIZONTAL" Order="0030"/><Field DataSource="ZT050.IDUSER" FieldOptions="" Order="0040"/><Field DataSource="ZT050.TXIPADDRESS" FieldOptions="HORIZONTAL(44)" Order="0070"/><Field DataSource="ZT050.KBSESSIONSTATUS" FieldOptions="" Order="0060"/><Detail Caption="機能利用履歴" DetailFunction="ZF052" InitialMsg="" KeyFields="" Order="0" OrderBy="" Table="ZT051"><Column DataSource="ZT051.DTSTART" FieldOptions="" Order="0"/><Column DataSource="ZT051.IDMENU" FieldOptions="" Order="1"/><Column DataSource="ZT051.IDPROGRAM" FieldOptions="" Order="2"/><Column DataSource="ZT051.TXPROGRAM" FieldOptions="" Order="3"/><Column DataSource="ZT051.KBPROGRAMSTATUS" FieldOptions="" Order="4"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Detail><Field DataSource="ZT020.TXNAME" FieldOptions="HORIZONTAL(22)" Order="0050"/><Field DataSource="ZT050.VLVERSION" FieldOptions="HORIZONTAL(42)" Order="0080"/></Function><Function DetailFunction="ZF061" ID="ZF060" InitialListing="T" InitialMsg="" KeyFields="" Name="消費税率の一覧・保守" OrderBy="ZT060.DTSTART" PrimaryTable="ZT060" Size="AUTO" SubsystemID="Z" Type="XF100"><Filter DataSource="ZT060.DTSTART" FieldOptions="GENERIC,CAPTION(開始日上位桁)" Order="0"/><Column DataSource="ZT060.DTSTART" FieldOptions="" Order="0"/><Column DataSource="ZT060.VLTAXRATE" FieldOptions="" Order="1"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DataName="消費税率" ID="ZF061" InitialMsg="" KeyFields="" Name="消費税率の保守" PrimaryTable="ZT060" Size="AUTO" SubsystemID="Z" Type="XF200"><Field DataSource="ZT060.DTSTART" FieldOptions="" Order="0"/><Field DataSource="ZT060.VLTAXRATE" FieldOptions="" Order="1"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="複写" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DataName="プログラム利用履歴" ID="ZF052" InitialMsg="" KeyFields="" Name="プログラム利用履歴の確認" PrimaryTable="ZT051" Size="AUTO" SubsystemID="Z" Type="XF200"><Field DataSource="ZT051.NRSESSION" FieldOptions="" Order="0010"/><Field DataSource="ZT051.SQPROGRAM" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(70)" Order="0040"/><Field DataSource="ZT051.IDMENU" FieldOptions="HORIZONTAL" Order="0050"/><Field DataSource="ZT051.IDPROGRAM" FieldOptions="CAPTION(プログラム)" Order="0060"/><Field DataSource="ZT051.TXPROGRAM" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0070"/><Field DataSource="ZT051.KBPROGRAMSTATUS" FieldOptions="HORIZONTAL" Order="0080"/><Field DataSource="ZT051.TXERRORLOG" FieldOptions="WIDTH(874),ROWS(16)" Order="0090"/><Field DataSource="ZT051.DTSTART" FieldOptions="" Order="0100"/><Field DataSource="ZT051.DTEND" FieldOptions="HORIZONTAL" Order="0110"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function ID="ZF053" Name="ログイン制御" Script="//////////////////////////#EOL#// Javaパッケージの導入 //#EOL#//////////////////////////#EOL#var importedPackage = new JavaImporter(javax.swing);#EOL#with (importedPackage) {#EOL##EOL#&#x9;//////////////#EOL#&#x9;// 変数定義 //#EOL#&#x9;//////////////#EOL#&#x9;var rZT010; var uZT010;#EOL#&#x9;var count = 0; var errorMessage = ''; var ans;#EOL##EOL#&#x9;//////////////////////////////////////////////////////////////////////////////////////#EOL#&#x9;// システム変数テーブル(ZT010)のログイン認可フラグ(LOGIN_PERMITTED)を調べて更新する //#EOL#&#x9;//////////////////////////////////////////////////////////////////////////////////////#EOL#&#x9;rZT010 = instance.createTableOperator('Select', 'ZT010');#EOL#&#x9;rZT010.addKeyValue('IDVARIANT',&#x9;'LOGIN_PERMITTED');#EOL#&#x9;if (rZT010.next()) {#EOL##EOL#&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;// フラグをログイン禁止(F)として更新する //#EOL#&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;var value  = rZT010.getValueOf('TXVALUE').trim();#EOL#&#x9;&#x9;if (value == 'T') {#EOL##EOL#&#x9;&#x9;&#x9;ans = JOptionPane.showConfirmDialog(null, '新たなログインを禁止しますか？', 'LOGIN制御', JOptionPane.OK_CANCEL_OPTION);#EOL#&#x9;&#x9;&#x9;if (ans == JOptionPane.OK_OPTION) {#EOL#&#x9;&#x9;&#x9;&#x9;uZT010 = instance.createTableOperator('Update', 'ZT010');#EOL#&#x9;&#x9;&#x9;&#x9;uZT010.addValue('TXVALUE',&#x9;'F');#EOL#&#x9;&#x9;&#x9;&#x9;uZT010.addKeyValue('IDVARIANT',&#x9;'LOGIN_PERMITTED');#EOL#&#x9;&#x9;&#x9;&#x9;count = uZT010.execute();#EOL#&#x9;&#x9;&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;instance.commit();#EOL#&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = 'システム変数(ZT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;} else {#EOL##EOL#&#x9;&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;// フラグをログイン認可(T)として更新する //#EOL#&#x9;&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;if (value == 'F') {#EOL#&#x9;&#x9;&#x9;&#x9;ans = JOptionPane.showConfirmDialog(null, '現在、新たなログインは禁止されています。解除しますか？', 'LOGIN制御', JOptionPane.OK_CANCEL_OPTION);#EOL#&#x9;&#x9;&#x9;&#x9;if (ans == JOptionPane.OK_OPTION) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uZT010 = instance.createTableOperator('Update', 'ZT010');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uZT010.addValue('TXVALUE','T');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uZT010.addKeyValue('IDVARIANT','LOGIN_PERMITTED');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;count = uZT010.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;instance.commit();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = 'システム変数(ZT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;////////////////#EOL#&#x9;&#x9;// エラー処理 //#EOL#&#x9;&#x9;////////////////#EOL#&#x9;&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;JOptionPane.showMessageDialog(null, 'ログイン制御用のシステム変数(LOGIN_PERMITTED)が登録されていないので処理できません。');#EOL#&#x9;}#EOL#}" SubsystemID="Z" Type="XF000"/><PrintFont FontName="Times-Roman" ID="Font0" PDFEncoding="Cp1252" PDFFontName="Times-Roman"/><PrintFont FontName="Hゴシック" ID="Font1" PDFEncoding="UniJIS-UCS2-H" PDFFontName="HeiseiKakuGo-W5"/><PrintFont FontName="H明朝" ID="Font2" PDFEncoding="UniJIS-UCS2-H" PDFFontName="HeiseiMin-W3"/><Function DetailFunction="ZF081" ID="ZF080" InitialListing="T" InitialMsg="" KeyFields="" Name="年次為替レートの一覧・保守" OrderBy="" PrimaryTable="ZT080" Size="AUTO" SubsystemID="Z" Type="XF100"><Column DataSource="ZT080.KBCURRENCY" FieldOptions="CAPTION(通貨)" Order="0000"/><Column DataSource="ZT080.DTNEND" FieldOptions="" Order="0010"/><Column DataSource="ZT080.VLRATEB" FieldOptions="" Order="0020"/><Column DataSource="ZT080.VLRATEM" FieldOptions="" Order="0030"/><Column DataSource="ZT080.VLRATES" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Filter DataSource="ZT080.KBCURRENCY" FieldOptions="PROMPT_LIST1,CAPTION(通貨)" Order="0010"/><Filter DataSource="ZT080.DTNEND" FieldOptions="" Order="0020"/></Function><Function ContinueAdd="T" ID="ZF081" InitialMsg="" KeyFields="" Name="年次為替レートの保守" PrimaryTable="ZT080" Size="AUTO" SubsystemID="Z" Type="XF200"><Field DataSource="ZT080.KBCURRENCY" FieldOptions="" Order="0000"/><Field DataSource="ZT080.DTNEND" FieldOptions="HORIZONTAL" Order="0010"/><Field DataSource="ZT080.VLRATEB" FieldOptions="" Order="0020"/><Field DataSource="ZT080.VLRATEM" FieldOptions="" Order="0030"/><Field DataSource="ZT080.VLRATES" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DetailFunction="ZF083" ID="ZF082" InitialListing="T" InitialMsg="" KeyFields="" Name="月次為替レートの一覧・保守" OrderBy="" PrimaryTable="ZT081" Size="AUTO" SubsystemID="Z" Type="XF100"><Column DataSource="ZT081.KBCURRENCY" FieldOptions="CAPTION(通貨)" Order="0000"/><Column DataSource="ZT081.DTNEND" FieldOptions="" Order="0010"/><Column DataSource="ZT081.DTMSEQ" FieldOptions="" Order="0020"/><Column DataSource="ZT081.VLRATEB" FieldOptions="" Order="0030"/><Column DataSource="ZT081.VLRATEM" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Filter DataSource="ZT081.KBCURRENCY" FieldOptions="PROMPT_LIST1,CAPTION(通貨)" Order="0010"/><Filter DataSource="ZT081.DTNEND" FieldOptions="" Order="0020"/></Function><Function ContinueAdd="T" ID="ZF083" InitialMsg="" KeyFields="" Name="月次為替レートの保守" PrimaryTable="ZT081" Size="AUTO" SubsystemID="Z" Type="XF200"><Field DataSource="ZT081.KBCURRENCY" FieldOptions="" Order="0000"/><Field DataSource="ZT081.DTNEND" FieldOptions="HORIZONTAL" Order="0010"/><Field DataSource="ZT081.DTMSEQ" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="ZT081.VLRATEB" FieldOptions="" Order="0030"/><Field DataSource="ZT081.VLRATEM" FieldOptions="" Order="0040"/><Field DataSource="ZT081.VLRATES" FieldOptions="" Order="0050"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DetailFunction="ZF071" ID="ZF070" InitialListing="T" InitialMsg="" InitialReadCount="" KeyFields="" Name="休日の一覧・保守" OrderBy="" PrimaryTable="ZT070" Size="AUTO" SubsystemID="Z" Type="XF100"><Column DataSource="ZT070.KBCALENDAR" FieldOptions="" Order="0000"/><Column DataSource="ZT070.DTOFF" FieldOptions="" Order="0010"/><Column DataSource="ZT070.TXOFF" FieldOptions="" Order="0020"/><Filter DataSource="ZT070.KBCALENDAR" FieldOptions="PROMPT_LIST1" Order="0000"/><Filter DataSource="ZT070.DTOFF" FieldOptions="GE,CAPTION(日付≧)" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Button Action="CALL(ZF072)" Caption="土日登録" Number="7" Position="4"/></Function><Function ID="ZF071" InitialMsg="" KeyFields="" Name="休日の保守" PrimaryTable="ZT070" Size="AUTO" SubsystemID="Z" Type="XF200"><Field DataSource="ZT070.KBCALENDAR" FieldOptions="" Order="0000"/><Field DataSource="ZT070.DTOFF" FieldOptions="" Order="0010"/><Field DataSource="ZT070.TXOFF" FieldOptions="" Order="0020"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DetailFunction="AF031" ID="AF030" InitialListing="T" InitialMsg="" KeyFields="" Name="取引先マスターの一覧・保守" OrderBy="" PrimaryTable="AT030" Size="AUTO" SubsystemID="A" Type="XF100"><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="" Order="0010"/><Column DataSource="AT030.TXKANJI" FieldOptions="WIDTH(250)" Order="0030"/><Filter DataSource="AT030.TXKANA" FieldOptions="SCAN,CAPTION(カナ名SCAN)" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="AT030.TXJYUSYO1" FieldOptions="WIDTH(300)" Order="0040"/><Column DataSource="AT030.TXKANA" FieldOptions="WIDTH(200)" Order="0020"/><Column DataSource="AT030.FGTOKUISAKI" FieldOptions="CAPTION(得意先)" Order="0050"/><Column DataSource="AT030.FGSIIRESAKI" FieldOptions="CAPTION(仕入先)" Order="0060"/><Filter DataSource="AT030.KBTOKUISAKI" FieldOptions="PROMPT_LIST1,CAPTION(得意先)" Order="0020"/><Filter DataSource="AT030.KBSIIRESAKI" FieldOptions="PROMPT_LIST1,CAPTION(仕入先)" Order="0030"/></Function><Function ID="AF031" InitialMsg="" KeyFields="" Name="取引先マスターの保守" PrimaryTable="AT030" Size="AUTO" SubsystemID="A" Type="XF200"><Field DataSource="AT030.IDTORIHIKISAKI" FieldOptions="" Order="0000"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="HORIZONTAL" Order="0010"/><Field DataSource="AT030.TXKANA" FieldOptions="" Order="0020"/><Field DataSource="AT030.TXKANJI" FieldOptions="" Order="0030"/><Field DataSource="AT030.NRYUBIN" FieldOptions="CAPTION(郵便番号／住所１)" Order="0040"/><Field DataSource="AT030.TXJYUSYO1" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/><Field DataSource="AT030.TXJYUSYO2" FieldOptions="" Order="0060"/><Field DataSource="AT030.NRDENWA" FieldOptions="" Order="0070"/><Field DataSource="AT030.NRFAX" FieldOptions="HORIZONTAL" Order="0080"/><Field DataSource="AT030.TXURL" FieldOptions="" Order="0090"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DetailFunction="AF041" ID="AF040" InitialListing="T" InitialMsg="" KeyFields="" Name="倉庫マスターの一覧・保守" OrderBy="" PrimaryTable="AT040" Size="AUTO" SubsystemID="A" Type="XF100"><Column DataSource="AT040.CDSOUKO" FieldOptions="" Order="0000"/><Column DataSource="AT040.TXSOUKO" FieldOptions="" Order="0010"/><Column DataSource="AT040.NRYUBIN" FieldOptions="" Order="0020"/><Column DataSource="AT040.TXJYUSYO1" FieldOptions="" Order="0030"/><Column DataSource="AT040.TXJYUSYO2" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function ID="AF041" InitialMsg="" KeyFields="" Name="倉庫マスターの保守" PrimaryTable="AT040" Size="AUTO" SubsystemID="A" Type="XF200"><Field DataSource="AT040.CDSOUKO" FieldOptions="CAPTION(倉庫Ｃ／名称)" Order="0000"/><Field DataSource="AT040.TXSOUKO" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0010"/><Field DataSource="AT040.NRYUBIN" FieldOptions="CAPTION(郵便番号／住所１)" Order="0020"/><Field DataSource="AT040.TXJYUSYO1" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0030"/><Field DataSource="AT040.TXJYUSYO2" FieldOptions="" Order="0040"/><Field DataSource="AT040.NRDENWA" FieldOptions="" Order="0050"/><Field DataSource="AT040.NRFAX" FieldOptions="HORIZONTAL" Order="0060"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DetailFunction="" ID="AF120" InitialListing="T" InitialMsg="" KeyFields="" Name="取引先検索" OrderBy="" ParmType="COLUMNS" PrimaryTable="AT030" Size="AUTO" SubsystemID="A" Type="XF100"><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="" Order="0010"/><Column DataSource="AT030.TXKANA" FieldOptions="WIDTH(200)" Order="0020"/><Column DataSource="AT030.TXKANJI" FieldOptions="WIDTH(250)" Order="0030"/><Filter DataSource="AT030.TXKANA" FieldOptions="SCAN,CAPTION(カナ名SCAN)" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="AT030.TXJYUSYO1" FieldOptions="WIDTH(300)" Order="0050"/><Column DataSource="AT030.FGTOKUISAKI" FieldOptions="CAPTION(得意先)" Order="0060"/><Column DataSource="AT030.FGSIIRESAKI" FieldOptions="CAPTION(仕入先)" Order="0070"/><Filter DataSource="AT030.KBTOKUISAKI" FieldOptions="PROMPT_LIST1,CAPTION(得意先)" Order="0020"/><Filter DataSource="AT030.KBSIIRESAKI" FieldOptions="PROMPT_LIST1,CAPTION(仕入先)" Order="0030"/></Function><Function DetailFunction="BF012" ID="BF010" InitialListing="T" InitialMsg="" KeyFields="" Name="品目マスターの一覧・保守" OrderBy="BT010.TXHINBAN" PrimaryTable="BT010" Size="AUTO" SubsystemID="B" Type="XF100"><Column DataSource="BT010.TXHINBAN" FieldOptions="" Order="0010"/><Column DataSource="BT010.TXHINMEI" FieldOptions="" Order="0020"/><Column DataSource="BT010.KBHINSYU" FieldOptions="" Order="0030"/><Filter DataSource="BT010.TXHINMEI" FieldOptions="SCAN,CAPTION(品名SCAN)" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(BF011)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0040"/><Column DataSource="BT010.FGKOUNYU" FieldOptions="CAPTION(購入)" Order="0060"/><Column DataSource="BT010.FGHANBAI" FieldOptions="CAPTION(販売)" Order="0070"/><Column DataSource="BT010.FGZAIKO" FieldOptions="CAPTION(在庫)" Order="0050"/><Filter DataSource="BT010.KBHINSYU" FieldOptions="PROMPT_LIST1" Order="0020"/><Filter DataSource="BT010.KBKOUNYU" FieldOptions="PROMPT_LIST1,CAPTION(購入)" Order="0040"/><Filter DataSource="BT010.KBHANBAI" FieldOptions="PROMPT_LIST1,CAPTION(販売)" Order="0050"/><Filter DataSource="BT010.KBZAIKO" FieldOptions="VERTICAL,PROMPT_LIST1,CAPTION(在庫)" Order="0030"/><Filter DataSource="BT010.KBSEIZO" FieldOptions="PROMPT_LIST1,CAPTION(製造)" Order="0070"/><Column DataSource="BT010.FGSEIZO" FieldOptions="CAPTION(製造)" Order="0090"/></Function><Function DetailFunction="" FixedWhere="FGZAIKO = 'T'" ID="BF100" InitialListing="T" InitialMsg="" KeyFields="" Name="在庫品検索" OrderBy="BT010.TXHINBAN" ParmType="COLUMNS" PrimaryTable="BT010" Size="AUTO" SubsystemID="B" Type="XF100"><Column DataSource="BT010.TXHINBAN" FieldOptions="" Order="0010"/><Column DataSource="BT010.TXHINMEI" FieldOptions="" Order="0020"/><Column DataSource="BT010.KBHINSYU" FieldOptions="" Order="0030"/><Filter DataSource="BT010.TXHINMEI" FieldOptions="SCAN,CAPTION(品名SCAN)" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="BT010.FGKOUNYU" FieldOptions="CAPTION(購入)" Order="0060"/><Column DataSource="BT010.FGHANBAI" FieldOptions="CAPTION(販売)" Order="0070"/><Filter DataSource="BT010.KBHINSYU" FieldOptions="PROMPT_LIST1" Order="0020"/><Filter DataSource="BT010.KBKOUNYU" FieldOptions="PROMPT_LIST1,CAPTION(購入)" Order="0040"/><Filter DataSource="BT010.KBHANBAI" FieldOptions="PROMPT_LIST1,CAPTION(販売)" Order="0050"/><Column DataSource="BT010.FGSEIZO" FieldOptions="CAPTION(製造)" Order="0080"/><Filter DataSource="BT010.KBSEIZO" FieldOptions="PROMPT_LIST1,CAPTION(製造)" Order="0060"/><Column DataSource="BT010.KBUNIT" FieldOptions="" Order="0050"/></Function><Function DetailFunction="MF012" ID="MF010" InitialListing="T" InitialMsg="" KeyFields="NRZAIHURI" Name="在庫振替データの一覧・保守" OrderBy="" PrimaryTable="MT010" Size="AUTO" SubsystemID="M" Type="XF100"><Column DataSource="MT010.NRZAIHURI" FieldOptions="" Order="0020"/><Column DataSource="MT010.CDSOUKO" FieldOptions="" Order="0050"/><Filter DataSource="MT010.CDSOUKO" FieldOptions="" Order="0020"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(MF011)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="MT010.DTHURIKAE" FieldOptions="" Order="0010"/><Column DataSource="MT010.PRHURIKAE" FieldOptions="" Order="0090"/><Column DataSource="MT010.QTHURIKAE" FieldOptions="" Order="0100"/><Column DataSource="AT040.TXSOUKO" FieldOptions="WIDTH(200)" Order="0060"/><Column DataSource="BT010.TXHINBAN" FieldOptions="" Order="0070"/><Column DataSource="BT010.TXHINMEI" FieldOptions="WIDTH(200)" Order="0080"/><Column DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0110"/><Filter DataSource="MT010.DTHURIKAE" FieldOptions="GE,CAPTION(振替日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Filter DataSource="BT010.TXHINBAN" FieldOptions="" Order="0030"/><Column DataSource="MT010.KBZAIHURI" FieldOptions="" Order="0040"/><Column DataSource="MT010.KBZOUGEN" FieldOptions="" Order="0030"/></Function><Function FunctionAfterInsert="MF012" ID="MF011" InitialMsg="" KeyFields="NRZAIHURI" Name="在庫振替の保守" PrimaryTable="MT010" Size="AUTO" SubsystemID="M" Type="XF200"><Field DataSource="MT010.NRZAIHURI" FieldOptions="" Order="0010"/><Field DataSource="MT010.PRHURIKAE" FieldOptions="" Order="0080"/><Field DataSource="MT010.QTHURIKAE" FieldOptions="HORIZONTAL" Order="0090"/><Field DataSource="MT010.TXTEKIYO" FieldOptions="" Order="0110"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="MT010.DTHURIKAE" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0020"/><Field DataSource="AT040.TXSOUKO" FieldOptions="CAPTION(倉庫),PROMPT_LIST" Order="0050"/><Field DataSource="BT010.TXHINBAN" FieldOptions="PROMPT_CALL(BF100),PROMPT_CALL_TO_GET(BT010.IDHINMOKU;BT010.TXHINBAN;BT010.TXHINMEI;BT010.KBUNIT),PROMPT_CALL_TO_GET_TO(MT010.IDHINMOKU;BT010.TXHINBAN;BT010.TXHINMEI;BT010.KBUNIT)" Order="0060"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0070"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0100"/><Field DataSource="MT010.KBZOUGEN" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0030"/><Field DataSource="MT010.KBZAIHURI" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0040"/></Function><Function HeaderFunction="MF011" HeaderKeyFields="" HeaderTable="MT010" ID="MF012" Name="在庫振替の検討" Size="AUTO" SubsystemID="M" Type="XF300"><Detail Caption="在庫増減履歴" DetailFunction="FF101" HeaderKeyFields="NRSOURCE" InitialListing="T" InitialMsg="" KeyFields="NRSOURCE;NRZAITORI" Order="0010" Table="FT100"><Column DataSource="FT100.NRZAITORI" FieldOptions="" Order="0020"/><Column DataSource="FT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="FT100.KBUKEBARAI" FieldOptions="" Order="0050"/><Column DataSource="FT100.KBAKADEN" FieldOptions="" Order="0030"/><Column DataSource="FT100.FGVALID" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="振替情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="FT100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0080"/><Column DataSource="FT100.PRTORIHIKI" FieldOptions="" Order="0060"/><Column DataSource="FT100.QTTORIHIKI" FieldOptions="" Order="0070"/><Column DataSource="FT100.AMTORIHIKI" FieldOptions="" Order="0090"/></Detail><Field DataSource="MT010.NRZAIHURI" FieldOptions="" Order="0010"/><Field DataSource="MT010.CDSOUKO" FieldOptions="" Order="0060"/><Field DataSource="MT010.PRHURIKAE" FieldOptions="" Order="0100"/><Field DataSource="MT010.QTHURIKAE" FieldOptions="HORIZONTAL" Order="0110"/><Field DataSource="MT010.TXTEKIYO" FieldOptions="" Order="0130"/><Field DataSource="MT010.DTHURIKAE" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0020"/><Field DataSource="AT040.TXSOUKO" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0070"/><Field DataSource="BT010.TXHINBAN" FieldOptions="" Order="0080"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0090"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0120"/><Field DataSource="MT010.KBZOUGEN" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0030"/><Field DataSource="MT010.KBZAIHURI" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0050"/></Function><Function ID="MF990" Name="一般在庫取引パージ処理" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rMT010; var dMT010;#EOL#var rMT020; var dMT020; var rMT021; var dMT021;#EOL#var rMT030; var dMT030; var rMT031; var dMT031;#EOL#var limitDate = instance.parmMap.get('LIMIT_DATE');#EOL#var countMT010_ToBeDeleted = 0; var countMT010_Deleted = 0;#EOL#var countMT020_ToBeDeleted = 0; var countMT020_Deleted = 0;#EOL#var countMT021_ToBeDeleted = 0; var countMT021_Deleted = 0;#EOL#var countMT030_ToBeDeleted = 0; var countMT030_Deleted = 0;#EOL#var countMT031_ToBeDeleted = 0; var countMT031_Deleted = 0;#EOL#var count = 0;#EOL##EOL#//////////////////////////#EOL#// 削除結果省略値の登録 //#EOL#//////////////////////////#EOL#instance.returnMap.put('MT010_COUNT', -1);#EOL#instance.returnMap.put('MT020_COUNT', -1);#EOL#instance.returnMap.put('MT021_COUNT', -1);#EOL#instance.returnMap.put('MT030_COUNT', -1);#EOL#instance.returnMap.put('MT031_COUNT', -1);#EOL##EOL#////////////////////#EOL#// MT010 削除処理 //#EOL#////////////////////#EOL#rMT010 = instance.createTableOperator('Count', 'MT010');#EOL#rMT010.addKeyValue('DTHURIKAE &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#countMT010_ToBeDeleted = rMT010.execute();#EOL#dMT010 = instance.createTableOperator('Delete', 'MT010');#EOL#dMT010.addKeyValue('DTHURIKAE &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#countMT010_Deleted = dMT010.execute();#EOL##EOL#//////////////////////////////#EOL#// MT020 削除対象件数の検索 //#EOL#//////////////////////////////#EOL#rMT020 = instance.createTableOperator('Select', 'MT020');#EOL#rMT020.setSelectFields('NRTANAOROSI, DTKAKUTEI');#EOL#rMT020.addKeyValue('DTKIJYUN &lt;=',&#x9;'\'' + limitDate + ' 23:59:59.999\'');#EOL#while (rMT020.next()) {#EOL##EOL#&#x9;////////////////////////////#EOL#&#x9;// 完了分であれば削除対象 //#EOL#&#x9;////////////////////////////#EOL#&#x9;if (rMT020.getValueOf('DTKAKUTEI') != null &amp;&amp; rMT020.getValueOf('DTKAKUTEI') != '') {#EOL#&#x9;&#x9;countMT020_ToBeDeleted++;#EOL##EOL#&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;// MT021 削除処理 //#EOL#&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;rMT021 = instance.createTableOperator('Count', 'MT021');#EOL#&#x9;&#x9;rMT021.addKeyValue('NRTANAOROSI',rMT020.getValueOf('NRTANAOROSI'));#EOL#&#x9;&#x9;count = rMT021.execute();#EOL#&#x9;&#x9;countMT021_ToBeDeleted = Number(countMT021_ToBeDeleted) + Number(count);#EOL#&#x9;&#x9;dMT021 = instance.createTableOperator('Delete', 'MT021');#EOL#&#x9;&#x9;dMT021.addKeyValue('NRTANAOROSI',rMT010.getValueOf('NRTANAOROSI'));#EOL#&#x9;&#x9;count = dMT021.execute();#EOL#&#x9;&#x9;countMT021_Deleted = Number(countMT021_Deleted) + Number(count);#EOL##EOL#&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;// MT020 削除処理 //#EOL#&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;dMT020 = instance.createTableOperator('Delete', 'MT020');#EOL#&#x9;&#x9;dMT020.addKeyValue('NRTANAOROSI',rMT020.getValueOf('NRTANAOROSI'));#EOL#&#x9;&#x9;count = dMT020.execute();#EOL#&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;countMT020_Deleted++;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#//////////////////////////////#EOL#// MT030 削除対象件数の検索 //#EOL#//////////////////////////////#EOL#rMT030 = instance.createTableOperator('Select', 'MT030');#EOL#rMT030.setSelectFields('NRZAIIDOU, DTKANRYO');#EOL#rMT030.addKeyValue('DTSHIJI &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#while (rMT030.next()) {#EOL##EOL#&#x9;////////////////////////////#EOL#&#x9;// 完了分であれば削除対象 //#EOL#&#x9;////////////////////////////#EOL#&#x9;if (rMT030.getValueOf('DTKANRYO') != null &amp;&amp; rMT030.getValueOf('DTKANRYO') != '') {#EOL#&#x9;&#x9;countMT030_ToBeDeleted++;#EOL##EOL#&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;// MT031 削除処理 //#EOL#&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;rMT031 = instance.createTableOperator('Count', 'MT031');#EOL#&#x9;&#x9;rMT031.addKeyValue('NRZAIIDOU',&#x9;rMT030.getValueOf('NRZAIIDOU'));#EOL#&#x9;&#x9;count = rMT031.execute();#EOL#&#x9;&#x9;countMT031_ToBeDeleted = Number(countMT031_ToBeDeleted) + Number(count);#EOL#&#x9;&#x9;dMT031 = instance.createTableOperator('Delete', 'MT031');#EOL#&#x9;&#x9;dMT031.addKeyValue('NRZAIKOIDOU',&#x9;rMT030.getValueOf('NRZAIKOIDOU'));#EOL#&#x9;&#x9;count = dMT031.execute();#EOL#&#x9;&#x9;countMT031_Deleted = Number(countMT031_Deleted) + Number(count);#EOL##EOL#&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;// MT030 削除処理 //#EOL#&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;dMT030 = instance.createTableOperator('Delete', 'MT030');#EOL#&#x9;&#x9;dMT030.addKeyValue('NRZAIIDOU',&#x9;rMT030.getValueOf('NRZAIIDOU'));#EOL#&#x9;&#x9;count = dMT030.execute();#EOL#&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;countMT030_Deleted++;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////#EOL#// 削除結果の登録 //#EOL#////////////////////#EOL#if (countMT010_Deleted == countMT010_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('MT010_COUNT', countMT010_ToBeDeleted);#EOL#}#EOL#if (countMT020_Deleted == countMT020_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('MT020_COUNT', countMT020_ToBeDeleted);#EOL#}#EOL#if (countMT021_Deleted == countMT021_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('MT021_COUNT', countMT021_ToBeDeleted);#EOL#}#EOL#if (countMT030_Deleted == countMT030_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('MT030_COUNT', countMT030_ToBeDeleted);#EOL#}#EOL#if (countMT031_Deleted == countMT031_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('MT031_COUNT', countMT031_ToBeDeleted);#EOL#}" SubsystemID="M" Type="XF000"/><Function ID="LF990" Name="一般売上取引パージ処理" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rLT010; var dLT010; var rLT020; var dLT020;#EOL#var limitDate = instance.parmMap.get('LIMIT_DATE');#EOL#var countLT010_ToBeDeleted = 0; var countLT010_Deleted = 0;#EOL#var countLT020_ToBeDeleted = 0; var countLT020_Deleted = 0;#EOL##EOL#//////////////////////////#EOL#// 削除結果の省略値登録 //#EOL#//////////////////////////#EOL#instance.returnMap.put('LT010_COUNT', -1);#EOL#instance.returnMap.put('LT020_COUNT', -1);#EOL##EOL#////////////////////#EOL#// LT010 削除処理 //#EOL#////////////////////#EOL#rLT010 = instance.createTableOperator('Count', 'LT010');#EOL#rLT010.addKeyValue('DTHURIKAE &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#countLT010_ToBeDeleted = rLT010.execute();#EOL#dLT010 = instance.createTableOperator('Delete', 'LT010');#EOL#dLT010.addKeyValue('DTHURIKAE &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#countLT010_Deleted = dLT010.execute();#EOL#if (countLT010_Deleted == countLT010_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('LT010_COUNT', countLT010_ToBeDeleted);#EOL#}#EOL##EOL#////////////////////#EOL#// LT020 削除処理 //#EOL#////////////////////#EOL#rLT020 = instance.createTableOperator('Count', 'LT020');#EOL#rLT020.addKeyValue('DTTORIHIKI &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#countLT020_ToBeDeleted = rLT020.execute();#EOL#dLT020 = instance.createTableOperator('Delete', 'LT020');#EOL#dLT020.addKeyValue('DTTORIHIKI &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#countLT020_Deleted = dLT020.execute();#EOL#if (countLT020_Deleted == countLT020_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('LT020_COUNT', countLT020_ToBeDeleted);#EOL#}" SubsystemID="L" Type="XF000"/><Function DetailFunction="KF023" ID="KF020" InitialListing="T" InitialMsg="" KeyFields="NRTOKUSIIRE" Name="特殊仕入データの一覧・保守" OrderBy="" PrimaryTable="KT020" Size="AUTO" SubsystemID="K" Type="XF100"><Column DataSource="KT020.NRTOKUSIIRE" FieldOptions="" Order="0020"/><Column DataSource="KT020.KBTOKUSIIRE" FieldOptions="" Order="0030"/><Column DataSource="KT020.DTTORIHIKI" FieldOptions="" Order="0010"/><Filter DataSource="KT020.KBTOKUSIIRE" FieldOptions="PROMPT_LIST1" Order="0020"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(KF021)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="KT020.QTTORIHIKI" FieldOptions="" Order="0080"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(仕入先),WIDTH(200)" Order="0040"/><Column DataSource="BT010.TXHINBAN" FieldOptions="" Order="0050"/><Column DataSource="BT010.TXHINMEI" FieldOptions="WIDTH(200)" Order="0060"/><Column DataSource="BT010.KBUNITPUR" FieldOptions="CAPTION(U/M)" Order="0090"/><Filter DataSource="KT020.DTTORIHIKI" FieldOptions="GE,CAPTION(取引日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Filter DataSource="AT030.CDTORIHIKISAKI" FieldOptions="" Order="0030"/></Function><Function FunctionAfterInsert="KF023" ID="KF021" InitialMsg="" KeyFields="NRTOKUSIIRE" Name="特殊仕入データの保守" PrimaryTable="KT020" Size="AUTO" SubsystemID="K" Type="XF200"><Field DataSource="KT020.NRTOKUSIIRE" FieldOptions="" Order="0010"/><Field DataSource="KT020.KBTOKUSIIRE" FieldOptions="" Order="0070"/><Field DataSource="KT020.DTTORIHIKI" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="KT020.PRTORIHIKI" FieldOptions="" Order="0090"/><Field DataSource="KT020.QTTORIHIKI" FieldOptions="HORIZONTAL" Order="0100"/><Field DataSource="KT020.TXTEKIYO" FieldOptions="" Order="0180"/><Field DataSource="KT020.AMTORIHIKI" FieldOptions="" Order="0120"/><Field DataSource="KT020.AMTAX" FieldOptions="HORIZONTAL" Order="0130"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="KT020.PRZAIKO" FieldOptions="" Order="0140"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C),PROMPT_CALL(DF800),PROMPT_CALL_TO_GET(DT010.IDSIIRESAKI;AT030.CDTORIHIKISAKI;AT030.TXKANJI),PROMPT_CALL_TO_GET_TO(KT020.IDSIIRESAKI;AT030.CDTORIHIKISAKI;AT030.TXKANJI)" Order="0030"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Field DataSource="BT010.TXHINBAN" FieldOptions="PROMPT_CALL(BF110),PROMPT_CALL_TO_GET(BT010.IDHINMOKU;BT010.TXHINBAN;BT010.TXHINMEI;BT010.KBUNITPUR;BT010.KBUNIT),PROMPT_CALL_TO_GET_TO(KT020.IDHINMOKU;BT010.TXHINBAN;BT010.TXHINMEI;BT010.KBUNITPUR;BT010.KBUNIT)" Order="0050"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0060"/><Field DataSource="BT010.KBUNITPUR" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0110"/><Field DataSource="AT040.TXSOUKO" FieldOptions="CAPTION(取引倉庫),HORIZONTAL,PROMPT_LIST" Order="0080"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0170"/><Field DataSource="KT020.QTZAIKO" FieldOptions="HORIZONTAL" Order="0160"/></Function><Function HeaderFunction="KF021" HeaderKeyFields="" HeaderTable="KT020" ID="KF023" Name="特殊仕入と関連情報の確認" Size="AUTO" SubsystemID="K" Type="XF300"><Detail Caption="買掛増減履歴" DetailFunction="DF101" HeaderKeyFields="NRSOURCE" InitialListing="T" InitialMsg="" KeyFields="NRSOURCE;NRKAIKAKE" Order="0010" Table="DT100"><Column DataSource="DT100.NRKAIKAKE" FieldOptions="" Order="0020"/><Column DataSource="DT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="DT100.KBAKADEN" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="仕入情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="DT100.FGVALID" FieldOptions="" Order="0040"/><Column DataSource="DT100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0080"/><Column DataSource="DT100.PRTORIHIKI" FieldOptions="" Order="0060"/><Column DataSource="DT100.QTTORIHIKI" FieldOptions="" Order="0070"/><Column DataSource="DT100.AMTORIHIKI" FieldOptions="" Order="0090"/><Column DataSource="DT100.AMTAX" FieldOptions="" Order="0100"/><Button Action="CALL(KF022)" Caption="通知書" Number="10" Position="5"/></Detail><Detail Caption="在庫増減履歴" DetailFunction="FF101" HeaderKeyFields="NRSOURCE" InitialMsg="" KeyFields="NRSOURCE;NRZAITORI" Order="0020" Table="FT100"><Column DataSource="FT100.NRZAITORI" FieldOptions="" Order="0020"/><Column DataSource="FT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="FT100.KBUKEBARAI" FieldOptions="" Order="0050"/><Column DataSource="FT100.KBAKADEN" FieldOptions="" Order="0030"/><Column DataSource="FT100.FGVALID" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="仕入情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="FT100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0110"/><Column DataSource="FT100.PRTORIHIKI" FieldOptions="" Order="0090"/><Column DataSource="FT100.QTTORIHIKI" FieldOptions="" Order="0100"/><Column DataSource="FT100.AMTORIHIKI" FieldOptions="" Order="0120"/><Button Action="CALL(KF022)" Caption="通知書" Number="10" Position="5"/></Detail><Field DataSource="KT020.NRTOKUSIIRE" FieldOptions="" Order="0010"/><Field DataSource="KT020.KBTOKUSIIRE" FieldOptions="" Order="0070"/><Field DataSource="KT020.DTTORIHIKI" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="KT020.PRTORIHIKI" FieldOptions="" Order="0090"/><Field DataSource="KT020.QTTORIHIKI" FieldOptions="HORIZONTAL" Order="0100"/><Field DataSource="KT020.TXTEKIYO" FieldOptions="" Order="0180"/><Field DataSource="KT020.AMTORIHIKI" FieldOptions="" Order="0120"/><Field DataSource="KT020.AMTAX" FieldOptions="HORIZONTAL" Order="0130"/><Field DataSource="KT020.PRZAIKO" FieldOptions="" Order="0140"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C)" Order="0030"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Field DataSource="BT010.TXHINBAN" FieldOptions="" Order="0050"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0060"/><Field DataSource="BT010.KBUNITPUR" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0110"/><Field DataSource="AT040.TXSOUKO" FieldOptions="CAPTION(取引倉庫),HORIZONTAL" Order="0080"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0170"/><Field DataSource="KT020.QTZAIKO" FieldOptions="HORIZONTAL" Order="0160"/></Function><Function ID="KF990" Name="一般仕入取引パージ処理" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rKT010; var dKT010; var rKT020; var dKT020;#EOL#var limitDate = instance.parmMap.get('LIMIT_DATE');#EOL#var countKT010_ToBeDeleted = 0; var countKT010_Deleted = 0;#EOL#var countKT020_ToBeDeleted = 0; var countKT020_Deleted = 0;#EOL##EOL#//////////////////////////#EOL#// 削除結果の省略値登録 //#EOL#//////////////////////////#EOL#instance.returnMap.put('KT010_COUNT', -1);#EOL#instance.returnMap.put('KT020_COUNT', -1);#EOL##EOL#////////////////////#EOL#// KT010 削除処理 //#EOL#////////////////////#EOL#rKT010 = instance.createTableOperator('Count', 'KT010');#EOL#rKT010.addKeyValue('DTHURIKAE &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#countKT010_ToBeDeleted = rKT010.execute();#EOL#dKT010 = instance.createTableOperator('Delete', 'KT010');#EOL#dKT010.addKeyValue('DTHURIKAE &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#countKT010_Deleted = dKT010.execute();#EOL#if (countKT010_Deleted == countKT010_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('KT010_COUNT', countKT010_ToBeDeleted);#EOL#}#EOL##EOL#////////////////////#EOL#// KT020 削除処理 //#EOL#////////////////////#EOL#rKT020 = instance.createTableOperator('Count', 'KT020');#EOL#rKT020.addKeyValue('DTTORIHIKI &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#countKT020_ToBeDeleted = rKT020.execute();#EOL#dKT020 = instance.createTableOperator('Delete', 'KT020');#EOL#dKT020.addKeyValue('DTTORIHIKI &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#countKT020_Deleted = dKT020.execute();#EOL#if (countKT020_Deleted == countKT020_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('KT020_COUNT', countKT020_ToBeDeleted);#EOL#}" SubsystemID="K" Type="XF000"/><Function DetailFunction="FF011" ID="FF010" InitialListing="T" InitialMsg="" KeyFields="" Name="倉庫在庫の検索・一覧" OrderBy="" PrimaryTable="FT010" Size="AUTO" SubsystemID="F" Type="XF100"><Column DataSource="FT010.CDSOUKO" FieldOptions="" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(FF012)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="FT010.QTGENZAIKO" FieldOptions="" Order="0050"/><Column DataSource="BT010.TXHINBAN" FieldOptions="" Order="0030"/><Column DataSource="BT010.TXHINMEI" FieldOptions="" Order="0040"/><Column DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0060"/><Column DataSource="AT040.TXSOUKO" FieldOptions="" Order="0020"/><Filter DataSource="BT010.TXHINMEI" FieldOptions="SCAN,CAPTION(品名SCAN)" Order="0030"/><Filter DataSource="AT040.TXSOUKO" FieldOptions="PROMPT_LIST0" Order="0020"/></Function><Function HeaderFunction="FF012" HeaderKeyFields="" HeaderTable="FT010" ID="FF011" Name="倉庫在庫と関連情報の確認" Size="AUTO" SubsystemID="F" Type="XF300"><Field DataSource="FT010.CDSOUKO" FieldOptions="" Order="0010"/><Field DataSource="FT010.AMKISYU" FieldOptions="" Order="0100"/><Field DataSource="FT010.AMSYUKKO" FieldOptions="HORIZONTAL" Order="0120"/><Field DataSource="FT010.AMNYUKO" FieldOptions="HORIZONTAL" Order="0110"/><Field DataSource="FT010.QTKISYU" FieldOptions="" Order="0060"/><Field DataSource="FT010.QTSYUKKO" FieldOptions="HORIZONTAL" Order="0080"/><Detail Caption="在庫増減履歴" DetailFunction="FF101" HeaderKeyFields="IDHINMOKU;CDSOUKO" InitialListing="T" InitialMsg="" KeyFields="IDHINMOKU;CDSOUKO;NRZAITORI" Order="0010" Table="FT100"><Column DataSource="FT100.NRZAITORI" FieldOptions="" Order="0020"/><Column DataSource="FT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="FT100.KBUKEBARAI" FieldOptions="" Order="0050"/><Column DataSource="FT100.KBAKADEN" FieldOptions="" Order="0030"/><Column DataSource="FT100.FGVALID" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="倉庫在庫" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="FT100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0100"/><Column DataSource="FT100.TXAITESAKI" FieldOptions="WIDTH(200)" Order="0060"/><Column DataSource="FT100.PRTORIHIKI" FieldOptions="" Order="0070"/><Filter DataSource="FT100.DTTORIHIKI" FieldOptions="GE,CAPTION(取引日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Filter DataSource="FT100.KBUKEBARAI" FieldOptions="PROMPT_LIST1" Order="0020"/><Filter DataSource="FT100.FGVALID" FieldOptions="PROMPT_LIST1" Order="0030"/><Column DataSource="FT100.QTZOUGEN" FieldOptions="" Order="0090"/><Column DataSource="FT100.AMZOUGEN" FieldOptions="" Order="0110"/></Detail><Field DataSource="FT010.QTNYUKO" FieldOptions="HORIZONTAL" Order="0070"/><Field DataSource="FT010.AMGENZAIKO" FieldOptions="HORIZONTAL" Order="0130"/><Field DataSource="FT010.QTGENZAIKO" FieldOptions="HORIZONTAL" Order="0090"/><Field DataSource="BT010.TXHINBAN" FieldOptions="" Order="0030"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Field DataSource="BT010.KBUNIT" FieldOptions="HORIZONTAL" Order="0050"/><Field DataSource="AT040.TXSOUKO" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/></Function><Function ID="FF012" InitialMsg="" KeyFields="" Name="倉庫在庫の保守" PrimaryTable="FT010" Size="AUTO" SubsystemID="F" Type="XF200"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="FT010.CDSOUKO" FieldOptions="" Order="0010"/><Field DataSource="FT010.AMKISYU" FieldOptions="" Order="0060"/><Field DataSource="FT010.AMSYUKKO" FieldOptions="HORIZONTAL" Order="0080"/><Field DataSource="FT010.AMNYUKO" FieldOptions="HORIZONTAL" Order="0070"/><Field DataSource="FT010.QTKISYU" FieldOptions="" Order="0100"/><Field DataSource="FT010.QTSYUKKO" FieldOptions="HORIZONTAL" Order="0120"/><Field DataSource="FT010.QTNYUKO" FieldOptions="HORIZONTAL" Order="0110"/><Field DataSource="FT010.AMGENZAIKO" FieldOptions="HORIZONTAL" Order="0090"/><Field DataSource="FT010.QTGENZAIKO" FieldOptions="HORIZONTAL" Order="0130"/><Field DataSource="BT010.TXHINBAN" FieldOptions="PROMPT_CALL(BF100),PROMPT_CALL_TO_GET(BT010.IDHINMOKU;BT010.TXHINBAN;BT010.TXHINMEI;BT010.KBUNIT),PROMPT_CALL_TO_GET_TO(FT010.IDHINMOKU;BT010.TXHINBAN;BT010.TXHINMEI;BT010.KBUNIT)" Order="0030"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Field DataSource="BT010.KBUNIT" FieldOptions="HORIZONTAL" Order="0050"/><Field DataSource="AT040.TXSOUKO" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/></Function><Function DetailFunction="FF101" ID="FF100" InitialListing="T" InitialMsg="" KeyFields="" Name="在庫増減履歴の一覧" OrderBy="" PrimaryTable="FT100" Size="AUTO" SubsystemID="F" Type="XF100"><Column DataSource="FT100.NRZAITORI" FieldOptions="" Order="0020"/><Column DataSource="FT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="FT100.KBUKEBARAI" FieldOptions="" Order="0050"/><Column DataSource="FT100.KBAKADEN" FieldOptions="" Order="0030"/><Column DataSource="FT100.FGVALID" FieldOptions="" Order="0040"/><Filter DataSource="FT100.DTTORIHIKI" FieldOptions="GE,CAPTION(取引日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Filter DataSource="FT100.KBUKEBARAI" FieldOptions="PROMPT_CALL(FF800),PROMPT_CALL_TO_PUT(FT100.KBUKEBARAI),PROMPT_CALL_TO_PUT_TO(FT100.KBUKEBARAI),PROMPT_CALL_TO_GET(FT100.KBUKEBARAI),PROMPT_CALL_TO_GET_TO(FT100.KBUKEBARAI)" Order="0020"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Filter DataSource="FT100.FGVALID" FieldOptions="PROMPT_LIST1,VALUE(VALUE:T)" Order="0050"/><Filter DataSource="FT100.TXHINMEI" FieldOptions="SCAN,CAPTION(品名SCAN)" Order="0040"/><Filter DataSource="FT100.CDSOUKO" FieldOptions="" Order="0030"/><Column DataSource="FT100.TXHINBAN" FieldOptions="" Order="0070"/><Column DataSource="FT100.TXHINMEI" FieldOptions="WIDTH(200)" Order="0080"/><Column DataSource="FT100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0110"/><Column DataSource="FT100.CDSOUKO" FieldOptions="" Order="0060"/><Column DataSource="FT100.TXAITESAKI" FieldOptions="WIDTH(200)" Order="0090"/><Column DataSource="FT100.QTZOUGEN" FieldOptions="" Order="0100"/><Column DataSource="FT100.AMZOUGEN" FieldOptions="" Order="0120"/></Function><Function ID="FF101" InitialMsg="" KeyFields="" Name="在庫増減履歴の表示" PrimaryTable="FT100" Size="AUTO" SubsystemID="F" Type="XF200"><Field DataSource="FT100.NRZAITORI" FieldOptions="" Order="0010"/><Field DataSource="FT100.DTTORIHIKI" FieldOptions="" Order="0060"/><Field DataSource="FT100.KBUKEBARAI" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0040"/><Field DataSource="FT100.KBAKADEN" FieldOptions="CAPTION(伝票区分),CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0020"/><Field DataSource="FT100.FGVALID" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0030"/><Field DataSource="FT100.CDSOUKO" FieldOptions="" Order="0090"/><Field DataSource="FT100.TXAITESAKI" FieldOptions="CAPTION(相手先),CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0110"/><Field DataSource="FT100.PRTORIHIKI" FieldOptions="" Order="0150"/><Field DataSource="FT100.QTTORIHIKI" FieldOptions="HORIZONTAL" Order="0160"/><Field DataSource="FT100.AMSAGAKU" FieldOptions="HORIZONTAL" Order="0180"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(FF102)" Caption="元取引" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="FT100.TXHINBAN" FieldOptions="" Order="0120"/><Field DataSource="FT100.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0130"/><Field DataSource="FT100.KBUNIT" FieldOptions="HORIZONTAL" Order="0140"/><Field DataSource="FT100.AMTORIHIKI" FieldOptions="HORIZONTAL" Order="0170"/><Field DataSource="FT100.DTCREATE" FieldOptions="HORIZONTAL" Order="0200"/><Field DataSource="FT100.TXREFNO" FieldOptions="" Order="0190"/><Field DataSource="FT100.DTNEND" FieldOptions="CAPTION(取引月度),HORIZONTAL" Order="0070"/><Field DataSource="FT100.DTMSEQ" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0080"/><Field DataSource="AT040.TXSOUKO" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0100"/><Field DataSource="FT100.KBZAIHURI" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0050"/></Function><Function ID="FF102" Name="在庫取引情報表示切替処理" Script="///////////////////////////////////////#EOL#// 当該在庫増減履歴(FT100)の読み込み //#EOL#///////////////////////////////////////#EOL#var rFT100 = instance.createTableOperator('Select', 'FT100');#EOL#rFT100.setSelectFields('KBUKEBARAI, NRSOURCE');#EOL#rFT100.addKeyValue('NRZAITORI',&#x9;instance.parmMap.get('NRZAITORI'));#EOL#if (rFT100.next()) {#EOL##EOL#&#x9;////////////////////////////////////#EOL#&#x9;// 030(仕入入庫) : HT011 発注明細 //#EOL#&#x9;////////////////////////////////////#EOL#&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '030') {#EOL#&#x9;&#x9;var rHT011 = instance.createTableOperator('Select', 'HT011');#EOL#&#x9;&#x9;rHT011.setSelectFields('NRHATTYU, SQHATTYU');#EOL#&#x9;&#x9;rHT011.addKeyValue('NRSOURCE',&#x9;rFT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rHT011.next()) {#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('NRHATTYU',&#x9;rHT011.getValueOf('NRHATTYU'));#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('SQHATTYU',&#x9;rHT011.getValueOf('SQHATTYU'));#EOL#&#x9;&#x9;&#x9;instance.callFunction('HF026');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;showMessage('取引の元情報が存在しません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////#EOL#&#x9;// 060(完成入庫),130(販売出庫),160(材料出庫) : JT010 製造指示 //#EOL#&#x9;////////////////////////////////////////////////////////////////#EOL#&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '060'#EOL#&#x9;&#x9; || rFT100.getValueOf('KBUKEBARAI') == '130'#EOL#&#x9;&#x9; || rFT100.getValueOf('KBUKEBARAI') == '160') {#EOL#&#x9;&#x9;var rJT010 = instance.createTableOperator('Select', 'JT010');#EOL#&#x9;&#x9;rJT010.setSelectFields('NRSEIZO');#EOL#&#x9;&#x9;rJT010.addKeyValue('NRSOURCE',&#x9;rFT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rJT010.next()) {#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('NRSEIZO',&#x9;rJT010.getValueOf('NRSEIZO'));#EOL#&#x9;&#x9;&#x9;instance.callFunction('JF012');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;showMessage('取引の元情報が存在しません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////////////////////////////////////////#EOL#&#x9;// 020(振替入庫),120(振替出庫) : MT010 在庫振替     //#EOL#&#x9;// 120(振替出庫) : JT010 製造指示(出荷時の製品廃棄) //#EOL#&#x9;//////////////////////////////////////////////////////#EOL#&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '020'#EOL#&#x9;&#x9; || rFT100.getValueOf('KBUKEBARAI') == '120') {#EOL#&#x9;&#x9;var rMT010 = instance.createTableOperator('Select', 'MT010');#EOL#&#x9;&#x9;rMT010.setSelectFields('NRZAIHURI');#EOL#&#x9;&#x9;rMT010.addKeyValue('NRSOURCE',&#x9;rFT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rMT010.next()) {#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('NRZAIHURI',&#x9;rMT010.getValueOf('NRZAIHURI'));#EOL#&#x9;&#x9;&#x9;instance.callFunction('MF012');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;var rJT010 = instance.createTableOperator('Select', 'JT010');#EOL#&#x9;&#x9;&#x9;rJT010.setSelectFields('NRSEIZO');#EOL#&#x9;&#x9;&#x9;rJT010.addKeyValue('NRSOURCE',&#x9;rFT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;&#x9;if (rJT010.next()) {#EOL#&#x9;&#x9;&#x9;&#x9;instance.parmMap.put('NRSEIZO',&#x9;rJT010.getValueOf('NRSEIZO'));#EOL#&#x9;&#x9;&#x9;&#x9;instance.callFunction('JF012');#EOL#&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;showMessage('取引の元情報が存在しません。');#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////#EOL#&#x9;// 040(直仕入入荷),140(仕入返品) : KT020 特殊仕入 //#EOL#&#x9;////////////////////////////////////////////////////#EOL#&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '040'#EOL#&#x9;&#x9; || rFT100.getValueOf('KBUKEBARAI') == '140') {#EOL#&#x9;&#x9;var rKT020 = instance.createTableOperator('Select', 'KT020');#EOL#&#x9;&#x9;rKT020.setSelectFields('NRTOKUSIIRE');#EOL#&#x9;&#x9;rKT020.addKeyValue('NRSOURCE',&#x9;rFT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rKT020.next()) {#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('NRTOKUSIIRE',&#x9;rKT020.getValueOf('NRTOKUSIIRE'));#EOL#&#x9;&#x9;&#x9;instance.callFunction('KF023');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;showMessage('取引の元情報が存在しません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////#EOL#&#x9;// 050(売上返品),150(直売上出荷) : LT020 特殊売上 //#EOL#&#x9;////////////////////////////////////////////////////#EOL#&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '050'#EOL#&#x9;&#x9; || rFT100.getValueOf('KBUKEBARAI') == '150') {#EOL#&#x9;&#x9;var rLT020 = instance.createTableOperator('Select', 'LT020');#EOL#&#x9;&#x9;rLT020.setSelectFields('NRTOKUURI');#EOL#&#x9;&#x9;rLT020.addKeyValue('NRSOURCE',&#x9;rFT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rLT020.next()) {#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('NRTOKUURI',&#x9;rLT020.getValueOf('NRTOKUURI'));#EOL#&#x9;&#x9;&#x9;instance.callFunction('LF023');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;showMessage('取引の元情報が存在しません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////////////////////////////////#EOL#&#x9;// 070(棚卸増),170(棚卸減) : MT020 棚卸指示 //#EOL#&#x9;//////////////////////////////////////////////#EOL#&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '070'#EOL#&#x9;&#x9; || rFT100.getValueOf('KBUKEBARAI') == '170') {#EOL#&#x9;&#x9;var rMT020 = instance.createTableOperator('Select', 'MT020');#EOL#&#x9;&#x9;rMT020.setSelectFields('NRTANAOROSI');#EOL#&#x9;&#x9;rMT020.addKeyValue('NRSOURCE',&#x9;rFT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rMT020.next()) {#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('NRTANAOROSI',&#x9;rMT020.getValueOf('NRTANAOROSI'));#EOL#&#x9;&#x9;&#x9;instance.callFunction('MF022');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;showMessage('取引の元情報が存在しません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////////////////////////////////////////#EOL#&#x9;// 010(移動入庫),110(移動出庫) : MT030 在庫移動指示 //#EOL#&#x9;//////////////////////////////////////////////////////#EOL#&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '010'#EOL#&#x9;&#x9; || rFT100.getValueOf('KBUKEBARAI') == '110') {#EOL#&#x9;&#x9;var rMT030 = instance.createTableOperator('Select', 'MT030');#EOL#&#x9;&#x9;rMT030.setSelectFields('NRZAIIDOU');#EOL#&#x9;&#x9;rMT030.addKeyValue('NRSOURCE',&#x9;rFT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rMT030.next()) {#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('NRZAIIDOU',&#x9;rMT030.getValueOf('NRZAIIDOU'));#EOL#&#x9;&#x9;&#x9;instance.callFunction('MF032');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;showMessage('取引の元情報が存在しません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL#" SubsystemID="F" Type="XF000"/><Function ID="FF900" Name="年次在庫残高繰越処理" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rFT010; var uFT010; var rFT100;#EOL#var amSyukkoCur010 = 0; var amNyukoCur010 = 0; var amSyukkoNew010 = 0; var amNyukoNew010 = 0;#EOL#var qtSyukkoCur010 = 0; var qtNyukoCur010 = 0; var qtSyukkoNew010 = 0; var qtNyukoNew010 = 0;#EOL#var amKisyuZaiko010 = 0; var qtKisyuZaiko010 = 0; var amUkebarai010 = 0; var qtUkebarai010 = 0;#EOL#var errorMessage = ''; var numberOfErrors = 0; var count = 0; var logMessage = '';#EOL##EOL#////////////////////////////////////#EOL#// 新旧の集計対象最過去年月の設定 //#EOL#////////////////////////////////////#EOL#var curNend = instance.parmMap.get('CUR_NEND');#EOL#var newNend = instance.parmMap.get('NEW_NEND');#EOL#var isCheckOnly = instance.parmMap.get('CHECK_ONLY');#EOL##EOL#///////////////////////////#EOL#// 倉庫在庫(FT010)の読取 //#EOL#///////////////////////////#EOL#rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#while (rFT010.next()) {#EOL##EOL#&#x9;/////////////////////////////////////////#EOL#&#x9;// 関連する売上実績(FT100)の読取と集計 //#EOL#&#x9;/////////////////////////////////////////#EOL#&#x9;summarizeZaiko();#EOL##EOL#&#x9;/////////////////////////////////////////#EOL#&#x9;// 合算チェックと倉庫在庫(FT010)の更新 //#EOL#&#x9;/////////////////////////////////////////#EOL#&#x9;validateFT010();#EOL#&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;break;#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////////////////#EOL#// エラー処理と診断結果の登録 //#EOL#////////////////////////////////#EOL#if (errorMessage == '') {#EOL#&#x9;instance.parmMap.put('NUMBER_OF_ERRORS_FF900', numberOfErrors);#EOL#} else {#EOL#&#x9;instance.returnMap.put('RETURN_MESSAGE', '＊処理は取り消されました。');#EOL#}#EOL##EOL#///////////////////////////////////////////////////////#EOL#// サブルーチン：関連する売上実績(FT100)の読取と集計 //#EOL#///////////////////////////////////////////////////////#EOL#function summarizeZaiko() {#EOL#&#x9;rFT100 = instance.createTableOperator('Select', 'FT100');#EOL#&#x9;rFT100.addKeyValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;rFT100.addKeyValue('DTNEND >=',&#x9;&#x9;curNend);#EOL#&#x9;rFT100.addKeyValue('IDHINMOKU',&#x9;&#x9;rFT010.getValueOf('IDHINMOKU'));#EOL#&#x9;rFT100.addKeyValue('CDSOUKO',&#x9;&#x9;rFT010.getValueOf('CDSOUKO'));#EOL#&#x9;while (rFT100.next()) {#EOL##EOL#&#x9;&#x9;////////////////////////////////////////////////////////////#EOL#&#x9;&#x9;// 受払区分が以下ならば、出庫合計数として加算：           //#EOL#&#x9;&#x9;// 110:移動出庫, 120:振替出庫, 130:売上出庫, 140:仕入返品 //#EOL#&#x9;&#x9;// 150:直売上出庫, 160:材料出庫, 170:棚卸減               //#EOL#&#x9;&#x9;////////////////////////////////////////////////////////////#EOL#&#x9;&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '110' || rFT100.getValueOf('KBUKEBARAI') == '120'#EOL#&#x9;&#x9; || rFT100.getValueOf('KBUKEBARAI') == '130' || rFT100.getValueOf('KBUKEBARAI') == '140'#EOL#&#x9;&#x9; || rFT100.getValueOf('KBUKEBARAI') == '150' || rFT100.getValueOf('KBUKEBARAI') == '160'#EOL#&#x9;&#x9; || rFT100.getValueOf('KBUKEBARAI') == '170') {#EOL#&#x9;&#x9;&#x9;if (rFT100.getValueOf('DTNEND') >= curNend) {#EOL#&#x9;&#x9;&#x9;&#x9;amSyukkoCur010 = Number(amSyukkoCur010) + Number(rFT100.getValueOf('AMTORIHIKI'));#EOL#&#x9;&#x9;&#x9;&#x9;qtSyukkoCur010 = Number(qtSyukkoCur010) + Number(rFT100.getValueOf('QTTORIHIKI'));#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;if (rFT100.getValueOf('DTNEND') == newNend) {#EOL#&#x9;&#x9;&#x9;&#x9;amSyukkoNew010 = Number(amSyukkoNew010) + Number(rFT100.getValueOf('AMTORIHIKI'));#EOL#&#x9;&#x9;&#x9;&#x9;qtSyukkoNew010 = Number(qtSyukkoNew010) + Number(rFT100.getValueOf('QTTORIHIKI'));#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;//////////////////////////////////////////////////////////////#EOL#&#x9;&#x9;// 受払区分が以下ならば、入庫合計数として加算：             //#EOL#&#x9;&#x9;// 010:移動入庫, 020:振替入庫, 030:仕入入庫, 040:直仕入入庫 //#EOL#&#x9;&#x9;// 050:売上返品, 060:完成入庫, 070:棚卸増                   //#EOL#&#x9;&#x9;//////////////////////////////////////////////////////////////#EOL#&#x9;&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '010' || rFT100.getValueOf('KBUKEBARAI') == '020'#EOL#&#x9;&#x9;|| rFT100.getValueOf('KBUKEBARAI') == '030' || rFT100.getValueOf('KBUKEBARAI') == '040'#EOL#&#x9;&#x9;|| rFT100.getValueOf('KBUKEBARAI') == '050' || rFT100.getValueOf('KBUKEBARAI') == '060'#EOL#&#x9;&#x9;|| rFT100.getValueOf('KBUKEBARAI') == '070') {#EOL#&#x9;&#x9;&#x9;if (rFT100.getValueOf('DTNEND') >= curNend) {#EOL#&#x9;&#x9;&#x9;&#x9;amNyukoCur010 = Number(amNyukoCur010) + Number(rFT100.getValueOf('AMTORIHIKI'));#EOL#&#x9;&#x9;&#x9;&#x9;qtNyukoCur010 = Number(qtNyukoCur010) + Number(rFT100.getValueOf('QTTORIHIKI'));#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;if (rFT100.getValueOf('DTNEND') == newNend) {#EOL#&#x9;&#x9;&#x9;&#x9;amNyukoNew010 = Number(amNyukoNew010) + Number(rFT100.getValueOf('AMTORIHIKI'));#EOL#&#x9;&#x9;&#x9;&#x9;qtNyukoNew010 = Number(qtNyukoNew010) + Number(rFT100.getValueOf('QTTORIHIKI'));#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;}#EOL#}#EOL##EOL#/////////////////////////////////////////////////////////////////////#EOL#// サブルーチン：合算チェックと商品・倉庫別在庫サマリ(FT010)の更新 //#EOL#/////////////////////////////////////////////////////////////////////#EOL#function validateFT010() {#EOL#&#x9;if (rFT010.getValueOf('AMNYUKO') == amNyukoCur010#EOL#&#x9; &amp;&amp; rFT010.getValueOf('AMSYUKKO') == amSyukkoCur010#EOL#&#x9; &amp;&amp; rFT010.getValueOf('QTNYUKO') == qtNyukoCur010#EOL#&#x9; &amp;&amp; rFT010.getValueOf('QTSYUKKO') == qtSyukkoCur010) {#EOL#&#x9;&#x9;if (isCheckOnly == 'false') {#EOL#&#x9;&#x9;&#x9;amKisyuZaiko010 = Number(rFT010.getValueOf('AMKISYU'))#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; + Number(amNyukoCur010) - Number(amNyukoNew010) - Number(amSyukkoCur010) + Number(amSyukkoNew010);#EOL#&#x9;&#x9;&#x9;qtKisyuZaiko010 = Number(rFT010.getValueOf('QTKISYU'))#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; + Number(qtNyukoCur010) - Number(qtNyukoNew010) - Number(qtSyukkoCur010) + Number(qtSyukkoNew010);#EOL#&#x9;&#x9;&#x9;uFT010 = instance.createTableOperator('Update', 'FT010');#EOL#&#x9;&#x9;&#x9;uFT010.addValue('AMKISYU',&#x9;&#x9;amKisyuZaiko010);#EOL#&#x9;&#x9;&#x9;uFT010.addValue('AMNYUKO',&#x9;&#x9;amNyukoNew010);#EOL#&#x9;&#x9;&#x9;uFT010.addValue('AMSYUKKO',&#x9;&#x9;amSyukkoNew010);#EOL#&#x9;&#x9;&#x9;uFT010.addValue('QTKISYU',&#x9;&#x9;qtKisyuZaiko010);#EOL#&#x9;&#x9;&#x9;uFT010.addValue('QTNYUKO',&#x9;&#x9;qtNyukoNew010);#EOL#&#x9;&#x9;&#x9;uFT010.addValue('QTSYUKKO',&#x9;&#x9;qtSyukkoNew010);#EOL#&#x9;&#x9;&#x9;uFT010.addValue('UPDCOUNTER',&#x9;Number(rFT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;uFT010.addKeyValue('IDHINMOKU',&#x9;&#x9;rFT010.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;uFT010.addKeyValue('CDSOUKO',&#x9;&#x9;rFT010.getValueOf('CDSOUKO'));#EOL#&#x9;&#x9;&#x9;uFT010.addKeyValue('UPDCOUNTER',&#x9;rFT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;count = uFT010.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '倉庫在庫(FT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;numberOfErrors++;#EOL#&#x9;&#x9;logMessage = '倉庫在庫(Key:' + rFT010.getValueOf('IDHINMOKU') + #EOL#&#x9;&#x9;&#x9;&#x9;&#x9;'-' + rFT010.getValueOf('CDSOUKO') +#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;')の入庫数(' + rFT010.getValueOf('QTNYUKO') +#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;'),出庫数(' + rFT010.getValueOf('QTSYUKKO') +#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;'),入庫額(' + rFT010.getValueOf('AMNYUKO') + #EOL#&#x9;&#x9;&#x9;&#x9;&#x9;'),出庫額(' + rFT010.getValueOf('AMSYUKKO') +#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;')が、在庫増減履歴を合算した' +#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;'入庫数(' + qtNyukoCur010 +#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;'),出庫数(' + qtSyukkoCur010 +#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;'),入庫額(' + amNyukoCur010 +#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;'),出庫額(' + amSyukkoCur010 +#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;')に一致しません。';#EOL#&#x9;&#x9;instance.setProcessLog(logMessage);#EOL#&#x9;}#EOL#&#x9;amSyukkoCur010 = 0; amNyukoCur010 = 0; amSyukkoNew010 = 0; amNyukoNew010 = 0;#EOL#&#x9;qtSyukkoCur010 = 0; qtNyukoCur010 = 0; qtSyukkoNew010 = 0; qtNyukoNew010 = 0;#EOL#}" SubsystemID="F" Type="XF000"/><Function ID="FF999" Name="在庫増減履歴パージ処理" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var limitDate = instance.parmMap.get('LIMIT_DATE');#EOL#var countToBeDeleted = 0; var countDeleted = 0; var isToBeDeleted = false;#EOL##EOL#//////////////////////////#EOL#// 削除結果の省略値登録 //#EOL#//////////////////////////#EOL#instance.returnMap.put('FT100_COUNT', -1);#EOL##EOL#//////////////////////////#EOL#// FT100 削除対象の検索 //#EOL#//////////////////////////#EOL#var rFT100 = instance.createTableOperator('Select', 'FT100');#EOL#rFT100.setSelectFields('NRZAITORI, KBUKEBARAI, NRSOURCE');#EOL#rFT100.addKeyValue('DTTORIHIKI &lt;=', '\'' + limitDate + '\'');#EOL#while (rFT100.next()) {#EOL##EOL#&#x9;//////////////////////////////#EOL#&#x9;// 削除対象フラグのリセット //#EOL#&#x9;//////////////////////////////#EOL#&#x9;isToBeDeleted = false;#EOL##EOL#&#x9;////////////////////////////////////#EOL#&#x9;// 030(仕入入庫) : HT011 発注明細 //#EOL#&#x9;////////////////////////////////////#EOL#&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '030') {#EOL#&#x9;&#x9;var rHT011 = instance.createTableOperator('Count', 'HT011');#EOL#&#x9;&#x9;rHT011.addKeyValue('NRSOURCE',&#x9;rFT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rHT011.execute() == 0) {#EOL#&#x9;&#x9;&#x9;isToBeDeleted = true;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////////////////#EOL#&#x9;// 060(完成入庫),130(販売出庫),160(材料出庫) : JT010 製造指示 //#EOL#&#x9;////////////////////////////////////////////////////////////////#EOL#&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '060'#EOL#&#x9;&#x9; || rFT100.getValueOf('KBUKEBARAI') == '130'#EOL#&#x9;&#x9; || rFT100.getValueOf('KBUKEBARAI') == '160') {#EOL#&#x9;&#x9;var rJT010 = instance.createTableOperator('Count', 'JT010');#EOL#&#x9;&#x9;rJT010.addKeyValue('NRSOURCE',&#x9;rFT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rJT010.execute() == 0) {#EOL#&#x9;&#x9;&#x9;isToBeDeleted = true;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////////////////////////////////////////#EOL#&#x9;// 020(振替入庫),120(振替出庫) : MT010 在庫振替     //#EOL#&#x9;// 120(振替出庫) : JT010 製造指示(出荷時の製品廃棄) //#EOL#&#x9;//////////////////////////////////////////////////////#EOL#&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '020'#EOL#&#x9;&#x9; || rFT100.getValueOf('KBUKEBARAI') == '120') {#EOL#&#x9;&#x9;var rMT010 = instance.createTableOperator('Count', 'MT010');#EOL#&#x9;&#x9;rMT010.addKeyValue('NRSOURCE',&#x9;rFT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rMT010.execute() == 0) {#EOL#&#x9;&#x9;&#x9;isToBeDeleted = true;#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;var rJT010 = instance.createTableOperator('Count', 'JT010');#EOL#&#x9;&#x9;rJT010.addKeyValue('NRSOURCE',&#x9;rFT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rJT010.execute() == 0) {#EOL#&#x9;&#x9;&#x9;isToBeDeleted = true;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////#EOL#&#x9;// 040(直仕入入荷),140(仕入返品) : KT020 特殊仕入 //#EOL#&#x9;////////////////////////////////////////////////////#EOL#&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '040'#EOL#&#x9;&#x9; || rFT100.getValueOf('KBUKEBARAI') == '140') {#EOL#&#x9;&#x9;var rKT020 = instance.createTableOperator('Count', 'KT020');#EOL#&#x9;&#x9;rKT020.addKeyValue('NRSOURCE',&#x9;rFT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rKT020.execute() == 0) {#EOL#&#x9;&#x9;&#x9;isToBeDeleted = true;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////////#EOL#&#x9;// 050(売上返品),150(直売上出荷) : LT020 特殊売上 //#EOL#&#x9;////////////////////////////////////////////////////#EOL#&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '050'#EOL#&#x9;&#x9; || rFT100.getValueOf('KBUKEBARAI') == '150') {#EOL#&#x9;&#x9;var rLT020 = instance.createTableOperator('Count', 'LT020');#EOL#&#x9;&#x9;rLT020.addKeyValue('NRSOURCE',&#x9;rFT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rLT020.execute() == 0) {#EOL#&#x9;&#x9;&#x9;isToBeDeleted = true;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////////////////////////////////#EOL#&#x9;// 070(棚卸増),170(棚卸減) : MT020 棚卸指示 //#EOL#&#x9;//////////////////////////////////////////////#EOL#&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '070'#EOL#&#x9;&#x9; || rFT100.getValueOf('KBUKEBARAI') == '170') {#EOL#&#x9;&#x9;var rMT020 = instance.createTableOperator('Count', 'MT020');#EOL#&#x9;&#x9;rMT020.addKeyValue('NRSOURCE',&#x9;rFT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rMT020.execute() == 0) {#EOL#&#x9;&#x9;&#x9;isToBeDeleted = true;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////////////////////////////////////////#EOL#&#x9;// 010(移動入庫),110(移動出庫) : MT030 在庫移動指示 //#EOL#&#x9;//////////////////////////////////////////////////////#EOL#&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '010'#EOL#&#x9;&#x9; || rFT100.getValueOf('KBUKEBARAI') == '110') {#EOL#&#x9;&#x9;var rMT030 = instance.createTableOperator('Count', 'MT030');#EOL#&#x9;&#x9;rMT030.addKeyValue('NRSOURCE',&#x9;rFT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rMT030.execute() == 0) {#EOL#&#x9;&#x9;&#x9;isToBeDeleted = true;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;//////////////#EOL#&#x9;// 削除処理 //#EOL#&#x9;//////////////#EOL#&#x9;if (isToBeDeleted) {#EOL#&#x9;&#x9;countToBeDeleted++;#EOL#&#x9;&#x9;var dFT100 = instance.createTableOperator('Delete', 'FT100');#EOL#&#x9;&#x9;dFT100.addKeyValue('NRZAITORI',&#x9;rFT100.getValueOf('NRZAITORI'));#EOL#&#x9;&#x9;if (dFT100.execute() == 1) {#EOL#&#x9;&#x9;&#x9;countDeleted++;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////#EOL#// 削除結果の登録 //#EOL#////////////////////#EOL#if (countToBeDeleted == countDeleted) {#EOL#&#x9;instance.returnMap.put('FT100_COUNT', countToBeDeleted);#EOL#}" SubsystemID="F" Type="XF000"/><Function DetailFunction="HF013" ID="HF010" InitialListing="T" InitialMsg="" KeyFields="" Name="発注データの一覧・保守" OrderBy="" PrimaryTable="HT010" Size="AUTO" SubsystemID="H" Type="XF100"><Column DataSource="HT010.NRHATTYU" FieldOptions="" Order="0030"/><Filter DataSource="HT010.NRHATTYU" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(HF011)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(仕入先名)" Order="0040"/><Column DataSource="HT010.STHATTYU" FieldOptions="" Order="0060"/><Column DataSource="AT040.TXSOUKO" FieldOptions="CAPTION(入荷予定倉庫)" Order="0050"/><Filter DataSource="AT030.TXKANJI" FieldOptions="SCAN,WIDTH(200),CAPTION(仕入先SCAN)" Order="0040"/><Filter DataSource="HT010.STHATTYU" FieldOptions="PROMPT_LIST1" Order="0050"/><Column DataSource="HT010.DTCREATE" FieldOptions="" Order="0020"/><Filter DataSource="HT010.DTCREATE" FieldOptions="GE,CAPTION(登録日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0020"/></Function><Function FunctionAfterInsert="HF016" ID="HF011" InitialMsg="" KeyFields="" Name="発注見出しの保守" PrimaryTable="HT010" Size="AUTO" SubsystemID="H" Type="XF200"><Field DataSource="HT010.NRHATTYU" FieldOptions="" Order="0010"/><Field DataSource="HT010.DTHATTYU" FieldOptions="HORIZONTAL" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="HT010.STHATTYU" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先Ｃ),PROMPT_CALL(DF800),PROMPT_CALL_TO_GET(DT010.IDSIIRESAKI;AT030.CDTORIHIKISAKI;AT030.TXKANJI),PROMPT_CALL_TO_GET_TO(HT010.IDSIIRESAKI;AT030.CDTORIHIKISAKI;AT030.TXKANJI)" Order="0040"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/><Field DataSource="AT040.TXSOUKO" FieldOptions="CAPTION(入荷予定倉庫),PROMPT_LIST" Order="0060"/><Field DataSource="HT010.TXTEKIYO" FieldOptions="WIDTH(865)" Order="0080"/><Field DataSource="HT010.DTNOUKI" FieldOptions="HORIZONTAL" Order="0070"/></Function><Function DetailKeyFields="NRHATTYU;SQHATTYU" DetailTable="HT011" HeaderKeyFields="NRHATTYU" HeaderTable="HT010" ID="HF012" Name="発注見出し／明細の保守" Size="AUTO" SubsystemID="H" Type="XF310"><Column DataSource="HT011.PRHATTYU" FieldOptions="" Order="0030"/><Column DataSource="HT011.QTHATTYU" FieldOptions="" Order="0040"/><Column DataSource="HT011.DTNOUKI" FieldOptions="" Order="0060"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="UPDATE" Caption="更新" Number="5" Position="2"/><Button Action="ADD_ROW" Caption="行追加" Number="6" Position="4"/><Button Action="REMOVE_ROW" Caption="行削除" Number="9" Position="5"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="HT010.NRHATTYU" FieldOptions="" Order="0010"/><Field DataSource="HT010.DTHATTYU" FieldOptions="HORIZONTAL" Order="0030"/><Field DataSource="HT010.STHATTYU" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先Ｃ)" Order="0040"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/><Field DataSource="AT040.TXSOUKO" FieldOptions="CAPTION(入荷予定倉庫),PROMPT_LIST" Order="0060"/><Field DataSource="HT010.TXTEKIYO" FieldOptions="WIDTH(839)" Order="0080"/><Column DataSource="BT010.TXHINBAN" FieldOptions="PROMPT_CALL(BF110),PROMPT_CALL_TO_GET(BT010.IDHINMOKU;BT010.TXHINBAN;BT010.TXHINMEI;BT010.KBUNITPUR;BT010.PRKOUNYU),PROMPT_CALL_TO_GET_TO(HT011.IDHINMOKU;BT010.TXHINBAN;BT010.TXHINMEI;BT010.KBUNITPUR;HT011.PRHATTYU)" Order="0010"/><Column DataSource="BT010.TXHINMEI" FieldOptions="WIDTH(300)" Order="0020"/><Column DataSource="BT010.KBUNITPUR" FieldOptions="CAPTION(U/M)" Order="0050"/></Function><Function HeaderFunction="HF011" HeaderKeyFields="" HeaderTable="HT010" ID="HF013" Name="発注見出し／明細の検討" Size="AUTO" SubsystemID="H" Type="XF300"><Detail Caption="発注明細" DetailFunction="HF026" HeaderKeyFields="" InitialListing="T" InitialMsg="" KeyFields=";NRHATTYU;SQHATTYU" Order="0010" Table="HT011"><Column DataSource="HT011.PRHATTYU" FieldOptions="" Order="0030"/><Column DataSource="HT011.QTHATTYU" FieldOptions="" Order="0040"/><Column DataSource="HT011.DTNOUKI" FieldOptions="" Order="0080"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(HF012)" Caption="編集" Number="5" Position="2"/><Button Action="HEADER" Caption="発注見出し" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="BT010.TXHINBAN" FieldOptions="" Order="0010"/><Column DataSource="BT010.TXHINMEI" FieldOptions="WIDTH(280)" Order="0020"/><Column DataSource="BT010.KBUNITPUR" FieldOptions="CAPTION(U/M)" Order="0070"/><Button Action="CALL(HF015)" Caption="発注書" Number="10" Position="5"/><Column DataSource="HT011.QTKENSYU" FieldOptions="" Order="0060"/></Detail><Field DataSource="HT010.NRHATTYU" FieldOptions="" Order="0010"/><Field DataSource="HT010.DTHATTYU" FieldOptions="HORIZONTAL" Order="0030"/><Field DataSource="HT010.STHATTYU" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先Ｃ)" Order="0040"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/><Field DataSource="AT040.TXSOUKO" FieldOptions="CAPTION(入荷予定倉庫)" Order="0060"/><Field DataSource="HT010.TXTEKIYO" FieldOptions="WIDTH(839)" Order="0070"/></Function><Function ID="HF014" InitialMsg="" KeyFields="" Name="発注明細の保守" PrimaryTable="HT011" Size="AUTO" SubsystemID="H" Type="XF200"><Field DataSource="HT011.NRHATTYU" FieldOptions="" Order="0010"/><Field DataSource="HT011.SQHATTYU" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="HT011.PRHATTYU" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(57)" Order="0070"/><Field DataSource="HT011.QTHATTYU" FieldOptions="" Order="0080"/><Field DataSource="HT011.DTNOUKI" FieldOptions="" Order="0060"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="HT011.NRNYUKA" FieldOptions="HORIZONTAL" Order="0030"/><Field DataSource="BT010.TXHINBAN" FieldOptions="" Order="0040"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/><Field DataSource="BT010.KBUNITPUR" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0120"/><Field DataSource="HT011.QTKANZAN" FieldOptions="CAPTION(入庫数),HORIZONTAL" Order="0130"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0140"/><Field DataSource="BT010.KBUNITPUR" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0090"/><Field DataSource="HT011.QTKENSYU" FieldOptions="HORIZONTAL" Order="0110"/></Function><Function DetailFunction="HF025" ID="HF020" InitialListing="T" InitialMsg="" KeyFields="" Name="入荷データの一覧・保守" OrderBy="" PrimaryTable="HT020" Size="AUTO" SubsystemID="H" Type="XF100"><Column DataSource="HT020.NRNYUKA" FieldOptions="" Order="0020"/><Column DataSource="HT020.DTNYUKA" FieldOptions="" Order="0010"/><Filter DataSource="HT020.NRNYUKA" FieldOptions="" Order="0020"/><Filter DataSource="HT020.DTNYUKA" FieldOptions="GE,CAPTION(入荷日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(HF021A)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C)" Order="0030"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(仕入先名)" Order="0040"/><Column DataSource="AT040.TXSOUKO" FieldOptions="CAPTION(入荷倉庫)" Order="0050"/><Column DataSource="HT020.STNYUKA" FieldOptions="" Order="0060"/><Filter DataSource="HT020.STNYUKA" FieldOptions="PROMPT_LIST1" Order="0040"/><Filter DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C)" Order="0030"/></Function><Function ID="HF024" InitialMsg="" KeyFields="" Name="入荷見出しの保守" PrimaryTable="HT020" Size="AUTO" SubsystemID="H" Type="XF200"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="HT020.NRNYUKA" FieldOptions="" Order="0010"/><Field DataSource="HT020.DTNYUKA" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="HT020.DTKENSYU" FieldOptions="HORIZONTAL" Order="0070"/><Field DataSource="HT020.STNYUKA" FieldOptions="HORIZONTAL" Order="0030"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先)" Order="0040"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/><Field DataSource="AT040.TXSOUKO" FieldOptions="CAPTION(入荷倉庫),PROMPT_LIST" Order="0060"/></Function><Function ID="HF990" Name="発注･入荷パージ処理" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rHT020; var dHT020; var rHT010; var dHT010; var rHT011; var dHT011;#EOL#var limitDate = instance.parmMap.get('LIMIT_DATE');#EOL#var workCount1 = 0; var workCount2 = 0; var count = 0;#EOL#var countHT010_ToBeDeleted = 0; var countHT010_Deleted = 0;#EOL#var countHT011_ToBeDeleted = 0; var countHT011_Deleted = 0;#EOL#var countHT020_ToBeDeleted = 0; var countHT020_Deleted = 0;#EOL##EOL#//////////////////////////#EOL#// 削除結果の省略値登録 //#EOL#//////////////////////////#EOL#instance.returnMap.put('HT010_COUNT', -1);#EOL#instance.returnMap.put('HT011_COUNT', -1);#EOL#instance.returnMap.put('HT020_COUNT', -1);#EOL##EOL#//////////////////////////////#EOL#// HT020 削除対象件数の検索 //#EOL#//////////////////////////////#EOL#rHT020 = instance.createTableOperator('Select', 'HT020');#EOL#rHT020.setSelectFields('NRNYUKA, DTKENSYU');#EOL#rHT020.addKeyValue('DTNYUKA &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#while (rHT020.next()) {#EOL##EOL#&#x9;if (rHT020.getValueOf('DTKENSYU') != ''#EOL#&#x9;&#x9;&amp;&amp; rHT020.getValueOf('DTKENSYU') != null#EOL#&#x9;&#x9;&amp;&amp; rHT020.getValueOf('DTKENSYU') &lt;= limitDate + '') {#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// KT011 削除対象件数の検索 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;rHT011 = instance.createTableOperator('Select', 'HT011');#EOL#&#x9;&#x9;rHT011.setSelectFields('NRHATTYU, SQHATTYU');#EOL#&#x9;&#x9;rHT011.addKeyValue('NRNYUKA',&#x9;rHT020.getValueOf('NRNYUKA'));#EOL#&#x9;&#x9;while (rHT011.next()) {#EOL#&#x9;&#x9;&#x9;countHT011_ToBeDeleted++;#EOL##EOL#&#x9;&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;&#x9;// KT011 削除処理 //#EOL#&#x9;&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;&#x9;dHT011 = instance.createTableOperator('Delete', 'HT011');#EOL#&#x9;&#x9;&#x9;dHT011.addKeyValue('NRHATTYU',&#x9;rHT011.getValueOf('NRHATTYU'));#EOL#&#x9;&#x9;&#x9;dHT011.addKeyValue('SQHATTYU',&#x9;rHT011.getValueOf('SQHATTYU'));#EOL#&#x9;&#x9;&#x9;count = dHT011.execute();#EOL#&#x9;&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;&#x9;countHT011_Deleted++;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;// HT020 削除処理 //#EOL#&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;countHT020_ToBeDeleted++;#EOL#&#x9;&#x9;dHT020 = instance.createTableOperator('Delete', 'HT020');#EOL#&#x9;&#x9;dHT020.addKeyValue('NRNYUKA',&#x9;rKT020.getValueOf('NRNYUKA'));#EOL#&#x9;&#x9;count = dHT020.execute();#EOL#&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;countHT020_Deleted++;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#//////////////////////////////#EOL#// HT010 削除対象件数の検索 //#EOL#//////////////////////////////#EOL#rHT010 = instance.createTableOperator('Select', 'HT010');#EOL#rHT010.setSelectFields('NRHATTYU');#EOL#rHT010.addKeyValue('DTHATTYU &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#while (rHT010.next()) {#EOL##EOL#&#x9;////////////////////////#EOL#&#x9;// 明細件数のリセット //#EOL#&#x9;////////////////////////#EOL#&#x9;workCount1 = 0;#EOL#&#x9;workCount2 = 0;#EOL##EOL#&#x9;//////////////////////////////#EOL#&#x9;// HT011 削除対象件数の検索 //#EOL#&#x9;//////////////////////////////#EOL#&#x9;rHT011 = instance.createTableOperator('Select', 'HT011');#EOL#&#x9;rHT011.setSelectFields('NRHATTYU, SQHATTYU');#EOL#&#x9;rHT011.addKeyValue('NRHATTYU',&#x9;rHT010.getValueOf('NRHATTYU'));#EOL#&#x9;while (rKT011.next()) {#EOL#&#x9;&#x9;workCount1++;#EOL##EOL#&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;// KT011 削除処理 //#EOL#&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;if (rHT011.getValueOf('NRNYUKA') == '') {#EOL#&#x9;&#x9;&#x9;countKT011_ToBeDeleted++;#EOL#&#x9;&#x9;&#x9;dKT011 = instance.createTableOperator('Delete', 'KT011');#EOL#&#x9;&#x9;&#x9;dKT011.addKeyValue('NRHATTYU',&#x9;rKT011.getValueOf('NRHATTYU'));#EOL#&#x9;&#x9;&#x9;dKT011.addKeyValue('SQHATTYU',&#x9;rKT011.getValueOf('SQHATTYU'));#EOL#&#x9;&#x9;&#x9;count = dKT011.execute();#EOL#&#x9;&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;&#x9;workCount2++;#EOL#&#x9;&#x9;&#x9;&#x9;countHT011_Deleted++;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////#EOL#&#x9;// HT010 削除処理 //#EOL#&#x9;////////////////////#EOL#&#x9;if (workCount1 == workCount2) {#EOL#&#x9;&#x9;countHT010_ToBeDeleted++;#EOL#&#x9;&#x9;dHT010 = instance.createTableOperator('Delete', 'HT010');#EOL#&#x9;&#x9;dHT010.addKeyValue('NRHATTYU',&#x9;rHT010.getValueOf('NRHATTYU'));#EOL#&#x9;&#x9;count = dHT010.execute();#EOL#&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;countHT010_Deleted++;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////#EOL#// 削除結果の登録 //#EOL#////////////////////#EOL#if (countHT010_Deleted == countHT010_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('HT010_COUNT', countHT010_ToBeDeleted);#EOL#}#EOL#if (countHT011_Deleted == countHT011_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('HT011_COUNT', countHT011_ToBeDeleted);#EOL#}#EOL#if (countHT020_Deleted == countHT020_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('HT020_COUNT', countHT020_ToBeDeleted);#EOL#}#EOL#" SubsystemID="H" Type="XF000"/><Function ID="JF990" Name="製造指示パージ処理" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rJT010; var dJT010; var rJT020; var dJT020;#EOL#var rJT030; var dJT030; var dJT030W; var rJT040; var dJT040;#EOL#var limitDate = instance.parmMap.get('LIMIT_DATE');#EOL#var workCount1 = 0; var workCount2 = 0; var count = 0;#EOL#var countJT010_ToBeDeleted = 0; var countJT010_Deleted = 0;#EOL#var countJT020_ToBeDeleted = 0; var countJT020_Deleted = 0;#EOL#var countJT030_ToBeDeleted = 0; var countJT030_Deleted = 0;#EOL#var countJT040_ToBeDeleted = 0; var countJT040_Deleted = 0;#EOL##EOL#//////////////////////////#EOL#// 削除結果の省略値登録 //#EOL#//////////////////////////#EOL#instance.returnMap.put('JT010_COUNT', -1);#EOL#instance.returnMap.put('JT020_COUNT', -1);#EOL#instance.returnMap.put('JT030_COUNT', -1);#EOL#instance.returnMap.put('JT040_COUNT', -1);#EOL##EOL#//////////////////////////////#EOL#// JT010 削除対象件数の検索 //#EOL#//////////////////////////////#EOL#rJT010 = instance.createTableOperator('Select', 'JT010');#EOL#rJT010.setSelectFields('NRSEIZO, DTSYUKKA');#EOL#rJT010.addKeyValue('DTCREATE &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#while (rJT010.next()) {#EOL##EOL#&#x9;if (rJT010.getValueOf('DTSYUKKA') != ''#EOL#&#x9;&#x9;&amp;&amp; rJT010.getValueOf('DTSYUKKA') != null#EOL#&#x9;&#x9;&amp;&amp; rJT010.getValueOf('DTSYUKKA') &lt;= limitDate + '') {#EOL##EOL#&#x9;&#x9;countJT010_ToBeDeleted++;#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// JT020 削除対象件数の検索 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;rJT020 = instance.createTableOperator('Select', 'JT020');#EOL#&#x9;&#x9;rJT020.setSelectFields('NRSEIZO, SQSPEC');#EOL#&#x9;&#x9;rJT020.addKeyValue('NRSEIZO',&#x9;rJT010.getValueOf('NRSEIZO'));#EOL#&#x9;&#x9;while (rJT020.next()) {#EOL#&#x9;&#x9;&#x9;countJT020_ToBeDeleted++;#EOL##EOL#&#x9;&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;&#x9;// JT020 削除処理 //#EOL#&#x9;&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;&#x9;dJT020 = instance.createTableOperator('Delete', 'JT020');#EOL#&#x9;&#x9;&#x9;dJT020.addKeyValue('NRSEIZO',&#x9;rJT020.getValueOf('NRSEIZO'));#EOL#&#x9;&#x9;&#x9;dJT020.addKeyValue('SQSPEC',&#x9;rJT020.getValueOf('SQSPEC'));#EOL#&#x9;&#x9;&#x9;count = dJT020.execute();#EOL#&#x9;&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;&#x9;countJT020_Deleted++;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// JT030 削除対象件数の検索 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;rJT030 = instance.createTableOperator('Select', 'JT030');#EOL#&#x9;&#x9;rJT030.setSelectFields('NRSEIZO, SQKOUTEI');#EOL#&#x9;&#x9;rJT030.addKeyValue('NRSEIZO',&#x9;rJT010.getValueOf('NRSEIZO'));#EOL#&#x9;&#x9;while (rJT030.next()) {#EOL#&#x9;&#x9;&#x9;countJT030_ToBeDeleted++;#EOL##EOL#&#x9;&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;&#x9;// JT030 削除処理 //#EOL#&#x9;&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;&#x9;dJT030 = instance.createTableOperator('Delete', 'JT030');#EOL#&#x9;&#x9;&#x9;dJT030.addKeyValue('NRSEIZO',&#x9;rJT030.getValueOf('NRSEIZO'));#EOL#&#x9;&#x9;&#x9;dJT030.addKeyValue('SQSPEC',&#x9;rJT030.getValueOf('SQKOUTEI'));#EOL#&#x9;&#x9;&#x9;count = dJT030.execute();#EOL#&#x9;&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;&#x9;countJT030_Deleted++;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// JT040 削除対象件数の検索 //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;rJT040 = instance.createTableOperator('Select', 'JT040');#EOL#&#x9;&#x9;rJT040.setSelectFields('NRSEIZO, SQZAIRYO');#EOL#&#x9;&#x9;rJT040.addKeyValue('NRSEIZO',&#x9;rJT010.getValueOf('NRSEIZO'));#EOL#&#x9;&#x9;while (rJT040.next()) {#EOL#&#x9;&#x9;&#x9;countJT040_ToBeDeleted++;#EOL##EOL#&#x9;&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;&#x9;// JT040 削除処理 //#EOL#&#x9;&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;&#x9;dJT040 = instance.createTableOperator('Delete', 'JT040');#EOL#&#x9;&#x9;&#x9;dJT040.addKeyValue('NRSEIZO',&#x9;rJT040.getValueOf('NRSEIZO'));#EOL#&#x9;&#x9;&#x9;dJT040.addKeyValue('SQZAIRYO',&#x9;rJT040.getValueOf('SQZAIRYO'));#EOL#&#x9;&#x9;&#x9;count = dJT040.execute();#EOL#&#x9;&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;&#x9;countJT040_Deleted++;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;// JT010 削除処理 //#EOL#&#x9;&#x9;////////////////////#EOL#&#x9;&#x9;if (countJT020_ToBeDeleted == countJT020_Deleted#EOL#&#x9;&#x9;&#x9;&amp;&amp; countJT030_ToBeDeleted == countJT030_Deleted#EOL#&#x9;&#x9;&#x9;&amp;&amp; countJT040_ToBeDeleted == countJT040_Deleted) {#EOL#&#x9;&#x9;&#x9;dJT010 = instance.createTableOperator('Delete', 'JT010');#EOL#&#x9;&#x9;&#x9;dJT010.addKeyValue('NRSEIZO',&#x9;rJT010.getValueOf('NRSEIZO'));#EOL#&#x9;&#x9;&#x9;count = dJT010.execute();#EOL#&#x9;&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;&#x9;countJT010_Deleted++;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#/////////////////////#EOL#// JT030W 削除処理 //#EOL#/////////////////////#EOL#dJT030W = instance.createTableOperator('Delete', 'JT030W');#EOL#dJT030W.execute();#EOL##EOL#////////////////////#EOL#// 削除結果の登録 //#EOL#////////////////////#EOL#if (countJT010_Deleted == countJT010_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('JT010_COUNT', countJT010_ToBeDeleted);#EOL#}#EOL#if (countJT020_Deleted == countJT020_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('JT020_COUNT', countJT020_ToBeDeleted);#EOL#}#EOL#if (countJT030_Deleted == countJT030_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('JT030_COUNT', countJT030_ToBeDeleted);#EOL#}#EOL#if (countJT040_Deleted == countJT040_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('JT040_COUNT', countJT040_ToBeDeleted);#EOL#}#EOL#" SubsystemID="J" Type="XF000"/><Function DetailFunction="EF011" ID="EF010" InitialListing="T" InitialMsg="" KeyFields="IDTOKUISAKI" Name="得意先マスターの一覧・保守" OrderBy="" PrimaryTable="ET010" Size="AUTO" SubsystemID="E" Type="XF100"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(EF012)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="ET010.NRTANTOUJYUGYOIN" FieldOptions="" Order="0040"/><Column DataSource="ET010.AMGENURIKAKE" FieldOptions="" Order="0050"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(得意先名)" Order="0020"/><Column DataSource="AT030.TXJYUSYO1" FieldOptions="" Order="0030"/><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先C)" Order="0010"/><Filter DataSource="ET010.NRTANTOUJYUGYOIN" FieldOptions="VALUE(USER_ATTRIBUTE:EmployeeNo)" Order="0030"/><Filter DataSource="AT030.TXKANJI" FieldOptions="SCAN,CAPTION(得意先名SCAN)" Order="0020"/><Filter DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先C)" Order="0010"/></Function><Function HeaderFunction="EF012" HeaderKeyFields="" HeaderTable="ET010" ID="EF011" Name="得意先と関連情報の確認" Size="AUTO" SubsystemID="E" Type="XF300"><Field DataSource="ET010.KBSEIKYUHOUSHIKI" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(28)" Order="0060"/><Detail Caption="売掛増減履歴" DetailFunction="EF101" HeaderKeyFields="IDTOKUISAKI" InitialListing="T" InitialMsg="" KeyFields="IDTOKUISAKI;NRURIKAKE" Order="0020" Table="ET100"><Column DataSource="ET100.NRURIKAKE" FieldOptions="" Order="0020"/><Column DataSource="ET100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="ET100.KBURITORI" FieldOptions="" Order="0050"/><Column DataSource="ET100.KBAKADEN" FieldOptions="" Order="0030"/><Column DataSource="ET100.FGVALID" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="得意先情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="ET100.TXHINMEI" FieldOptions="WIDTH(200)" Order="0060"/><Column DataSource="ET100.AMARARI" FieldOptions="" Order="0110"/><Filter DataSource="ET100.DTTORIHIKI" FieldOptions="GE,CAPTION(取引日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Filter DataSource="ET100.KBURITORI" FieldOptions="PROMPT_LIST1" Order="0020"/><Filter DataSource="ET100.FGVALID" FieldOptions="PROMPT_LIST1,VALUE(VALUE:T)" Order="0030"/><Button Action="CALL(EF014)" Caption="残高確認書" Number="10" Position="5"/><Column DataSource="ET100.AMZOUGEN" FieldOptions="" Order="0070"/></Detail><Detail Caption="出荷先" DetailFunction="EF013" HeaderKeyFields="IDTOKUISAKI" InitialListing="T" InitialMsg="" KeyFields=";IDTOKUISAKI;SQSYUKKASAKI" Order="0010" Table="ET011"><Column DataSource="ET011.TXKANJI" FieldOptions="CAPTION(出荷先名)" Order="0010"/><Column DataSource="ET011.NRYUBIN" FieldOptions="" Order="0020"/><Column DataSource="ET011.TXJYUSYO1" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="2"/><Button Action="HEADER" Caption="得意先情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Button Action="CALL(EF014)" Caption="残高確認書" Number="10" Position="5"/></Detail><Detail Caption="請求実績" DetailFunction="EF113" HeaderKeyFields="IDTOKUISAKI" InitialListing="T" InitialMsg="" KeyFields="IDTOKUISAKI;NRSEIKYU" Order="0030" Table="ET110"><Column DataSource="ET110.NRSEIKYU" FieldOptions="" Order="0020"/><Column DataSource="ET110.DTSEIKYU" FieldOptions="" Order="0010"/><Column DataSource="ET110.AMSEIKYU" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="得意先情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Filter DataSource="ET110.DTSEIKYU" FieldOptions="GE,CAPTION(請求日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Button Action="CALL(EF014)" Caption="残高確認書" Number="10" Position="5"/></Detail><Field DataSource="ET010.TXSIMEBI" FieldOptions="" Order="0050"/><Field DataSource="ET010.KBNYUKINHOUHOU" FieldOptions="CAPTION(標準入金方法),CAPTION_LENGTH_VARIABLE,HORIZONTAL(28)" Order="0070"/><Field DataSource="ET010.VLNYUKINSAITO" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(29)" Order="0080"/><Field DataSource="ET010.AMYOSHIN" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(29)" Order="0090"/><Field DataSource="ET010.AMURIAGE" FieldOptions="HORIZONTAL" Order="0110"/><Field DataSource="ET010.AMJYURYO" FieldOptions="HORIZONTAL" Order="0120"/><Field DataSource="ET010.AMGENURIKAKE" FieldOptions="HORIZONTAL" Order="0130"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Field DataSource="AT030.TXJYUSYO1" FieldOptions="CAPTION(住所)" Order="0030"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先Ｃ)" Order="0010"/><Field DataSource="ET010.TXTEKIYO" FieldOptions="WIDTH(1027)" Order="0140"/><Field DataSource="ET010.AMKISYU" FieldOptions="" Order="0100"/><Detail Caption="受領実績" DetailFunction="EF122" HeaderKeyFields="" InitialListing="T" InitialMsg="" KeyFields="IDTOKUISAKI;NRJYURYOU" Order="0040" Table="ET120"><Column DataSource="ET120.NRJYURYOU" FieldOptions="" Order="0020"/><Column DataSource="ET120.DTJYURYOU" FieldOptions="" Order="0010"/><Column DataSource="ET120.KBKINSYU" FieldOptions="" Order="0030"/><Column DataSource="ET120.AMJYURYOU" FieldOptions="" Order="0040"/><Column DataSource="ET120.AMTESURYOU" FieldOptions="" Order="0050"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="得意先情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Filter DataSource="ET120.DTJYURYOU" FieldOptions="GE,CAPTION(受領日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Button Action="CALL(EF014)" Caption="残高確認書" Number="10" Position="5"/></Detail><Field DataSource="AT030.TXJYUSYO2" FieldOptions="NO_CAPTION,WIDTH(466),HORIZONTAL" Order="0040"/><Detail Caption="月次取引" DetailFunction="YF110" HeaderKeyFields="" InitialMsg="" KeyFields="IDTOKUISAKI;DTNEND;DTMSEQ" Order="0050" Table="YT100"><Column DataSource="YT100.DTNEND" FieldOptions="" Order="0010"/><Column DataSource="YT100.DTMSEQ" FieldOptions="" Order="0020"/><Column DataSource="YT100.AMKIKANURI" FieldOptions="" Order="0030"/><Column DataSource="YT100.AMKIKANJYU" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="得意先情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="YT100.AMURIKAKE" FieldOptions="" Order="0050"/><Column DataSource="YT100.AMKIKANARARI" FieldOptions="" Order="0070"/></Detail></Function><Function DataName="得意先" FunctionAfterInsert="EF011" ID="EF012" InitialMsg="" KeyFields="IDTOKUISAKI" Name="得意先マスターの保守" PrimaryTable="ET010" Size="AUTO" SubsystemID="E" Type="XF200"><Field DataSource="ET010.TXTANTOUBUSYO" FieldOptions="" Order="0070"/><Field DataSource="ET010.TXTANTOUSYA" FieldOptions="HORIZONTAL" Order="0080"/><Field DataSource="ET010.TXTANTOUSYASYOKUI" FieldOptions="" Order="0090"/><Field DataSource="ET010.TXTANTOUSYAEMAIL" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(35)" Order="0100"/><Field DataSource="ET010.TXTANTOUSYADENWA" FieldOptions="" Order="0110"/><Field DataSource="ET010.KBSEIKYUHOUSHIKI" FieldOptions="HORIZONTAL" Order="0120"/><Field DataSource="ET010.TXSIMEBI" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(52)" Order="0130"/><Field DataSource="ET010.KBNYUKINHOUHOU" FieldOptions="" Order="0150"/><Field DataSource="ET010.VLNYUKINSAITO" FieldOptions="HORIZONTAL" Order="0140"/><Field DataSource="ET010.AMYOSHIN" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(31)" Order="0180"/><Field DataSource="ET010.NRTANTOUJYUGYOIN" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(46),PROMPT_CALL(AF110),PROMPT_CALL_TO_GET(AT020.NRJYUGYOIN;AT020.TXKANJI),PROMPT_CALL_TO_GET_TO(ET010.NRTANTOUJYUGYOIN;AT020.TXKANJI)" Order="0160"/><Field DataSource="ET010.TXTEKIYO" FieldOptions="WIDTH(937)" Order="0230"/><Field DataSource="ET010.AMURIAGE" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(30)" Order="0200"/><Field DataSource="ET010.AMJYURYO" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(30)" Order="0210"/><Field DataSource="ET010.AMGENURIKAKE" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(30)" Order="0220"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Field DataSource="AT030.NRYUBIN" FieldOptions="CAPTION(〒／住所)" Order="0030"/><Field DataSource="AT030.TXJYUSYO1" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Field DataSource="AT030.TXJYUSYO2" FieldOptions="CAPTION(　)" Order="0050"/><Field DataSource="AT030.NRDENWA" FieldOptions="HORIZONTAL" Order="0060"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="PROMPT_CALL(AF120),PROMPT_CALL_TO_GET(AT030.IDTORIHIKISAKI;AT030.TXKANJI;AT030.CDTORIHIKISAKI),PROMPT_CALL_TO_GET_TO(ET010.IDTOKUISAKI;AT030.TXKANJI;AT030.CDTORIHIKISAKI)" Order="0010"/><Field DataSource="ET010.AMKISYU" FieldOptions="" Order="0190"/><Field DataSource="AT020.TXKANJI" FieldOptions="NO_CAPTION,WIDTH(300),HORIZONTAL" Order="0170"/></Function><Function ID="EF013" InitialMsg="" KeyFields="IDTOKUISAKI;SQSYUKKASAKI" Name="出荷先情報の保守" PrimaryTable="ET011" Size="AUTO" SubsystemID="E" Type="XF200"><Field DataSource="ET011.TXKANJI" FieldOptions="CAPTION(出荷先名)" Order="0050"/><Field DataSource="ET011.NRYUBIN" FieldOptions="CAPTION(〒／住所)" Order="0060"/><Field DataSource="ET011.TXJYUSYO1" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0070"/><Field DataSource="ET011.TXJYUSYO2" FieldOptions="CAPTION(　)" Order="0080"/><Field DataSource="ET011.NRDENWA" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(42)" Order="0090"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0030"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先Ｃ)" Order="0020"/></Function><Function Direction="NORMAL" ID="EF014" KeyFields="IDTOKUISAKI" Margins="50;50;50;50" Name="売掛残高確認書の印刷" PageSize="A4" PrimaryTable="ET010" SubsystemID="E" Type="XF290" WithPageNumber="F"><Phrase Alignment="CENTER" Block="HEADER" FontID="Font1" FontSize="15" FontStyle="BOLD" MarginLeft="0" MarginRight="0" Order="0010" SpacingAfter="0" Value="&amp;Text(売掛残高確認書)"/><Phrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0020" SpacingAfter="-18" Value="&amp;DataSource(AT030.TXKANJI)&amp;Text( 御中)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0030" SpacingAfter="0" Value="&amp;Image(logo.PNG;0;-5;32;0)&amp;SystemVariant(COMP_NAME)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0040" SpacingAfter="0" Value="&amp;SystemVariant(COMP_ADDRESS)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0050" SpacingAfter="0" Value="&amp;SystemVariant(COMP_TEL)&amp;Text( ㈹)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0060" SpacingAfter="20" Value="&amp;Text(営業担当 )&amp;DataSource(AT020.TXKANJI)"/><Phrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0070" SpacingAfter="30" Value="&amp;Text(毎度お世話になっております。)&amp;Date(jp11)&amp;Text( 時点でのお支払残高をお知らせいたします。)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="400" Order="0080" SpacingAfter="-18" Value="&amp;Text(前期繰越額)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="320" Order="0090" SpacingAfter="0" Value="&amp;DataSource(ET010.AMKISYU;a1)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="400" Order="0100" SpacingAfter="-18" Value="&amp;Text(当期お買上額)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="320" Order="0110" SpacingAfter="0" Value="&amp;DataSource(ET010.AMURIAGE;a1)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="400" Order="0120" SpacingAfter="-18" Value="&amp;Text(当期お支払額)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="320" Order="0130" SpacingAfter="0" Value="&amp;DataSource(ET010.AMJYURYO;a1)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="400" Order="0140" SpacingAfter="-18" Value="&amp;Text(お支払残額)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="320" Order="0150" SpacingAfter="0" Value="&amp;DataSource(ET010.AMGENURIKAKE;a1)"/></Function><Function DetailFunction="EF101" ID="EF100" InitialListing="T" InitialMsg="" KeyFields="NRURIKAKE" Name="売掛増減履歴の一覧" OrderBy="" PrimaryTable="ET100" Size="AUTO" SubsystemID="E" Type="XF100"><Column DataSource="ET100.NRURIKAKE" FieldOptions="" Order="0020"/><Column DataSource="ET100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="ET100.KBURITORI" FieldOptions="" Order="0050"/><Column DataSource="ET100.KBAKADEN" FieldOptions="" Order="0030"/><Filter DataSource="ET100.DTTORIHIKI" FieldOptions="GE,CAPTION(取引日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="ET100.FGVALID" FieldOptions="" Order="0040"/><Column DataSource="ET100.TXHINMEI" FieldOptions="WIDTH(250)" Order="0070"/><Column DataSource="ET100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0100"/><Column DataSource="ET100.PRTORIHIKI" FieldOptions="" Order="0080"/><Column DataSource="ET100.QTTORIHIKI" FieldOptions="" Order="0090"/><Column DataSource="ET100.NRSEIKYU" FieldOptions="" Order="0140"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(得意先),WIDTH(250)" Order="0060"/><Filter DataSource="ET100.FGVALID" FieldOptions="PROMPT_LIST1,VALUE(VALUE:T)" Order="0050"/><Filter DataSource="ET100.TXHINMEI" FieldOptions="SCAN,CAPTION(品名／摘要SCAN)" Order="0040"/><Column DataSource="ET100.AMZOUGEN" FieldOptions="" Order="0110"/><Filter DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先C)" Order="0030"/><Filter DataSource="ET100.KBURITORI" FieldOptions="PROMPT_CALL(EF810),PROMPT_CALL_TO_PUT(ET100.KBURITORI),PROMPT_CALL_TO_PUT_TO(ET100.KBURITORI),PROMPT_CALL_TO_GET(ET100.KBURITORI),PROMPT_CALL_TO_GET_TO(ET100.KBURITORI)" Order="0020"/></Function><Function ID="EF101" InitialMsg="" KeyFields="NRURIKAKE" Name="売掛増減履歴の表示" PrimaryTable="ET100" Size="AUTO" SubsystemID="E" Type="XF200"><Field DataSource="ET100.NRURIKAKE" FieldOptions="" Order="0010"/><Field DataSource="ET100.DTTORIHIKI" FieldOptions="" Order="0060"/><Field DataSource="ET100.KBURITORI" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0040"/><Field DataSource="ET100.KBAKADEN" FieldOptions="CAPTION(伝票区分),CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0020"/><Field DataSource="ET100.FGVALID" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0030"/><Field DataSource="ET100.PRTORIHIKI" FieldOptions="" Order="0130"/><Field DataSource="ET100.QTTORIHIKI" FieldOptions="HORIZONTAL" Order="0140"/><Field DataSource="ET100.AMTAX" FieldOptions="HORIZONTAL" Order="0180"/><Field DataSource="ET100.NRSEIKYU" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0210"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="ET100.AMTORIHIKI" FieldOptions="" Order="0170"/><Field DataSource="ET100.AMGENKA" FieldOptions="HORIZONTAL" Order="0160"/><Field DataSource="ET100.DTNEND" FieldOptions="CAPTION(取引月度),HORIZONTAL" Order="0070"/><Field DataSource="ET100.DTMSEQ" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0080"/><Field DataSource="ET100.TXHINMEI" FieldOptions="" Order="0110"/><Field DataSource="ET100.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0150"/><Field DataSource="ET100.DTCREATE" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0220"/><Field DataSource="ET100.TXREFNO" FieldOptions="" Order="0200"/><Field DataSource="ET100.AMARARI" FieldOptions="HORIZONTAL(48)" Order="0190"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0100"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先Ｃ)" Order="0090"/><Field DataSource="ET100.TXHINBAN" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0120"/><Button Action="CALL(EF102)" Caption="元取引" Number="8" Position="4"/><Button Action="CALL(EF116)" Caption="請求取消" Number="9" Position="5"/><Field DataSource="ET100.KBURIHURI" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0050"/></Function><Function ID="EF102" Name="売掛取引情報表示切替処理" Script="///////////////////////////////////////#EOL#// 当該売掛増減履歴(ET100)の読み込み //#EOL#///////////////////////////////////////#EOL#var rET100 = instance.createTableOperator('Select', 'ET100');#EOL#rET100.setSelectFields('KBURITORI, NRSOURCE');#EOL#rET100.addKeyValue('NRURIKAKE',&#x9;instance.parmMap.get('NRURIKAKE'));#EOL#if (rET100.next()) {#EOL##EOL#&#x9;/////////////////////////////////#EOL#&#x9;// 00(出荷売上) JT010 製造指示 //#EOL#&#x9;/////////////////////////////////#EOL#&#x9;if (rET100.getValueOf('KBURITORI') == '00') {#EOL#&#x9;&#x9;var rJT010 = instance.createTableOperator('Select', 'JT010');#EOL#&#x9;&#x9;rJT010.setSelectFields('NRSEIZO');#EOL#&#x9;&#x9;rJT010.addKeyValue('NRSOURCE',&#x9;rET100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rJT010.next()) {#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('NRSEIZO',&#x9;rJT010.getValueOf('NRSEIZO'));#EOL#&#x9;&#x9;&#x9;instance.callFunction('JF012');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;showMessage('取引の元情報が存在しません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////#EOL#&#x9;// 01(直出荷売上),02(売上返品) LT020 特殊売上 //#EOL#&#x9;////////////////////////////////////////////////#EOL#&#x9;if (rDT100.getValueOf('KBURITORI') == '01' || rDT100.getValueOf('KBURITORI') == '02') {#EOL#&#x9;&#x9;var rLT020 = instance.createTableOperator('Select', 'LT020');#EOL#&#x9;&#x9;rLT020.setSelectFields('NRTOKUURI');#EOL#&#x9;&#x9;rLT020.addKeyValue('NRSOURCE',&#x9;rET100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rLT020.next()) {#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('NRTOKUURI',&#x9;rLT020.getValueOf('NRTOKUURI'));#EOL#&#x9;&#x9;&#x9;instance.callFunction('LF023');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;showMessage('取引の元情報が存在しません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////////////////////////////////#EOL#&#x9;// 10(振替控除),11(振替計上) LT010 売掛振替 //#EOL#&#x9;//////////////////////////////////////////////#EOL#&#x9;if (rDT100.getValueOf('KBURITORI') == '10' || rDT100.getValueOf('KBURITORI') == '11') {#EOL#&#x9;&#x9;var rLT010 = instance.createTableOperator('Select', 'LT010');#EOL#&#x9;&#x9;rLT010.setSelectFields('NRURIHURI');#EOL#&#x9;&#x9;rLT010.addKeyValue('NRSOURCE',&#x9;rET100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rLT010.next()) {#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('NRURIHURI',&#x9;rLT020.getValueOf('NRURIHURI'));#EOL#&#x9;&#x9;&#x9;instance.callFunction('LF012');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;showMessage('取引の元情報が存在しません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;/////////////////////////////////////////////////////////#EOL#&#x9;// 90(現金受領),91(手形受領),92(手数料) ET120 受領明細 //#EOL#&#x9;/////////////////////////////////////////////////////////#EOL#&#x9;if (rET100.getValueOf('KBURITORI') == '90' || rET100.getValueOf('KBURITORI') == '91' || rET100.getValueOf('KBURITORI') == '92') {#EOL#&#x9;&#x9;rET120 = instance.createTableOperator('Select', 'ET120');#EOL#&#x9;&#x9;rET120.setSelectFields('NRJYURYO');#EOL#&#x9;&#x9;rET120.addKeyValue('NRSOURCE',rET100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rET120.next()) {#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('NRJYURYO', rET120.getValueOf('NRJYURYO'));#EOL#&#x9;&#x9;&#x9;instance.callFunction('EF122');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;showMessage('取引の元情報が存在しません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL#" SubsystemID="E" Type="XF000"/><Function DetailFunction="EF113" ID="EF110" InitialListing="T" InitialMsg="" KeyFields="NRSEIKYU" Name="請求データの一覧・保守" OrderBy="" PrimaryTable="ET110" Size="AUTO" SubsystemID="E" Type="XF100"><Column DataSource="ET110.NRSEIKYU" FieldOptions="" Order="0020"/><Column DataSource="ET110.DTSEIKYU" FieldOptions="" Order="0010"/><Column DataSource="ET110.AMSEIKYU" FieldOptions="" Order="0050"/><Filter DataSource="ET110.NRSEIKYU" FieldOptions="" Order="0020"/><Filter DataSource="ET110.DTSEIKYU" FieldOptions="GE,CAPTION(請求日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(EF111)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(得意先名)" Order="0040"/><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先Ｃ)" Order="0030"/><Filter DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先Ｃ)" Order="0030"/></Function><Function BatchKeyFields="IDTOKUISAKI" BatchRecordFunction="EF115" BatchRecordFunctionMsg="請求書を発行しますか？" BatchTable="ET110" BatchWithKeyFields="ET100.IDTOKUISAKI" FixedWhere="FGVALID = 'T' AND NRSEIKYU = '       ' AND KBURITORI != '90'" ID="EF111" InitialListing="T" InitialMsg="" KeyFields="NRURIKAKE" Name="請求エントリー" OrderBy="" PrimaryTable="ET100" Size="AUTO" SubsystemID="E" Type="XF110"><Column DataSource="ET100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="ET100.KBURITORI" FieldOptions="" Order="0020"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="PREV" Caption="戻る" Number="4" Position="2"/><Button Action="NEXT" Caption="次へ" Number="5" Position="4"/><Button Action="UPDATE" Caption="更新" Number="5" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="ET100.TXHINMEI" FieldOptions="WIDTH(250)" Order="0060"/><Column DataSource="ET100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0090"/><Column DataSource="ET100.PRTORIHIKI" FieldOptions="" Order="0070"/><Column DataSource="ET100.QTTORIHIKI" FieldOptions="" Order="0080"/><Column DataSource="ET100.AMTORIHIKI" FieldOptions="" Order="0100"/><Column DataSource="ET100.AMTAX" FieldOptions="" Order="0110"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(取引先名),WIDTH(250)" Order="0040"/><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="" Order="0030"/><Column DataSource="ET010.TXSIMEBI" FieldOptions="" Order="0050"/><Filter DataSource="ET010.NRTANTOUJYUGYOIN" FieldOptions="" Order="0010"/><Filter DataSource="ET010.TXSIMEBI" FieldOptions="SCAN,CAPTION(締日SCAN)" Order="0030"/><Filter DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先Ｃ)" Order="0020"/><BatchField DataSource="ET110.DTSEIKYU" FieldOptions="" Order="0010"/></Function><Function ID="EF112" Name="都度請求処理" Script="//////////////////////////#EOL#// Javaパッケージの導入 //#EOL#//////////////////////////#EOL#var importedPackage = new JavaImporter(javax.swing);#EOL#with (importedPackage) {#EOL##EOL#&#x9;//////////////#EOL#&#x9;// 変数定義 //#EOL#&#x9;//////////////#EOL#&#x9;var rET100; var uET100; var cET110;#EOL#&#x9;var count = 0; var nrSeikyu =''; var reply = 0; var errorMessage = '';#EOL##EOL#&#x9;///////////////////////////////////////#EOL#&#x9;// 当該売掛増減履歴(ET100)の読み込み //#EOL#&#x9;///////////////////////////////////////#EOL#&#x9;rET100 = instance.createTableOperator('Select', 'ET100');#EOL#&#x9;rET100.setSelectFields('IDTOKUISAKI');#EOL#&#x9;rET100.addKeyValue('NRURIKAKE',&#x9;instance.parmMap.get('NRURIKAKE'));#EOL#&#x9;if (rET100.next()) {#EOL##EOL#&#x9;&#x9;/////////////////////////////////////////#EOL#&#x9;&#x9;// 請求見出し(ET110)の追加と請求書発行 //#EOL#&#x9;&#x9;/////////////////////////////////////////#EOL#&#x9;&#x9;nrSeikyu = session.getNextNumber('NRSEIKYU');#EOL#&#x9;&#x9;cET110 = instance.createTableOperator('Insert', 'ET110');#EOL#&#x9;&#x9;cET110.addValue('NRSEIKYU',&#x9;&#x9;nrSeikyu);#EOL#&#x9;&#x9;cET110.addValue('IDTOKUISAKI',&#x9;rET100.getValueOf('IDTOKUISAKI'));#EOL#&#x9;&#x9;cET110.addValue('DTSEIKYU',&#x9;&#x9;session.today + '');#EOL#&#x9;&#x9;cET110.addValue('TXTEKIYO',&#x9;&#x9;'');#EOL#&#x9;&#x9;count = cET110.execute();#EOL#&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;uET100 = instance.createTableOperator('Update', 'ET100');#EOL#&#x9;&#x9;&#x9;uET100.addValue('NRSEIKYU',&#x9;nrSeikyu);#EOL#&#x9;&#x9;&#x9;uET100.addKeyValue('NRURIKAKE',&#x9;instance.parmMap.get('NRURIKAKE'));#EOL#&#x9;&#x9;&#x9;count = uET100.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '売掛増減履歴(ET100)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;errorMessage = '請求見出し(ET110)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL##EOL#&#x9;////////////////////////////////#EOL#&#x9;// 請求書発行またはエラー処理 //#EOL#&#x9;////////////////////////////////#EOL#&#x9;if (errorMessage == '') {#EOL#&#x9;&#x9;reply = JOptionPane.showConfirmDialog(null, '＊請求データが追加されました。請求書を発行しますか？', '都度請求書の発行確認', JOptionPane.YES_NO_OPTION);#EOL#&#x9;&#x9;if (reply == JOptionPane.YES_OPTION) {#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('NRSEIKYU',&#x9;nrSeikyu);#EOL#&#x9;&#x9;&#x9;instance.callFunction('EF115');#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL#}" SubsystemID="E" Type="XF000"/><Function HeaderFunction="EF114" HeaderKeyFields="" HeaderTable="ET110" ID="EF113" Name="請求指示と関連情報の確認" Size="1350;700" SubsystemID="E" Type="XF300"><Field DataSource="ET110.NRSEIKYU" FieldOptions="" Order="0010"/><Field DataSource="ET110.DTSEIKYU" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="ET110.TXTEKIYO" FieldOptions="WIDTH(900)" Order="0070"/><Field DataSource="ET110.AMSEIKYU" FieldOptions="HORIZONTAL" Order="0060"/><Field DataSource="ET110.AMNYUKIN" FieldOptions="" Order="0050"/><Detail Caption="請求明細" DetailFunction="EF101" HeaderKeyFields="NRSEIKYU" InitialListing="T" InitialMsg="" KeyFields="NRSEIKYU;NRURIKAKE" Order="0010" Table="ET100"><Column DataSource="ET100.NRURIKAKE" FieldOptions="" Order="0020"/><Column DataSource="ET100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="ET100.KBURITORI" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="請求見出し" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="ET100.TXHINBAN" FieldOptions="" Order="0040"/><Column DataSource="ET100.TXHINMEI" FieldOptions="WIDTH(250)" Order="0050"/><Column DataSource="ET100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0070"/><Column DataSource="ET100.PRTORIHIKI" FieldOptions="" Order="0080"/><Column DataSource="ET100.QTTORIHIKI" FieldOptions="" Order="0060"/><Column DataSource="ET100.AMTORIHIKI" FieldOptions="" Order="0090"/><Column DataSource="ET100.AMTAX" FieldOptions="" Order="0100"/><Button Action="CALL(EF115)" Caption="請求書" Number="10" Position="5"/></Detail><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先Ｃ)" Order="0030"/></Function><Function DetailKeyFields="NRSEIKYU;NRURIKAKE" DetailTable="ET100" Direction="LANDSCAPE" HeaderKeyFields="NRSEIKYU" HeaderTable="ET110" ID="EF115" Margins="50;50;50;50" Name="請求書の印刷" PageSize="A4" SubsystemID="E" TableFontID="Font1" TableFontSize="9" TableRowNoWidth="5" Type="XF390" WithPageNumber="T"><Detail Caption="" CaptionFontSize="12" FixedWhere="KBURITORI != '90'" FontID="Font1" FontSize="9" HeaderKeyFields="" KeyFields="NRSEIKYU;NRURIKAKE" Order="0010" OrderBy="" RowNoWidth="5" Table="ET100"><Column Alignment="LEFT" DataSource="ET100.DTTORIHIKI" FieldOptions="" Order="0010" Width="10"/><Column Alignment="LEFT" DataSource="ET100.KBURITORI" FieldOptions="" Order="0020" Width="10"/><Column Alignment="LEFT" DataSource="ET100.TXHINMEI" FieldOptions="" Order="0030" Width="30"/><Column Alignment="LEFT" DataSource="ET100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0060" Width="5"/><Column Alignment="RIGHT" DataSource="ET100.PRTORIHIKI" FieldOptions="" Order="0040" Width="10"/><Column Alignment="RIGHT" DataSource="ET100.QTTORIHIKI" FieldOptions="" Order="0050" Width="10"/><Column Alignment="RIGHT" DataSource="ET100.AMTORIHIKISIGN" FieldOptions="CAPTION(税抜取引額),WITH_TOTAL" Order="0080" Width="10"/><Column Alignment="RIGHT" DataSource="ET100.AMTAXSIGN" FieldOptions="CAPTION(消費税額),WITH_TOTAL" Order="0090" Width="10"/></Detail><HeaderPhrase Alignment="CENTER" AlignmentMargin="" Block="HEADER" FontID="Font1" FontSize="15" FontStyle="BOLD" Order="0010" SpacingAfter="0" Value="&amp;Text(請　求　書)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" Order="0020" SpacingAfter="-18" Value="&amp;DataSource(AT030.TXKANJI)&amp;Text( 御中)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" Order="0030" SpacingAfter="0" Value="&amp;Image(logo.PNG;0;-5;32;0)&amp;SystemVariant(COMP_NAME)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" Order="0040" SpacingAfter="0" Value="&amp;SystemVariant(COMP_ADDRESS)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" Order="0050" SpacingAfter="0" Value="&amp;SystemVariant(COMP_TEL)&amp;Text( ㈹)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0060" SpacingAfter="20" Value="&amp;Text(営業担当 )&amp;DataSource(AT020.TXKANJI)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0070" SpacingAfter="30" Value="&amp;Text(毎度お世話になっております。以下のとおり請求させていただきます。ご確認ください。)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="400" Order="0080" SpacingAfter="-18" Value="&amp;Text(今回請求額)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="UNDERLINE" MarginLeft="0" MarginRight="300" Order="0090" SpacingAfter="0" Value="&amp;DataSource(ET110.AMSEIKYU;a1)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="400" Order="0100" SpacingAfter="-18" Value="&amp;Text(前回請求以降のご入金額)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="300" Order="0110" SpacingAfter="0" Value="&amp;DataSource(ET110.AMNYUKIN;a1)"/></Function><Function DetailFunction="EF122" ID="EF120" InitialListing="T" InitialMsg="" KeyFields="NRJYURYOU" Name="受領データの一覧・保守" OrderBy="" PrimaryTable="ET120" Size="AUTO" SubsystemID="E" Type="XF100"><Column DataSource="ET120.NRJYURYOU" FieldOptions="" Order="0020"/><Column DataSource="ET120.DTJYURYOU" FieldOptions="" Order="0010"/><Column DataSource="ET120.KBKINSYU" FieldOptions="CAPTION(金種)" Order="0060"/><Column DataSource="ET120.AMJYURYOU" FieldOptions="" Order="0070"/><Filter DataSource="ET120.DTJYURYOU" FieldOptions="GE,CAPTION(受領日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(EF121)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先Ｃ)" Order="0040"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(得意先名)" Order="0050"/><Filter DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先Ｃ)" Order="0020"/></Function><Function ID="EF121" InitialMsg="" KeyFields="NRJYURYOU" Name="受領データの保守" PrimaryTable="ET120" Size="AUTO" SubsystemID="E" Type="XF200"><Field DataSource="ET120.NRJYURYOU" FieldOptions="" Order="0010"/><Field DataSource="ET120.DTJYURYOU" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="ET120.KBKINSYU" FieldOptions="" Order="0050"/><Field DataSource="ET120.AMJYURYOU" FieldOptions="HORIZONTAL" Order="0060"/><Field DataSource="ET120.AMTESURYOU" FieldOptions="HORIZONTAL(40)" Order="0070"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先Ｃ),PROMPT_CALL(EF800),PROMPT_CALL_TO_GET(ET010.IDTOKUISAKI;AT030.CDTORIHIKISAKI;AT030.TXKANJI),PROMPT_CALL_TO_GET_TO(ET120.IDTOKUISAKI;AT030.CDTORIHIKISAKI;AT030.TXKANJI)" Order="0030"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/></Function><Function HeaderFunction="EF121" HeaderKeyFields="" HeaderTable="ET120" ID="EF122" Name="受領明細と関連情報の確認" Size="AUTO" SubsystemID="E" Type="XF300"><Detail Caption="売掛増減履歴" DetailFunction="NONE" HeaderKeyFields="NRSOURCE" InitialListing="T" InitialMsg="" KeyFields="NRSOURCE;NRURIKAKE" Order="0010" Table="ET100"><Column DataSource="ET100.NRURIKAKE" FieldOptions="" Order="0020"/><Column DataSource="ET100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="ET100.KBURITORI" FieldOptions="" Order="0050"/><Column DataSource="ET100.KBAKADEN" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="受領情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="ET100.FGVALID" FieldOptions="" Order="0040"/><Column DataSource="ET100.AMTORIHIKI" FieldOptions="CAPTION(売掛控除額)" Order="0060"/></Detail><Field DataSource="ET120.NRJYURYOU" FieldOptions="" Order="0010"/><Field DataSource="ET120.DTJYURYOU" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="ET120.KBKINSYU" FieldOptions="" Order="0050"/><Field DataSource="ET120.AMJYURYOU" FieldOptions="HORIZONTAL" Order="0060"/><Field DataSource="ET120.AMTESURYOU" FieldOptions="HORIZONTAL(40)" Order="0070"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先Ｃ)" Order="0030"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/></Function><Function DetailFunction="" ID="EF800" InitialListing="T" InitialMsg="" KeyFields="IDTOKUISAKI" Name="得意先検索" OrderBy="" ParmType="COLUMNS" PrimaryTable="ET010" Size="AUTO" SubsystemID="E" Type="XF100"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="ET010.NRTANTOUJYUGYOIN" FieldOptions="" Order="0040"/><Column DataSource="ET010.AMGENURIKAKE" FieldOptions="" Order="0050"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(得意先名)" Order="0020"/><Column DataSource="AT030.TXJYUSYO1" FieldOptions="" Order="0030"/><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先C)" Order="0010"/><Filter DataSource="ET010.NRTANTOUJYUGYOIN" FieldOptions="VALUE(USER_ATTRIBUTE:EmployeeNo)" Order="0030"/><Filter DataSource="AT030.TXKANJI" FieldOptions="SCAN,CAPTION(得意先名SCAN)" Order="0020"/><Filter DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先C)" Order="0010"/></Function><Function ID="EF900" Name="年次売掛残高繰越処理" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rET010; var uET010; var rET100;#EOL#var amJyuryoCur = 0; var amUriageCur = 0; var amJyuryoNew = 0; var amUriageNew = 0;#EOL#var amTorihiki = 0; var amKisyu = 0; var errorMessage = ''; var numberOfErrors = 0;#EOL#var amUriage = 0; var count = 0; var logMessage = '';#EOL##EOL#////////////////////////////////////#EOL#// 新旧の集計対象最過去年月の設定 //#EOL#////////////////////////////////////#EOL#var curNend = instance.parmMap.get('CUR_NEND');#EOL#var newNend = instance.parmMap.get('NEW_NEND');#EOL#var isCheckOnly = instance.parmMap.get('CHECK_ONLY');#EOL##EOL#///////////////////////#EOL#// 顧客(ET010)の読取 //#EOL#///////////////////////#EOL#rET010 = instance.createTableOperator('Select', 'ET010');#EOL#while (rET010.next()) {#EOL##EOL#&#x9;/////////////////////////////////////////#EOL#&#x9;// 関連する売上実績(ET100)の読取と集計 //#EOL#&#x9;/////////////////////////////////////////#EOL#&#x9;amJyuryoCur = 0; amUriageCur = 0; amJyuryoNew = 0; amUriageNew = 0;#EOL#&#x9;rET100 = instance.createTableOperator('Select', 'ET100');#EOL#&#x9;rET100.addKeyValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;rET100.addKeyValue('DTNEND >=',&#x9;&#x9;curNend);#EOL#&#x9;rET100.addKeyValue('IDTOKUISAKI',&#x9;rET010.getValueOf('IDTOKUISAKI'));#EOL#&#x9;while (rET100.next()) {#EOL#&#x9;&#x9;amTorihiki = Number(rET100.getValueOf('AMTORIHIKI')) + Number(rET100.getValueOf('AMTAX'));#EOL##EOL#&#x9;&#x9;/////////////////////#EOL#&#x9;&#x9;// 90 : 現預金受領 //#EOL#&#x9;&#x9;// 91 : 手形受領   //#EOL#&#x9;&#x9;// 92 : 手数料     //#EOL#&#x9;&#x9;/////////////////////#EOL#&#x9;&#x9;if (rET100.getValueOf('KBURITORI') == '90'#EOL#&#x9;&#x9;&#x9;|| rET100.getValueOf('KBURITORI') == '91'#EOL#&#x9;&#x9;&#x9;|| rET100.getValueOf('KBURITORI') == '92') {#EOL#&#x9;&#x9;&#x9;if (rET100.getValueOf('DTNEND') >= curNend) {#EOL#&#x9;&#x9;&#x9;&#x9;amJyuryoCur = Number(amJyuryoCur) + Number(amTorihiki);#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;if (rET100.getValueOf('DTNEND') == newNend) {#EOL#&#x9;&#x9;&#x9;&#x9;amJyuryoNew = Number(amJyuryoNew) + Number(amTorihiki);#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;} else {#EOL##EOL#&#x9;&#x9;&#x9;/////////////////////#EOL#&#x9;&#x9;&#x9;// 00 : 出荷売上   //#EOL#&#x9;&#x9;&#x9;// 01 : 直出荷売上 //#EOL#&#x9;&#x9;&#x9;// 11 : 振替計上   //#EOL#&#x9;&#x9;&#x9;/////////////////////#EOL#&#x9;&#x9;&#x9;if (rET100.getValueOf('KBURITORI') == '00'#EOL#&#x9;&#x9;&#x9;&#x9;|| rET100.getValueOf('KBURITORI') == '01'#EOL#&#x9;&#x9;&#x9;&#x9;|| rET100.getValueOf('KBURITORI') == '11') {#EOL#&#x9;&#x9;&#x9;&#x9;if (rET100.getValueOf('DTNEND') >= curNend) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amUriageCur = Number(amUriageCur) + Number(amTorihiki);#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;if (rET100.getValueOf('DTNEND') == newNend) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amUriageNew = Number(amUriageNew) + Number(amTorihiki);#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;///////////////////#EOL#&#x9;&#x9;&#x9;// 02 : 売上返品 //#EOL#&#x9;&#x9;&#x9;// 10 : 振替控除 //#EOL#&#x9;&#x9;&#x9;///////////////////#EOL#&#x9;&#x9;&#x9;if (rET100.getValueOf('KBURITORI') == '02'#EOL#&#x9;&#x9;&#x9;&#x9;|| rET100.getValueOf('KBURITORI') == '10') {#EOL#&#x9;&#x9;&#x9;&#x9;if (rET100.getValueOf('DTNEND') >= curNend) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amUriageCur = Number(amUriageCur) - Number(amTorihiki);#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;if (rET100.getValueOf('DTNEND') == newNend) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amUriageNew = Number(amUriageNew) - Number(amTorihiki);#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;/////////////////////////////////////#EOL#&#x9;// 合算チェックと顧客(ET010)の更新 //#EOL#&#x9;/////////////////////////////////////#EOL#&#x9;if (rET010.getValueOf('AMURIAGE') == amUriageCur &amp;&amp; rET010.getValueOf('AMJYURYO') == amJyuryoCur) {#EOL#&#x9;&#x9;if (isCheckOnly == 'false') {#EOL#&#x9;&#x9;&#x9;amKisyu = Number(rET010.getValueOf('AMKISYU'))#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; + Number(amUriageCur) - Number(amUriageNew) - Number(amJyuryoCur) + Number(amJyuryoNew);#EOL#&#x9;&#x9;&#x9;uET010 = instance.createTableOperator('Update', 'ET010');#EOL#&#x9;&#x9;&#x9;uET010.addValue('AMKISYU',&#x9;&#x9;amKisyu);#EOL#&#x9;&#x9;&#x9;uET010.addValue('AMURIAGE',&#x9;&#x9;amUriageNew);#EOL#&#x9;&#x9;&#x9;uET010.addValue('AMJYURYO',&#x9;&#x9;amJyuryoNew);#EOL#&#x9;&#x9;&#x9;uET010.addValue('UPDCOUNTER',&#x9;Number(rET010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;uET010.addKeyValue('IDTOKUISAKI',&#x9;&#x9;rET010.getValueOf('IDTOKUISAKI'));#EOL#&#x9;&#x9;&#x9;uET010.addKeyValue('UPDCOUNTER',&#x9;&#x9;rET010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;count = uET010.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '顧客(ET010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;numberOfErrors++;#EOL#&#x9;&#x9;logMessage = '顧客(' + rET010.getValueOf('IDTOKUISAKI') +#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;')の計上額(' + rET010.getValueOf('AMURIAGE') + #EOL#&#x9;&#x9;&#x9;&#x9;&#x9;')と受領額(' + rET010.getValueOf('AMJYURYO') +#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;')が、売掛増減履歴を合算した計上額(' + amUriageCur + ')と受領額(' + amJyuryoCur +#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;')に一致しません。';#EOL#&#x9;&#x9;instance.setProcessLog(logMessage);#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////////////////#EOL#// エラー処理と診断結果の登録 //#EOL#////////////////////////////////#EOL#if (errorMessage == '') {#EOL#&#x9;instance.parmMap.put('NUMBER_OF_ERRORS_EF900', numberOfErrors);#EOL#} else {#EOL#&#x9;instance.returnMap.put('RETURN_MESSAGE', '＊処理は取り消されました。');#EOL#}" SubsystemID="E" Type="XF000"/><Function ID="EF990" Name="請求･受領パージ処理" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rET110; var dET110; var rET120; var dET120;#EOL#var limitDate = instance.parmMap.get('LIMIT_DATE');#EOL#var countET110_ToBeDeleted = 0; var countET110_Deleted = 0;#EOL#var countET120_ToBeDeleted = 0; var countET120_Deleted = 0;#EOL##EOL#//////////////////////////#EOL#// 削除結果の省略値登録 //#EOL#//////////////////////////#EOL#instance.returnMap.put('ET110_COUNT', -1);#EOL#instance.returnMap.put('ET120_COUNT', -1);#EOL##EOL#////////////////////#EOL#// ET110 削除処理 //#EOL#////////////////////#EOL#rET110 = instance.createTableOperator('Count', 'ET110');#EOL#rET110.addKeyValue('DTSEIKYU &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#countET110_ToBeDeleted = rET110.execute();#EOL#dET110 = instance.createTableOperator('Delete', 'ET110');#EOL#dET110.addKeyValue('DTSEIKYU &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#countET110_Deleted = dET110.execute();#EOL#if (countET110_Deleted == countET110_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('ET110_COUNT', countET110_ToBeDeleted);#EOL#}#EOL##EOL#////////////////////#EOL#// ET120 削除処理 //#EOL#////////////////////#EOL#rET120 = instance.createTableOperator('Count', 'ET120');#EOL#rET120.addKeyValue('DTJYURYOU &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#countET120_ToBeDeleted = rET120.execute();#EOL#dET120 = instance.createTableOperator('Delete', 'ET120');#EOL#dET120.addKeyValue('DTJYURYOU &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#countET120_Deleted = dET120.execute();#EOL#if (countET120_Deleted == countET120_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('ET120_COUNT', countET120_ToBeDeleted);#EOL#}" SubsystemID="E" Type="XF000"/><Function ID="EF999" Name="売掛増減履歴パージ処理" Script="////////////////#EOL#// 変数の定義 //#EOL#////////////////#EOL#var limitDate = instance.parmMap.get('LIMIT_DATE');#EOL#var countToBeDeleted = 0; var countDeleted = 0; var isToBeDeleted = false;#EOL##EOL#//////////////////////////#EOL#// 削除結果の省略値登録 //#EOL#//////////////////////////#EOL#instance.returnMap.put('ET100_COUNT', -1);#EOL##EOL#//////////////////////////#EOL#// ET100 削除対象の検索 //#EOL#//////////////////////////#EOL#var rET100 = instance.createTableOperator('Select', 'ET100');#EOL#rET100.setSelectFields('NRURIKAKE, KBURITORI, NRSOURCE');#EOL#rET100.addKeyValue('DTTORIHIKI &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#while (rET100.next()) {#EOL##EOL#&#x9;//////////////////////////////#EOL#&#x9;// 削除対象フラグのリセット //#EOL#&#x9;//////////////////////////////#EOL#&#x9;isToBeDeleted = false;#EOL##EOL#&#x9;/////////////////////////////////#EOL#&#x9;// 00(出荷売上) JT010 製造指示 //#EOL#&#x9;/////////////////////////////////#EOL#&#x9;if (rET100.getValueOf('KBURITORI') == '00') {#EOL#&#x9;&#x9;var rJT010 = instance.createTableOperator('Count', 'JT010');#EOL#&#x9;&#x9;rJT010.addKeyValue('NRSOURCE',&#x9;rET100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rJT010.execute() == 0) {#EOL#&#x9;&#x9;&#x9;isToBeDeleted = true;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////#EOL#&#x9;// 01(直出荷売上),02(売上返品) LT020 特殊売上 //#EOL#&#x9;////////////////////////////////////////////////#EOL#&#x9;if (rDT100.getValueOf('KBURITORI') == '01' || rDT100.getValueOf('KBURITORI') == '02') {#EOL#&#x9;&#x9;var rLT020 = instance.createTableOperator('Count', 'LT020');#EOL#&#x9;&#x9;rLT020.addKeyValue('NRSOURCE',&#x9;rET100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rLT020.execute() == 0) {#EOL#&#x9;&#x9;&#x9;isToBeDeleted = true;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////////////////////////////////#EOL#&#x9;// 10(振替控除),11(振替計上) LT010 売掛振替 //#EOL#&#x9;//////////////////////////////////////////////#EOL#&#x9;if (rDT100.getValueOf('KBURITORI') == '10' || rDT100.getValueOf('KBURITORI') == '11') {#EOL#&#x9;&#x9;var rLT010 = instance.createTableOperator('Count', 'LT010');#EOL#&#x9;&#x9;rLT010.addKeyValue('NRSOURCE',&#x9;rET100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rLT010.execute() == 0) {#EOL#&#x9;&#x9;&#x9;isToBeDeleted = true;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;/////////////////////////////////////////////////////////#EOL#&#x9;// 90(現金受領),91(手形受領),92(手数料) ET120 受領明細 //#EOL#&#x9;/////////////////////////////////////////////////////////#EOL#&#x9;if (rET100.getValueOf('KBURITORI') == '90' || rET100.getValueOf('KBURITORI') == '91' || rET100.getValueOf('KBURITORI') == '92') {#EOL#&#x9;&#x9;var rET120 = instance.createTableOperator('Count', 'ET120');#EOL#&#x9;&#x9;rET120.addKeyValue('NRSOURCE',&#x9;rET100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rET120.execute() == 0) {#EOL#&#x9;&#x9;&#x9;isToBeDeleted = true;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;//////////////#EOL#&#x9;// 削除処理 //#EOL#&#x9;//////////////#EOL#&#x9;if (isToBeDeleted) {#EOL#&#x9;&#x9;countToBeDeleted++;#EOL#&#x9;&#x9;var dET100 = instance.createTableOperator('Delete', 'ET100');#EOL#&#x9;&#x9;dET100.addKeyValue('NRURIAGE',&#x9;rET100.getValueOf('NRURIAGE'));#EOL#&#x9;&#x9;if (dET100.execute() == 1) {#EOL#&#x9;&#x9;&#x9;countDeleted++;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////#EOL#// 削除結果の登録 //#EOL#////////////////////#EOL#if (countToBeDeleted == countDeleted) {#EOL#&#x9;instance.returnMap.put('ET100_COUNT', countToBeDeleted);#EOL#}" SubsystemID="E" Type="XF000"/><Function DetailFunction="DF011" ID="DF010" InitialListing="T" InitialMsg="" KeyFields="IDSIIRESAKI" Name="仕入先マスターの一覧・保守" OrderBy="" PrimaryTable="DT010" Size="AUTO" SubsystemID="D" Type="XF100"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(DF012)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="DT010.AMGENKAIKAKE" FieldOptions="" Order="0090"/><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C)" Order="0060"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(仕入先名)" Order="0070"/><Column DataSource="AT030.TXJYUSYO1" FieldOptions="" Order="0080"/><Filter DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C)" Order="0010"/><Filter DataSource="AT030.TXKANJI" FieldOptions="SCAN,CAPTION(仕入先名SCAN)" Order="0020"/></Function><Function HeaderFunction="DF012" HeaderKeyFields="" HeaderTable="DT010" ID="DF011" Name="仕入先関連情報の確認" Size="AUTO" SubsystemID="D" Type="XF300"><Field DataSource="DT010.TXHURIKOMI" FieldOptions="HORIZONTAL" Order="0060"/><Field DataSource="DT010.TXTEKIYO" FieldOptions="WIDTH(938)" Order="0110"/><Field DataSource="DT010.AMSIIRE" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(30)" Order="0080"/><Field DataSource="DT010.AMSIHARAI" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(30)" Order="0090"/><Detail Caption="買掛増減履歴" DetailFunction="DF101" HeaderKeyFields="IDSIIRESAKI" InitialListing="T" InitialMsg="" KeyFields="IDSIIRESAKI;NRKAIKAKE" Order="0010" Table="DT100"><Column DataSource="DT100.NRKAIKAKE" FieldOptions="" Order="0020"/><Column DataSource="DT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="DT100.KBAKADEN" FieldOptions="" Order="0030"/><Column DataSource="DT100.FGVALID" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="仕入先情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="DT100.KBKAITORI" FieldOptions="" Order="0050"/><Column DataSource="DT100.TXHINMEI" FieldOptions="WIDTH(300)" Order="0060"/><Filter DataSource="DT100.DTTORIHIKI" FieldOptions="GE,CAPTION(取引日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Filter DataSource="DT100.KBKAITORI" FieldOptions="PROMPT_LIST1" Order="0020"/><Filter DataSource="DT100.FGVALID" FieldOptions="PROMPT_LIST1,VALUE(VALUE:T)" Order="0030"/><Column DataSource="DT100.AMZOUGEN" FieldOptions="" Order="0070"/></Detail><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先c)" Order="0010"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Field DataSource="AT030.TXJYUSYO1" FieldOptions="" Order="0030"/><Field DataSource="DT010.AMGENKAIKAKE" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(30)" Order="0100"/><Detail Caption="支払依頼" DetailFunction="DF112" HeaderKeyFields="IDSIIRESAKI" InitialMsg="" KeyFields="IDSIIRESAKI;NRSIHARAI" Order="0020" Table="DT110"><Column DataSource="DT110.NRSIHARAI" FieldOptions="" Order="0020"/><Column DataSource="DT110.DTSIHARAI" FieldOptions="" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="HEADER" Caption="見出し情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Filter DataSource="DT110.DTSIHARAI" FieldOptions="GE,CAPTION(支払指示日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" FieldOptions_CAPTION="GE,CAPTION(支払指示日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Column DataSource="DT110.AMSIHARAI" FieldOptions="" Order="0040"/><Column DataSource="DT110.TXSEIKYU" FieldOptions="" Order="0030"/><Column DataSource="DT110.STSIHARAI" FieldOptions="" Order="0050"/></Detail><Field DataSource="DT010.AMKISYU" FieldOptions="" Order="0070"/><Field DataSource="DT010.KBSIHARAI" FieldOptions="" Order="0050"/><Detail Caption="月次取引" DetailFunction="YF210" HeaderKeyFields="" InitialMsg="" KeyFields="IDSIIRESAKI;DTNEND;DTMSEQ" Order="0030" Table="YT200"><Column DataSource="YT200.DTNEND" FieldOptions="" Order="0010"/><Column DataSource="YT200.DTMSEQ" FieldOptions="" Order="0020"/><Column DataSource="YT200.AMKIKANSIHA" FieldOptions="" Order="0050"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="仕入先情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="YT200.AMKAIKAKE" FieldOptions="" Order="0060"/><Column DataSource="YT200.AMKIKANKAI" FieldOptions="" Order="0040"/></Detail></Function><Function DataName="仕入先" FunctionAfterInsert="DF011" ID="DF012" InitialMsg="" KeyFields="IDSIIRESAKI" Name="仕入先マスターの保守" PrimaryTable="DT010" Size="AUTO" SubsystemID="D" Type="XF200"><Field DataSource="DT010.TXHURIKOMI" FieldOptions="HORIZONTAL" Order="0090"/><Field DataSource="DT010.TXTEKIYO" FieldOptions="WIDTH(937)" Order="0140"/><Field DataSource="DT010.AMSIIRE" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(30)" Order="0110"/><Field DataSource="DT010.AMSIHARAI" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(30)" Order="0120"/><Field DataSource="DT010.AMGENKAIKAKE" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(30)" Order="0130"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先),PROMPT_CALL(AF120),PROMPT_CALL_TO_GET(AT030.IDTORIHIKISAKI;AT030.TXKANJI;AT030.CDTORIHIKISAKI;AT030.TXJYUSYO1),PROMPT_CALL_TO_GET_TO(DT010.IDSIIRESAKI;AT030.TXKANJI;AT030.CDTORIHIKISAKI;AT030.TXJYUSYO1)" Order="0010"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Field DataSource="AT030.NRYUBIN" FieldOptions="CAPTION(住所)" Order="0030"/><Field DataSource="AT030.TXJYUSYO1" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Field DataSource="AT030.TXJYUSYO2" FieldOptions="CAPTION(　)" Order="0050"/><Field DataSource="AT030.NRDENWA" FieldOptions="HORIZONTAL" Order="0060"/><Field DataSource="DT010.AMKISYU" FieldOptions="" Order="0100"/><Field DataSource="DT010.KBSIHARAI" FieldOptions="" Order="0080"/></Function><Function DetailFunction="DF101" ID="DF100" InitialListing="T" InitialMsg="" KeyFields="NRKAIKAKE" Name="買掛増減履歴の一覧" OrderBy="" PrimaryTable="DT100" Size="AUTO" SubsystemID="D" Type="XF100"><Column DataSource="DT100.NRKAIKAKE" FieldOptions="CAPTION(取引№)" Order="0020"/><Column DataSource="DT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="DT100.KBAKADEN" FieldOptions="" Order="0030"/><Filter DataSource="DT100.DTTORIHIKI" FieldOptions="GE,CAPTION(取引日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="DT100.KBKAITORI" FieldOptions="" Order="0050"/><Column DataSource="DT100.FGVALID" FieldOptions="" Order="0040"/><Column DataSource="DT100.TXHINMEI" FieldOptions="" Order="0080"/><Column DataSource="DT100.NRSIHARAI" FieldOptions="" Order="0110"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(仕入先名)" Order="0070"/><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先Ｃ)" Order="0060"/><Filter DataSource="DT100.KBKAITORI" FieldOptions="PROMPT_CALL(DF810),PROMPT_CALL_TO_PUT(DT100.KBKAITORI),PROMPT_CALL_TO_PUT_TO(DT100.KBKAITORI),PROMPT_CALL_TO_GET(DT100.KBKAITORI),PROMPT_CALL_TO_GET_TO(DT100.KBKAITORI)" Order="0020"/><Filter DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先Ｃ)" Order="0030"/><Filter DataSource="DT100.FGVALID" FieldOptions="PROMPT_LIST1,VALUE(VALUE:T)" Order="0050"/><Column DataSource="DT100.AMZOUGEN" FieldOptions="" Order="0090"/><Filter DataSource="DT100.TXHINMEI" FieldOptions="SCAN,CAPTION(品名／摘要SCAN)" Order="0040"/></Function><Function ID="DF101" InitialMsg="" KeyFields="NRKAIKAKE" Name="買掛増減履歴の表示" PrimaryTable="DT100" Size="AUTO" SubsystemID="D" Type="XF200"><Field DataSource="DT100.NRKAIKAKE" FieldOptions="" Order="0010"/><Field DataSource="DT100.DTTORIHIKI" FieldOptions="" Order="0060"/><Field DataSource="DT100.KBAKADEN" FieldOptions="CAPTION(伝票区分),CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0020"/><Field DataSource="DT100.FGVALID" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0030"/><Field DataSource="DT100.PRTORIHIKI" FieldOptions="HORIZONTAL" Order="0140"/><Field DataSource="DT100.QTTORIHIKI" FieldOptions="" Order="0120"/><Field DataSource="DT100.AMTAX" FieldOptions="HORIZONTAL(59)" Order="0160"/><Field DataSource="DT100.NRSIHARAI" FieldOptions="" Order="0170"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="DT100.KBKAITORI" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0040"/><Field DataSource="DT100.TXHINMEI" FieldOptions="" Order="0110"/><Field DataSource="DT100.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0130"/><Field DataSource="DT100.AMTORIHIKI" FieldOptions="" Order="0150"/><Field DataSource="DT100.TXREFNO" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(40)" Order="0180"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0100"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C)" Order="0090"/><Field DataSource="DT100.DTCREATE" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(40)" Order="0190"/><Button Action="CALL(DF102)" Caption="元取引" Number="8" Position="4"/><Button Action="CALL(DF113)" Caption="依頼取消" Number="9" Position="5"/><Field DataSource="DT100.KBKAIHURI" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0050"/><Field DataSource="DT100.DTNEND" FieldOptions="CAPTION(取引年月度),HORIZONTAL" Order="0070"/><Field DataSource="DT100.DTMSEQ" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0080"/></Function><Function ID="DF102" Name="買掛取引情報表示切替処理" Script="///////////////////////////////////////#EOL#// 当該買掛増減履歴(DT100)の読み込み //#EOL#///////////////////////////////////////#EOL#var rDT100 = instance.createTableOperator('Select', 'DT100');#EOL#rDT100.setSelectFields('KBKAITORI, NRSOURCE');#EOL#rDT100.addKeyValue('NRKAIKAKE',&#x9;instance.parmMap.get('NRKAIKAKE'));#EOL#if (rDT100.next()) {#EOL##EOL#&#x9;/////////////////////////////////#EOL#&#x9;// 00(入荷仕入) HT011 入荷明細 //#EOL#&#x9;/////////////////////////////////#EOL#&#x9;if (rDT100.getValueOf('KBKAITORI') == '00') {#EOL#&#x9;&#x9;var rHT011 = instance.createTableOperator('Select', 'HT011');#EOL#&#x9;&#x9;rHT011.setSelectFields('NRHATTYU, SQHATTYU');#EOL#&#x9;&#x9;rHT011.addKeyValue('NRSOURCE',&#x9;rDT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rHT011.next()) {#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('NRHATTYU',&#x9;rHT011.getValueOf('NRHATTYU'));#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('SQHATTYU',&#x9;rHT011.getValueOf('SQHATTYU'));#EOL#&#x9;&#x9;&#x9;instance.callFunction('HF026');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;showMessage('取引の元情報が存在しません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////#EOL#&#x9;// 01(直入荷仕入),02(仕入返品) KT020 特殊仕入 //#EOL#&#x9;////////////////////////////////////////////////#EOL#&#x9;if (rDT100.getValueOf('KBKAITORI') == '01' || rDT100.getValueOf('KBKAITORI') == '02') {#EOL#&#x9;&#x9;var rKT020 = instance.createTableOperator('Select', 'KT020');#EOL#&#x9;&#x9;rKT020.setSelectFields('NRTOKUSIIRE');#EOL#&#x9;&#x9;rKT020.addKeyValue('NRSOURCE',&#x9;rDT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rKT020.next()) {#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('NRTOKUSIIRE',&#x9;rKT020.getValueOf('NRTOKUSIIRE'));#EOL#&#x9;&#x9;&#x9;instance.callFunction('KF023');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;showMessage('取引の元情報が存在しません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////////////////////////////////#EOL#&#x9;// 10(振替控除),11(振替計上) KT010 買掛振替 //#EOL#&#x9;//////////////////////////////////////////////#EOL#&#x9;if (rDT100.getValueOf('KBKAITORI') == '10' || rDT100.getValueOf('KBKAITORI') == '11') {#EOL#&#x9;&#x9;var rKT010 = instance.createTableOperator('Select', 'KT010');#EOL#&#x9;&#x9;rKT010.setSelectFields('NRKAIHURI');#EOL#&#x9;&#x9;rKT010.addKeyValue('NRSOURCE',&#x9;rDT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rKT010.next()) {#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('NRKAIHURI',&#x9;rKT020.getValueOf('NRKAIHURI'));#EOL#&#x9;&#x9;&#x9;instance.callFunction('KF012');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;showMessage('取引の元情報が存在しません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;/////////////////////////////#EOL#&#x9;// 90(支払) DT110 支払依頼 //#EOL#&#x9;/////////////////////////////#EOL#&#x9;if (rDT100.getValueOf('KBKAITORI') == '90') {#EOL#&#x9;&#x9;var rDT110 = instance.createTableOperator('Select', 'DT110');#EOL#&#x9;&#x9;rDT110.setSelectFields('NRSIHARAI');#EOL#&#x9;&#x9;rDT110.addKeyValue('NRSOURCE',rDT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rDT110.next()) {#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('NRSIHARAI', rDT110.getValueOf('NRSIHARAI'));#EOL#&#x9;&#x9;&#x9;instance.callFunction('DF112');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;showMessage('取引の元情報が存在しません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL#" SubsystemID="D" Type="XF000"/><Function DetailFunction="DF112" ID="DF110" InitialListing="T" InitialMsg="" KeyFields="NRSIHARAI" Name="支払依頼の一覧・保守" OrderBy="" PrimaryTable="DT110" Size="AUTO" SubsystemID="D" Type="XF100"><Column DataSource="DT110.NRSIHARAI" FieldOptions="" Order="0020"/><Column DataSource="DT110.DTSIHARAI" FieldOptions="" Order="0010"/><Filter DataSource="DT110.NRSIHARAI" FieldOptions="" Order="0020"/><Filter DataSource="DT110.DTSIHARAI" FieldOptions="GE,CAPTION(支払依頼≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(DF111A)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="DT110.STSIHARAI" FieldOptions="" Order="0090"/><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先Ｃ)" Order="0030"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(仕入先名),WIDTH(250)" Order="0040"/><Column DataSource="DT110.AMSIHARAI" FieldOptions="" Order="0080"/><Column DataSource="DT110.TXSEIKYU" FieldOptions="WIDTH(200)" Order="0070"/><Filter DataSource="DT110.STSIHARAI" FieldOptions="PROMPT_LIST1" Order="0040"/><Filter DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先Ｃ)" Order="0030"/><Column DataSource="DT110.KBSIHARAI" FieldOptions="CAPTION(支払方法)" Order="0060"/></Function><Function HeaderFunction="DF114" HeaderKeyFields="" HeaderTable="DT110" ID="DF112" Name="支払依頼と関連情報の確認" Size="1150;700" SubsystemID="D" Type="XF300"><Field DataSource="DT110.NRSIHARAI" FieldOptions="" Order="0010"/><Field DataSource="DT110.DTSIHARAI" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="DT110.DTSYONIN" FieldOptions="HORIZONTAL" Order="0030"/><Detail Caption="仕入明細" DetailFunction="DF101" HeaderKeyFields="NRSIHARAI" InitialListing="T" InitialMsg="" KeyFields="NRSIHARAI;NRKAIKAKE" Order="0010" Table="DT100"><Column DataSource="DT100.NRKAIKAKE" FieldOptions="" Order="0020"/><Column DataSource="DT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="依頼見出し" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="DT100.KBKAITORI" FieldOptions="" Order="0030"/><Column DataSource="DT100.TXHINMEI" FieldOptions="WIDTH(200)" Order="0040"/><Column DataSource="DT100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0070"/><Column DataSource="DT100.PRTORIHIKI" FieldOptions="WIDTH(100)" Order="0050"/><Column DataSource="DT100.QTTORIHIKI" FieldOptions="" Order="0060"/><Column DataSource="DT100.AMTORIHIKI" FieldOptions="" Order="0080"/><Column DataSource="DT100.AMTAX" FieldOptions="WIDTH(100)" Order="0090"/><Button Action="CALL(DF115)" Caption="依頼書" Number="10" Position="5"/></Detail><Field DataSource="DT110.AMSIHARAI" FieldOptions="" Order="0060"/><Field DataSource="DT110.TXSEIKYU" FieldOptions="HORIZONTAL" Order="0070"/><Field DataSource="DT110.KBSIHARAI" FieldOptions="CAPTION(支払方法)" Order="0080"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先Ｃ)" Order="0040"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/><Field DataSource="DT010.TXHURIKOMI" FieldOptions="HORIZONTAL(68)" Order="0090"/><Field DataSource="DT110.TXTEKIYO" FieldOptions="WIDTH(900)" Order="0110"/><Detail Caption="買掛増減履歴" DetailFunction="DF101" HeaderKeyFields="NRSOURCE" InitialMsg="" KeyFields="NRSOURCE;NRKAIKAKE" Order="0020" Table="DT100"><Column DataSource="DT100.NRKAIKAKE" FieldOptions="" Order="0020"/><Column DataSource="DT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="DT100.KBKAITORI" FieldOptions="" Order="0050"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="HEADER" Caption="見出し情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="DT100.TXHINMEI" FieldOptions="" Order="0060"/><Column DataSource="DT100.AMTORIHIKI" FieldOptions="" Order="0070"/><Column DataSource="DT100.KBAKADEN" FieldOptions="" Order="0030"/><Column DataSource="DT100.FGVALID" FieldOptions="" Order="0040"/></Detail></Function><Function ID="DF114" InitialMsg="" KeyFields="NRSIHARAI" Name="支払依頼の保守" PrimaryTable="DT110" Size="AUTO" SubsystemID="D" Type="XF200"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="DT110.NRSIHARAI" FieldOptions="" Order="0010"/><Field DataSource="DT110.DTSIHARAI" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="DT110.DTSYONIN" FieldOptions="HORIZONTAL" Order="0030"/><Field DataSource="DT110.AMSIHARAI" FieldOptions="" Order="0060"/><Field DataSource="DT110.TXSEIKYU" FieldOptions="HORIZONTAL" Order="0070"/><Field DataSource="DT110.KBSIHARAI" FieldOptions="CAPTION(支払方法)" Order="0080"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先Ｃ)" Order="0040"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/><Field DataSource="DT010.TXHURIKOMI" FieldOptions="HORIZONTAL(48)" Order="0090"/><Field DataSource="DT110.TXTEKIYO" FieldOptions="WIDTH(900)" Order="0110"/></Function><Function DetailKeyFields="NRSIHARAI;NRKAIKAKE" DetailTable="DT100" Direction="LANDSCAPE" HeaderKeyFields="NRSIHARAI" HeaderTable="DT110" ID="DF115" Margins="50;50;50;50" Name="支払依頼書の印刷" PageSize="A4" SubsystemID="D" TableFontID="Font1" TableFontSize="9" TableRowNoWidth="5" Type="XF390" WithPageNumber="T"><Detail Caption="" CaptionFontSize="12" FixedWhere="" FontID="Font1" FontSize="9" HeaderKeyFields="" KeyFields="NRSIHARAI;NRKAIKAKE" Order="0010" OrderBy="" RowNoWidth="5" Table="DT100"><Column Alignment="LEFT" DataSource="DT100.NRKAIKAKE" FieldOptions="" Order="0020" Width="8"/><Column Alignment="LEFT" DataSource="DT100.DTTORIHIKI" FieldOptions="" Order="0010" Width="9"/><Column Alignment="LEFT" DataSource="DT100.KBKAITORI" FieldOptions="" Order="0030" Width="10"/><Column Alignment="LEFT" DataSource="DT100.TXHINMEI" FieldOptions="" Order="0040" Width="30"/><Column Alignment="CENTER" DataSource="DT100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0070" Width="5"/><Column Alignment="RIGHT" DataSource="DT100.PRTORIHIKI" FieldOptions="" Order="0050" Width="8"/><Column Alignment="RIGHT" DataSource="DT100.QTTORIHIKI" FieldOptions="" Order="0060" Width="8"/><Column Alignment="RIGHT" DataSource="DT100.AMTORIHIKISIGN" FieldOptions="CAPTION(税抜取引額),WITH_TOTAL" Order="0100" Width="9"/><Column Alignment="RIGHT" DataSource="DT100.AMTAXSIGN" FieldOptions="CAPTION(消費税額),WITH_TOTAL" Order="0110" Width="8"/></Detail><HeaderPhrase Alignment="CENTER" Block="HEADER" FontID="Font1" FontSize="15" FontStyle="BOLD" Order="0000" Value="&amp;Text(支　払　依　頼　書)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0010" SpacingAfter="0" Value="&amp;Text(支払依頼№ )&amp;DataSource(DT110.NRSIHARAI)&amp;Text(　　依頼日 )&amp;DataSource(DT110.DTSIHARAI)&amp;Text(　　相手先請求番号 )&amp;DataSource(DT110.TXSEIKYU)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0020" SpacingAfter="0" Value="&amp;Text(　　仕入先 )&amp;DataSource(AT030.TXKANJI)&amp;Text(　　支払依頼額 )&amp;DataSource(DT110.AMSIHARAI)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0021" SpacingAfter="0" Value="&amp;Text(　支払方法 )&amp;DataSource(DT110.KBSIHARAI)&amp;Text(　　振込銀行口座 )&amp;DataSource(DT010.TXHURIKOMI)"/></Function><Function DetailFunction="DF121" ID="DF120" InitialListing="T" InitialMsg="" KeyFields="NRSIHARAI" Name="支払依頼の一覧・承認" OrderBy="" PrimaryTable="DT110" Size="AUTO" SubsystemID="D" Type="XF100"><Column DataSource="DT110.NRSIHARAI" FieldOptions="" Order="0020"/><Column DataSource="DT110.DTSIHARAI" FieldOptions="" Order="0010"/><Filter DataSource="DT110.DTSIHARAI" FieldOptions="GE,CAPTION(支払依頼日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="DT110.KBSIHARAI" FieldOptions="CAPTION(支払方法)" Order="0050"/><Column DataSource="DT110.STSIHARAI" FieldOptions="" Order="0070"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(仕入先)" Order="0040"/><Column DataSource="DT110.AMSIHARAI" FieldOptions="" Order="0060"/><Filter DataSource="DT110.STSIHARAI" FieldOptions="PROMPT_LIST1,VALUE(VALUE:10)" Order="0020"/></Function><Function DetailFunction="" ID="DF800" InitialListing="T" InitialMsg="" KeyFields="IDSIIRESAKI" Name="仕入先検索" OrderBy="" ParmType="COLUMNS" PrimaryTable="DT010" Size="AUTO" SubsystemID="D" Type="XF100"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="DT010.AMGENKAIKAKE" FieldOptions="" Order="0090"/><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C)" Order="0060"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(仕入先名)" Order="0070"/><Column DataSource="AT030.TXJYUSYO1" FieldOptions="" Order="0080"/><Filter DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C)" Order="0010"/><Filter DataSource="AT030.TXKANJI" FieldOptions="SCAN,CAPTION(仕入先名SCAN)" Order="0020"/></Function><Function ID="DF900" Name="年次買掛残高繰越処理" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rDT010; var uDT010; var rDT100;#EOL#var amSiharaiCur = 0; var amSiireCur = 0; var amSiharaiNew = 0; var amSiireNew = 0;#EOL#var amTorihiki = 0; var amKisyu = 0; var errorMessage = ''; var numberOfErrors = 0;#EOL#var amTorihiki = 0; var count = 0; var logMessage = '';#EOL##EOL#////////////////////////////////////#EOL#// 新旧の集計対象最過去年月の設定 //#EOL#////////////////////////////////////#EOL#var curNend = instance.parmMap.get('CUR_NEND');#EOL#var newNend = instance.parmMap.get('NEW_NEND');#EOL#var isCheckOnly = instance.parmMap.get('CHECK_ONLY');#EOL##EOL#/////////////////////////#EOL#// 仕入先(DT010)の読取 //#EOL#/////////////////////////#EOL#rDT010 = instance.createTableOperator('Select', 'DT010');#EOL#while (rDT010.next()) {#EOL##EOL#&#x9;/////////////////////////////////////////////#EOL#&#x9;// 関連する買掛増減履歴(DT100)の読取と集計 //#EOL#&#x9;/////////////////////////////////////////////#EOL#&#x9;amSiharaiCur = 0; amSiireCur = 0; amSiharaiNew = 0; amSiireNew = 0;#EOL#&#x9;rDT100 = instance.createTableOperator('Select', 'DT100');#EOL#&#x9;rDT100.addKeyValue('FGVALID',&#x9;&#x9;'T');#EOL#&#x9;rDT100.addKeyValue('DTNEND >=',&#x9;&#x9;curNend);#EOL#&#x9;rDT100.addKeyValue('IDSIIRESAKI',&#x9;rDT010.getValueOf('IDSIIRESAKI'));#EOL#&#x9;while (rDT100.next()) {#EOL#&#x9;&#x9;amTorihiki = Number(rDT100.getValueOf('AMTORIHIKI')) + Number(rDT100.getValueOf('AMTAX'));#EOL##EOL#&#x9;&#x9;///////////////#EOL#&#x9;&#x9;// 90 : 支払 //#EOL#&#x9;&#x9;///////////////#EOL#&#x9;&#x9;if (rDT100.getValueOf('KBKAITORI') == '90') {#EOL#&#x9;&#x9;&#x9;if (rDT100.getValueOf('KBAKADEN') == '1') {#EOL#&#x9;&#x9;&#x9;&#x9;if (rDT100.getValueOf('DTNEND') >= curNend) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amSiharaiCur = Number(amSiharaiCur) + Number(amTorihiki);#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;if (rDT100.getValueOf('DTNEND') == newNend) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amSiharaiNew = Number(amSiharaiNew) + Number(amTorihiki);#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;if (rDT100.getValueOf('DTNEND') >= curNend) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amSiharaiCur = Number(amSiharaiCur) - Number(amTorihiki);#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;if (rDT100.getValueOf('DTNEND') == newNend) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amSiharaiNew = Number(amSiharaiNew) - Number(amTorihiki);#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;} else {#EOL##EOL#&#x9;&#x9;&#x9;/////////////////////#EOL#&#x9;&#x9;&#x9;// 00 : 入荷仕入   //#EOL#&#x9;&#x9;&#x9;// 01 : 直入荷仕入 //#EOL#&#x9;&#x9;&#x9;// 11 : 振替計上   //#EOL#&#x9;&#x9;&#x9;/////////////////////#EOL#&#x9;&#x9;&#x9;if (rDT100.getValueOf('KBKAITORI') == '00'#EOL#&#x9;&#x9;&#x9;&#x9;|| rDT100.getValueOf('KBKAITORI') == '01'#EOL#&#x9;&#x9;&#x9;&#x9;|| rDT100.getValueOf('KBKAITORI') == '11') {#EOL#&#x9;&#x9;&#x9;&#x9;if (rDT100.getValueOf('DTNEND') >= curNend) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amSiireCur = Number(amSiireCur) + Number(amTorihiki);#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;if (rDT100.getValueOf('DTNEND') == newNend) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amSiireNew = Number(amSiireNew) + Number(amTorihiki);#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;///////////////////#EOL#&#x9;&#x9;&#x9;// 02 : 仕入返品 //#EOL#&#x9;&#x9;&#x9;// 10 : 振替控除 //#EOL#&#x9;&#x9;&#x9;///////////////////#EOL#&#x9;&#x9;&#x9;if (rDT100.getValueOf('KBKAITORI') == '02'#EOL#&#x9;&#x9;&#x9;&#x9;|| rDT100.getValueOf('KBKAITORI') == '10') {#EOL#&#x9;&#x9;&#x9;&#x9;if (rDT100.getValueOf('DTNEND') >= curNend) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amSiireCur = Number(amSiireCur) - Number(amTorihiki);#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;if (rDT100.getValueOf('DTNEND') == newNend) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amSiireNew = Number(amSiireNew) - Number(amTorihiki);#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////////////////#EOL#&#x9;// 合算チェックと仕入先(DT010)の更新 //#EOL#&#x9;///////////////////////////////////////#EOL#&#x9;if (rDT010.getValueOf('AMSIIRE') == amSiireCur &amp;&amp; rDT010.getValueOf('AMSIHARAI') == amSiharaiCur) {#EOL#&#x9;&#x9;if (isCheckOnly == 'false') {#EOL#&#x9;&#x9;&#x9;amKisyu = Number(rDT010.getValueOf('AMKISYU'))#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; + Number(amSiireCur) - Number(amSiireNew) - Number(amSiharaiCur) + Number(amSiharaiNew);#EOL#&#x9;&#x9;&#x9;uDT010 = instance.createTableOperator('Update', 'DT010');#EOL#&#x9;&#x9;&#x9;uDT010.addValue('AMKISYU',&#x9;&#x9;amKisyu);#EOL#&#x9;&#x9;&#x9;uDT010.addValue('AMSIIRE',&#x9;&#x9;amSiireNew);#EOL#&#x9;&#x9;&#x9;uDT010.addValue('AMSIHARAI',&#x9;amSiharaiNew);#EOL#&#x9;&#x9;&#x9;uDT010.addValue('UPDCOUNTER',&#x9;Number(rDT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;uDT010.addKeyValue('IDSIIRESAKI',&#x9;rDT010.getValueOf('IDSIIRESAKI'));#EOL#&#x9;&#x9;&#x9;uDT010.addKeyValue('UPDCOUNTER',&#x9;rDT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;count = uDT010.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '仕入先(DT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;numberOfErrors++;#EOL#&#x9;&#x9;logMessage = '仕入先(' + rDT010.getValueOf('IDSIIRESAKI') +#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;')の計上額(' + rDT010.getValueOf('AMSIIRE') + #EOL#&#x9;&#x9;&#x9;&#x9;&#x9;')と支払額(' + rDT010.getValueOf('AMSIHARAI') +#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;')が、買掛増減履歴を合算した計上額(' + amSiireCur + ')と支払額(' + amSiharaiCur +#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;')に一致しません。';#EOL#&#x9;&#x9;instance.setProcessLog(logMessage);#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////////////////#EOL#// エラー処理と診断結果の登録 //#EOL#////////////////////////////////#EOL#if (errorMessage == '') {#EOL#&#x9;instance.parmMap.put('NUMBER_OF_ERRORS_DF900', numberOfErrors);#EOL#} else {#EOL#&#x9;instance.returnMap.put('RETURN_MESSAGE', '＊処理は取り消されました。');#EOL#}" SubsystemID="D" Type="XF000"/><Function ID="DF990" Name="支払依頼パージ処理" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rDT110; var dDT110;#EOL#var limitDate = instance.parmMap.get('LIMIT_DATE');#EOL#var countDT110_ToBeDeleted = 0; var countDT110_Deleted = 0;#EOL##EOL#//////////////////////////#EOL#// 削除結果の省略値登録 //#EOL#//////////////////////////#EOL#instance.returnMap.put('DT110_COUNT', -1);#EOL##EOL#////////////////////#EOL#// DT110 削除処理 //#EOL#////////////////////#EOL#rDT110 = instance.createTableOperator('Count', 'DT110');#EOL#rDT110.addKeyValue('DTSIHARAI &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#countDT110_ToBeDeleted = rDT110.execute();#EOL#dDT110 = instance.createTableOperator('Delete', 'DT110');#EOL#dDT110.addKeyValue('DTSIHARAI &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#countDT110_Deleted = dDT110.execute();#EOL#if (countDT110_Deleted == countDT110_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('DT110_COUNT', countDT110_ToBeDeleted);#EOL#}" SubsystemID="D" Type="XF000"/><Function DetailFunction="" FixedWhere="FGKOUNYU = 'T'" ID="BF110" InitialListing="T" InitialMsg="" KeyFields="" Name="発注品検索" OrderBy="" ParmType="COLUMNS" PrimaryTable="BT010" Size="AUTO" SubsystemID="B" Type="XF100"><Column DataSource="BT010.TXHINBAN" FieldOptions="CAPTION(発注品番)" Order="0010"/><Column DataSource="BT010.TXHINMEI" FieldOptions="CAPTION(発注品名)" Order="0020"/><Filter DataSource="BT010.TXHINBAN" FieldOptions="SCAN,CAPTION(品番SCAN)" Order="0010"/><Filter DataSource="BT010.TXHINMEI" FieldOptions="SCAN,CAPTION(品名SCAN)" Order="0020"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="BT010.KBUNITPUR" FieldOptions="CAPTION(発注単位)" Order="0030"/><Column DataSource="BT010.PRKOUNYU" FieldOptions="" Order="0040"/><Column DataSource="BT010.KBUNIT" FieldOptions="CAPTION(在庫単位)" Order="0050"/><Column DataSource="BT010.VLKANZAN" FieldOptions="CAPTION(換算係数)" Order="0060"/></Function><Function DetailFunction="" FixedWhere="FGHANBAI = 'T'" ID="BF120" InitialListing="T" InitialMsg="" KeyFields="" Name="受注品検索" OrderBy="" ParmType="COLUMNS" PrimaryTable="BT010" Size="AUTO" SubsystemID="B" Type="XF100"><Column DataSource="BT010.TXHINBAN" FieldOptions="CAPTION(受注品番)" Order="0010"/><Column DataSource="BT010.TXHINMEI" FieldOptions="CAPTION(受注品名)" Order="0020"/><Filter DataSource="BT010.TXHINBAN" FieldOptions="SCAN,CAPTION(品番SCAN)" Order="0010"/><Filter DataSource="BT010.TXHINMEI" FieldOptions="SCAN,CAPTION(品名SCAN)" Order="0020"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="BT010.KBUNIT" FieldOptions="" Order="0030"/></Function><Function DetailFunction="" FixedWhere="FGSEIZO = 'T'" ID="BF130" InitialListing="T" InitialMsg="" KeyFields="" Name="製造品検索" OrderBy="" ParmType="COLUMNS" PrimaryTable="BT010" Size="AUTO" SubsystemID="B" Type="XF100"><Column DataSource="BT010.TXHINBAN" FieldOptions="CAPTION(製造品番)" Order="0010"/><Column DataSource="BT010.TXHINMEI" FieldOptions="CAPTION(製造品名)" Order="0020"/><Filter DataSource="BT010.TXHINBAN" FieldOptions="SCAN,CAPTION(品番SCAN)" Order="0010"/><Filter DataSource="BT010.TXHINMEI" FieldOptions="SCAN,CAPTION(品名SCAN)" Order="0020"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0040"/></Function><Function AddRowListReturnDataSources="BT050.CDKOUTEI;BT050.TXNAME" AddRowListReturnToDetailDataSources="BT030.CDKOUTEI;BT050.TXNAME" AddRowListTable="BT050" DetailKeyFields="IDSEIZOHIN;SQKOUTEI" DetailTable="BT030" HeaderKeyFields="IDHINMOKU" HeaderTable="BT010" ID="BF030" Name="製造品工程明細の一括保守" Size="AUTO" SubsystemID="B" Type="XF310"><Field DataSource="BT010.TXHINBAN" FieldOptions="CAPTION(製造品)" Order="0010"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Field DataSource="BT010.KBUNIT" FieldOptions="HORIZONTAL" Order="0030"/><Column DataSource="BT030.SQLIST" FieldOptions="" Order="0010"/><Column DataSource="BT030.VLLTFIX" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="UPDATE" Caption="更新" Number="5" Position="2"/><Button Action="ADD_ROW" Caption="行追加" Number="6" Position="4"/><Button Action="REMOVE_ROW" Caption="行削除" Number="9" Position="5"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="BT030.VLLTQTY" FieldOptions="" Order="0050"/><Column DataSource="BT050.TXNAME" FieldOptions="CAPTION(工程),PROMPT_LIST" Order="0020"/><Column DataSource="BT050.FGPLANNING" FieldOptions="CAPTION(計画対象)" Order="0030"/><AddRowListColumn DataSource="BT050.TXNAME" FieldOptions="" Order="0010"/><AddRowListColumn DataSource="BT050.FGPLANNING" FieldOptions="" Order="0020"/><AddRowListButton Action="EXIT" Caption="終了" Number="3" Position="0"/><AddRowListButton Action="ADD_SELECTED" Caption="選択分追加" Number="6" Position="4"/><Column DataSource="BT060.TXCENTER" FieldOptions="CAPTION(標準作業場),PROMPT_LIST" Order="0070"/></Function><Function AddRowListReturnDataSources="BT010.IDHINMOKU;BT010.TXHINBAN;BT010.TXHINMEI;BT010.KBUNIT" AddRowListReturnToDetailDataSources="BT040.IDHINCHILD;BT010C.TXHINBAN;BT010C.TXHINMEI;BT010C.KBUNIT" AddRowListTable="BT010" DetailKeyFields="IDSEIZOHIN;SQZAIRYO" DetailTable="BT040" HeaderKeyFields="IDHINMOKU" HeaderTable="BT010" ID="BF040" Name="製造品材料明細の一括保守" Size="AUTO" SubsystemID="B" Type="XF310"><Field DataSource="BT010.TXHINBAN" FieldOptions="CAPTION(製造品)" Order="0010"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Field DataSource="BT010.KBUNIT" FieldOptions="HORIZONTAL" Order="0050"/><Column DataSource="BT040.VLKOUSEI" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="UPDATE" Caption="更新" Number="5" Position="2"/><Button Action="ADD_ROW" Caption="行追加" Number="6" Position="4"/><Button Action="REMOVE_ROW" Caption="行削除" Number="9" Position="5"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="BT010C.TXHINBAN" FieldOptions="" Order="0020"/><Column DataSource="BT010C.TXHINMEI" FieldOptions="" Order="0030"/><Column DataSource="BT010C.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0050"/><Column DataSource="BT040.SQLIST" FieldOptions="" Order="0010"/><AddRowListColumn DataSource="BT010.TXHINBAN" FieldOptions="" Order="0010"/><AddRowListColumn DataSource="BT010.TXHINMEI" FieldOptions="" Order="0020"/><AddRowListColumn DataSource="BT010.KBHINSYU" FieldOptions="" Order="0030"/><AddRowListColumn DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0040"/><Column DataSource="BT050.TXNAME" FieldOptions="CAPTION(投入工程),PROMPT_CALL(BF140),PROMPT_CALL_TO_PUT(BT010P.IDHINMOKU),PROMPT_CALL_TO_PUT_TO(BT010.IDHINMOKU),PROMPT_CALL_TO_GET(BT030.SQKOUTEI;BT050.TXNAME),PROMPT_CALL_TO_GET_TO(BT040.SQKOUTEI;BT050.TXNAME)" Order="0060"/></Function><Function FunctionAfterInsert="BF012" ID="BF011" InitialMsg="" KeyFields="" Name="品目の保守" PrimaryTable="BT010" Size="AUTO" SubsystemID="B" Type="XF200"><Field DataSource="BT010.IDHINMOKU" FieldOptions="" Order="0010"/><Field DataSource="BT010.TXHINBAN" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="BT010.TXHINMEI" FieldOptions="" Order="0030"/><Field DataSource="BT010.KBHINSYU" FieldOptions="" Order="0040"/><Field DataSource="BT010.PRGENKA" FieldOptions="HORIZONTAL" Order="0060"/><Field DataSource="BT010.KBUNIT" FieldOptions="CAPTION(扱い単位),HORIZONTAL" Order="0050"/><Field DataSource="BT010.KBUNITPUR" FieldOptions="CAPTION(発注単位),CAPTION_LENGTH_VARIABLE,HORIZONTAL(38)" Order="0140"/><Field DataSource="BT010.VLKANZAN" FieldOptions="HORIZONTAL" Order="0150"/><Field DataSource="BT010.FGKOUNYU" FieldOptions="CAPTION(購入対象),HORIZONTAL" Order="0090"/><Field DataSource="BT010.FGHANBAI" FieldOptions="CAPTION(販売対象),HORIZONTAL" Order="0100"/><Field DataSource="BT010.FGZAIKO" FieldOptions="CAPTION(在庫対象)" Order="0080"/><Field DataSource="BT010.TXTEKIYO" FieldOptions="WIDTH(805)" Order="0170"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="BT010.FGSEIZO" FieldOptions="CAPTION(製造対象),HORIZONTAL" Order="0110"/><Field DataSource="BT010.PRHANBAI" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(40)" Order="0070"/><Field DataSource="BT010.PRKOUNYU" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(40)" Order="0160"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(標準仕入先Ｃ),PROMPT_CALL(DF800),PROMPT_CALL_TO_GET(DT010.IDSIIRESAKI;AT030.CDTORIHIKISAKI),PROMPT_CALL_TO_GET_TO(BT010.IDSIIRESAKI;AT030.CDTORIHIKISAKI)" Order="0130"/></Function><Function DetailKeyFields="IDSEIZOHIN;SQSPEC" DetailTable="BT020" HeaderKeyFields="IDHINMOKU" HeaderTable="BT010" ID="BF020" Name="製造品仕様明細の一括保守" Size="AUTO" SubsystemID="B" Type="XF310"><Field DataSource="BT010.TXHINBAN" FieldOptions="CAPTION(製造品)" Order="0010"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Field DataSource="BT010.KBUNIT" FieldOptions="HORIZONTAL" Order="0050"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="UPDATE" Caption="更新" Number="5" Position="2"/><Button Action="ADD_ROW" Caption="行追加" Number="6" Position="4"/><Button Action="REMOVE_ROW" Caption="行削除" Number="9" Position="5"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="BT020.SQLIST" FieldOptions="" Order="0010"/><Column DataSource="BT020.KBSPEC" FieldOptions="" Order="0020"/><Column DataSource="BT020.TXTEKIYO" FieldOptions="" Order="0030"/></Function><Function HeaderFunction="BF011" HeaderKeyFields="" HeaderTable="BT010" ID="BF012" Name="品目と関連情報の確認" Size="1600;900" StructureChildKeys="IDHINCHILD" StructureNodeText="BT010.TXHINBAN;' ';BT010.TXHINMEI" StructureOrderBy="SQLIST" StructureRootText="TXHINBAN;' ';TXHINMEI" StructureTable="BT040" StructureUpperKeys="IDSEIZOHIN" StructureViewTitle="構成ツリー" StructureViewWidth="250" SubsystemID="B" Type="XF300"><Field DataSource="BT010.TXHINBAN" FieldOptions="CAPTION(品番／品名)" Order="0010"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Field DataSource="BT010.KBHINSYU" FieldOptions="" Order="0030"/><Field DataSource="BT010.PRGENKA" FieldOptions="HORIZONTAL" Order="0050"/><Field DataSource="BT010.KBUNIT" FieldOptions="CAPTION(扱い単位),HORIZONTAL" Order="0040"/><Field DataSource="BT010.KBUNITPUR" FieldOptions="CAPTION(発注単位),CAPTION_LENGTH_VARIABLE,HORIZONTAL(45)" Order="0130"/><Field DataSource="BT010.FGHANBAI" FieldOptions="CAPTION(販売対象),HORIZONTAL" Order="0090"/><Field DataSource="BT010.FGZAIKO" FieldOptions="CAPTION(在庫対象)" Order="0070"/><Field DataSource="BT010.VLKANZAN" FieldOptions="HORIZONTAL" Order="0140"/><Field DataSource="BT010.FGKOUNYU" FieldOptions="CAPTION(購入対象),HORIZONTAL" Order="0080"/><Field DataSource="BT010.TXTEKIYO" FieldOptions="WIDTH(804)" Order="0160"/><Detail Caption="倉庫在庫" DetailFunction="FF011" HeaderKeyFields="" InitialMsg="" KeyFields="" Order="0020" Table="FT010"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="品目情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="FT010.QTKISYU" FieldOptions="" Order="0030"/><Column DataSource="FT010.QTSYUKKO" FieldOptions="" Order="0050"/><Column DataSource="FT010.QTNYUKO" FieldOptions="" Order="0040"/><Column DataSource="FT010.QTGENZAIKO" FieldOptions="" Order="0060"/><Column DataSource="FT010.AMGENZAIKO" FieldOptions="" Order="0070"/><Column DataSource="AT040.TXSOUKO" FieldOptions="" Order="0020"/></Detail><Detail Caption="仕入履歴" DetailFunction="DF101" HeaderKeyFields="" InitialMsg="" KeyFields="IDHINMOKU;NRKAIKAKE" Order="0030" OrderBy="DT100.DTTORIHIKI(D)" Table="DT100"><Column DataSource="DT100.NRKAIKAKE" FieldOptions="" Order="0020"/><Column DataSource="DT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="品目情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="DT100.KBAKADEN" FieldOptions="" Order="0030"/><Column DataSource="DT100.FGVALID" FieldOptions="" Order="0040"/><Column DataSource="DT100.PRTORIHIKI" FieldOptions="" Order="0080"/><Column DataSource="DT100.QTTORIHIKI" FieldOptions="" Order="0090"/><Column DataSource="DT100.AMTAX" FieldOptions="" Order="0110"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(仕入先),WIDTH(200)" Order="0070"/><Column DataSource="DT100.AMTORIHIKI" FieldOptions="" Order="0100"/><Column DataSource="DT100.KBKAITORI" FieldOptions="" Order="0060"/></Detail><Detail Caption="売上履歴" DetailFunction="EF101" HeaderKeyFields="" InitialMsg="" KeyFields="IDHINMOKU;NRURIKAKE" Order="0040" OrderBy="ET100.DTTORIHIKI(D)" Table="ET100"><Column DataSource="ET100.NRURIKAKE" FieldOptions="" Order="0020"/><Column DataSource="ET100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="ET100.KBURITORI" FieldOptions="" Order="0050"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="品目情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="ET100.KBAKADEN" FieldOptions="" Order="0030"/><Column DataSource="ET100.FGVALID" FieldOptions="" Order="0040"/><Column DataSource="ET100.PRTORIHIKI" FieldOptions="" Order="0070"/><Column DataSource="ET100.QTTORIHIKI" FieldOptions="" Order="0080"/><Column DataSource="ET100.AMTAX" FieldOptions="" Order="0100"/><Column DataSource="ET100.AMTORIHIKI" FieldOptions="" Order="0090"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(得意先),WIDTH(200)" Order="0060"/><Column DataSource="ET100.AMGENKA" FieldOptions="" Order="0110"/></Detail><Detail Caption="仕様明細" DetailFunction="NONE" HeaderKeyFields="" InitialMsg="" KeyFields="" Order="0050" OrderBy="BT020.SQLIST" Table="BT020"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(BF020)" Caption="編集" Number="5" Position="2"/><Button Action="HEADER" Caption="品目情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="BT020.KBSPEC" FieldOptions="" Order="0020"/><Column DataSource="BT020.SQLIST" FieldOptions="" Order="0010"/><Column DataSource="BT020.TXTEKIYO" FieldOptions="" Order="0030"/></Detail><Detail Caption="工程明細" DetailFunction="NONE" HeaderKeyFields="" InitialMsg="" KeyFields="" Order="0060" OrderBy="BT030.SQLIST" Table="BT030"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(BF030)" Caption="編集" Number="5" Position="2"/><Button Action="HEADER" Caption="品目情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="BT030.VLLTFIX" FieldOptions="" Order="0050"/><Column DataSource="BT030.VLLTQTY" FieldOptions="" Order="0060"/><Column DataSource="BT050.TXNAME" FieldOptions="CAPTION(工程)" Order="0020"/><Column DataSource="BT050.FGPLANNING" FieldOptions="CAPTION(計画対象)" Order="0030"/><Column DataSource="BT060.TXCENTER" FieldOptions="CAPTION(標準作業場)" Order="0040"/></Detail><Detail Caption="材料明細" DetailFunction="NONE" HeaderKeyFields="" InitialMsg="" KeyFields="" Order="0070" OrderBy="BT040.SQLIST" Table="BT040"><Column DataSource="BT040.VLKOUSEI" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(BF040)" Caption="編集" Number="5" Position="2"/><Button Action="HEADER" Caption="品目情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="BT010C.TXHINBAN" FieldOptions="" Order="0010"/><Column DataSource="BT010C.TXHINMEI" FieldOptions="" Order="0020"/><Column DataSource="BT010C.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0040"/><Column DataSource="BT050.TXNAME" FieldOptions="CAPTION(投入工程)" Order="0050"/></Detail><Detail Caption="製造履歴" DetailFunction="JF012" HeaderKeyFields="IDHINMOKU" InitialMsg="" KeyFields="IDSEIZOHIN;NRSEIZO" Order="0080" OrderBy="JT010.DTCREATE(D)" Table="JT010"><Column DataSource="JT010.NRSEIZO" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="品目情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="JT010.STSEIZO" FieldOptions="" Order="0070"/><Column DataSource="JT010.QTSYUKKA" FieldOptions="" Order="0060"/><Column DataSource="JT010.QTKANSEI" FieldOptions="" Order="0050"/><Column DataSource="JT010.QTSEIZO" FieldOptions="" Order="0040"/><Column DataSource="JT010.DTCREATE" FieldOptions="" Order="0020"/></Detail><Field DataSource="BT010.FGSEIZO" FieldOptions="CAPTION(製造対象),HORIZONTAL" Order="0100"/><Detail Caption="月次取引" DetailFunction="YF310" HeaderKeyFields="" InitialMsg="" KeyFields="IDHINMOKU;DTNEND;DTMSEQ" Order="0090" Table="YT300"><Column DataSource="YT300.DTNEND" FieldOptions="" Order="0010"/><Column DataSource="YT300.DTMSEQ" FieldOptions="" Order="0020"/><Column DataSource="YT300.AMKIKANNYUKO" FieldOptions="WIDTH(100)" Order="0060"/><Column DataSource="YT300.AMKIKANSYUKKO" FieldOptions="WIDTH(100)" Order="0070"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="HEADER" Caption="見出し情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="YT300.QTKIKANNYUKO" FieldOptions="WIDTH(100)" Order="0030"/><Column DataSource="YT300.QTKIKANSYUKKO" FieldOptions="WIDTH(100)" Order="0040"/><Column DataSource="YT300.AMZAIKO" FieldOptions="WIDTH(100)" Order="0080"/><Column DataSource="YT300.QTZAIKO" FieldOptions="WIDTH(100)" Order="0050"/><Column DataSource="YT300.QTKIKANURI" FieldOptions="WIDTH(100)" Order="0130"/><Column DataSource="YT300.AMKIKANURI" FieldOptions="WIDTH(100)" Order="0140"/><Column DataSource="YT300.AMKIKANARARI" FieldOptions="WIDTH(100)" Order="0150"/><Column DataSource="YT300.QTKIKANKAI" FieldOptions="WIDTH(100)" Order="0090"/><Column DataSource="YT300.AMKIKANKAI" FieldOptions="WIDTH(100)" Order="0100"/><Column DataSource="YT300.QTKIKANSEI" FieldOptions="WIDTH(100)" Order="0110"/><Column DataSource="YT300.AMKIKANSEI" FieldOptions="WIDTH(100)" Order="0120"/></Detail><Field DataSource="BT010.PRHANBAI" FieldOptions="HORIZONTAL" Order="0060"/><Field DataSource="BT010.PRKOUNYU" FieldOptions="HORIZONTAL" Order="0150"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(標準仕入先C)" Order="0120"/></Function><Function DetailFunction="JF012" ID="JF010" InitialListing="T" InitialMsg="" KeyFields="" Name="製造指示データの一覧・保守" OrderBy="" PrimaryTable="JT010" Size="AUTO" SubsystemID="J" Type="XF100"><Column DataSource="JT010.NRSEIZO" FieldOptions="" Order="0030"/><Column DataSource="JT010.QTKANSEI" FieldOptions="CAPTION(完成数)" Order="0070"/><Filter DataSource="JT010.NRSEIZO" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(JF011)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="JT010.QTSEIZO" FieldOptions="" Order="0060"/><Column DataSource="JT010.STSEIZO" FieldOptions="CAPTION(状況)" Order="0100"/><Column DataSource="JT010.QTSYUKKA" FieldOptions="" Order="0080"/><Column DataSource="BT010.TXHINBAN" FieldOptions="CAPTION(製造品番)" Order="0040"/><Column DataSource="BT010.TXHINMEI" FieldOptions="WIDTH(200)" Order="0050"/><Column DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0090"/><Filter DataSource="JT010.STSEIZO" FieldOptions="PROMPT_LIST1,CAPTION(状況)" Order="0050"/><Filter DataSource="BT010.TXHINBAN" FieldOptions="PROMPT_LIST0,CAPTION(製造品番)" Order="0040"/><Filter DataSource="JT010.DTCREATE" FieldOptions="GE,CAPTION(登録日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0020"/><Column DataSource="JT010.TXSEIZOYOTEI" FieldOptions="" Order="0020"/><Column DataSource="JT010.DTCREATE" FieldOptions="" Order="0010"/></Function><Function FunctionAfterInsert="JF012" ID="JF011" InitialMsg="" KeyFields="" Name="製造指示の保守" PrimaryTable="JT010" Size="AUTO" SubsystemID="J" Type="XF200"><Field DataSource="JT010.NRSEIZO" FieldOptions="" Order="0010"/><Field DataSource="JT010.STSEIZO" FieldOptions="HORIZONTAL" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="JT010.TXTEKIYO" FieldOptions="WIDTH(862)" Order="0200"/><Field DataSource="JT010.QTJYUTYU" FieldOptions="" Order="0110"/><Field DataSource="BT010.TXHINBAN" FieldOptions="CAPTION(製造品番),PROMPT_CALL(BF130),PROMPT_CALL_TO_GET(BT010.IDHINMOKU;BT010.TXHINBAN;BT010.TXHINMEI;BT010.KBUNIT),PROMPT_CALL_TO_GET_TO(JT010.IDSEIZOHIN;BT010.TXHINBAN;BT010.TXHINMEI;BT010.KBUNIT)" Order="0080"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0090"/><Field DataSource="BT010.KBUNIT" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(42)" Order="0100"/><Field DataSource="JT010.QTSEIZO" FieldOptions="HORIZONTAL" Order="0120"/><Field DataSource="JT010.TXTYUMONBANGO" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先C),PROMPT_CALL(EF800),PROMPT_CALL_TO_GET(ET010.IDTOKUISAKI;AT030.CDTORIHIKISAKI;AT030.TXKANJI),PROMPT_CALL_TO_GET_TO(JT010.IDTOKUISAKI;AT030.CDTORIHIKISAKI;AT030.TXKANJI)" Order="0040"/><Field DataSource="JT010.PRMITSUMORI" FieldOptions="HORIZONTAL" Order="0160"/><Field DataSource="JT010.PRJYUTYU" FieldOptions="HORIZONTAL" Order="0170"/><Field DataSource="ET011.TXKANJI" FieldOptions="CAPTION(出荷先),PROMPT_LIST" Order="0060"/><Field DataSource="JT010.PRYOTEIGEN" FieldOptions="" Order="0150"/><Field DataSource="JT010.DTNOUKI" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(70)" Order="0070"/><Field DataSource="AT040KAN.TXSOUKO" FieldOptions="CAPTION(完成入庫倉庫),WIDTH(350),HORIZONTAL,PROMPT_LIST" Order="0190"/><Field DataSource="AT040ZAI.TXSOUKO" FieldOptions="CAPTION(材料出庫倉庫),WIDTH(350),PROMPT_LIST" Order="0180"/><Field DataSource="JT010.QTKANSEI" FieldOptions="HORIZONTAL" Order="0130"/></Function><Function HeaderFunction="JF012A" HeaderKeyFields="" HeaderTable="JT010" ID="JF012" Name="製造指示と関連情報の確認" Size="AUTO" SubsystemID="J" Type="XF300"><Detail Caption="仕様明細" DetailFunction="NONE" HeaderKeyFields="NRSEIZO" InitialListing="T" InitialMsg="" KeyFields="NRSEIZO;SQSPEC" Order="0020" Table="JT020"><Column DataSource="JT020.TXVALUE" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(JF020)" Caption="編集" Number="5" Position="2"/><Button Action="HEADER" Caption="オプション" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="BT020.KBSPEC" FieldOptions="" Order="0010"/><Column DataSource="BT020.TXTEKIYO" FieldOptions="" Order="0020"/></Detail><Detail Caption="材料明細" DetailFunction="NONE" HeaderKeyFields="NRSEIZO" InitialListing="T" InitialMsg="" KeyFields="NRSEIZO;SQZAIRYO" Order="0040" Table="JT040"><Column DataSource="JT040.QTTOUNYU" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(JF040)" Caption="編集" Number="5" Position="2"/><Button Action="HEADER" Caption="オプション" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="BT050.TXNAME" FieldOptions="CAPTION(投入工程)" Order="0090"/><Column DataSource="JT040.PRSYUKKO" FieldOptions="" Order="0080"/><Column DataSource="JT040.PRYOTEI" FieldOptions="" Order="0070"/><Column DataSource="BT010ZAI.TXHINBAN" FieldOptions="" Order="0010"/><Column DataSource="BT010ZAI.TXHINMEI" FieldOptions="WIDTH(300)" Order="0030"/><Column DataSource="BT010ZAI.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0060"/></Detail><Detail Caption="工程明細" DetailFunction="JF032" HeaderKeyFields="NRSEIZO" InitialListing="T" InitialMsg="" KeyFields="NRSEIZO;SQKOUTEI" Order="0030" Table="JT030"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(JF030)" Caption="編集" Number="5" Position="2"/><Button Action="HEADER" Caption="オプション" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="JT030.TXSAGYOYOTEI" FieldOptions="" Order="0010"/><Column DataSource="BT050.TXNAME" FieldOptions="CAPTION(工程)" Order="0030"/><Column DataSource="BT050.FGPLANNING" FieldOptions="CAPTION(計画対象)" Order="0040"/><Column DataSource="BT060.TXCENTER" FieldOptions="CAPTION(作業場)" Order="0050"/><Column DataSource="JT030.LTSEIZO" FieldOptions="" Order="0020"/><Column DataSource="JT030.AMKAKOU" FieldOptions="" Order="0060"/></Detail><Detail Caption="受払履歴" DetailFunction="FF101" HeaderKeyFields="NRSOURCE" InitialListing="T" InitialMsg="" KeyFields="NRSOURCE;NRZAITORI" Order="0050" Table="FT100"><Column DataSource="FT100.NRZAITORI" FieldOptions="" Order="0020"/><Column DataSource="FT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="FT100.KBUKEBARAI" FieldOptions="" Order="0030"/><Column DataSource="FT100.KBAKADEN" FieldOptions="" Order="0040"/><Column DataSource="FT100.FGVALID" FieldOptions="" Order="0050"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="FT100.TXAITESAKI" FieldOptions="WIDTH(130)" Order="0060"/><Column DataSource="FT100.PRTORIHIKI" FieldOptions="WIDTH(100)" Order="0090"/><Column DataSource="FT100.QTTORIHIKI" FieldOptions="WIDTH(100)" Order="0100"/><Button Action="HEADER" Caption="オプション" Number="8" Position="4"/><Column DataSource="FT100.TXHINBAN" FieldOptions="" Order="0070"/><Column DataSource="FT100.TXHINMEI" FieldOptions="WIDTH(150)" Order="0080"/></Detail><Field DataSource="JT010.NRSEIZO" FieldOptions="" Order="0010"/><Field DataSource="JT010.QTKANSEI" FieldOptions="HORIZONTAL" Order="0160"/><Field DataSource="JT010.QTHURYO" FieldOptions="HORIZONTAL" Order="0170"/><Field DataSource="JT010.STSEIZO" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(30)" Order="0040"/><Field DataSource="JT010.PRGENKA" FieldOptions="HORIZONTAL" Order="0190"/><Field DataSource="JT010.DTCREATE" FieldOptions="" Order="0280"/><Field DataSource="JT010.TXTEKIYO" FieldOptions="WIDTH(951)" Order="0270"/><Field DataSource="JT010.QTJYUTYU" FieldOptions="" Order="0120"/><Field DataSource="BT010.TXHINBAN" FieldOptions="CAPTION(製造品番)" Order="0050"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0060"/><Field DataSource="BT010.KBUNIT" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(40)" Order="0070"/><Field DataSource="JT010.QTSEIZO" FieldOptions="" Order="0150"/><Field DataSource="AT040KAN.TXSOUKO" FieldOptions="CAPTION(完成入庫倉庫),HORIZONTAL" Order="0260"/><Field DataSource="AT040ZAI.TXSOUKO" FieldOptions="CAPTION(材料出庫倉庫)" Order="0250"/><Field DataSource="JT010.DTHAKKO" FieldOptions="HORIZONTAL" Order="0290"/><Field DataSource="JT010.DTSYUKKO" FieldOptions="HORIZONTAL" Order="0300"/><Field DataSource="JT010.DTKANSEI" FieldOptions="" Order="0310"/><Field DataSource="JT010.TXSEIZOYOTEI" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(30)" Order="0030"/><Field DataSource="JT010.TXTYUMONBANGO" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(30)" Order="0020"/><Field DataSource="JT010.QTHAIKI" FieldOptions="HORIZONTAL" Order="0140"/><Field DataSource="JT010.PRMITSUMORI" FieldOptions="HORIZONTAL" Order="0200"/><Field DataSource="JT010.PRJYUTYU" FieldOptions="HORIZONTAL" Order="0210"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0090"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先C)" Order="0080"/><Field DataSource="ET011.TXKANJI" FieldOptions="CAPTION(出荷先)" Order="0100"/><Field DataSource="JT010.PRYOTEIGEN" FieldOptions="" Order="0180"/><Field DataSource="JT010.DTNOUKI" FieldOptions="HORIZONTAL" Order="0110"/><Field DataSource="JT010.QTSYUKKA" FieldOptions="HORIZONTAL" Order="0130"/><Field DataSource="JT010.DTSYUKKA" FieldOptions="HORIZONTAL" Order="0320"/><Field DataSource="JT010.DTCANCEL" FieldOptions="HORIZONTAL" Order="0330"/><Field DataSource="JT010.AMGENKA" FieldOptions="" Order="0220"/><Field DataSource="JT010.AMHANBAI" FieldOptions="HORIZONTAL" Order="0230"/><Field DataSource="JT010.AMARARI" FieldOptions="HORIZONTAL" Order="0240"/><Detail Caption="売上履歴" DetailFunction="EF101" HeaderKeyFields="NRSOURCE" InitialMsg="" KeyFields="NRSOURCE;NRURIKAKE" Order="0060" Table="ET100"><Column DataSource="ET100.NRURIKAKE" FieldOptions="" Order="0020"/><Column DataSource="ET100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="ET100.KBURITORI" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="オプション" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="ET100.KBAKADEN" FieldOptions="" Order="0040"/><Column DataSource="ET100.FGVALID" FieldOptions="" Order="0050"/><Column DataSource="ET100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0080"/><Column DataSource="ET100.PRTORIHIKI" FieldOptions="" Order="0060"/><Column DataSource="ET100.QTTORIHIKI" FieldOptions="" Order="0070"/><Column DataSource="ET100.AMTORIHIKI" FieldOptions="" Order="0090"/><Column DataSource="ET100.NRSEIKYU" FieldOptions="" Order="0130"/><Column DataSource="ET100.AMTAX" FieldOptions="" Order="0100"/><Column DataSource="ET100.AMGENKA" FieldOptions="" Order="0110"/></Detail></Function><Function ID="JF013" InitialMsg="" KeyFields="" Name="完成・出荷エントリー" PrimaryTable="JT010" Size="AUTO" SubsystemID="J" Type="XF200" UpdateOnly="T"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="JT010.NRSEIZO" FieldOptions="" Order="0010"/><Field DataSource="JT010.QTKANSEI" FieldOptions="HORIZONTAL" Order="0120"/><Field DataSource="JT010.QTHURYO" FieldOptions="HORIZONTAL" Order="0130"/><Field DataSource="JT010.STSEIZO" FieldOptions="HORIZONTAL" Order="0030"/><Field DataSource="JT010.PRGENKA" FieldOptions="HORIZONTAL" Order="0200"/><Field DataSource="JT010.TXTEKIYO" FieldOptions="WIDTH(939)" Order="0230"/><Field DataSource="BT010.TXHINBAN" FieldOptions="CAPTION(製造品番)" Order="0080"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0090"/><Field DataSource="BT010.KBUNIT" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(40)" Order="0100"/><Field DataSource="JT010.QTSEIZO" FieldOptions="" Order="0110"/><Field DataSource="AT040KAN.TXSOUKO" FieldOptions="CAPTION(完成入庫倉庫)" Order="0060"/><Field DataSource="JT010.DTKANSEI" FieldOptions="CAPTION(完成日),CAPTION_LENGTH_VARIABLE,HORIZONTAL(37)" Order="0140"/><Field DataSource="JT010.TXSEIZOYOTEI" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="BT010.PRGENKA" FieldOptions="" Order="0190"/><Field DataSource="JT010.QTJYUTYU" FieldOptions="" Order="0150"/><Field DataSource="JT010.QTSYUKKA" FieldOptions="HORIZONTAL" Order="0160"/><Field DataSource="JT010.QTHAIKI" FieldOptions="HORIZONTAL" Order="0170"/><Field DataSource="JT010.PRJYUTYU" FieldOptions="HORIZONTAL" Order="0220"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先)" Order="0040"/><Field DataSource="ET011.TXKANJI" FieldOptions="CAPTION(出荷先),CAPTION_LENGTH_VARIABLE,HORIZONTAL(45)" Order="0070"/><Field DataSource="JT010.DTSYUKKA" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(37)" Order="0180"/><Field DataSource="JT010.PRMITSUMORI" FieldOptions="HORIZONTAL" Order="0210"/></Function><Function DetailKeyFields="NRSEIZO;SQSPEC" DetailOrderBy="JT020.SQLIST" DetailTable="JT020" HeaderKeyFields="NRSEIZO" HeaderTable="JT010" ID="JF020" Name="製造指示仕様明細の一括保守" Size="AUTO" SubsystemID="J" Type="XF310"><Column DataSource="JT020.TXVALUE" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="UPDATE" Caption="更新" Number="5" Position="2"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="JT010.NRSEIZO" FieldOptions="" Order="0010"/><Field DataSource="JT010.QTSEIZO" FieldOptions="" Order="0060"/><Field DataSource="JT010.TXTEKIYO" FieldOptions="WIDTH(888)" Order="0110"/><Field DataSource="JT010.STSEIZO" FieldOptions="HORIZONTAL" Order="0030"/><Field DataSource="JT010.PRGENKA" FieldOptions="HORIZONTAL" Order="0080"/><Field DataSource="JT010.QTJYUTYU" FieldOptions="HORIZONTAL" Order="0090"/><Field DataSource="BT010.TXHINBAN" FieldOptions="CAPTION(製造品番)" Order="0040"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0070"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0100"/><Column DataSource="BT020.KBSPEC" FieldOptions="" Order="0010"/><Field DataSource="JT010.TXSEIZOYOTEI" FieldOptions="HORIZONTAL" Order="0020"/><Column DataSource="BT020.TXTEKIYO" FieldOptions="" Order="0020"/></Function><Function DetailKeyFields="NRSEIZO;SQKOUTEI" DetailOrderBy="JT030.SQLIST" DetailTable="JT030" HeaderKeyFields="NRSEIZO" HeaderTable="JT010" ID="JF030" Name="製造指示工程明細の一括保守" Size="AUTO" SubsystemID="J" Type="XF310"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="UPDATE" Caption="更新" Number="5" Position="2"/><Button Action="ADD_ROW" Caption="行追加" Number="6" Position="4"/><Button Action="REMOVE_ROW" Caption="行削除" Number="9" Position="5"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="JT010.NRSEIZO" FieldOptions="" Order="0010"/><Field DataSource="JT010.QTSEIZO" FieldOptions="" Order="0060"/><Field DataSource="JT010.TXTEKIYO" FieldOptions="WIDTH(888)" Order="0110"/><Field DataSource="JT010.STSEIZO" FieldOptions="HORIZONTAL" Order="0030"/><Field DataSource="JT010.PRGENKA" FieldOptions="HORIZONTAL" Order="0080"/><Field DataSource="JT010.QTJYUTYU" FieldOptions="HORIZONTAL" Order="0090"/><Field DataSource="BT010.TXHINBAN" FieldOptions="CAPTION(製造品番)" Order="0040"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0070"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0100"/><Field DataSource="JT010.TXSEIZOYOTEI" FieldOptions="HORIZONTAL" Order="0020"/><Column DataSource="BT050.TXNAME" FieldOptions="CAPTION(工程)" Order="0020"/><Column DataSource="BT060.TXCENTER" FieldOptions="CAPTION(作業場),PROMPT_LIST" Order="0040"/><Column DataSource="JT030.TXSAGYOYOTEI" FieldOptions="" Order="0010"/><Column DataSource="BT050.FGPLANNING" FieldOptions="CAPTION(計画対象)" Order="0030"/></Function><Function AddRowListTable="" DetailKeyFields="NRSEIZO;SQZAIRYO" DetailOrderBy="JT040.SQLIST" DetailTable="JT040" HeaderKeyFields="NRSEIZO" HeaderTable="JT010" ID="JF040" Name="製造指示材料明細の一括保守" Size="AUTO" SubsystemID="J" Type="XF310"><Column DataSource="JT040.QTTOUNYU" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="UPDATE" Caption="更新" Number="5" Position="2"/><Button Action="ADD_ROW" Caption="行追加" Number="6" Position="4"/><Button Action="REMOVE_ROW" Caption="行削除" Number="9" Position="5"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="JT010.NRSEIZO" FieldOptions="" Order="0010"/><Field DataSource="JT010.QTSEIZO" FieldOptions="" Order="0060"/><Field DataSource="JT010.TXTEKIYO" FieldOptions="WIDTH(888)" Order="0110"/><Field DataSource="JT010.STSEIZO" FieldOptions="HORIZONTAL" Order="0030"/><Field DataSource="JT010.PRGENKA" FieldOptions="HORIZONTAL" Order="0080"/><Field DataSource="JT010.QTJYUTYU" FieldOptions="HORIZONTAL" Order="0090"/><Field DataSource="BT010.TXHINBAN" FieldOptions="CAPTION(製造品番)" Order="0040"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0070"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0100"/><Field DataSource="JT010.TXSEIZOYOTEI" FieldOptions="HORIZONTAL" Order="0020"/><Column DataSource="BT050.TXNAME" FieldOptions="PROMPT_CALL(BF140),PROMPT_CALL_TO_PUT(JT010.IDSEIZOHIN),PROMPT_CALL_TO_PUT_TO(BT010.IDHINMOKU),PROMPT_CALL_TO_GET(BT030.SQKOUTEI;BT050.TXNAME),PROMPT_CALL_TO_GET_TO(JT040.SQKOUTEI;BT050.TXNAME)" Order="0070"/><Column DataSource="BT010ZAI.TXHINBAN" FieldOptions="CAPTION(材料品番)" Order="0010"/><Column DataSource="BT010ZAI.TXHINMEI" FieldOptions="CAPTION(材料品名),PROMPT_CALL(BF100),PROMPT_CALL_TO_GET(BT010.IDHINMOKU;BT010.TXHINBAN;BT010.TXHINMEI;BT010.KBUNIT),PROMPT_CALL_TO_GET_TO(JT040.IDHINMOKU;BT010ZAI.TXHINBAN;BT010ZAI.TXHINMEI;BT010ZAI.KBUNIT)" Order="0030"/><Column DataSource="BT010ZAI.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0060"/></Function><Function DetailFunction="BF051" ID="BF050" InitialListing="T" InitialMsg="" KeyFields="CDKOUTEI" Name="工程マスターの一覧・保守" OrderBy="" PrimaryTable="BT050" Size="AUTO" SubsystemID="B" Type="XF100"><Column DataSource="BT050.CDKOUTEI" FieldOptions="" Order="0000"/><Column DataSource="BT050.TXNAME" FieldOptions="CAPTION(工程名)" Order="0010"/><Column DataSource="BT050.FGPLANNING" FieldOptions="CAPTION(計画対象)" Order="0020"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(BF052)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function HeaderFunction="BF052" HeaderKeyFields="" HeaderTable="BT050" ID="BF051" Name="工程関連情報の確認" Size="AUTO" SubsystemID="B" Type="XF300"><Field DataSource="BT050.CDKOUTEI" FieldOptions="" Order="0010"/><Field DataSource="BT050.TXNAME" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Field DataSource="BT050.FGPLANNING" FieldOptions="CAPTION(計画対象),CAPTION_LENGTH_VARIABLE,HORIZONTAL(20)" Order="0030"/><Detail Caption="作業場" DetailFunction="BF061" HeaderKeyFields="CDKOUTEI" InitialListing="T" InitialMsg="" KeyFields="CDKOUTEI;SQCENTER" Order="0010" Table="BT060"><Column DataSource="BT060.TXCENTER" FieldOptions="" Order="0010"/><Column DataSource="BT060.KBCALENDAR" FieldOptions="CAPTION(稼働暦)" Order="0020"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(BF060)" Caption="追加" Number="6" Position="2"/><Button Action="HEADER" Caption="工程情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="BT060.TMFROM" FieldOptions="CAPTION(開始時刻)" Order="0030"/><Column DataSource="BT060.TMTHRU" FieldOptions="CAPTION(終了時刻)" Order="0040"/><Column DataSource="BT060.RTKAKOU" FieldOptions="" Order="0050"/></Detail></Function><Function ID="BF052" InitialMsg="" KeyFields="CDKOUTEI" Name="工程マスターの保守" PrimaryTable="BT050" Size="AUTO" SubsystemID="B" Type="XF200"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="BT050.CDKOUTEI" FieldOptions="" Order="0010"/><Field DataSource="BT050.TXNAME" FieldOptions="" Order="0020"/><Field DataSource="BT050.FGPLANNING" FieldOptions="CAPTION(計画対象)" Order="0030"/></Function><Function ID="BF060" InitialMsg="" KeyFields="CDKOUTEI;SQCENTER" Name="作業場マスターの保守" PrimaryTable="BT060" Size="AUTO" SubsystemID="B" Type="XF200"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="BT060.TXCENTER" FieldOptions="" Order="0040"/><Field DataSource="BT060.CDKOUTEI" FieldOptions="" Order="0010"/><Field DataSource="BT060.KBCALENDAR" FieldOptions="CAPTION(稼働暦),CAPTION_LENGTH_VARIABLE,HORIZONTAL(20)" Order="0050"/><Field DataSource="BT060.TMFROM" FieldOptions="CAPTION(標準稼働時間)" Order="0060"/><Field DataSource="BT060.TMTHRU" FieldOptions="CAPTION(～),CAPTION_LENGTH_VARIABLE,HORIZONTAL" Order="0070"/><Field DataSource="BT050.TXNAME" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Field DataSource="BT050.FGPLANNING" FieldOptions="CAPTION(計画対象),CAPTION_LENGTH_VARIABLE,HORIZONTAL(20)" Order="0030"/><Field DataSource="BT060.RTKAKOU" FieldOptions="" Order="0080"/></Function><Function HeaderFunction="" HeaderKeyFields="" HeaderTable="BT010" ID="BF140" Name="製品別工程検索" Size="AUTO" SubsystemID="B" Type="XF300"><Field DataSource="BT010.TXHINBAN" FieldOptions="" Order="0010"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Detail Caption="製造品工程明細" DetailFunction="" HeaderKeyFields="" InitialListing="T" InitialMsg="" KeyFields="" Order="0010" OrderBy="BT030.SQLIST" ParmType="COLUMNS" Table="BT030"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="BT050.TXNAME" FieldOptions="" Order="0030"/></Detail></Function><Function HeaderFunction="BF060" HeaderKeyFields="" HeaderTable="BT060" ID="BF061" Name="作業場別製造指示の確認" Size="AUTO" SubsystemID="B" Type="XF300"><Detail Caption="製造指示" DetailFunction="JF031" HeaderKeyFields="CDKOUTEI;SQCENTER" InitialListing="T" InitialMsg="" KeyFields="CDKOUTEI;SQCENTER;NRSEIZO;SQKOUTEI" Order="0010" OrderBy="JT030.DTFROM;JT030.TMFROM" Table="JT030"><Column DataSource="JT030.NRSEIZO" FieldOptions="" Order="0020"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="作業場情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="JT030.TXSAGYOYOTEI" FieldOptions="" Order="0010"/><Column DataSource="JT010.QTSEIZO" FieldOptions="" Order="0050"/><Column DataSource="BT010.TXHINBAN" FieldOptions="" Order="0030"/><Column DataSource="BT010.TXHINMEI" FieldOptions="WIDTH(200)" Order="0040"/><Column DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0060"/><Filter DataSource="JT030.DTFROM" FieldOptions="GE,CAPTION(開始予定日≧),VALUE(SESSION_ATTRIBUTE:Today)" Order="0020"/></Detail><Field DataSource="BT060.TXCENTER" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="BT060.KBCALENDAR" FieldOptions="CAPTION(稼働暦)" Order="0030"/><Field DataSource="BT060.TMFROM" FieldOptions="CAPTION(標準稼働時間),HORIZONTAL" Order="0040"/><Field DataSource="BT060.TMTHRU" FieldOptions="CAPTION(～),CAPTION_LENGTH_VARIABLE,HORIZONTAL" Order="0050"/><Field DataSource="BT060.RTKAKOU" FieldOptions="HORIZONTAL" Order="0060"/><Field DataSource="BT050.TXNAME" FieldOptions="" Order="0010"/></Function><Function ID="JF012A" Name="製造指示処理オプション" Script="//////////////////////////////////////#EOL#// ダイアログの取得とオプション設定 //#EOL#//////////////////////////////////////#EOL#var dialog = session.getOptionDialog();#EOL#dialog.addOption('製造指示の保守');      // 0 //#EOL#dialog.addOption('見積書の発行');        // 1 //#EOL#dialog.addOption('製造指示書の発行');    // 2 //#EOL#dialog.addOption('材料出庫エントリー');  // 3 //#EOL#dialog.addOption('完成･出荷エントリー'); // 4 //#EOL#dialog.addOption('納品書の発行');        // 5 //#EOL#dialog.addOption('製造指示の取消');      // 6 //#EOL#dialog.addOption('閉じる　　　　　　');  // 7 //#EOL##EOL#//////////////////////////////////////#EOL#// ダイアログの表示と関連機能の起動 //#EOL#//////////////////////////////////////#EOL#var reply = dialog.request('処理オプション');#EOL#if (reply == 0) {#EOL#&#x9;instance.callFunction('JF011'); //製造指示の保守//#EOL#}#EOL#if (reply == 1) {#EOL#&#x9;instance.callFunction('JF021'); //見積書の発行//#EOL#}#EOL#if (reply == 2) {#EOL#&#x9;instance.callFunction('JF022'); //製造指示書の発行//#EOL#}#EOL#if (reply == 3) {#EOL#&#x9;instance.callFunction('JF041'); //材料出庫エントリー//#EOL#}#EOL#if (reply == 4) {#EOL#&#x9;instance.callFunction('JF013'); //完成･出荷エントリー//#EOL#}#EOL#if (reply == 5) {#EOL#&#x9;instance.callFunction('JF023'); //納品書の発行//#EOL#}#EOL#if (reply == 6) {#EOL#&#x9;instance.callFunction('JF014'); //製造指示の取消//#EOL#}#EOL#if (reply == 7 || reply == -1) {#EOL#&#x9;instance.returnMap.put('RETURN_MESSAGE', '＊処理は取り消されました。');#EOL#}" SubsystemID="J" Type="XF000"/><Function DetailKeyFields="NRSEIZO;SQSPEC" DetailTable="JT020" Direction="LANDSCAPE" HeaderKeyFields="NRSEIZO" HeaderTable="JT010" ID="JF023" Margins="50;50;50;50" Name="納品書の印刷" PageSize="A4" SubsystemID="J" TableFontID="Font1" TableFontSize="9" TableRowNoWidth="5" Type="XF390" WithPageNumber="T"><HeaderPhrase Alignment="CENTER" AlignmentMargin="" Block="HEADER" FontID="Font1" FontSize="15" FontStyle="BOLD" MarginLeft="0" MarginRight="0" Order="0010" SpacingAfter="0" Value="&amp;Text(納　品　書)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0020" SpacingAfter="-18" Value="&amp;DataSource(AT030.TXKANJI)&amp;Text( 御中)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0040" SpacingAfter="0" Value="&amp;Image(logo.PNG;0;-3;32;0)&amp;SystemVariant(COMP_NAME)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" Order="0050" SpacingAfter="0" Value="&amp;SystemVariant(COMP_ADDRESS)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" Order="0060" SpacingAfter="0" Value="&amp;SystemVariant(COMP_TEL)&amp;Text( ㈹)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0070" SpacingAfter="10" Value="&amp;Text(営業担当 )&amp;DataSource(AT020.TXKANJI)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0080" SpacingAfter="10" Value="&amp;Text(毎度お世話になっております。以下の製品を納品させていただきます。ご確認ください。)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0110" SpacingAfter="0" Value="&amp;Text(　ご注文品　)&amp;DataSource(BT010.TXHINBAN)&amp;Text(　)&amp;DataSource(BT010.TXHINMEI)&amp;Text(　　納品数　)&amp;DataSource(JT010.QTSYUKKA;a1)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0130" SpacingAfter="0" Value="&amp;Text(　　　摘要　)&amp;DataSource(JT010.TXTEKIYO)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0090" SpacingAfter="0" Value="&amp;Text(　　納品先　)&amp;DataSource(ET011.TXKANJI)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0100" SpacingAfter="0" Value="&amp;Text(　　　　　　)&amp;DataSource(ET011.NRYUBIN)&amp;Text(　)&amp;DataSource(ET011.TXJYUSYO1)&amp;Text(　)&amp;DataSource(ET011.TXJYUSYO2)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0030" SpacingAfter="0" Value="&amp;Text(ご注文番号　)&amp;DataSource(JT010.TXTYUMONBANGO)&amp;Text(　管理番号　)&amp;DataSource(JT010.NRSEIZO)"/><Detail Caption="" CaptionFontSize="12" FixedWhere="" FontID="Font1" FontSize="9" HeaderKeyFields="" KeyFields="NRSEIZO;SQSPEC" Order="0010" OrderBy="" RowNoWidth="5" Table="JT020"><Column Alignment="LEFT" DataSource="JT020.TXVALUE" FieldOptions="" Order="0030" Width="70"/><Column Alignment="LEFT" DataSource="BT020.KBSPEC" FieldOptions="" Order="0020" Width="25"/></Detail></Function><Function ID="JF014" Name="製造指示の取消" Script="//////////////////////////#EOL#// Javaパッケージの導入 //#EOL#//////////////////////////#EOL#var importedPackage = new JavaImporter(javax.swing);#EOL#with (importedPackage) {#EOL##EOL#&#x9;//////////////#EOL#&#x9;// 変数定義 //#EOL#&#x9;//////////////#EOL#&#x9;var rJT010; var rJT040; var uJT010;#EOL#&#x9;var errorMessage = ''; var qtSyukko = 0;#EOL##EOL#&#x9;////////////////////#EOL#&#x9;// 製造指示の読取 //#EOL#&#x9;////////////////////#EOL#&#x9;rJT010 = instance.createTableOperator('Select', 'JT010');#EOL#&#x9;rJT010.addKeyValue('NRSEIZO',&#x9;instance.parmMap.get('NRSEIZO'));#EOL#&#x9;if (rJT010.next()) {#EOL##EOL#&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;// 製造指示状況の評価 //#EOL#&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;if (rJT010.getValueOf('DTSYUKKO') != '') {#EOL#&#x9;&#x9;&#x9;rJT040 = instance.createTableOperator('Select', 'JT040');#EOL#&#x9;&#x9;&#x9;rJT040.addKeyValue('NRSEIZO',&#x9;instance.parmMap.get('NRSEIZO'));#EOL#&#x9;&#x9;&#x9;while (rJT040.next()) {#EOL#&#x9;&#x9;&#x9;&#x9;qtSyukko = Number(qtSyukko) + Number(rJT040.getValueOf('QTTOUNYU'));#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;if (qtSyukko > 0) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '出庫数＞０として材料出庫報告されているため、取消できません。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;if (errorMessage == '' &amp;&amp; rJT010.getValueOf('QTKANSEI') > 0) {#EOL#&#x9;&#x9;&#x9;errorMessage = '完成数＞０として完成報告されているため、取消できません。';#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;if (errorMessage == '' &amp;&amp; rJT010.getValueOf('QTSYUKKA') > 0) {#EOL#&#x9;&#x9;&#x9;errorMessage = '出荷数＞０として出荷報告されているため、取消できません。';#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;if (errorMessage == '' &amp;&amp; rJT010.getValueOf('QTHAIKI') > 0) {#EOL#&#x9;&#x9;&#x9;errorMessage = '廃棄数＞０として出荷報告されているため、取消できません。';#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;////////////////////////////#EOL#&#x9;&#x9;// 評価結果にもとづく処理 //#EOL#&#x9;&#x9;////////////////////////////#EOL#&#x9;&#x9;if (errorMessage == '') {#EOL#&#x9;&#x9;&#x9;ans = JOptionPane.showConfirmDialog(null, '製造指示を取り消しますか？', '製造指示の取消', JOptionPane.YES_NO_OPTION);#EOL#&#x9;&#x9;&#x9;if (ans == JOptionPane.OK_OPTION) {#EOL#&#x9;&#x9;&#x9;&#x9;uJT010 = instance.createTableOperator('Update', 'JT010');#EOL#&#x9;&#x9;&#x9;&#x9;uJT010.addValue('DTCANCEL',&#x9;&#x9;session.today + '');#EOL#&#x9;&#x9;&#x9;&#x9;uJT010.addValue('UPDCOUNTER',&#x9;Number(rJT010.getValueOf('UPDCOUNTER')) + 1);#EOL#&#x9;&#x9;&#x9;&#x9;uJT010.addKeyValue('NRSEIZO',&#x9;&#x9;instance.parmMap.get('NRSEIZO'));#EOL#&#x9;&#x9;&#x9;&#x9;uJT010.addKeyValue('UPDCOUNTER',&#x9;rJT010.getValueOf('UPDCOUNTER'));#EOL#&#x9;&#x9;&#x9;&#x9;count = uJT010.execute();#EOL#&#x9;&#x9;&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;instance.returnMap.put('RETURN_CODE', '20');#EOL#&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;showMessage('製造指示の取消処理に失敗しました。処理はキャンセルされます。');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;instance.returnMap.put('RETURN_CODE', '21');#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;instance.returnMap.put('RETURN_CODE', '21');#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;showMessage(errorMessage);#EOL#&#x9;&#x9;&#x9;instance.returnMap.put('RETURN_CODE', '21');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}" SubsystemID="J" Type="XF000"/><Function DetailKeyFields="NRSEIZO;SQKOUTEI" DetailTable="JT030" Direction="LANDSCAPE" HeaderKeyFields="NRSEIZO" HeaderTable="JT010" ID="JF022" Margins="50;50;50;50" Name="製造指示書の印刷" PageSize="A4" SubsystemID="J" TableFontID="Font1" TableFontSize="9" TableRowNoWidth="5" Type="XF390" WithPageNumber="T"><HeaderPhrase Alignment="CENTER" Block="HEADER" FontID="Font1" FontSize="15" FontStyle="BOLD" MarginLeft="0" MarginRight="0" Order="0010" SpacingAfter="0" Value="&amp;Text(製　造　指　示　書　　　　　　　　　　　　　　　　　　　　　　　　　　　　製造指示№ )&amp;DataSource(JT010.NRSEIZO)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0020" SpacingAfter="0" Value="&amp;Text(　　　製造品　)&amp;DataSource(BT010.TXHINBAN)&amp;Text(　)&amp;DataSource(BT010.TXHINMEI)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0040" SpacingAfter="0" Value="&amp;Text(　　作業予定　)&amp;DataSource(JT010.TXSEIZOYOTEI)&amp;Text(　　　製造指示数　)&amp;DataSource(JT010.QTSEIZO)&amp;Text(　　完成数　＿＿＿　　不良数　＿＿＿　　出荷数　＿＿＿ )&amp;DataSource(BT010.KBUNIT)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0041" SpacingAfter="0" Value="&amp;Text(完成入庫倉庫　)&amp;DataSource(AT040KAN.TXSOUKO)&amp;Text(　　　顧客名　)&amp;DataSource(AT030.TXKANJI)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0043" SpacingAfter="0" Value="&amp;Text(　　　　摘要　)&amp;DataSource(JT010.TXTEKIYO)"/><Detail Caption="【工程明細】" CaptionFontSize="11" CaptionFontStyle="ITALIC" CaptionSpacingAfter="-14" FixedWhere="" FontID="Font1" FontSize="11" HeaderKeyFields="" KeyFields="NRSEIZO;SQKOUTEI" Order="0020" OrderBy="" RowNoWidth="5" Table="JT030" TableFontID="Font1" TableFontSize="9" TableRowNoWidth="5"><Column Alignment="LEFT" DataSource="JT030.TXSAGYOYOTEI" FieldOptions="" Order="0030" Width="20"/><Column Alignment="LEFT" DataSource="BT050.TXNAME" FieldOptions="CAPTION(工程)" Order="0040" Width="35"/><Column Alignment="LEFT" DataSource="BT060.TXCENTER" FieldOptions="CAPTION(作業場)" Order="0050" Width="40"/></Detail><Detail Caption="【材料明細】" CaptionFontSize="11" CaptionFontStyle="ITALIC" CaptionSpacingAfter="-14" FontID="Font1" FontSize="11" HeaderKeyFields="" KeyFields="" Order="0030" RowNoWidth="5" Table="JT040" TableFontID="Font1" TableFontSize="9" TableRowNoWidth="5"><Column Alignment="LEFT" DataSource="JT040.QTTOUNYU" FieldOptions="CAPTION(出庫数)" Order="0030" Width="10"/><Column Alignment="LEFT" DataSource="BT010ZAI.TXHINBAN" FieldOptions="CAPTION(材料品番)" Order="0010" Width="10"/><Column Alignment="LEFT" DataSource="BT010ZAI.TXHINMEI" FieldOptions="CAPTION(材料品名)" Order="0020" Width="35"/><Column Alignment="LEFT" DataSource="BT010ZAI.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0040" Width="5"/><Column Alignment="LEFT" DataSource="BT050.TXNAME" FieldOptions="CAPTION(投入工程)" Order="0050" Width="35"/></Detail><Detail Caption="【仕様明細】" CaptionFontSize="11" CaptionFontStyle="ITALIC" FontID="Font1" FontSize="11" HeaderKeyFields="" KeyFields="" Order="0010" RowNoWidth="5" Table="JT020"><Column Alignment="LEFT" DataSource="JT020.TXVALUE" FieldOptions="" Order="0020" Width="70"/><Column Alignment="LEFT" DataSource="BT020.KBSPEC" FieldOptions="" Order="0010" Width="25"/></Detail></Function><Function ID="JF031" InitialMsg="" KeyFields="NRSEIZO;SQKOUTEI" Name="製造指示工程明細の照会" PrimaryTable="JT030" Size="AUTO" SubsystemID="J" Type="XF200" UpdateOnly=""><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="JT030.NRSEIZO" FieldOptions="" Order="0010"/><Field DataSource="JT030.DTFROM" FieldOptions="CAPTION(開始予定日時)" Order="0140"/><Field DataSource="JT030.TMFROM" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0150"/><Field DataSource="JT010.QTSEIZO" FieldOptions="" Order="0110"/><Field DataSource="BT010.TXHINBAN" FieldOptions="" Order="0020"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0030"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0120"/><Field DataSource="BT050.TXNAME" FieldOptions="" Order="0040"/><Field DataSource="BT050.FGPLANNING" FieldOptions="HORIZONTAL" Order="0050"/><Field DataSource="BT060.TXCENTER" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(37)" Order="0060"/><Field DataSource="JT030.DTTHRU" FieldOptions="CAPTION(終了予定日時),HORIZONTAL" Order="0160"/><Field DataSource="JT030.TMTHRU" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0170"/><Field DataSource="JT030.LTSEIZO" FieldOptions="HORIZONTAL,COMMENT(（分）)" Order="0130"/><Field DataSource="BT060.TMFROM" FieldOptions="CAPTION(標準稼働時間),HORIZONTAL(18)" Order="0080"/><Field DataSource="BT060.TMTHRU" FieldOptions="CAPTION(～),CAPTION_LENGTH_VARIABLE,HORIZONTAL" Order="0090"/><Field DataSource="BT060.KBCALENDAR" FieldOptions="CAPTION(稼働カレンダー)" Order="0070"/><Field DataSource="BT060.RTKAKOU" FieldOptions="HORIZONTAL(12)" Order="0100"/></Function><Function DetailKeyFields="NRSEIZO;SQKOUTEI;NRSEIZO2;SQKOUTEI2" DetailOrderBy="JT030W.DTFROM;JT030W.TMFROM" DetailTable="JT030W" HeaderKeyFields="" HeaderTable="JT030" ID="JF032" InitialMsg="" Name="工程作業予定エントリー" Size="AUTO" SubsystemID="J" Type="XF310"><Column DataSource="JT030W.NRSEIZO2" FieldOptions="CAPTION(製造指示№)" Order="0020"/><Column DataSource="JT030W.TXSAGYOYOTEI" FieldOptions="" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="UPDATE" Caption="更新" Number="5" Position="2"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="JT030.NRSEIZO" FieldOptions="" Order="0010"/><Field DataSource="JT030.DTFROM" FieldOptions="CAPTION(開始予定日時)" Order="0140"/><Field DataSource="JT030.TMFROM" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0150"/><Field DataSource="JT010.QTSEIZO" FieldOptions="" Order="0110"/><Field DataSource="BT010.TXHINBAN" FieldOptions="" Order="0020"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0030"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0120"/><Field DataSource="BT050.TXNAME" FieldOptions="" Order="0040"/><Field DataSource="BT050.FGPLANNING" FieldOptions="HORIZONTAL" Order="0050"/><Field DataSource="BT060.TXCENTER" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(37)" Order="0060"/><Column DataSource="JT010.QTSEIZO" FieldOptions="" Order="0050"/><Column DataSource="BT010.TXHINBAN" FieldOptions="" Order="0030"/><Column DataSource="BT010.TXHINMEI" FieldOptions="WIDTH(210)" Order="0040"/><Column DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0060"/><Field DataSource="JT030.DTTHRU" FieldOptions="CAPTION(終了予定日時),HORIZONTAL" Order="0160"/><Field DataSource="JT030.TMTHRU" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0170"/><Field DataSource="JT030.LTSEIZO" FieldOptions="HORIZONTAL,COMMENT(（分）)" Order="0130"/><Field DataSource="BT060.TMFROM" FieldOptions="CAPTION(標準稼働時間),HORIZONTAL(18)" Order="0080"/><Field DataSource="BT060.TMTHRU" FieldOptions="CAPTION(～),CAPTION_LENGTH_VARIABLE,HORIZONTAL" Order="0090"/><Field DataSource="BT060.KBCALENDAR" FieldOptions="CAPTION(稼働カレンダー)" Order="0070"/><Field DataSource="BT060.RTKAKOU" FieldOptions="HORIZONTAL(12)" Order="0100"/></Function><Function DetailKeyFields="NRSEIZO;SQZAIRYO" DetailTable="JT040" HeaderKeyFields="NRSEIZO" HeaderTable="JT010" ID="JF041" Name="材料出庫エントリー" Size="AUTO" SubsystemID="J" Type="XF310"><Column DataSource="JT040.QTTOUNYU" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="UPDATE" Caption="更新" Number="5" Position="2"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="JT010.NRSEIZO" FieldOptions="" Order="0010"/><Field DataSource="JT010.QTSEIZO" FieldOptions="" Order="0060"/><Field DataSource="JT010.TXTEKIYO" FieldOptions="WIDTH(888)" Order="0100"/><Field DataSource="JT010.STSEIZO" FieldOptions="HORIZONTAL" Order="0030"/><Field DataSource="BT010.TXHINBAN" FieldOptions="CAPTION(製造品番)" Order="0040"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0070"/><Field DataSource="JT010.TXSEIZOYOTEI" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="AT040ZAI.TXSOUKO" FieldOptions="CAPTION(材料出庫倉庫),CAPTION_LENGTH_VARIABLE,WIDTH(280),HORIZONTAL(30)" Order="0080"/><Column DataSource="JT040.PRSYUKKO" FieldOptions="" Order="0070"/><Field DataSource="JT010.DTSYUKKO" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(30)" Order="0090"/><Column DataSource="BT010ZAI.TXHINBAN" FieldOptions="CAPTION(材料品番)" Order="0010"/><Column DataSource="BT010ZAI.TXHINMEI" FieldOptions="CAPTION(材料品名)" Order="0030"/><Column DataSource="BT010ZAI.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0060"/></Function><Function DetailKeyFields="NRSEIZO;SQSPEC" DetailTable="JT020" Direction="LANDSCAPE" HeaderKeyFields="NRSEIZO" HeaderTable="JT010" ID="JF021" Margins="50;50;50;50" Name="見積書の印刷" PageSize="A4" SubsystemID="J" TableFontID="Font1" TableFontSize="9" TableRowNoWidth="5" Type="XF390" WithPageNumber="T"><HeaderPhrase Alignment="CENTER" AlignmentMargin="" Block="HEADER" FontID="Font1" FontSize="15" FontStyle="BOLD" MarginLeft="0" MarginRight="0" Order="0010" SpacingAfter="0" Value="&amp;Text(見積書（兼仕様確認書）)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0020" SpacingAfter="-18" Value="&amp;DataSource(AT030.TXKANJI)&amp;Text( 御中)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0030" SpacingAfter="0" Value="&amp;Image(logo.PNG;0;-3;32;0)&amp;SystemVariant(COMP_NAME)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" Order="0040" SpacingAfter="0" Value="&amp;SystemVariant(COMP_ADDRESS)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" Order="0050" SpacingAfter="0" Value="&amp;SystemVariant(COMP_TEL)&amp;Text( ㈹)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0060" SpacingAfter="10" Value="&amp;Text(営業担当 )&amp;DataSource(AT020.TXKANJI)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0070" SpacingAfter="10" Value="&amp;Text(毎度お世話になっております。ご注文内容を以下のように承りました。ご確認ください。)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0100" SpacingAfter="0" Value="&amp;Text(　ご注文数　)&amp;DataSource(JT010.QTJYUTYU;a1)&amp;Text(　　見積単価　)&amp;DataSource(JT010.PRMITSUMORI;a1)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0090" SpacingAfter="0" Value="&amp;Text(　ご注文品　)&amp;DataSource(BT010.TXHINBAN)&amp;Text(　)&amp;DataSource(BT010.TXHINMEI)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0110" SpacingAfter="0" Value="&amp;Text(　　　摘要　)&amp;DataSource(JT010.TXTEKIYO)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0080" SpacingAfter="0" Value="&amp;Text(　　納品先　)&amp;DataSource(ET011.TXKANJI)&amp;Text(　　納期　)&amp;DataSource(JT010.DTNOUKI)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0021" SpacingAfter="0" Value="&amp;Text(ご注文番号　)&amp;DataSource(JT010.TXTYUMONBANGO)&amp;Text(　管理番号　)&amp;DataSource(JT010.NRSEIZO)"/><Detail Caption="" CaptionFontSize="12" FixedWhere="" FontID="Font1" FontSize="9" HeaderKeyFields="" KeyFields="NRSEIZO;SQSPEC" Order="0010" OrderBy="" RowNoWidth="5" Table="JT020" TableFontID="Font1" TableFontSize="9" TableRowNoWidth="5"><Column Alignment="LEFT" DataSource="JT020.TXVALUE" FieldOptions="" Order="0030" Width="70"/><Column Alignment="LEFT" DataSource="BT020.KBSPEC" FieldOptions="" Order="0020" Width="25"/></Detail></Function><Function Direction="LANDSCAPE" HeaderKeyFields="NRHATTYU" HeaderTable="HT010" ID="HF015" Margins="50;50;50;50" Name="発注書の印刷" PageSize="A4" SubsystemID="H" Type="XF390" WithPageNumber="T"><Detail Caption="" CaptionFontSize="12" CaptionFontStyle="" FontID="Font1" FontSize="10" HeaderKeyFields="" KeyFields="NRHATTYU;SQHATTYU" Order="0010" RowNoWidth="5" Table="HT011"><Column Alignment="RIGHT" DataSource="HT011.PRHATTYU" FieldOptions="" Order="0030" Width="10"/><Column Alignment="RIGHT" DataSource="HT011.QTHATTYU" FieldOptions="" Order="0040" Width="10"/><Column Alignment="CENTER" DataSource="HT011.DTNOUKI" FieldOptions="" Order="0070" Width="10"/><Column Alignment="LEFT" DataSource="BT010.TXHINBAN" FieldOptions="" Order="0010" Width="15"/><Column Alignment="LEFT" DataSource="BT010.TXHINMEI" FieldOptions="" Order="0020" Width="45"/><Column Alignment="CENTER" DataSource="BT010.KBUNITPUR" FieldOptions="CAPTION(U/M)" Order="0050" Width="5"/></Detail><HeaderPhrase Alignment="CENTER" AlignmentMargin="" Block="HEADER" FontID="Font1" FontSize="15" FontStyle="BOLD" MarginLeft="0" MarginRight="0" Order="0010" SpacingAfter="0" Value="&amp;Text(発　注　書)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0020" SpacingAfter="-18" Value="&amp;DataSource(AT030.TXKANJI)&amp;Text( 御中)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0040" SpacingAfter="0" Value="&amp;Image(logo.PNG;0;-3;32;0)&amp;SystemVariant(COMP_NAME)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" Order="0050" SpacingAfter="0" Value="&amp;SystemVariant(COMP_ADDRESS)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0060" SpacingAfter="0" Value="&amp;SystemVariant(COMP_TEL)&amp;Text( ㈹)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0080" SpacingAfter="10" Value="&amp;Text(毎度お世話になっております。以下を注文させていただきます。ご確認ください。)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0130" SpacingAfter="0" Value="&amp;Text(　　　摘要　)&amp;DataSource(HT010.TXTEKIYO)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0090" SpacingAfter="0" Value="&amp;Text(　　納品先　)&amp;DataSource(AT040.TXSOUKO)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0100" SpacingAfter="0" Value="&amp;Text(　　　　　　)&amp;DataSource(AT040.NRYUBIN)&amp;Text(　)&amp;DataSource(AT040.TXJYUSYO1)&amp;Text(　)&amp;DataSource(AT040.TXJYUSYO2)"/><HeaderPhrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0030" SpacingAfter="0" Value="&amp;Text(　発注№ )&amp;DataSource(HT010.NRHATTYU)&amp;Text(　発注日 )&amp;DataSource(HT010.DTHATTYU)"/></Function><Function Direction="LANDSCAPE" HeaderKeyFields="NRNYUKA" HeaderTable="HT020" ID="HF022" Margins="50;50;50;50" Name="倉入指示書の印刷" PageSize="A4" SubsystemID="H" Type="XF390" WithPageNumber="T"><HeaderPhrase Alignment="CENTER" Block="HEADER" FontID="Font1" FontSize="15" FontStyle="BOLD" Order="0000" Value="&amp;Text(倉　入　指　示　書)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0010" SpacingAfter="0" Value="&amp;Text(　　入荷№ )&amp;DataSource(HT020.NRNYUKA)&amp;Text(　　入荷日 )&amp;DataSource(HT020.DTNYUKA)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0020" SpacingAfter="0" Value="&amp;Text(　　仕入先 )&amp;DataSource(AT030.TXKANJI)&amp;Text(　　入荷倉庫 )&amp;DataSource(AT040.TXSOUKO)"/><Detail Caption="" CaptionFontSize="12" CaptionFontStyle="" FontID="Font1" FontSize="10" HeaderKeyFields="" KeyFields="NRNYUKA;NRHATTYU;SQHATTYU" Order="0010" RowNoWidth="5" Table="HT011"><Column Alignment="LEFT" DataSource="HT011.NRHATTYU" FieldOptions="" Order="0010" Width="10"/><Column Alignment="RIGHT" DataSource="HT011.QTHATTYU" FieldOptions="" Order="0040" Width="10"/><Column Alignment="LEFT" DataSource="BT010.TXHINBAN" FieldOptions="" Order="0020" Width="10"/><Column Alignment="LEFT" DataSource="BT010.TXHINMEI" FieldOptions="" Order="0030" Width="30"/><Column Alignment="CENTER" DataSource="BT010.KBUNITPUR" FieldOptions="CAPTION(発注単位)" Order="0060" Width="8"/><Column Alignment="RIGHT" DataSource="HT011.DUMMY" FieldOptions="CAPTION(検収数)" Order="0050" Width="10"/><Column Alignment="CENTER" DataSource="BT010.KBUNIT" FieldOptions="CAPTION(在庫単位)" Order="0070" Width="8"/><Column Alignment="RIGHT" DataSource="BT010.VLKANZAN" FieldOptions="CAPTION(換算係数)" Order="0080" Width="10"/></Detail></Function><Function HeaderFunction="HF024" HeaderKeyFields="" HeaderTable="HT020" ID="HF025" Name="入荷見出し／明細の検討" Size="AUTO" SubsystemID="H" Type="XF300"><Detail Caption="発注明細" DetailFunction="HF026" HeaderKeyFields="NRNYUKA" InitialListing="T" InitialMsg="" KeyFields="NRNYUKA;NRHATTYU;SQHATTYU" Order="0010" Table="HT011"><Column DataSource="HT011.NRHATTYU" FieldOptions="" Order="0010"/><Column DataSource="HT011.PRHATTYU" FieldOptions="" Order="0040"/><Column DataSource="HT011.QTHATTYU" FieldOptions="WIDTH(100)" Order="0050"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(HF023)" Caption="実績報告" Number="5" Position="2"/><Button Action="HEADER" Caption="入荷見出し" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="HT011.QTKANZAN" FieldOptions="" Order="0090"/><Column DataSource="BT010.TXHINBAN" FieldOptions="" Order="0020"/><Column DataSource="BT010.TXHINMEI" FieldOptions="WIDTH(200)" Order="0030"/><Column DataSource="BT010.KBUNITPUR" FieldOptions="CAPTION(U/M)" Order="0080"/><Column DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0100"/><Column DataSource="HT011.QTKENSYU" FieldOptions="WIDTH(100)" Order="0070"/></Detail><Field DataSource="HT020.NRNYUKA" FieldOptions="" Order="0010"/><Field DataSource="HT020.DTNYUKA" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="HT020.DTKENSYU" FieldOptions="HORIZONTAL" Order="0070"/><Field DataSource="HT020.STNYUKA" FieldOptions="HORIZONTAL" Order="0030"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先)" Order="0040"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/><Field DataSource="AT040.TXSOUKO" FieldOptions="CAPTION(入荷倉庫)" Order="0060"/></Function><Function HeaderFunction="HF014" HeaderKeyFields="" HeaderTable="HT011" ID="HF026" Name="発注明細別取引実績の検討" Size="AUTO" SubsystemID="H" Type="XF300"><Detail Caption="仕入実績" DetailFunction="DF101" HeaderKeyFields="NRSOURCE" InitialListing="T" InitialMsg="" KeyFields="NRSOURCE;NRKAIKAKE" Order="0010" Table="DT100"><Column DataSource="DT100.NRKAIKAKE" FieldOptions="" Order="0010"/><Column DataSource="DT100.DTTORIHIKI" FieldOptions="" Order="0060"/><Column DataSource="DT100.KBAKADEN" FieldOptions="" Order="0020"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(HF027)" Caption="入荷取消" Number="9" Position="5"/><Button Action="HEADER" Caption="発注明細" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="DT100.PRTORIHIKI" FieldOptions="" Order="0070"/><Column DataSource="DT100.QTTORIHIKI" FieldOptions="" Order="0080"/><Column DataSource="DT100.AMTORIHIKI" FieldOptions="" Order="0090"/><Column DataSource="DT100.AMTAX" FieldOptions="" Order="0100"/><Column DataSource="DT100.FGVALID" FieldOptions="" Order="0030"/><Column DataSource="DT100.KBKAITORI" FieldOptions="" Order="0050"/></Detail><Field DataSource="HT011.NRHATTYU" FieldOptions="" Order="0010"/><Field DataSource="HT011.SQHATTYU" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="HT011.PRHATTYU" FieldOptions="" Order="0160"/><Field DataSource="HT011.QTHATTYU" FieldOptions="" Order="0100"/><Field DataSource="HT011.DTNOUKI" FieldOptions="" Order="0080"/><Field DataSource="HT011.NRNYUKA" FieldOptions="HORIZONTAL" Order="0030"/><Field DataSource="BT010.TXHINBAN" FieldOptions="CAPTION(品番／品名)" Order="0060"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0070"/><Field DataSource="BT010.KBUNITPUR" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0130"/><Field DataSource="HT011.QTKANZAN" FieldOptions="CAPTION(入庫数),HORIZONTAL" Order="0140"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0150"/><Detail Caption="受払実績" DetailFunction="FF101" HeaderKeyFields="NRSOURCE" InitialMsg="" KeyFields="NRSOURCE;NRZAITORI" Order="0020" Table="FT100"><Column DataSource="FT100.NRZAITORI" FieldOptions="" Order="0010"/><Column DataSource="FT100.DTTORIHIKI" FieldOptions="" Order="0040"/><Column DataSource="FT100.KBUKEBARAI" FieldOptions="" Order="0050"/><Column DataSource="FT100.KBAKADEN" FieldOptions="" Order="0020"/><Column DataSource="FT100.FGVALID" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(HF027)" Caption="入荷取消" Number="9" Position="5"/><Button Action="HEADER" Caption="発注明細" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="FT100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0090"/><Column DataSource="FT100.CDSOUKO" FieldOptions="" Order="0060"/><Column DataSource="FT100.PRTORIHIKI" FieldOptions="" Order="0070"/><Column DataSource="FT100.QTTORIHIKI" FieldOptions="" Order="0080"/><Column DataSource="FT100.AMTORIHIKI" FieldOptions="" Order="0100"/></Detail><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先Ｃ)" Order="0040"/><Field DataSource="HT020.DTNYUKA" FieldOptions="CAPTION(実際入荷日),HORIZONTAL" Order="0090"/><Field DataSource="HT011.AMSIIRE" FieldOptions="HORIZONTAL" Order="0170"/><Field DataSource="HT011.AMTAX" FieldOptions="HORIZONTAL(39)" Order="0180"/><Field DataSource="HT011.QTKENSYU" FieldOptions="HORIZONTAL" Order="0120"/></Function><Function ID="HF027" InitialMsg="*Ｆ５を押せば入荷№がクリアされて入荷見出しから切り離されます。事前に入荷数をゼロにしておいてください。" KeyFields="" Name="入荷取消エントリー" PrimaryTable="HT011" Size="AUTO" SubsystemID="H" Type="XF200" UpdateOnly="T"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="更新" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="HT011.NRHATTYU" FieldOptions="" Order="0010"/><Field DataSource="HT011.SQHATTYU" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="BT010.TXHINBAN" FieldOptions="" Order="0040"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/></Function><Function BatchKeyFields="IDSIIRESAKI" BatchRecordFunction="HF022" BatchRecordFunctionMsg="同時に倉入指示書を発行する" BatchTable="HT020" BatchWithKeyFields="HT010.IDSIIRESAKI" FixedWhere="NRNYUKA = ''" ID="HF021B" InitialListing="T" InitialMsg="" KeyFields="" Name="入荷指示エントリー／発注明細の選択" OrderBy="HT011.DTNOUKI;HT011.NRHATTYU;HT011.SQHATTYU" PrimaryTable="HT011" Size="AUTO" SubsystemID="H" Type="XF110"><Column DataSource="HT011.NRHATTYU" FieldOptions="" Order="0020"/><Column DataSource="HT011.QTHATTYU" FieldOptions="" Order="0060"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="PREV" Caption="戻る" Number="4" Position="2"/><Button Action="NEXT" Caption="次へ" Number="5" Position="4"/><Button Action="UPDATE" Caption="更新" Number="5" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Filter DataSource="AT030.TXKANJI" FieldOptions="CAPTION(仕入先名),NON_EDITABLE" Order="0010"/><Column DataSource="HT011.DTNOUKI" FieldOptions="" Order="0010"/><Column DataSource="BT010.TXHINBAN" FieldOptions="" Order="0040"/><Column DataSource="BT010.TXHINMEI" FieldOptions="WIDTH(200)" Order="0050"/><Column DataSource="BT010.KBUNITPUR" FieldOptions="CAPTION(U/M)" Order="0070"/><Column DataSource="AT040.TXSOUKO" FieldOptions="CAPTION(入荷予定倉庫),WIDTH(200)" Order="0030"/><BatchField DataSource="HT020.DTNYUKA" FieldOptions="" Order="0030"/><BatchField DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先)" Order="0010"/><BatchField DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><BatchField DataSource="AT040.TXSOUKO" FieldOptions="CAPTION(入荷倉庫),CAPTION_LENGTH_VARIABLE,WIDTH(250),HORIZONTAL(40),PROMPT_LIST" Order="0040"/></Function><Function DetailFunction="HF021B" ID="HF021A" InitialListing="T" InitialMsg="" KeyFields="IDSIIRESAKI" Name="入荷指示エントリー／仕入先の選択" OrderBy="" ParmType="COLUMNS" PrimaryTable="DT010" Size="AUTO" SubsystemID="H" Type="XF100"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="DT010.AMGENKAIKAKE" FieldOptions="" Order="0090"/><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C)" Order="0060"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(仕入先名)" Order="0070"/><Column DataSource="AT030.TXJYUSYO1" FieldOptions="" Order="0080"/><Filter DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C)" Order="0010"/><Filter DataSource="AT030.TXKANJI" FieldOptions="SCAN,CAPTION(仕入先名SCAN)" Order="0020"/></Function><Function DetailKeyFields="NRNYUKA;NRHATTYU;SQHATTYU" DetailTable="HT011" HeaderKeyFields="" HeaderTable="HT020" ID="HF023" Name="入荷実績エントリー" Size="1130;600" SubsystemID="H" Type="XF310"><Column DataSource="HT011.NRHATTYU" FieldOptions="" Order="0010"/><Column DataSource="HT011.PRHATTYU" FieldOptions="" Order="0040"/><Column DataSource="HT011.QTHATTYU" FieldOptions="" Order="0050"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="UPDATE" Caption="更新" Number="5" Position="2"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="HT020.NRNYUKA" FieldOptions="" Order="0010"/><Field DataSource="HT020.DTNYUKA" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="HT020.DTKENSYU" FieldOptions="HORIZONTAL" Order="0070"/><Field DataSource="HT020.STNYUKA" FieldOptions="HORIZONTAL" Order="0030"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先)" Order="0040"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/><Field DataSource="AT040.TXSOUKO" FieldOptions="CAPTION(入荷倉庫),PROMPT_LIST" Order="0060"/><Column DataSource="HT011.QTKANZAN" FieldOptions="" Order="0090"/><Column DataSource="BT010.TXHINBAN" FieldOptions="" Order="0020"/><Column DataSource="BT010.TXHINMEI" FieldOptions="WIDTH(250)" Order="0030"/><Column DataSource="BT010.KBUNITPUR" FieldOptions="CAPTION(U/M)" Order="0080"/><Column DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0100"/><Column DataSource="HT011.QTKENSYU" FieldOptions="" Order="0070"/><Button Action="ADD_ROW" Caption="行追加" Number="6" Position="4"/><Button Action="EXIT" Caption="行削除" Number="9" Position="5"/></Function><Function DetailFunction="DF111B" ID="DF111A" InitialListing="T" InitialMsg="" KeyFields="IDSIIRESAKI" Name="支払依頼エントリー／仕入先の選択" OrderBy="" ParmType="COLUMNS" PrimaryTable="DT010" Size="AUTO" SubsystemID="D" Type="XF100"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="DT010.AMGENKAIKAKE" FieldOptions="" Order="0090"/><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C)" Order="0060"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(仕入先名)" Order="0070"/><Column DataSource="AT030.TXJYUSYO1" FieldOptions="" Order="0080"/><Filter DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C)" Order="0010"/><Filter DataSource="AT030.TXKANJI" FieldOptions="SCAN,CAPTION(仕入先名SCAN)" Order="0020"/></Function><Function BatchKeyFields="IDSIIRESAKI" BatchRecordFunction="DF115" BatchRecordFunctionMsg="支払依頼書を発行しますか？" BatchTable="DT110" BatchWithKeyFields="DT100.IDSIIRESAKI" FixedWhere="FGVALID = 'T' AND NRSIHARAI = '       ' AND KBKAITORI != '90'" ID="DF111B" InitialListing="T" InitialMsg="" KeyFields="NRKAIKAKE" Name="支払依頼エントリー／仕入明細の選択" OrderBy="" PrimaryTable="DT100" Size="AUTO" SubsystemID="D" Type="XF110"><Column DataSource="DT100.NRKAIKAKE" FieldOptions="" Order="0010"/><Column DataSource="DT100.DTTORIHIKI" FieldOptions="" Order="0020"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="PREV" Caption="戻る" Number="4" Position="2"/><Button Action="NEXT" Caption="次へ" Number="5" Position="4"/><Button Action="UPDATE" Caption="更新" Number="5" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Filter DataSource="AT030.TXKANJI" FieldOptions="CAPTION(仕入先名),NON_EDITABLE" Order="0020"/><Column DataSource="DT100.KBKAITORI" FieldOptions="" Order="0030"/><Column DataSource="DT100.TXHINBAN" FieldOptions="" Order="0040"/><Column DataSource="DT100.TXHINMEI" FieldOptions="WIDTH(250)" Order="0050"/><Column DataSource="DT100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0080"/><Column DataSource="DT100.PRTORIHIKI" FieldOptions="" Order="0060"/><Column DataSource="DT100.QTTORIHIKI" FieldOptions="" Order="0070"/><Column DataSource="DT100.AMTORIHIKI" FieldOptions="" Order="0090"/><Column DataSource="DT100.AMTAX" FieldOptions="" Order="0100"/><BatchField DataSource="DT110.DTSIHARAI" FieldOptions="" Order="0040"/><BatchField DataSource="DT110.AMSIHARAI" FieldOptions="HORIZONTAL" Order="0060"/><BatchField DataSource="DT110.TXSEIKYU" FieldOptions="HORIZONTAL" Order="0050"/><BatchField DataSource="AT030.TXKANJI" FieldOptions="" Order="0010"/><BatchField DataSource="DT110.KBSIHARAI" FieldOptions="CAPTION(支払方法),HORIZONTAL" Order="0030"/></Function><Function DetailKeyFields="NRSIHARAI;NRKAIKAKE" DetailTable="DT100" HeaderKeyFields="NRSIHARAI" HeaderTable="DT110" ID="DF121" Name="支払承認エントリー" Size="1200;700" SubsystemID="D" Type="XF310"><Column DataSource="DT100.NRKAIKAKE" FieldOptions="" Order="0020"/><Column DataSource="DT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="UPDATE" Caption="更新" Number="5" Position="2"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="DT110.NRSIHARAI" FieldOptions="" Order="0010"/><Field DataSource="DT110.DTSIHARAI" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="DT110.AMSIHARAI" FieldOptions="" Order="0060"/><Field DataSource="DT110.TXSEIKYU" FieldOptions="HORIZONTAL" Order="0070"/><Field DataSource="DT110.KBSIHARAI" FieldOptions="CAPTION(支払方法)" Order="0080"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先Ｃ)" Order="0040"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/><Field DataSource="DT010.TXHURIKOMI" FieldOptions="HORIZONTAL(48)" Order="0090"/><Column DataSource="DT100.KBKAITORI" FieldOptions="" Order="0030"/><Column DataSource="DT100.TXHINMEI" FieldOptions="WIDTH(200)" Order="0040"/><Column DataSource="DT100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0070"/><Column DataSource="DT100.PRTORIHIKI" FieldOptions="" Order="0050"/><Column DataSource="DT100.QTTORIHIKI" FieldOptions="" Order="0060"/><Column DataSource="DT100.AMTORIHIKI" FieldOptions="" Order="0080"/><Column DataSource="DT100.AMTAX" FieldOptions="" Order="0090"/><Field DataSource="DT110.TXTEKIYO" FieldOptions="WIDTH(900)" Order="0100"/><Field DataSource="DT110.STSIHARAI" FieldOptions="HORIZONTAL" Order="0030"/></Function><Function ID="DF113" Name="支払依頼取消処理" Script="////////////////////////#EOL#// 当該増減履歴の検索 //#EOL#////////////////////////#EOL#var rDT100 = instance.createTableOperator('Select', 'DT100');#EOL#rDT100.setSelectFields('KBKAITORI, NRSOURCE');#EOL#rDT100.addKeyValue('NRKAIKAKE',&#x9;instance.parmMap.get('NRKAIKAKE'));#EOL#if (rDT100.next()) {#EOL##EOL#&#x9;////////////////////////#EOL#&#x9;// 90(支払)の増減履歴 //#EOL#&#x9;////////////////////////#EOL#&#x9;if (rDT100.getValueOf('KBKAITORI') == '90') {#EOL#&#x9;&#x9;showMessage('これは支払実績なので、支払依頼から切り離しできません。');#EOL#&#x9;} else {#EOL##EOL#&#x9;&#x9;/////////////////////////////#EOL#&#x9;&#x9;// 90(支払)以外の増減履歴 //#EOL#&#x9;&#x9;/////////////////////////////#EOL#&#x9;&#x9;var rDT110 = instance.createTableOperator('Select', 'DT110');#EOL#&#x9;&#x9;rDT110.setSelectFields('DTSIHARAI');#EOL#&#x9;&#x9;rDT110.addKeyValue('NRSIHARAI',&#x9;rDT100.getValueOf('NRSIHARAI'));#EOL#&#x9;&#x9;if (rDT110.next()) {#EOL##EOL#&#x9;&#x9;&#x9;////////////////////////////////#EOL#&#x9;&#x9;&#x9;// 承認済であるかの検査と更新 //#EOL#&#x9;&#x9;&#x9;////////////////////////////////#EOL#&#x9;&#x9;&#x9;if (rDT110.getValueOf('DTSYONIN') == '') {#EOL#&#x9;&#x9;&#x9;&#x9;var uDT100 = instance.createTableOperator('Update', 'DT100');#EOL#&#x9;&#x9;&#x9;&#x9;uDT100.addValue('NRSIHARAI',&#x9;'');#EOL#&#x9;&#x9;&#x9;&#x9;uDT100.addKeyValue('NRKAIKAKE',&#x9;instance.parmMap.get('NRKAIKAKE'));#EOL#&#x9;&#x9;&#x9;&#x9;var count = uDT100.execute();#EOL#&#x9;&#x9;&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;instance.returnMap.put('RETURN_CODE', '20');#EOL#&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;showMessage('対象データの更新に失敗しました。');#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;showMessage('支払依頼が既に承認済であるため、切り離しできません。');#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}" SubsystemID="D" Type="XF000"/><Function ID="EF114" InitialMsg="" KeyFields="" Name="請求見出しの保守" PrimaryTable="ET110" Size="AUTO" SubsystemID="E" Type="XF200"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="ET110.NRSEIKYU" FieldOptions="" Order="0010"/><Field DataSource="ET110.DTSEIKYU" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="ET110.TXTEKIYO" FieldOptions="WIDTH(900)" Order="0070"/><Field DataSource="ET110.AMSEIKYU" FieldOptions="HORIZONTAL" Order="0060"/><Field DataSource="ET110.AMNYUKIN" FieldOptions="" Order="0050"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先Ｃ)" Order="0030"/></Function><Function ID="EF116" Name="請求取消処理" Script="////////////////////////#EOL#// 当該増減履歴の検索 //#EOL#////////////////////////#EOL#var rET100 = instance.createTableOperator('Select', 'ET100');#EOL#rET100.setSelectFields('NRSEIKYU');#EOL#rET100.addKeyValue('NRURIKAKE',&#x9;instance.parmMap.get('NRURIKAKE'));#EOL#if (rET100.next()) {#EOL##EOL#&#x9;//////////////////////////#EOL#&#x9;// 未請求分なら処理不可 //#EOL#&#x9;//////////////////////////#EOL#&#x9;if (rET100.getValueOf('NRSEIKYU') == '') {#EOL#&#x9;&#x9;showMessage('まだ請求処理されていないため、請求取消できません。');#EOL#&#x9;} else {#EOL##EOL#&#x9;&#x9;var uET100 = instance.createTableOperator('Update', 'ET100');#EOL#&#x9;&#x9;uET100.addValue('NRSEIKYU',&#x9;'');#EOL#&#x9;&#x9;uET100.addKeyValue('NRURIKAKE',&#x9;instance.parmMap.get('NRURIKAKE'));#EOL#&#x9;&#x9;var count = uET100.execute();#EOL#&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;instance.returnMap.put('RETURN_CODE', '20');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;showMessage('対象データの更新に失敗しました。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}" SubsystemID="E" Type="XF000"/><Function DetailFunction="MF022" ID="MF020" InitialListing="T" InitialMsg="" KeyFields="" Name="棚卸指示データの一覧・保守" OrderBy="" PrimaryTable="MT020" Size="AUTO" SubsystemID="M" Type="XF100"><Column DataSource="MT020.NRTANAOROSI" FieldOptions="" Order="0020"/><Column DataSource="MT020.CDSOUKO" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(MF021)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="MT020.STTANAOROSI" FieldOptions="" Order="0050"/><Column DataSource="AT040.TXSOUKO" FieldOptions="" Order="0040"/><Filter DataSource="MT020.DTKIJYUNWORK" FieldOptions="GE,CAPTION(指示日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Column DataSource="MT020.DTKIJYUN" FieldOptions="" Order="0010"/></Function><Function FunctionAfterInsert="MF022" ID="MF021" InitialMsg="" KeyFields="" Name="棚卸指示の保守" PrimaryTable="MT020" Size="AUTO" SubsystemID="M" Type="XF200"><Field DataSource="MT020.NRTANAOROSI" FieldOptions="" Order="0010"/><Field DataSource="MT020.DTKAKUTEI" FieldOptions="HORIZONTAL" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="MT020.DTKIJYUN" FieldOptions="" Order="0030"/><Field DataSource="AT040.TXSOUKO" FieldOptions="CAPTION(倉庫),HORIZONTAL,PROMPT_LIST" Order="0020"/><Field DataSource="MT020.TXTEKIYO" FieldOptions="" Order="0050"/></Function><Function HeaderFunction="" HeaderKeyFields="" HeaderTable="MT020" ID="MF022" Name="棚卸指示と関連情報の検討" Size="AUTO" SubsystemID="M" Type="XF300"><Detail Caption="棚卸指示明細" DetailFunction="MF025" HeaderKeyFields="" InitialListing="T" InitialMsg="" KeyFields="NRTANAOROSI;IDHINMOKU" Order="0010" Table="MT021"><Column DataSource="MT021.QTJITSUTANA" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(MF029)" Caption="編集ツール" Number="5" Position="2"/><Button Action="CALL(MF023)" Caption="調査表" Number="7" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="MT021.QTKIJYUN" FieldOptions="" Order="0030"/><Column DataSource="BT010.TXHINBAN" FieldOptions="" Order="0010"/><Column DataSource="BT010.TXHINMEI" FieldOptions="" Order="0020"/><Column DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0060"/><Column DataSource="MT021.AMDIFF" FieldOptions="" Order="0090"/><Button Action="CALL(MF024)" Caption="結果検討表" Number="8" Position="5"/><Column DataSource="MT021.PRJITSUTANA" FieldOptions="" Order="0080"/><Column DataSource="MT021.QTDIFF" FieldOptions="" Order="0050"/><Column DataSource="BT010.PRGENKA" FieldOptions="" Order="0070"/></Detail><Detail Caption="在庫増減履歴" DetailFunction="FF101" HeaderKeyFields="NRSOURCE" InitialListing="T" InitialMsg="" KeyFields="NRSOURCE;NRZAITORI" Order="0020" Table="FT100"><Column DataSource="FT100.NRZAITORI" FieldOptions="" Order="0020"/><Column DataSource="FT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="FT100.KBUKEBARAI" FieldOptions="" Order="0050"/><Column DataSource="FT100.KBAKADEN" FieldOptions="" Order="0030"/><Column DataSource="FT100.FGVALID" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="FT100.TXHINBAN" FieldOptions="" Order="0060"/><Column DataSource="FT100.TXHINMEI" FieldOptions="" Order="0070"/><Column DataSource="FT100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0090"/><Column DataSource="FT100.QTTORIHIKI" FieldOptions="" Order="0080"/><Column DataSource="FT100.AMTORIHIKI" FieldOptions="" Order="0100"/></Detail><Field DataSource="MT020.NRTANAOROSI" FieldOptions="" Order="0010"/><Field DataSource="MT020.DTKAKUTEI" FieldOptions="HORIZONTAL" Order="0040"/><Field DataSource="MT020.DTKIJYUN" FieldOptions="" Order="0030"/><Field DataSource="AT040.TXSOUKO" FieldOptions="CAPTION(倉庫),HORIZONTAL" Order="0020"/><Field DataSource="MT020.TXTEKIYO" FieldOptions="" Order="0050"/></Function><Function Direction="NORMAL" HeaderKeyFields="NRTANAOROSI" HeaderTable="MT020" ID="MF023" Margins="50;50;50;50" Name="棚卸調査表の印刷" PageSize="A4" SubsystemID="M" Type="XF390" WithPageNumber="T"><HeaderPhrase Alignment="CENTER" Block="HEADER" FontID="Font1" FontSize="15" FontStyle="BOLD" Order="0000" Value="&amp;Text(棚 卸 調 査 表)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0010" SpacingAfter="0" Value="&amp;Text(　棚卸№ )&amp;DataSource(MT020.NRTANAOROSI)&amp;Text(　)&amp;DataSource(AT040.TXSOUKO)&amp;Text(　調査基準日時)&amp;DataSource(MT020.DTKIJYUN)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0020" SpacingAfter="0" Value="&amp;Text(　　 摘要 )&amp;DataSource(MT020.TXTEKIYO)"/><Detail Caption="" CaptionFontSize="12" CaptionFontStyle="" FontID="Font1" FontSize="10" HeaderKeyFields="" KeyFields="NRTANAOROSI;IDHINMOKU" Order="0010" OrderBy="BT010.TXHINBAN" RowNoWidth="5" Table="MT021"><Column Alignment="RIGHT" DataSource="MT021.QTJITSUTANA" FieldOptions="" Order="0040" Width="20"/><Column Alignment="LEFT" DataSource="BT010.TXHINBAN" FieldOptions="" Order="0010" Width="20"/><Column Alignment="LEFT" DataSource="BT010.TXHINMEI" FieldOptions="" Order="0020" Width="50"/><Column Alignment="CENTER" DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0050" Width="5"/></Detail></Function><Function Direction="LANDSCAPE" HeaderKeyFields="NRTANAOROSI" HeaderTable="MT020" ID="MF024" Margins="50;50;50;50" Name="棚卸結果検討表の印刷" PageSize="A4" SubsystemID="M" Type="XF390" WithPageNumber="T"><Detail Caption="" CaptionFontSize="12" CaptionFontStyle="" FontID="Font1" FontSize="10" HeaderKeyFields="" KeyFields="NRTANAOROSI;IDHINMOKU" Order="0010" RowNoWidth="5" Table="MT021"><Column Alignment="RIGHT" DataSource="MT021.QTJITSUTANA" FieldOptions="" Order="0040" Width="9"/><Column Alignment="RIGHT" DataSource="MT021.QTKIJYUN" FieldOptions="" Order="0030" Width="9"/><Column Alignment="RIGHT" DataSource="MT021.QTDIFF" FieldOptions="" Order="0050" Width="9"/><Column Alignment="LEFT" DataSource="BT010.TXHINBAN" FieldOptions="" Order="0010" Width="15"/><Column Alignment="LEFT" DataSource="BT010.TXHINMEI" FieldOptions="" Order="0020" Width="30"/><Column Alignment="CENTER" DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0060" Width="5"/><Column Alignment="RIGHT" DataSource="MT021.PRJITSUTANA" FieldOptions="" Order="0080" Width="9"/><Column Alignment="RIGHT" DataSource="BT010.PRGENKA" FieldOptions="" Order="0070" Width="9"/></Detail><HeaderPhrase Alignment="CENTER" Block="HEADER" FontID="Font1" FontSize="15" FontStyle="BOLD" Order="0000" Value="&amp;Text(棚 卸 結 果 検 討 表)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0010" SpacingAfter="0" Value="&amp;Text(　棚卸№ )&amp;DataSource(MT020.NRTANAOROSI)&amp;Text(　)&amp;DataSource(AT040.TXSOUKO)&amp;Text(　調査基準日時)&amp;DataSource(MT020.DTKIJYUN)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0020" SpacingAfter="0" Value="&amp;Text(　＊帳簿在庫数と実棚数で差のある明細のみが一覧されています。必要に応じて実棚数量や実棚単価を修正してください。)"/></Function><Function ID="MF025" InitialMsg="" KeyFields="" Name="棚卸指示明細の保守" PrimaryTable="MT021" Size="AUTO" SubsystemID="M" Type="XF200"><Field DataSource="MT021.NRTANAOROSI" FieldOptions="" Order="0010"/><Field DataSource="MT021.PRJITSUTANA" FieldOptions="HORIZONTAL" Order="0100"/><Field DataSource="MT021.QTJITSUTANA" FieldOptions="HORIZONTAL" Order="0060"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="AT040.TXSOUKO" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="MT021.PRKIJYUN" FieldOptions="" Order="0080"/><Field DataSource="MT021.QTKIJYUN" FieldOptions="" Order="0050"/><Field DataSource="BT010.TXHINBAN" FieldOptions="" Order="0030"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0070"/><Field DataSource="BT010.PRGENKA" FieldOptions="HORIZONTAL" Order="0090"/></Function><Function DetailKeyFields="NRTANAOROSI;IDHINMOKU" DetailTable="MT021" HeaderKeyFields="NRTANAOROSI" HeaderTable="MT020" ID="MF026" Name="棚卸結果エントリー" Size="AUTO" SubsystemID="M" Type="XF310"><Column DataSource="MT021.QTJITSUTANA" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="UPDATE" Caption="更新" Number="5" Position="2"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="MT020.NRTANAOROSI" FieldOptions="" Order="0010"/><Field DataSource="MT020.TXTEKIYO" FieldOptions="" Order="0040"/><Column DataSource="BT010.TXHINBAN" FieldOptions="" Order="0010"/><Column DataSource="BT010.TXHINMEI" FieldOptions="" Order="0020"/><Column DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0040"/><Field DataSource="MT020.DTKIJYUN" FieldOptions="HORIZONTAL" Order="0030"/></Function><Function ID="MF028" Name="棚卸指示の削除" Script="var rMT020 = instance.createTableOperator('Select', 'MT020');#EOL#rMT020.addKeyValue('NRTANAOROSI',&#x9;instance.parmMap.get('NRTANAOROSI'));#EOL#if (rMT020.next()) {#EOL##EOL#&#x9;var rMT021 = instance.createTableOperator('Count', 'MT021');#EOL#&#x9;rMT021.addKeyValue('NRTANAOROSI',&#x9;instance.parmMap.get('NRTANAOROSI'));#EOL#&#x9;var countOfRecords = rMT021.execute();#EOL##EOL#&#x9;var dMT021 = instance.createTableOperator('Delete', 'MT021');#EOL#&#x9;dMT021.addKeyValue('NRTANAOROSI',&#x9;instance.parmMap.get('NRTANAOROSI'));#EOL#&#x9;var countOfDeleted = dMT021.execute();#EOL#&#x9;if (countOfDeleted == countOfRecords) {#EOL##EOL#&#x9;&#x9;var dMT020 = instance.createTableOperator('Delete', 'MT020');#EOL#&#x9;&#x9;dMT020.addKeyValue('NRTANAOROSI',&#x9;instance.parmMap.get('NRTANAOROSI'));#EOL#&#x9;&#x9;countOfDeleted = dMT020.execute();#EOL#&#x9;&#x9;if (countOfDeleted == 1) {#EOL#&#x9;&#x9;&#x9;instance.returnMap.put('RETURN_CODE', '30');#EOL#&#x9;&#x9;&#x9;instance.returnMap.put('RETURN_MESSAGE', '＊正常に削除されました。');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;instance.cancelWithMessage('削除処理に失敗しました。処理は取り消されました。');#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;} else {#EOL#&#x9;&#x9;instance.cancelWithMessage('削除処理に失敗しました。処理は取り消されました。');#EOL#&#x9;}#EOL##EOL#} else {#EOL#&#x9;instance.returnMap.put('RETURN_MESSAGE', '＊レコードが存在しません。処理は取り消されました。');#EOL#}" SubsystemID="M" Type="XF000"/><Function ID="MF029" Name="棚卸編集ツール" Script="////////////////////#EOL#// 棚卸指示の読取 //#EOL#////////////////////#EOL#var rMT020 = instance.createTableOperator('Select', 'MT020');#EOL#rMT020.addKeyValue('NRTANAOROSI',&#x9;instance.parmMap.get('NRTANAOROSI'));#EOL#if (rMT020.next()) {#EOL##EOL#&#x9;//////////////////////////////////////#EOL#&#x9;// ダイアログの取得とオプション設定 //#EOL#&#x9;//////////////////////////////////////#EOL#&#x9;var dialog = session.getOptionDialog();#EOL#&#x9;dialog.addOption('棚卸指示の確認・編集'); // 0 //#EOL#&#x9;dialog.addOption('棚卸指示明細の追加');   // 1 //#EOL#&#x9;dialog.addOption('棚卸結果エントリー');   // 2 //#EOL#&#x9;if (rMT020.getValueOf('DTKAKUTEI') == '') {#EOL#&#x9;&#x9;dialog.addOption('確定更新');         // 3 //#EOL#&#x9;} else {#EOL#&#x9;&#x9;dialog.addOption('確定解除');         // 3 //#EOL#&#x9;}#EOL#&#x9;dialog.addOption('棚卸指示の削除');       // 4 //#EOL#&#x9;dialog.addOption('閉じる　　　　　　');   // 5 //#EOL##EOL#&#x9;//////////////////////////////////////#EOL#&#x9;// ダイアログの表示と関連機能の起動 //#EOL#&#x9;//////////////////////////////////////#EOL#&#x9;var reply = dialog.request('棚卸編集ツール');#EOL#&#x9;if (reply == 0) {#EOL#&#x9;&#x9;instance.callFunction('MF021');#EOL#&#x9;}#EOL#&#x9;if (reply == 1) {#EOL#&#x9;&#x9;instance.callFunction('MF025');#EOL#&#x9;}#EOL#&#x9;if (reply == 2) {#EOL#&#x9;&#x9;instance.callFunction('MF026');#EOL#&#x9;}#EOL#&#x9;if (reply == 3) {#EOL#&#x9;&#x9;if (rMT020.getValueOf('DTKAKUTEI') == '') {#EOL#&#x9;&#x9;&#x9;instance.callFunction('MF027A');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;instance.callFunction('MF027B');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#&#x9;if (reply == 4) {#EOL#&#x9;&#x9;instance.callFunction('MF028');#EOL#&#x9;}#EOL#&#x9;if (reply == 5 || reply == -1) {#EOL#&#x9;&#x9;instance.returnMap.put('RETURN_MESSAGE', '＊処理は取り消されました。');#EOL#&#x9;}#EOL##EOL#} else {#EOL#&#x9;instance.returnMap.put('RETURN_MESSAGE', '＊レコードが存在しません。処理は取り消されました。');#EOL#}" SubsystemID="M" Type="XF000"/><Function DetailFunction="MF032" ID="MF030" InitialListing="T" InitialMsg="" KeyFields="" Name="在庫移動指示データの一覧・保守" OrderBy="" PrimaryTable="MT030" Size="AUTO" SubsystemID="M" Type="XF100"><Column DataSource="MT030.NRZAIIDOU" FieldOptions="" Order="0020"/><Column DataSource="MT030.DTSHIJI" FieldOptions="" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(MF031)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="MT030.STZAIIDOU" FieldOptions="" Order="0050"/><Column DataSource="AT040F.TXSOUKO" FieldOptions="CAPTION(元倉庫)" Order="0030"/><Column DataSource="AT040T.TXSOUKO" FieldOptions="CAPTION(先倉庫)" Order="0040"/><Filter DataSource="MT030.DTSHIJI" FieldOptions="GE,CAPTION(指示日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0040"/></Function><Function FunctionAfterInsert="MF033" ID="MF031" InitialMsg="" KeyFields="" Name="在庫移動指示の保守" PrimaryTable="MT030" Size="AUTO" SubsystemID="M" Type="XF200"><Field DataSource="MT030.NRZAIIDOU" FieldOptions="" Order="0010"/><Field DataSource="MT030.DTSHIJI" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="MT030.TXTEKIYO" FieldOptions="" Order="0070"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="AT040F.TXSOUKO" FieldOptions="CAPTION(移動元／先倉庫),PROMPT_LIST" Order="0050"/><Field DataSource="AT040T.TXSOUKO" FieldOptions="NO_CAPTION,HORIZONTAL,PROMPT_LIST" Order="0060"/><Field DataSource="MT030.DTKANRYO" FieldOptions="HORIZONTAL" Order="0040"/></Function><Function ID="MF036" Name="在庫移動指示編集ツール" Script="////////////////////#EOL#// 棚卸指示の読取 //#EOL#////////////////////#EOL#var rMT030 = instance.createTableOperator('Select', 'MT030');#EOL#rMT030.addKeyValue('NRZAIIDOU',&#x9;instance.parmMap.get('NRZAIIDOU'));#EOL#if (rMT030.next()) {#EOL##EOL#&#x9;//////////////////////////////////////#EOL#&#x9;// ダイアログの取得とオプション設定 //#EOL#&#x9;//////////////////////////////////////#EOL#&#x9;var dialog = session.getOptionDialog();#EOL#&#x9;dialog.addOption('在庫移動指示の保守');     // 0 //#EOL#&#x9;dialog.addOption('在庫移動指示明細の保守'); // 1 //#EOL#&#x9;if (rMT030.getValueOf('DTKANRYO') == '') {#EOL#&#x9;&#x9;dialog.addOption('移動完了エントリー'); // 2 //#EOL#&#x9;} else {#EOL#&#x9;&#x9;dialog.addOption('移動完了取消');       // 2 //#EOL#&#x9;}#EOL#&#x9;dialog.addOption('閉じる　　　　　　');     // 3 //#EOL##EOL#&#x9;//////////////////////////////////////#EOL#&#x9;// ダイアログの表示と関連機能の起動 //#EOL#&#x9;//////////////////////////////////////#EOL#&#x9;var reply = dialog.request('棚卸編集ツール');#EOL#&#x9;if (reply == 0) {#EOL#&#x9;&#x9;instance.callFunction('MF031');#EOL#&#x9;}#EOL#&#x9;if (reply == 1) {#EOL#&#x9;&#x9;instance.callFunction('MF033');#EOL#&#x9;}#EOL#&#x9;if (reply == 2) {#EOL#&#x9;&#x9;if (rMT030.getValueOf('DTKANRYO') == '') {#EOL#&#x9;&#x9;&#x9;instance.callFunction('MF035A');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;instance.callFunction('MF035B');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#&#x9;if (reply == 3 || reply == -1) {#EOL#&#x9;&#x9;instance.returnMap.put('RETURN_MESSAGE', '＊処理は取り消されました。');#EOL#&#x9;}#EOL#}" SubsystemID="M" Type="XF000"/><Function ID="MF027A" InitialMsg="*確定ボタンを押せば、基準日時での帳簿在庫と実棚との差にもとづいて在庫更新されます。" KeyFields="" Name="実棚確定更新" PrimaryTable="MT020" Size="AUTO" SubsystemID="M" Type="XF200" UpdateOnly="T"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="確定" Number="5" Position="2"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="MT020.NRTANAOROSI" FieldOptions="" Order="0010"/><Field DataSource="MT020.DTKAKUTEI" FieldOptions="HORIZONTAL" Order="0040"/><Field DataSource="MT020.DTKIJYUN" FieldOptions="" Order="0030"/><Field DataSource="AT040.TXSOUKO" FieldOptions="CAPTION(倉庫),HORIZONTAL" Order="0020"/></Function><Function ID="MF027B" InitialMsg="*すでに確定されています。確定解除ボタンを押せば棚卸結果が解除されます。" KeyFields="" Name="実棚確定解除" PrimaryTable="MT020" Size="AUTO" SubsystemID="M" Type="XF200" UpdateOnly="T"><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="確定解除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="MT020.NRTANAOROSI" FieldOptions="" Order="0010"/><Field DataSource="MT020.DTKAKUTEI" FieldOptions="HORIZONTAL" Order="0040"/><Field DataSource="MT020.DTKIJYUN" FieldOptions="" Order="0030"/><Field DataSource="AT040.TXSOUKO" FieldOptions="CAPTION(倉庫),HORIZONTAL" Order="0020"/></Function><Function HeaderFunction="" HeaderKeyFields="" HeaderTable="MT030" ID="MF032" Name="在庫移動指示見出し明細の検討" Size="AUTO" SubsystemID="M" Type="XF300"><Detail Caption="品目明細" DetailFunction="NONE" HeaderKeyFields="" InitialListing="T" InitialMsg="" KeyFields="NRZAIIDOU;IDHINMOKU" Order="0010" Table="MT031"><Column DataSource="MT031.PRZAIIDOU" FieldOptions="" Order="0030"/><Column DataSource="MT031.QTZAIIDOU" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(MF036)" Caption="編集ツール" Number="5" Position="2"/><Button Action="CALL(MF034)" Caption="指示書" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="BT010.TXHINBAN" FieldOptions="" Order="0010"/><Column DataSource="BT010.TXHINMEI" FieldOptions="" Order="0020"/><Column DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0050"/></Detail><Field DataSource="MT030.NRZAIIDOU" FieldOptions="" Order="0010"/><Field DataSource="MT030.DTSHIJI" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="MT030.TXTEKIYO" FieldOptions="" Order="0070"/><Field DataSource="AT040F.TXSOUKO" FieldOptions="CAPTION(移動元／先倉庫)" Order="0050"/><Field DataSource="AT040T.TXSOUKO" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0060"/><Detail Caption="在庫増減履歴" DetailFunction="FF101" HeaderKeyFields="NRSOURCE" InitialMsg="" KeyFields="NRSOURCE;NRZAITORI" Order="0020" Table="FT100"><Column DataSource="FT100.NRZAITORI" FieldOptions="" Order="0020"/><Column DataSource="FT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="FT100.KBUKEBARAI" FieldOptions="" Order="0050"/><Column DataSource="FT100.KBAKADEN" FieldOptions="" Order="0030"/><Column DataSource="FT100.FGVALID" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="FT100.TXHINBAN" FieldOptions="" Order="0080"/><Column DataSource="FT100.TXHINMEI" FieldOptions="WIDTH(200)" Order="0090"/><Column DataSource="FT100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0120"/><Column DataSource="FT100.TXAITESAKI" FieldOptions="WIDTH(150)" Order="0070"/><Column DataSource="FT100.PRTORIHIKI" FieldOptions="" Order="0100"/><Column DataSource="FT100.QTTORIHIKI" FieldOptions="" Order="0110"/><Column DataSource="AT040.TXSOUKO" FieldOptions="WIDTH(150)" Order="0060"/></Detail><Field DataSource="MT030.DTKANRYO" FieldOptions="HORIZONTAL" Order="0040"/></Function><Function AddRowListReturnDataSources="FT010.IDHINMOKU" AddRowListReturnToDetailDataSources="MT031.IDHINMOKU" AddRowListTable="FT010" AddRowListWithFields="CDSOUKO" AddRowListWithHeaderFields="MT030.CDSOUKOFROM" DetailKeyFields="NRZAIIDOU;IDHINMOKU" DetailTable="MT031" HeaderKeyFields="NRZAIIDOU" HeaderTable="MT030" ID="MF033" Name="在庫移動指示見出し明細の保守" Size="AUTO" SubsystemID="M" Type="XF310"><Column DataSource="MT031.QTZAIIDOU" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="UPDATE" Caption="更新" Number="5" Position="2"/><Button Action="ADD_ROW" Caption="行追加" Number="6" Position="4"/><Button Action="REMOVE_ROW" Caption="行削除" Number="9" Position="5"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="MT030.NRZAIIDOU" FieldOptions="" Order="0010"/><Field DataSource="MT030.DTSHIJI" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="MT030.TXTEKIYO" FieldOptions="" Order="0060"/><Field DataSource="AT040F.TXSOUKO" FieldOptions="CAPTION(移動元／先倉庫)" Order="0040"/><Field DataSource="AT040T.TXSOUKO" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0050"/><Column DataSource="BT010.TXHINBAN" FieldOptions="" Order="0010"/><Column DataSource="BT010.TXHINMEI" FieldOptions="" Order="0020"/><Column DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0050"/><AddRowListColumn DataSource="FT010.QTGENZAIKO" FieldOptions="" Order="0030"/><AddRowListColumn DataSource="BT010.TXHINBAN" FieldOptions="" Order="0010"/><AddRowListColumn DataSource="BT010.TXHINMEI" FieldOptions="" Order="0020"/><AddRowListColumn DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0040"/><AddRowListButton Action="EXIT" Caption="終了" Number="3" Position="0"/><AddRowListButton Action="ADD_SELECTED" Caption="選択分追加" Number="6" Position="3"/><Column DataSource="MT031.PRZAIIDOU" FieldOptions="" Order="0030"/></Function><Function Direction="LANDSCAPE" HeaderKeyFields="NRZAIIDOU" HeaderTable="MT030" ID="MF034" Margins="50;50;50;50" Name="在庫移動指示書の印刷" PageSize="A4" SubsystemID="M" Type="XF390" WithPageNumber="T"><HeaderPhrase Alignment="CENTER" Block="HEADER" FontID="Font1" FontSize="15" FontStyle="BOLD" Order="0000" Value="&amp;Text(在　庫　移　動　指　示　書)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0010" SpacingAfter="0" Value="&amp;Text(　　　在庫移動№ )&amp;DataSource(MT030.NRZAIIDOU)&amp;Text(　　　指示日 )&amp;DataSource(MT030.DTSHIJI)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0020" SpacingAfter="0" Value="&amp;Text(　移動元／先倉庫 )&amp;DataSource(AT040F.TXSOUKO)&amp;Text( → )&amp;DataSource(AT040T.TXSOUKO)"/><HeaderPhrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0040" SpacingAfter="0" Value="&amp;Text(　　　　　　摘要 )&amp;DataSource(MT030.TXTEKIYO)"/><Detail Caption="" CaptionFontSize="12" CaptionFontStyle="" FontID="Font1" FontSize="10" HeaderKeyFields="" KeyFields="NRZAIIDOU;IDHINMOKU" Order="0010" RowNoWidth="5" Table="MT031"><Column Alignment="RIGHT" DataSource="MT031.QTZAIIDOU" FieldOptions="" Order="0030" Width="15"/><Column Alignment="LEFT" DataSource="BT010.TXHINBAN" FieldOptions="" Order="0010" Width="25"/><Column Alignment="LEFT" DataSource="BT010.TXHINMEI" FieldOptions="" Order="0020" Width="50"/><Column Alignment="LEFT" DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0040" Width="5"/></Detail></Function><Function DetailKeyFields="NRZAIIDOU;IDHINMOKU" DetailTable="MT031" HeaderKeyFields="NRZAIIDOU" HeaderTable="MT030" ID="MF035A" Name="在庫移動完了エントリー" Size="AUTO" SubsystemID="M" Type="XF310"><Column DataSource="MT031.PRZAIIDOU" FieldOptions="" Order="0030"/><Column DataSource="MT031.QTZAIIDOU" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="UPDATE" Caption="更新" Number="5" Position="2"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="MT030.NRZAIIDOU" FieldOptions="" Order="0010"/><Field DataSource="MT030.DTSHIJI" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="MT030.TXTEKIYO" FieldOptions="" Order="0070"/><Field DataSource="AT040F.TXSOUKO" FieldOptions="CAPTION(移動元／先倉庫)" Order="0050"/><Field DataSource="AT040T.TXSOUKO" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0060"/><Column DataSource="BT010.TXHINBAN" FieldOptions="" Order="0010"/><Column DataSource="BT010.TXHINMEI" FieldOptions="" Order="0020"/><Column DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0050"/></Function><Function FunctionAfterInsert="" ID="MF035B" InitialMsg="*すでに移動は完了しています。完了取消ボタンを押せば未完了に戻ります。" KeyFields="" Name="在庫移動完了取消" PrimaryTable="MT030" Size="AUTO" SubsystemID="M" Type="XF200" UpdateOnly="T"><Field DataSource="MT030.NRZAIIDOU" FieldOptions="" Order="0010"/><Field DataSource="MT030.DTSHIJI" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="MT030.TXTEKIYO" FieldOptions="" Order="0070"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="完了取消" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="AT040F.TXSOUKO" FieldOptions="CAPTION(移動元／先倉庫),PROMPT_LIST" Order="0050"/><Field DataSource="AT040T.TXSOUKO" FieldOptions="NO_CAPTION,HORIZONTAL,PROMPT_LIST" Order="0060"/><Field DataSource="MT030.DTKANRYO" FieldOptions="HORIZONTAL" Order="0040"/></Function><Function DetailFunction="KF012" ID="KF010" InitialListing="T" InitialMsg="" KeyFields="" Name="買掛振替データの一覧・保守" OrderBy="" PrimaryTable="KT010" Size="AUTO" SubsystemID="K" Type="XF100"><Column DataSource="KT010.NRKAIHURI" FieldOptions="" Order="0020"/><Column DataSource="KT010.KBKAIHURI" FieldOptions="" Order="0040"/><Column DataSource="KT010.DTHURIKAE" FieldOptions="" Order="0010"/><Column DataSource="KT010.AMHURIKAE" FieldOptions="" Order="0070"/><Filter DataSource="KT010.KBKAIHURI" FieldOptions="PROMPT_LIST1" Order="0020"/><Filter DataSource="KT010.DTHURIKAE" FieldOptions="GE,CAPTION(振替日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(KF011)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Filter DataSource="AT030.CDTORIHIKISAKI" FieldOptions="PROMPT_LIST0,CAPTION(仕入先C)" Order="0030"/><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C)" Order="0050"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(仕入先名)" Order="0060"/><Column DataSource="KT010.KBZOUGEN" FieldOptions="" Order="0030"/></Function><Function FunctionAfterInsert="KF012" ID="KF011" InitialMsg="" KeyFields="" Name="買掛振替データの保守" PrimaryTable="KT010" Size="AUTO" SubsystemID="K" Type="XF200"><Field DataSource="KT010.NRKAIHURI" FieldOptions="" Order="0010"/><Field DataSource="KT010.KBKAIHURI" FieldOptions="HORIZONTAL" Order="0060"/><Field DataSource="KT010.DTHURIKAE" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="KT010.AMHURIKAE" FieldOptions="HORIZONTAL" Order="0070"/><Field DataSource="KT010.TXTEKIYO" FieldOptions="" Order="0080"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C),PROMPT_CALL(DF800),PROMPT_CALL_TO_GET(DT010.IDSIIRESAKI;AT030.CDTORIHIKISAKI;AT030.TXKANJI),PROMPT_CALL_TO_GET_TO(KT010.IDSIIRESAKI;AT030.CDTORIHIKISAKI;AT030.TXKANJI)" Order="0030"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Field DataSource="KT010.KBZOUGEN" FieldOptions="" Order="0050"/></Function><Function HeaderFunction="KF011" HeaderKeyFields="" HeaderTable="KT010" ID="KF012" Name="買掛振替と関連情報の確認" Size="AUTO" SubsystemID="K" Type="XF300"><Detail Caption="買掛増減履歴" DetailFunction="DF101" HeaderKeyFields="NRSOURCE" InitialListing="T" InitialMsg="" KeyFields="NRSOURCE;NRKAIKAKE" Order="0010" Table="DT100"><Column DataSource="DT100.NRKAIKAKE" FieldOptions="" Order="0020"/><Column DataSource="DT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="DT100.KBKAITORI" FieldOptions="" Order="0050"/><Column DataSource="DT100.KBAKADEN" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="振替情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="DT100.FGVALID" FieldOptions="" Order="0040"/><Column DataSource="DT100.AMTORIHIKI" FieldOptions="CAPTION(取引額)" Order="0070"/><Column DataSource="DT100.TXHINMEI" FieldOptions="WIDTH(200)" Order="0060"/></Detail><Field DataSource="KT010.NRKAIHURI" FieldOptions="" Order="0010"/><Field DataSource="KT010.KBKAIHURI" FieldOptions="HORIZONTAL" Order="0060"/><Field DataSource="KT010.DTHURIKAE" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="KT010.AMHURIKAE" FieldOptions="HORIZONTAL" Order="0070"/><Field DataSource="KT010.TXTEKIYO" FieldOptions="" Order="0080"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C)" Order="0030"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Field DataSource="KT010.KBZOUGEN" FieldOptions="" Order="0050"/></Function><Function DetailFunction="LF012" ID="LF010" InitialListing="T" InitialMsg="" KeyFields="" Name="売掛振替データの一覧・保守" OrderBy="" PrimaryTable="LT010" Size="AUTO" SubsystemID="L" Type="XF100"><Column DataSource="LT010.NRURIHURI" FieldOptions="" Order="0020"/><Column DataSource="LT010.KBURIHURI" FieldOptions="" Order="0040"/><Column DataSource="LT010.DTHURIKAE" FieldOptions="" Order="0010"/><Column DataSource="LT010.AMHURIKAE" FieldOptions="" Order="0080"/><Filter DataSource="LT010.KBURIHURI" FieldOptions="PROMPT_LIST1" Order="0020"/><Filter DataSource="LT010.DTHURIKAE" FieldOptions="GE,CAPTION(振替日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(LF011)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="LT010.KBZOUGEN" FieldOptions="" Order="0030"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(得意先名)" Order="0070"/><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="" Order="0050"/><Filter DataSource="AT030.CDTORIHIKISAKI" FieldOptions="PROMPT_LIST0,CAPTION(得意先C)" Order="0030"/></Function><Function FunctionAfterInsert="LF012" ID="LF011" InitialMsg="" KeyFields="" Name="売掛振替データの保守" PrimaryTable="LT010" Size="AUTO" SubsystemID="L" Type="XF200"><Field DataSource="LT010.NRURIHURI" FieldOptions="" Order="0010"/><Field DataSource="LT010.KBURIHURI" FieldOptions="HORIZONTAL" Order="0060"/><Field DataSource="LT010.DTHURIKAE" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="LT010.AMHURIKAE" FieldOptions="HORIZONTAL" Order="0070"/><Field DataSource="LT010.TXTEKIYO" FieldOptions="" Order="0080"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="LT010.KBZOUGEN" FieldOptions="" Order="0050"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先C),PROMPT_CALL(EF800),PROMPT_CALL_TO_GET(ET010.IDTOKUISAKI;AT030.CDTORIHIKISAKI;AT030.TXKANJI),PROMPT_CALL_TO_GET_TO(LT010.IDTOKUISAKI;AT030.CDTORIHIKISAKI;AT030.TXKANJI)" Order="0030"/></Function><Function HeaderFunction="LF011" HeaderKeyFields="" HeaderTable="LT010" ID="LF012" Name="売上振替別取引実績の検討" Size="AUTO" SubsystemID="L" Type="XF300"><Detail Caption="売掛増減履歴" DetailFunction="EF101" HeaderKeyFields="NRSOURCE" InitialListing="T" InitialMsg="" KeyFields="NRSOURCE;NRURIKAKE" Order="0010" Table="ET100"><Column DataSource="ET100.NRURIKAKE" FieldOptions="" Order="0020"/><Column DataSource="ET100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="ET100.KBURITORI" FieldOptions="" Order="0050"/><Column DataSource="ET100.KBAKADEN" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="振替情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="ET100.FGVALID" FieldOptions="" Order="0040"/><Column DataSource="ET100.TXHINMEI" FieldOptions="WIDTH(200)" Order="0060"/><Column DataSource="ET100.AMTORIHIKI" FieldOptions="CAPTION(取引額)" Order="0070"/></Detail><Field DataSource="LT010.NRURIHURI" FieldOptions="" Order="0010"/><Field DataSource="LT010.KBURIHURI" FieldOptions="HORIZONTAL" Order="0060"/><Field DataSource="LT010.DTHURIKAE" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="LT010.AMHURIKAE" FieldOptions="HORIZONTAL" Order="0070"/><Field DataSource="LT010.TXTEKIYO" FieldOptions="" Order="0080"/><Field DataSource="LT010.KBZOUGEN" FieldOptions="" Order="0050"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先C)" Order="0030"/></Function><Function Direction="NORMAL" ID="KF022" KeyFields="NRTOKUSIIRE" Margins="50;50;50;50" Name="返品通知書の印刷" PageSize="A4" PrimaryTable="KT020" SubsystemID="K" Type="XF290" WithPageNumber="F"><Phrase Alignment="CENTER" AlignmentMargin="" Block="HEADER" FontID="Font1" FontSize="15" FontStyle="BOLD" Order="0010" SpacingAfter="0" Value="&amp;Text(返 品 通 知 書)"/><Phrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0020" SpacingAfter="-18" Value="&amp;DataSource(AT030.TXKANJI)&amp;Text( 御中)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0040" SpacingAfter="0" Value="&amp;Image(logo.PNG;0;-3;32;0)&amp;SystemVariant(COMP_NAME)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" Order="0050" SpacingAfter="0" Value="&amp;SystemVariant(COMP_ADDRESS)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0060" SpacingAfter="10" Value="&amp;SystemVariant(COMP_TEL)&amp;Text( ㈹)"/><Phrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0070" SpacingAfter="10" Value="&amp;Text(毎度お世話になっております。以下の内容で返品させていただきます。ご確認ください。)"/><Phrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0120" SpacingAfter="0" Value="&amp;Text(　　　 　摘要 )&amp;DataSource(KT020.TXTEKIYO)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0030" SpacingAfter="0" Value="&amp;Text(　管理№ )&amp;DataSource(KT020.NRTOKUSIIRE)&amp;Text(　取引日 )&amp;DataSource(KT020.DTTORIHIKI)"/><Phrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0100" SpacingAfter="0" Value="&amp;Text(　　　 　品名 )&amp;DataSource(BT010.TXHINMEI)"/><Phrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0110" SpacingAfter="0" Value="&amp;Text(　　　返品数 )&amp;DataSource(KT020.QTTORIHIKI)&amp;Text( )&amp;DataSource(BT010.KBUNITPUR)"/><Phrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0111" SpacingAfter="0" Value="&amp;Text(　　返品単価 )&amp;DataSource(KT020.PRTORIHIKI)&amp;Text( 　　返品額 )&amp;DataSource(KT020.AMTORIHIKI)&amp;Text( 　　税額 )&amp;DataSource(KT020.AMTAX)"/></Function><Function DetailFunction="LF023" ID="LF020" InitialListing="T" InitialMsg="" KeyFields="" Name="特殊売上データの一覧・保守" OrderBy="" PrimaryTable="LT020" Size="AUTO" SubsystemID="L" Type="XF100"><Column DataSource="LT020.NRTOKUURI" FieldOptions="" Order="0020"/><Column DataSource="LT020.KBTOKUURI" FieldOptions="" Order="0030"/><Column DataSource="LT020.DTTORIHIKI" FieldOptions="" Order="0010"/><Filter DataSource="LT020.KBTOKUURI" FieldOptions="PROMPT_LIST1" Order="0020"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(LF021)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Filter DataSource="LT020.DTTORIHIKI" FieldOptions="GE,CAPTION(取引日≧),VALUE(SESSION_ATTRIBUTE:DateLastMonth)" Order="0010"/><Filter DataSource="AT030.CDTORIHIKISAKI" FieldOptions="" Order="0030"/><Column DataSource="LT020.QTTORIHIKI" FieldOptions="" Order="0090"/><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先Ｃ)" Order="0040"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(得意先名),WIDTH(200)" Order="0050"/><Column DataSource="BT010.TXHINBAN" FieldOptions="" Order="0060"/><Column DataSource="BT010.TXHINMEI" FieldOptions="WIDTH(200)" Order="0070"/><Column DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0100"/><Column DataSource="LT020.PRTORIHIKI" FieldOptions="" Order="0080"/></Function><Function FunctionAfterInsert="LF023" ID="LF021" InitialMsg="" KeyFields="" Name="特殊売上データの保守" PrimaryTable="LT020" Size="AUTO" SubsystemID="L" Type="XF200"><Field DataSource="LT020.NRTOKUURI" FieldOptions="" Order="0010"/><Field DataSource="LT020.KBTOKUURI" FieldOptions="" Order="0070"/><Field DataSource="LT020.DTTORIHIKI" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="LT020.PRTORIHIKI" FieldOptions="" Order="0100"/><Field DataSource="LT020.QTTORIHIKI" FieldOptions="HORIZONTAL" Order="0110"/><Field DataSource="LT020.PRZAIKO" FieldOptions="" Order="0150"/><Field DataSource="LT020.TXTEKIYO" FieldOptions="" Order="0180"/><Field DataSource="LT020.AMTORIHIKI" FieldOptions="" Order="0130"/><Field DataSource="LT020.AMTAX" FieldOptions="HORIZONTAL" Order="0140"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="PROMPT_CALL(EF800),PROMPT_CALL_TO_GET(ET010.IDTOKUISAKI;AT030.CDTORIHIKISAKI;AT030.TXKANJI),PROMPT_CALL_TO_GET_TO(LT020.IDTOKUISAKI;AT030.CDTORIHIKISAKI;AT030.TXKANJI)" Order="0030"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Field DataSource="BT010.TXHINBAN" FieldOptions="PROMPT_CALL(BF120),PROMPT_CALL_TO_GET(BT010.IDHINMOKU;BT010.TXHINBAN;BT010.TXHINMEI;BT010.KBUNIT),PROMPT_CALL_TO_GET_TO(LT020.IDHINMOKU;BT010.TXHINBAN;BT010.TXHINMEI;BT010.KBUNIT)" Order="0050"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0060"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0120"/><Field DataSource="AT040.TXSOUKO" FieldOptions="HORIZONTAL,PROMPT_LIST" Order="0080"/><Field DataSource="ET011.TXKANJI" FieldOptions="CAPTION(出荷先),PROMPT_LIST" Order="0090"/><Field DataSource="LT020.QTZAIKO" FieldOptions="HORIZONTAL" Order="0160"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0170"/></Function><Function Direction="NORMAL" ID="LF022" KeyFields="" Margins="50;50;50;50" Name="直出荷納品書の印刷" PageSize="A4" PrimaryTable="LT020" SubsystemID="L" Type="XF290" WithPageNumber="F"><Phrase Alignment="CENTER" AlignmentMargin="" Block="HEADER" FontID="Font1" FontSize="15" FontStyle="BOLD" Order="0010" SpacingAfter="0" Value="&amp;Text(納 品 書（ 直 出 荷 分 ）)"/><Phrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0020" SpacingAfter="-18" Value="&amp;DataSource(AT030.TXKANJI)&amp;Text( 御中)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0040" SpacingAfter="0" Value="&amp;Image(logo.PNG;0;-3;32;0)&amp;SystemVariant(COMP_NAME)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" Order="0050" SpacingAfter="0" Value="&amp;SystemVariant(COMP_ADDRESS)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" Order="0060" SpacingAfter="0" Value="&amp;SystemVariant(COMP_TEL)&amp;Text( ㈹)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0070" SpacingAfter="10" Value="&amp;Text(営業担当 )&amp;DataSource(AT020.TXKANJI)"/><Phrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" Order="0080" SpacingAfter="10" Value="&amp;Text(毎度お世話になっております。以下の製品を納品させていただきます。ご確認ください。)"/><Phrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0110" SpacingAfter="0" Value="&amp;Text(　ご注文品　)&amp;DataSource(BT010.TXHINBAN)&amp;Text(　)&amp;DataSource(BT010.TXHINMEI)&amp;Text(　　納品数　)&amp;DataSource(LT020.QTTORIHIKI;a1)"/><Phrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0130" SpacingAfter="0" Value="&amp;Text(　　　摘要　)&amp;DataSource(LT020.TXTEKIYO)"/><Phrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0090" SpacingAfter="0" Value="&amp;Text(　　納品先　)&amp;DataSource(ET011.TXKANJI)"/><Phrase Alignment="LEFT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" Order="0100" SpacingAfter="0" Value="&amp;Text(　　　　　　)&amp;DataSource(ET011.NRYUBIN)&amp;Text(　)&amp;DataSource(ET011.TXJYUSYO1)&amp;Text(　)&amp;DataSource(ET011.TXJYUSYO2)"/><Phrase Alignment="RIGHT" AlignmentMargin="" Block="PARAGRAPH" FontID="Font1" FontSize="12" FontStyle="" MarginLeft="0" MarginRight="0" Order="0030" SpacingAfter="0" Value="&amp;Text(管理番号　)&amp;DataSource(LT020.NRTOKUURI)"/></Function><Function HeaderFunction="LF021" HeaderKeyFields="" HeaderTable="LT020" ID="LF023" Name="特殊売上別取引実績の検討" Size="AUTO" SubsystemID="L" Type="XF300"><Detail Caption="売掛増減履歴" DetailFunction="NONE" HeaderKeyFields="NRSOURCE" InitialListing="T" InitialMsg="" KeyFields="NRSOURCE;NRURIKAKE" Order="0010" Table="ET100"><Column DataSource="ET100.NRURIKAKE" FieldOptions="" Order="0020"/><Column DataSource="ET100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="ET100.KBURITORI" FieldOptions="" Order="0050"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="売上情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Button Action="CALL(LF022)" Caption="納品書" Number="10" Position="5"/><Column DataSource="ET100.KBAKADEN" FieldOptions="" Order="0030"/><Column DataSource="ET100.FGVALID" FieldOptions="" Order="0040"/><Column DataSource="ET100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0100"/><Column DataSource="ET100.PRTORIHIKI" FieldOptions="" Order="0080"/><Column DataSource="ET100.QTTORIHIKI" FieldOptions="" Order="0090"/><Column DataSource="ET100.AMTORIHIKI" FieldOptions="" Order="0110"/><Column DataSource="ET100.AMTAX" FieldOptions="" Order="0120"/><Column DataSource="ET100.AMGENKA" FieldOptions="" Order="0130"/><Column DataSource="ET100.NRSEIKYU" FieldOptions="" Order="0140"/></Detail><Detail Caption="在庫増減履歴" DetailFunction="NONE" HeaderKeyFields="NRSOURCE" InitialListing="T" InitialMsg="" KeyFields="NRSOURCE;NRZAITORI" Order="0020" Table="FT100"><Column DataSource="FT100.NRZAITORI" FieldOptions="" Order="0020"/><Column DataSource="FT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="FT100.KBUKEBARAI" FieldOptions="" Order="0050"/><Column DataSource="FT100.KBAKADEN" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="売上情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Button Action="CALL(LF022)" Caption="納品書" Number="10" Position="5"/><Column DataSource="FT100.FGVALID" FieldOptions="" Order="0040"/><Column DataSource="FT100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0080"/><Column DataSource="FT100.PRTORIHIKI" FieldOptions="" Order="0060"/><Column DataSource="FT100.QTTORIHIKI" FieldOptions="" Order="0070"/><Column DataSource="FT100.AMTORIHIKI" FieldOptions="" Order="0090"/></Detail><Field DataSource="LT020.NRTOKUURI" FieldOptions="" Order="0010"/><Field DataSource="LT020.KBTOKUURI" FieldOptions="" Order="0070"/><Field DataSource="LT020.DTTORIHIKI" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="LT020.PRTORIHIKI" FieldOptions="" Order="0100"/><Field DataSource="LT020.QTTORIHIKI" FieldOptions="HORIZONTAL" Order="0110"/><Field DataSource="LT020.PRZAIKO" FieldOptions="" Order="0150"/><Field DataSource="LT020.TXTEKIYO" FieldOptions="" Order="0180"/><Field DataSource="LT020.AMTORIHIKI" FieldOptions="" Order="0130"/><Field DataSource="LT020.AMTAX" FieldOptions="HORIZONTAL" Order="0140"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="" Order="0030"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Field DataSource="BT010.TXHINBAN" FieldOptions="" Order="0050"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0060"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0120"/><Field DataSource="AT040.TXSOUKO" FieldOptions="HORIZONTAL" Order="0080"/><Field DataSource="ET011.TXKANJI" FieldOptions="CAPTION(出荷先)" Order="0090"/><Field DataSource="LT020.QTZAIKO" FieldOptions="HORIZONTAL" Order="0160"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0170"/></Function><Function ID="ZF900" Name="パージ処理の起動" Script="////////////////#EOL#// 変数の定義 //#EOL#////////////////#EOL#var hasError = true; var workCount = 0; var totalCount = 0;#EOL##EOL#////////////////////#EOL#// ダイアログ定義 //#EOL#////////////////////#EOL#var dialog = session.getInputDialog();#EOL#dialog.setMessage('＊チェックされた対象について、上の日付を含めそれ以前の取引日を持つデータをクリアします。処理件数の詳細については、セッション履歴で確認してください。実行前にＤＢをバックアップすることをお勧めします。');#EOL#dialog.setMessageHeight(140);#EOL#var limitDate = dialog.addField('パージ基準日付', 'ALPHA');#EOL#limitDate.value = '0000/00/00';#EOL#var fgTransactionData = dialog.addField('トランザクションデータ', 'CHECKBOX');#EOL#fgTransactionData.setValue(false);#EOL#var fgSessionData = dialog.addField('セッション履歴データ', 'CHECKBOX');#EOL#fgSessionData.setValue(false);#EOL##EOL#////////////////////////////////////////////#EOL#// ダイアログ表示と条件にもとづく後続処理 //#EOL#////////////////////////////////////////////#EOL#var reply = dialog.request('パージ処理の条件設定');#EOL#if (reply == 0) {#EOL##EOL#&#x9;////////////////////////#EOL#&#x9;// 日付値の妥当性検査 //#EOL#&#x9;////////////////////////#EOL#&#x9;var date = limitDate.value + '';#EOL#&#x9;if (date.length == 10) {#EOL#&#x9;&#x9;var year = date.substr(0, 4);#EOL#&#x9;&#x9;var month = date.substr(5, 2);#EOL#&#x9;&#x9;var day = date.substr(8, 2);#EOL#&#x9;&#x9;date = new Date(year, month-1, day);#EOL#&#x9;&#x9;if (date.getFullYear()==year &amp;&amp; date.getMonth()==month-1 &amp;&amp; date.getDate()==day) {#EOL#&#x9;&#x9;&#x9;hasError = false;#EOL##EOL#&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;// パラメータのセット //#EOL#&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('LIMIT_DATE', year + '-' + month + '-' + day);#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#&#x9;if (hasError) {#EOL#&#x9;&#x9;instance.returnMap.put('RETURN_MESSAGE', '基準日付('+ limitDate.value + ')が正しくありません。処理はキャンセルされました。');#EOL#&#x9;&#x9;instance.returnMap.put('RETURN_CODE', '99');#EOL#&#x9;} else {#EOL##EOL#&#x9;&#x9;////////////////////////////////////#EOL#&#x9;&#x9;// トランザクションデータのパージ //#EOL#&#x9;&#x9;////////////////////////////////////#EOL#&#x9;&#x9;if (fgTransactionData.value == true) {#EOL#&#x9;&#x9;&#x9;purgeTransactionData();#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// セッションデータのパージ //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;if (fgSessionData.value == true) {#EOL#&#x9;&#x9;&#x9;purgeSessionData();#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;//////////////#EOL#&#x9;&#x9;// 終了処理 //#EOL#&#x9;&#x9;//////////////#EOL#&#x9;&#x9;if (fgTransactionData.value == true || fgSessionData.value == true) {#EOL#&#x9;&#x9;&#x9;finalization();#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#} else {#EOL#&#x9;instance.returnMap.put('RETURN_MESSAGE', '＊処理は取り消されました。');#EOL#}#EOL##EOL#//////////////////////////#EOL#// 取引実績のパージ処理 //#EOL#//////////////////////////#EOL#function purgeTransactionData() {#EOL##EOL#&#x9;if (!hasError) {#EOL#&#x9;&#x9;instance.callFunction('DF990'); // 支払指示･依頼パージ処理 //#EOL#&#x9;&#x9;summarizeCountOfDeleted('DT110');#EOL#&#x9;}#EOL##EOL#&#x9;if (!hasError) {#EOL#&#x9;&#x9;instance.callFunction('EF990'); // 請求･受領パージ処理 //#EOL#&#x9;&#x9;summarizeCountOfDeleted('ET110');#EOL#&#x9;&#x9;summarizeCountOfDeleted('ET120');#EOL#&#x9;}#EOL##EOL#&#x9;if (!hasError) {#EOL#&#x9;&#x9;instance.callFunction('HF990'); // 発注･入荷パージ処理 //#EOL#&#x9;&#x9;summarizeCountOfDeleted('HT010');#EOL#&#x9;&#x9;summarizeCountOfDeleted('HT011');#EOL#&#x9;&#x9;summarizeCountOfDeleted('HT020');#EOL#&#x9;}#EOL##EOL#&#x9;if (!hasError) {#EOL#&#x9;&#x9;instance.callFunction('JF990'); // 製造指示パージ処理 //#EOL#&#x9;&#x9;summarizeCountOfDeleted('JT010');#EOL#&#x9;&#x9;summarizeCountOfDeleted('JT020');#EOL#&#x9;&#x9;summarizeCountOfDeleted('JT030');#EOL#&#x9;&#x9;summarizeCountOfDeleted('JT040');#EOL#&#x9;}#EOL##EOL#&#x9;if (!hasError) {#EOL#&#x9;&#x9;instance.callFunction('KF990'); // 一般仕入取引パージ処理 //#EOL#&#x9;&#x9;summarizeCountOfDeleted('KT010');#EOL#&#x9;&#x9;summarizeCountOfDeleted('KT020');#EOL#&#x9;}#EOL##EOL#&#x9;if (!hasError) {#EOL#&#x9;&#x9;instance.callFunction('LF990'); // 一般売上取引パージ処理 //#EOL#&#x9;&#x9;summarizeCountOfDeleted('LT010');#EOL#&#x9;&#x9;summarizeCountOfDeleted('LT020');#EOL#&#x9;}#EOL##EOL#&#x9;if (!hasError) {#EOL#&#x9;&#x9;instance.callFunction('MF990'); // 一般在庫取引パージ処理 //#EOL#&#x9;&#x9;summarizeCountOfDeleted('MT010');#EOL#&#x9;&#x9;summarizeCountOfDeleted('MT020');#EOL#&#x9;&#x9;summarizeCountOfDeleted('MT021');#EOL#&#x9;&#x9;summarizeCountOfDeleted('MT030');#EOL#&#x9;&#x9;summarizeCountOfDeleted('MT031');#EOL#&#x9;}#EOL##EOL#&#x9;if (!hasError) {#EOL#&#x9;&#x9;instance.callFunction('DF999'); // 買掛増減履歴パージ処理 //#EOL#&#x9;&#x9;summarizeCountOfDeleted('DT100');#EOL#&#x9;}#EOL##EOL#&#x9;if (!hasError) {#EOL#&#x9;&#x9;instance.callFunction('EF999'); // 売掛増減履歴パージ処理 //#EOL#&#x9;&#x9;summarizeCountOfDeleted('ET100');#EOL#&#x9;}#EOL##EOL#&#x9;if (!hasError) {#EOL#&#x9;&#x9;instance.callFunction('FF999'); // 在庫増減履歴パージ処理 //#EOL#&#x9;&#x9;summarizeCountOfDeleted('FT100');#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////////////////#EOL#// セッション履歴のパージ処理 //#EOL#////////////////////////////////#EOL#function purgeSessionData() {#EOL#&#x9;if (!hasError) {#EOL#&#x9;&#x9;instance.callFunction('ZF910'); // セッション履歴パージ処理 //#EOL#&#x9;&#x9;summarizeCountOfDeleted('ZT050');#EOL#&#x9;&#x9;summarizeCountOfDeleted('ZT051');#EOL#&#x9;}#EOL#}#EOL##EOL#//////////////#EOL#// 終了処理 //#EOL#//////////////#EOL#function finalization() {#EOL##EOL#&#x9;if (hasError) {#EOL#&#x9;&#x9;instance.rollback();#EOL#&#x9;&#x9;instance.cancelWithMessage('＊パージ処理に失敗しました。');#EOL#&#x9;} else {#EOL#&#x9;&#x9;if (fgTransactionData.value == true) {#EOL#&#x9;&#x9;&#x9;session.compressTable('DT110');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('DT110 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('ET110');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('ET110 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('ET120');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('ET120 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('HT010');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('HT010 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('HT011');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('HT011 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('HT020');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('HT020 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('JT010');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('JT010 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('JT020');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('JT020 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('JT030');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('JT030 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('JT030W');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('JT030W compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('JT040');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('JT040 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('KT010');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('KT010 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('KT020');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('KT020 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('LT010');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('LT010 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('LT020');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('LT020 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('MT010');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('MT010 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('MT020');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('MT020 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('MT021');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('MT021 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('MT030');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('MT030 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('MT031');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('MT031 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('DT100');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('DT100 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('ET100');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('ET100 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('FT100');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('FT100 compressed.');#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;if (fgSessionData.value == true) {#EOL#&#x9;&#x9;&#x9;session.compressTable('ZT050');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('ZT050 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('ZT051');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('ZT051 compressed.');#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;instance.commit();#EOL#&#x9;&#x9;instance.setProcessLog('削除／コンプレス処理がコミットされました。');#EOL#&#x9;&#x9;var message = '＊パージ処理が完了しました。合計' + totalCount + 'レコードが削除されました。';#EOL#&#x9;&#x9;instance.returnMap.put('RETURN_MESSAGE', message);#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////////////////////////#EOL#// 内部関数：テーブル別削除件数の処理 //#EOL#////////////////////////////////////////#EOL#function summarizeCountOfDeleted(tableID) {#EOL#&#x9;workCount = parseInt(instance.returnMap.get(tableID + '_COUNT'));#EOL#&#x9;if (workCount == -1) {#EOL#&#x9;&#x9;hasError = true;#EOL#&#x9;} else {#EOL#&#x9;&#x9;instance.setProcessLog(tableID + 'の' + workCount + '件が削除されました');#EOL#&#x9;&#x9;totalCount = totalCount + workCount;#EOL#&#x9;}#EOL#}" SubsystemID="Z" TimerOption="CONSOLE" Type="XF000"/><Function ID="ZF910" Name="セッション履歴パージ処理" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rZT050; var dZT050; var dZT051;#EOL#var limitDate = instance.parmMap.get('LIMIT_DATE');#EOL#var countZT050_Deleted = 0; var countZT050_ToBeDeleted = 0; var countZT051_Deleted = 0;#EOL#var count = 0;#EOL##EOL#//////////////////////////#EOL#// 削除結果省略値の登録 //#EOL#//////////////////////////#EOL#instance.returnMap.put('ZT050_COUNT', -1);#EOL#instance.returnMap.put('ZT051_COUNT', -1);#EOL##EOL#/////////////////////////////////////////////#EOL#// セッション(ZT050)削除対象レコードの検索 //#EOL#/////////////////////////////////////////////#EOL#rZT050 = instance.createTableOperator('Select', 'ZT050');#EOL#rZT050.setSelectFields('NRSESSION');#EOL#rZT050.addKeyValue('DTLOGOUT &lt;=',&#x9;limitDate + ' 23:59:59.999');#EOL#while (rZT050.next()) {#EOL#&#x9;countZT050_ToBeDeleted++;#EOL##EOL#&#x9;/////////////////////////////////#EOL#&#x9;// セッション明細(ZT051)の削除 //#EOL#&#x9;/////////////////////////////////#EOL#&#x9;dZT051 = instance.createTableOperator('Delete', 'ZT051');#EOL#&#x9;dZT051.addKeyValue('NRSESSION',&#x9;rZT050.getValueOf('NRSESSION'));#EOL#&#x9;count = dZT051.execute();#EOL#&#x9;countZT051_Deleted = Number(countZT051_Deleted) + Number(count);#EOL##EOL#&#x9;/////////////////////////////#EOL#&#x9;// セッション(ZT050)の削除 //#EOL#&#x9;/////////////////////////////#EOL#&#x9;dZT050 = instance.createTableOperator('Delete', 'ZT050');#EOL#&#x9;dZT050.addKeyValue('NRSESSION',&#x9;rZT050.getValueOf('NRSESSION'));#EOL#&#x9;count = dZT050.execute();#EOL#&#x9;if (count == 1) {#EOL#&#x9;&#x9;countZT050_Deleted++;#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////#EOL#// 削除結果の登録 //#EOL#////////////////////#EOL#if (countZT050_Deleted == countZT050_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('ZT050_COUNT', countZT050_Deleted);#EOL#&#x9;instance.returnMap.put('ZT051_COUNT', countZT051_Deleted);#EOL#}#EOL#" SubsystemID="Z" Type="XF000"/><Function ID="ZF400" Name="年次繰越処理の起動" Script="////////////////////#EOL#// ダイアログ定義 //#EOL#////////////////////#EOL#var dialog = session.getInputDialog();#EOL#dialog.setMessageHeight(150);#EOL#var wrkStr = session.getSystemVariantString('ALLOWED_FISCAL_MONTH') + '';#EOL#var curNend = wrkStr.substring(0, 4);#EOL#var newNend = Number(curNend) + Number(1) + '';#EOL#dialog.setMessage('＊新年度の期首残高（在庫・売掛・買掛）が残高増減履歴にもとづいて計算され、更新されます。実行前にバックアップを取っておくことをお奨めします。処理後は旧年度(' + curNend + ')の会計データを変更できなくなります。');#EOL##EOL#////////////////////////////////////////////#EOL#// ダイアログ表示と条件にもとづく後続処理 //#EOL#////////////////////////////////////////////#EOL#var reply = dialog.request('年次繰越処理');#EOL#if (reply == 0) {#EOL##EOL#&#x9;////////////////////#EOL#&#x9;// 実行条件の設定 //#EOL#&#x9;////////////////////#EOL#&#x9;instance.parmMap.put('CUR_NEND', curNend);#EOL#&#x9;instance.parmMap.put('NEW_NEND', newNend);#EOL#&#x9;instance.parmMap.put('CHECK_ONLY', 'false'); //検査結果にもとづく繰越高の更新を実施する//#EOL##EOL#&#x9;////////////////////////#EOL#&#x9;// 残高繰越処理の実行 //#EOL#&#x9;////////////////////////#EOL#&#x9;instance.callFunction('DF900'); //買掛繰越//#EOL#&#x9;instance.callFunction('EF900'); //売掛繰越//#EOL#&#x9;instance.callFunction('FF900'); //在庫繰越//#EOL##EOL#&#x9;////////////////////////////////////////#EOL#&#x9;// 集計値の差異がなければ年度値を更新 //#EOL#&#x9;////////////////////////////////////////#EOL#&#x9;var numberOfErrorsDF900 =instance.parmMap.get('NUMBER_OF_ERRORS_DF900');#EOL#&#x9;var numberOfErrorsEF900 =instance.parmMap.get('NUMBER_OF_ERRORS_EF900');#EOL#&#x9;var numberOfErrorsFF900 =instance.parmMap.get('NUMBER_OF_ERRORS_FF900');#EOL#&#x9;if (numberOfErrorsDF900 == 0 &amp;&amp; numberOfErrorsEF900 == 0 &amp;&amp; numberOfErrorsFF900 == 0) {#EOL##EOL#&#x9;&#x9;//////////////////////#EOL#&#x9;&#x9;// アプリ年度の更新 //#EOL#&#x9;&#x9;//////////////////////#EOL#&#x9;&#x9;var uZT010 = instance.createTableOperator('Update', 'ZT010');#EOL#&#x9;&#x9;uZT010.addValue('TXVALUE',&#x9;newNend + '01');#EOL#&#x9;&#x9;uZT010.addKeyValue('IDVARIANT',&#x9;'ALLOWED_FISCAL_MONTH');#EOL#&#x9;&#x9;var count = uZT010.execute();#EOL#&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;instance.commit();#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;var message = 'システム変数(ZT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;instance.returnMap.put('RETURN_MESSAGE', message);#EOL#&#x9;&#x9;&#x9;instance.returnMap.put('RETURN_CODE', '99'); //abend to rollback//#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;} else {#EOL##EOL#&#x9;&#x9;////////////////////////////////////////////////#EOL#&#x9;&#x9;// 集計値の差異に関するエラーメッセージの設定 //#EOL#&#x9;&#x9;////////////////////////////////////////////////#EOL#&#x9;&#x9;var wrkStr = '';#EOL#&#x9;&#x9;if (numberOfErrorsDF900 > 0) {#EOL#&#x9;&#x9;&#x9;wrkStr = '買掛';#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;if (numberOfErrorsEF900 > 0) {#EOL#&#x9;&#x9;&#x9;if (wrkStr == '') {#EOL#&#x9;&#x9;&#x9;&#x9;wrkStr = '売掛';#EOL#&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;wrkStr = wrkStr + 'と売掛';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;if (numberOfErrorsFF900 > 0) {#EOL#&#x9;&#x9;&#x9;if (wrkStr == '') {#EOL#&#x9;&#x9;&#x9;&#x9;wrkStr = '在庫';#EOL#&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;wrkStr = wrkStr + 'と在庫';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;var numberOfErrors = Number(numberOfErrorsDF900) + Number(numberOfErrorsEF900) + Number(numberOfErrorsFF900);#EOL#&#x9;&#x9;var message = '＊' + wrkStr + 'に関して、' + numberOfErrors + '件の残高増減値の差異が見つかったため、処理は取り消されました。差異の詳細についてはセッションログを確認してください。';#EOL#&#x9;&#x9;instance.returnMap.put('RETURN_MESSAGE', message);#EOL#&#x9;&#x9;instance.returnMap.put('RETURN_CODE', '99'); //abend to rollback//#EOL#&#x9;}#EOL#} else {#EOL#&#x9;instance.returnMap.put('RETURN_MESSAGE', '処理は取り消されました。');#EOL#&#x9;instance.returnMap.put('RETURN_CODE', '01');#EOL#}#EOL#" SubsystemID="Z" TimerOption="CONSOLE" Type="XF000"/><Function ID="DF999" Name="買掛増減履歴パージ処理" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var limitDate = instance.parmMap.get('LIMIT_DATE');#EOL#var countToBeDeleted = 0; var countDeleted = 0; var isToBeDeleted = false;#EOL##EOL#//////////////////////////#EOL#// 削除結果の省略値登録 //#EOL#//////////////////////////#EOL#instance.returnMap.put('DT100_COUNT', -1);#EOL##EOL#//////////////////////////#EOL#// DT100 削除対象の検索 //#EOL#//////////////////////////#EOL#var rDT100 = instance.createTableOperator('Select', 'DT100');#EOL#rDT100.setSelectFields('NRKAIKAKE, KBKAITORI, NRSOURCE');#EOL#rDT100.addKeyValue('DTTORIHIKI &lt;=',&#x9;'\'' + limitDate + '\'');#EOL#while (rDT100.next()) {#EOL##EOL#&#x9;//////////////////////////////#EOL#&#x9;// 削除対象フラグのリセット //#EOL#&#x9;//////////////////////////////#EOL#&#x9;isToBeDeleted = false;#EOL##EOL#&#x9;/////////////////////////////////#EOL#&#x9;// 00(入荷仕入) HT011 入荷明細 //#EOL#&#x9;/////////////////////////////////#EOL#&#x9;if (rDT100.getValueOf('KBKAITORI') == '00') {#EOL#&#x9;&#x9;var rHT011 = instance.createTableOperator('Count', 'HT011');#EOL#&#x9;&#x9;rHT011.addKeyValue('NRSOURCE',&#x9;rDT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rHT011.execute() == 0) {#EOL#&#x9;&#x9;&#x9;isToBeDeleted = true;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////////////////////#EOL#&#x9;// 01(直入荷仕入),02(仕入返品) KT020 特殊仕入 //#EOL#&#x9;////////////////////////////////////////////////#EOL#&#x9;if (rDT100.getValueOf('KBKAITORI') == '01' || rDT100.getValueOf('KBKAITORI') == '02') {#EOL#&#x9;&#x9;var rKT020 = instance.createTableOperator('Count', 'KT020');#EOL#&#x9;&#x9;rKT020.addKeyValue('NRSOURCE',&#x9;rDT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rKT020.execute() == 0) {#EOL#&#x9;&#x9;&#x9;isToBeDeleted = true;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;//////////////////////////////////////////////#EOL#&#x9;// 10(振替控除),11(振替計上) KT010 買掛振替 //#EOL#&#x9;//////////////////////////////////////////////#EOL#&#x9;if (rDT100.getValueOf('KBKAITORI') == '10' || rDT100.getValueOf('KBKAITORI') == '11') {#EOL#&#x9;&#x9;var rKT010 = instance.createTableOperator('Count', 'KT010');#EOL#&#x9;&#x9;rKT010.addKeyValue('NRSOURCE',&#x9;rDT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rKT010.execute() == 0) {#EOL#&#x9;&#x9;&#x9;isToBeDeleted = true;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;/////////////////////////////#EOL#&#x9;// 90(支払) DT110 支払依頼 //#EOL#&#x9;/////////////////////////////#EOL#&#x9;if (rDT100.getValueOf('KBKAITORI') == '90') {#EOL#&#x9;&#x9;var rDT110 = instance.createTableOperator('Count', 'DT110');#EOL#&#x9;&#x9;rDT110.addKeyValue('NRSOURCE',&#x9;rDT100.getValueOf('NRSOURCE'));#EOL#&#x9;&#x9;if (rDT110.execute() == 0) {#EOL#&#x9;&#x9;&#x9;isToBeDeleted = true;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;//////////////#EOL#&#x9;// 削除処理 //#EOL#&#x9;//////////////#EOL#&#x9;if (isToBeDeleted) {#EOL#&#x9;&#x9;countToBeDeleted++;#EOL#&#x9;&#x9;var dDT100 = instance.createTableOperator('Delete', 'DT100');#EOL#&#x9;&#x9;dDT100.addKeyValue('NRKAIKAKE',&#x9;rDT100.getValueOf('NRKAIKAKE'));#EOL#&#x9;&#x9;if (dDT100.execute() == 1) {#EOL#&#x9;&#x9;&#x9;countDeleted++;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////#EOL#// 削除結果の登録 //#EOL#////////////////////#EOL#if (countToBeDeleted == countDeleted) {#EOL#&#x9;instance.returnMap.put('DT100_COUNT', countToBeDeleted);#EOL#}" SubsystemID="D" Type="XF000"/><Function ID="ZF410" Name="残高増減値一致検査の起動" Script="////////////////////#EOL#// ダイアログ定義 //#EOL#////////////////////#EOL#var dialog = session.getInputDialog();#EOL#dialog.setMessageHeight(130);#EOL#dialog.setMessage('＊在庫・売掛・買掛テーブル上の残高増減値と、残高増減履歴テーブルの内容にもとづく増減合計値とが比較されます。差異があれば、セッションログに書き出されます。');#EOL##EOL#////////////////////////////////////////////#EOL#// ダイアログ表示と条件にもとづく後続処理 //#EOL#////////////////////////////////////////////#EOL#var reply = dialog.request('残高増減値一致検査');#EOL#if (reply == 0) {#EOL##EOL#&#x9;////////////////////#EOL#&#x9;// 実行条件の設定 //#EOL#&#x9;////////////////////#EOL#&#x9;var wrkStr = session.getSystemVariantString('ALLOWED_FISCAL_MONTH') + '';#EOL#&#x9;var curNend = wrkStr.substring(0, 4);#EOL#&#x9;var newNend = Number(curNend.value) + Number(1) + '';#EOL#&#x9;instance.parmMap.put('CUR_NEND', curNend);#EOL#&#x9;instance.parmMap.put('NEW_NEND', newNend);#EOL#&#x9;instance.parmMap.put('CHECK_ONLY', 'true'); //検査のみを実施する//#EOL##EOL#&#x9;//////////////////////////#EOL#&#x9;// 集計値計算処理の実行 //#EOL#&#x9;//////////////////////////#EOL#&#x9;instance.callFunction('DF900'); //買掛繰越//#EOL#&#x9;instance.callFunction('EF900'); //売掛繰越//#EOL#&#x9;instance.callFunction('FF900'); //在庫繰越//#EOL##EOL#&#x9;////////////////////#EOL#&#x9;// 診断結果の表示 //#EOL#&#x9;////////////////////#EOL#&#x9;var numberOfErrorsDF900 =instance.parmMap.get('NUMBER_OF_ERRORS_DF900');#EOL#&#x9;var numberOfErrorsEF900 =instance.parmMap.get('NUMBER_OF_ERRORS_EF900');#EOL#&#x9;var numberOfErrorsFF900 =instance.parmMap.get('NUMBER_OF_ERRORS_FF900');#EOL#&#x9;if (numberOfErrorsDF900 == 0 &amp;&amp; numberOfErrorsEF900 == 0 &amp;&amp; numberOfErrorsFF900 == 0) {#EOL#&#x9;&#x9;instance.returnMap.put('RETURN_MESSAGE', '＊残高増減値の差異は見つかりませんでした。');#EOL#&#x9;} else {#EOL#&#x9;&#x9;wrkStr = '';#EOL#&#x9;&#x9;if (numberOfErrorsDF900 > 0) {#EOL#&#x9;&#x9;&#x9;wrkStr = '買掛';#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;if (numberOfErrorsEF900 > 0) {#EOL#&#x9;&#x9;&#x9;if (wrkStr == '') {#EOL#&#x9;&#x9;&#x9;&#x9;wrkStr = '売掛';#EOL#&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;wrkStr = wrkStr + 'と売掛';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;if (numberOfErrorsFF900 > 0) {#EOL#&#x9;&#x9;&#x9;if (wrkStr == '') {#EOL#&#x9;&#x9;&#x9;&#x9;wrkStr = '在庫';#EOL#&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;wrkStr = wrkStr + 'と在庫';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;var numberOfErrors = Number(numberOfErrorsDF900) + Number(numberOfErrorsEF900) + Number(numberOfErrorsFF900);#EOL#&#x9;&#x9;var errorMessage = '＊' + wrkStr + 'に関して、' + numberOfErrors + '件の残高増減値の差異が見つかりました。差異の詳細についてはセッションログを確認してください。';#EOL#&#x9;&#x9;instance.returnMap.put('RETURN_MESSAGE', errorMessage);#EOL#&#x9;}#EOL#} else {#EOL#&#x9;instance.returnMap.put('RETURN_MESSAGE', '処理は取り消されました。');#EOL#&#x9;instance.returnMap.put('RETURN_CODE', '01');#EOL#}#EOL#" SubsystemID="Z" TimerOption="CONSOLE" Type="XF000"/><Function DetailFunction="YF020" ID="YF010" InitialListing="T" InitialMsg="" KeyFields="" Name="年次取引サマリの一覧" OrderBy="" PrimaryTable="YT010" Size="AUTO" SubsystemID="Y" Type="XF100"><Column DataSource="YT010.DTNEND" FieldOptions="" Order="0010"/><Column DataSource="YT010.AMKIKANURI" FieldOptions="" Order="0020"/><Column DataSource="YT010.AMKIKANJYU" FieldOptions="" Order="0030"/><Filter DataSource="YT010.DTNEND" FieldOptions="GE,CAPTION(年度≧),IGNORE_IF_ZERO" Order="0000"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="YT010.AMKIKANSIHA" FieldOptions="" Order="0070"/><Column DataSource="YT010.AMKIKANNYUKO" FieldOptions="" Order="0090"/><Column DataSource="YT010.AMKIKANSYUKKO" FieldOptions="" Order="0100"/><Column DataSource="YT010.AMURIKAKE" FieldOptions="" Order="0040"/><Column DataSource="YT010.AMKAIKAKE" FieldOptions="" Order="0080"/><Column DataSource="YT010.AMZAIKO" FieldOptions="" Order="0110"/><Column DataSource="YT010.AMKIKANKAI" FieldOptions="" Order="0060"/><Column DataSource="YT010.AMKIKANARARI" FieldOptions="" Order="0050"/><Column DataSource="YT010.AMKIKANSEI" FieldOptions="" Order="0120"/></Function><Function HeaderFunction="" HeaderKeyFields="" HeaderTable="YT010" ID="YF020" Name="年次取引サマリの検討" Size="AUTO" SubsystemID="Y" Type="XF300"><Field DataSource="YT010.DTNEND" FieldOptions="" Order="0010"/><Field DataSource="YT010.AMKIKANURI" FieldOptions="" Order="0020"/><Field DataSource="YT010.AMKIKANJYU" FieldOptions="HORIZONTAL" Order="0030"/><Detail Caption="月次売掛サマリ" DetailFunction="YF100" HeaderKeyFields="" InitialListing="T" InitialMsg="" KeyFields="DTNEND;DTMSEQ" Order="0010" Table="YT020"><Column DataSource="YT020.DTMSEQ" FieldOptions="" Order="0010"/><Column DataSource="YT020.AMKIKANURI" FieldOptions="" Order="0020"/><Column DataSource="YT020.AMKIKANJYU" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="YT020.AMURIKAKE" FieldOptions="" Order="0040"/><Column DataSource="YT020.AMKIKANARARI" FieldOptions="" Order="0060"/></Detail><Field DataSource="YT010.AMKIKANSIHA" FieldOptions="HORIZONTAL" Order="0070"/><Field DataSource="YT010.AMKIKANNYUKO" FieldOptions="" Order="0090"/><Field DataSource="YT010.AMKIKANSYUKKO" FieldOptions="HORIZONTAL" Order="0100"/><Field DataSource="YT010.AMURIKAKE" FieldOptions="HORIZONTAL" Order="0040"/><Field DataSource="YT010.AMKAIKAKE" FieldOptions="HORIZONTAL" Order="0080"/><Field DataSource="YT010.AMZAIKO" FieldOptions="HORIZONTAL" Order="0110"/><Detail Caption="月次買掛サマリ" DetailFunction="YF200" HeaderKeyFields="" InitialMsg="" KeyFields="" Order="0020" Table="YT020"><Column DataSource="YT020.DTMSEQ" FieldOptions="" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="YT020.AMKIKANSIHA" FieldOptions="" Order="0040"/><Column DataSource="YT020.AMKAIKAKE" FieldOptions="" Order="0050"/><Column DataSource="YT020.AMKIKANKAI" FieldOptions="" Order="0030"/></Detail><Detail Caption="月次在庫サマリ" DetailFunction="YF300" HeaderKeyFields="" InitialMsg="" KeyFields="" Order="0030" Table="YT020"><Column DataSource="YT020.DTMSEQ" FieldOptions="" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="YT020.AMKIKANNYUKO" FieldOptions="" Order="0020"/><Column DataSource="YT020.AMKIKANSYUKKO" FieldOptions="" Order="0030"/><Column DataSource="YT020.AMZAIKO" FieldOptions="" Order="0040"/><Column DataSource="YT020.AMKIKANSEI" FieldOptions="" Order="0060"/></Detail><Field DataSource="YT010.AMKIKANKAI" FieldOptions="" Order="0060"/><Field DataSource="YT010.AMKIKANARARI" FieldOptions="HORIZONTAL" Order="0050"/><Field DataSource="YT010.AMKIKANSEI" FieldOptions="" Order="0120"/></Function><Function HeaderFunction="" HeaderKeyFields="" HeaderTable="YT020" ID="YF100" Name="月次売掛取引サマリの検討" Size="AUTO" SubsystemID="Y" Type="XF300"><Field DataSource="YT020.DTNEND" FieldOptions="CAPTION(年月度)" Order="0010"/><Field DataSource="YT020.DTMSEQ" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Field DataSource="YT020.AMKIKANURI" FieldOptions="HORIZONTAL" Order="0030"/><Field DataSource="YT020.AMKIKANJYU" FieldOptions="HORIZONTAL" Order="0040"/><Detail Caption="得意先別サマリ" DetailFunction="YF110" HeaderKeyFields="" InitialListing="T" InitialMsg="" KeyFields="DTNEND;DTMSEQ;IDTOKUISAKI" Order="0010" Table="YT100"><Column DataSource="YT100.AMKIKANURI" FieldOptions="" Order="0030"/><Column DataSource="YT100.AMKIKANJYU" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先C)" Order="0010"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(得意先名)" Order="0020"/><Column DataSource="YT100.AMURIKAKE" FieldOptions="" Order="0050"/><Column DataSource="YT100.AMKIKANARARI" FieldOptions="" Order="0070"/></Detail><Detail Caption="取引区分別サマリ" DetailFunction="YF120" HeaderKeyFields="" InitialListing="T" InitialMsg="" KeyFields="DTNEND;DTMSEQ;IDTOKUISAKI;KBURITORI;KBURIHURI" Order="0020" Table="YT110"><Column DataSource="YT110.KBURITORI" FieldOptions="" Order="0010"/><Column DataSource="YT110.KBURIHURI" FieldOptions="" Order="0020"/><Column DataSource="YT110.AMTORIHIKI" FieldOptions="" Order="0050"/><Column DataSource="YT110.AMTAX" FieldOptions="" Order="0060"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先C)" Order="0030"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(得意先名)" Order="0040"/><Filter DataSource="AT030.CDTORIHIKISAKI" FieldOptions="PROMPT_LIST0,CAPTION(得意先C)" Order="0020"/></Detail><Field DataSource="YT020.AMURIKAKE" FieldOptions="HORIZONTAL" Order="0050"/><Detail Caption="売掛増減履歴" DetailFunction="EF101" FixedWhere="FGVALID = 'T' AND KBAKADEN = '1'" HeaderKeyFields="" InitialMsg="" KeyFields="DTNEND;DTMSEQ;NRURIKAKE" Order="0030" Table="ET100"><Column DataSource="ET100.NRURIKAKE" FieldOptions="" Order="0030"/><Column DataSource="ET100.IDTOKUISAKI" FieldOptions="" Order="0010"/><Column DataSource="ET100.DTTORIHIKI" FieldOptions="" Order="0020"/><Column DataSource="ET100.KBURITORI" FieldOptions="" Order="0040"/><Column DataSource="ET100.KBURIHURI" FieldOptions="" Order="0050"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="ET100.TXHINMEI" FieldOptions="WIDTH(290)" Order="0090"/><Column DataSource="ET100.AMTORIHIKI" FieldOptions="" Order="0100"/><Column DataSource="ET100.AMTAX" FieldOptions="" Order="0110"/><Column DataSource="ET100.AMARARI" FieldOptions="" Order="0120"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(取引先名),WIDTH(290)" Order="0070"/><Filter DataSource="ET100.KBURITORI" FieldOptions="PROMPT_LIST1" Order="0010"/><Filter DataSource="ET100.TXHINMEI" FieldOptions="SCAN,CAPTION(品名／摘要SCAN)" Order="0030"/></Detail><Field DataSource="YT020.AMKIKANARARI" FieldOptions="HORIZONTAL" Order="0070"/></Function><Function HeaderFunction="" HeaderKeyFields="" HeaderTable="YT100" ID="YF110" Name="月次得意先別サマリの検討" Size="AUTO" SubsystemID="Y" Type="XF300"><Field DataSource="YT100.DTNEND" FieldOptions="CAPTION(年月度)" Order="0010"/><Field DataSource="YT100.DTMSEQ" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Field DataSource="YT100.AMKIKANURI" FieldOptions="" Order="0050"/><Field DataSource="YT100.AMKIKANJYU" FieldOptions="HORIZONTAL" Order="0060"/><Detail Caption="取引区分別サマリ" DetailFunction="YF120" HeaderKeyFields="" InitialListing="T" InitialMsg="" KeyFields="DTNEND;DTMSEQ;IDTOKUISAKI;KBURITORI;KBURIHURI" Order="0010" Table="YT110"><Column DataSource="YT110.KBURITORI" FieldOptions="" Order="0010"/><Column DataSource="YT110.KBURIHURI" FieldOptions="" Order="0020"/><Column DataSource="YT110.AMTORIHIKI" FieldOptions="" Order="0030"/><Column DataSource="YT110.AMTAX" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Detail><Field DataSource="YT100.AMURIKAKE" FieldOptions="HORIZONTAL" Order="0070"/><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先Ｃ),CAPTION_LENGTH_VARIABLE,HORIZONTAL(30)" Order="0030"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Detail Caption="売掛増減履歴" DetailFunction="EF101" FixedWhere="FGVALID = 'T' AND KBAKADEN = '1'" HeaderKeyFields="" InitialMsg="" KeyFields="DTNEND;DTMSEQ;IDTOKUISAKI;NRURIKAKE" Order="0020" Table="ET100"><Column DataSource="ET100.NRURIKAKE" FieldOptions="" Order="0020"/><Column DataSource="ET100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="ET100.KBURITORI" FieldOptions="" Order="0030"/><Column DataSource="ET100.KBURIHURI" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="ET100.TXHINMEI" FieldOptions="WIDTH(200)" Order="0050"/><Column DataSource="ET100.AMTORIHIKI" FieldOptions="" Order="0080"/><Column DataSource="ET100.AMTAX" FieldOptions="" Order="0090"/><Column DataSource="ET100.AMARARI" FieldOptions="" Order="0100"/><Filter DataSource="ET100.KBURITORI" FieldOptions="PROMPT_LIST1" Order="0010"/><Column DataSource="ET100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0070"/><Column DataSource="ET100.QTTORIHIKI" FieldOptions="" Order="0060"/><Filter DataSource="ET100.TXHINMEI" FieldOptions="SCAN,CAPTION(品名／摘要SCAN)" Order="0020"/></Detail><Field DataSource="YT100.AMKIKANARARI" FieldOptions="HORIZONTAL" Order="0090"/></Function><Function HeaderFunction="" HeaderKeyFields="" HeaderTable="YT110" ID="YF120" Name="月次売掛取引区分別サマリの検討" Size="AUTO" SubsystemID="Y" Type="XF300"><Field DataSource="YT110.DTNEND" FieldOptions="CAPTION(年月度)" Order="0010"/><Field DataSource="YT110.DTMSEQ" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Field DataSource="YT110.KBURITORI" FieldOptions="" Order="0060"/><Field DataSource="YT110.KBURIHURI" FieldOptions="HORIZONTAL" Order="0070"/><Field DataSource="YT110.AMTORIHIKI" FieldOptions="HORIZONTAL" Order="0080"/><Field DataSource="YT110.AMTAX" FieldOptions="HORIZONTAL" Order="0090"/><Detail Caption="売掛増減履歴" DetailFunction="NONE" FixedWhere="FGVALID = 'T' AND KBAKADEN = '1'" HeaderKeyFields="DTNEND;DTMSEQ;IDTOKUISAKI;KBURITORI;KBURIHURI" InitialListing="T" InitialMsg="" KeyFields="DTNEND;DTMSEQ;IDTOKUISAKI;KBURITORI;KBURIHURI;NRURIKAKE" Order="0010" Table="ET100"><Column DataSource="ET100.NRURIKAKE" FieldOptions="" Order="0020"/><Column DataSource="ET100.DTTORIHIKI" FieldOptions="" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="ET100.TXHINBAN" FieldOptions="" Order="0030"/><Column DataSource="ET100.TXHINMEI" FieldOptions="WIDTH(200)" Order="0040"/><Column DataSource="ET100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0060"/><Column DataSource="ET100.QTTORIHIKI" FieldOptions="" Order="0050"/><Column DataSource="ET100.AMTORIHIKI" FieldOptions="" Order="0070"/><Column DataSource="ET100.AMTAX" FieldOptions="" Order="0080"/><Column DataSource="ET100.AMARARI" FieldOptions="" Order="0090"/></Detail><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(得意先Ｃ),CAPTION_LENGTH_VARIABLE,HORIZONTAL(30)" Order="0030"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/></Function><Function HeaderFunction="" HeaderKeyFields="" HeaderTable="YT020" ID="YF200" Name="月次買掛取引サマリの検討" Size="AUTO" SubsystemID="Y" Type="XF300"><Field DataSource="YT020.DTNEND" FieldOptions="CAPTION(年月度)" Order="0010"/><Field DataSource="YT020.DTMSEQ" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Detail Caption="仕入先別サマリ" DetailFunction="YF210" HeaderKeyFields="" InitialListing="T" InitialMsg="" KeyFields="DTNEND;DTMSEQ;IDSIIRESAKI" Order="0010" Table="YT200"><Column DataSource="YT200.AMKIKANSIHA" FieldOptions="" Order="0050"/><Column DataSource="YT200.AMKAIKAKE" FieldOptions="" Order="0060"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C)" Order="0010"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(仕入先名)" Order="0020"/><Column DataSource="YT200.AMKIKANKAI" FieldOptions="" Order="0040"/></Detail><Detail Caption="取引区分別サマリ" DetailFunction="YF220" HeaderKeyFields="" InitialListing="T" InitialMsg="" KeyFields="DTNEND;DTMSEQ;IDSIIRESAKI;KBKAITORI;KBKAIHURI" Order="0020" Table="YT210"><Column DataSource="YT210.KBKAITORI" FieldOptions="" Order="0040"/><Column DataSource="YT210.KBKAIHURI" FieldOptions="" Order="0050"/><Column DataSource="YT210.AMTORIHIKI" FieldOptions="" Order="0060"/><Column DataSource="YT210.AMTAX" FieldOptions="" Order="0070"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C)" Order="0020"/><Column DataSource="AT030.TXKANJI" FieldOptions="CAPTION(仕入先名)" Order="0030"/><Filter DataSource="AT030.CDTORIHIKISAKI" FieldOptions="PROMPT_LIST0,CAPTION(仕入先C)" Order="0010"/></Detail><Field DataSource="YT020.AMKIKANSIHA" FieldOptions="HORIZONTAL" Order="0050"/><Field DataSource="YT020.AMKAIKAKE" FieldOptions="HORIZONTAL" Order="0060"/><Detail Caption="買掛増減履歴" DetailFunction="DF101" FixedWhere="FGVALID = 'T' AND KBAKADEN = '1'" HeaderKeyFields="" InitialMsg="" KeyFields="DTNEND;DTMSEQ;NRKAIKAKE" Order="0030" Table="DT100"><Column DataSource="DT100.NRKAIKAKE" FieldOptions="" Order="0020"/><Column DataSource="DT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="DT100.KBKAITORI" FieldOptions="" Order="0030"/><Column DataSource="DT100.KBKAIHURI" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="DT100.TXHINMEI" FieldOptions="" Order="0050"/><Column DataSource="DT100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0070"/><Column DataSource="DT100.QTTORIHIKI" FieldOptions="" Order="0060"/><Column DataSource="DT100.AMTORIHIKI" FieldOptions="" Order="0080"/><Column DataSource="DT100.AMTAX" FieldOptions="" Order="0090"/><Filter DataSource="DT100.KBKAITORI" FieldOptions="PROMPT_LIST1" Order="0010"/><Filter DataSource="DT100.TXHINMEI" FieldOptions="SCAN,CAPTION(品名／摘要SCAN)" Order="0020"/></Detail><Field DataSource="YT020.AMKIKANKAI" FieldOptions="" Order="0040"/></Function><Function HeaderFunction="" HeaderKeyFields="" HeaderTable="YT210" ID="YF220" Name="月次買掛取引区分別サマリの検討" Size="AUTO" SubsystemID="Y" Type="XF300"><Field DataSource="YT210.DTNEND" FieldOptions="CAPTION(年月度)" Order="0010"/><Field DataSource="YT210.DTMSEQ" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Field DataSource="YT210.KBKAITORI" FieldOptions="" Order="0050"/><Field DataSource="YT210.KBKAIHURI" FieldOptions="HORIZONTAL" Order="0060"/><Field DataSource="YT210.AMTORIHIKI" FieldOptions="HORIZONTAL" Order="0070"/><Field DataSource="YT210.AMTAX" FieldOptions="HORIZONTAL" Order="0080"/><Detail Caption="買掛増減履歴" DetailFunction="DF101" FixedWhere="FGVALID = 'T' AND KBAKADEN = '1'" HeaderKeyFields="DTNEND;DTMSEQ;IDSIIRESAKI;KBKAITORI;KBKAIHURI" InitialListing="T" InitialMsg="" KeyFields="DTNEND;DTMSEQ;IDSIIRESAKI;KBKAITORI;KBKAIHURI;NRKAIKAKE" Order="0010" Table="DT100"><Column DataSource="DT100.NRKAIKAKE" FieldOptions="" Order="0020"/><Column DataSource="DT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="DT100.TXHINMEI" FieldOptions="WIDTH(200)" Order="0040"/><Column DataSource="DT100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0060"/><Column DataSource="DT100.QTTORIHIKI" FieldOptions="" Order="0050"/><Column DataSource="DT100.AMTORIHIKI" FieldOptions="" Order="0070"/><Column DataSource="DT100.AMTAX" FieldOptions="" Order="0080"/><Column DataSource="DT100.TXHINBAN" FieldOptions="" Order="0030"/></Detail><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C),CAPTION_LENGTH_VARIABLE,HORIZONTAL(30)" Order="0030"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/></Function><Function HeaderFunction="" HeaderKeyFields="" HeaderTable="YT020" ID="YF300" Name="月次在庫取引サマリの検討" Size="AUTO" SubsystemID="Y" Type="XF300"><Field DataSource="YT020.DTNEND" FieldOptions="CAPTION(年月度)" Order="0010"/><Field DataSource="YT020.DTMSEQ" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Detail Caption="品目別サマリ" DetailFunction="YF310" HeaderKeyFields="" InitialListing="T" InitialMsg="" KeyFields="DTNEND;DTMSEQ;IDHINMOKU" Order="0010" Table="YT300"><Column DataSource="YT300.AMKIKANNYUKO" FieldOptions="WIDTH(100)" Order="0110"/><Column DataSource="YT300.AMKIKANSYUKKO" FieldOptions="WIDTH(100)" Order="0100"/><Column DataSource="YT300.AMZAIKO" FieldOptions="WIDTH(100)" Order="0120"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="BT010.TXHINBAN" FieldOptions="" Order="0010"/><Column DataSource="BT010.TXHINMEI" FieldOptions="WIDTH(200)" Order="0020"/><Column DataSource="YT300.QTKIKANNYUKO" FieldOptions="WIDTH(100)" Order="0030"/><Column DataSource="YT300.QTKIKANSYUKKO" FieldOptions="WIDTH(100)" Order="0040"/><Column DataSource="YT300.QTZAIKO" FieldOptions="WIDTH(100)" Order="0050"/><Column DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0090"/><Column DataSource="YT300.QTKIKANURI" FieldOptions="WIDTH(100)" Order="0070"/><Column DataSource="YT300.AMKIKANURI" FieldOptions="WIDTH(100)" Order="0150"/><Column DataSource="YT300.AMKIKANARARI" FieldOptions="WIDTH(100)" Order="0160"/><Column DataSource="YT300.QTKIKANKAI" FieldOptions="WIDTH(100)" Order="0060"/><Column DataSource="YT300.AMKIKANKAI" FieldOptions="WIDTH(100)" Order="0130"/><Column DataSource="YT300.QTKIKANSEI" FieldOptions="WIDTH(100)" Order="0080"/><Column DataSource="YT300.AMKIKANSEI" FieldOptions="WIDTH(100)" Order="0140"/></Detail><Detail Caption="取引区分別サマリ" DetailFunction="YF320" HeaderKeyFields="" InitialListing="T" InitialMsg="" KeyFields="DTNEND;DTMSEQ;IDHINMOKU;KBUKEBARAI;KBZAIHURI" Order="0020" Table="YT310"><Column DataSource="YT310.KBUKEBARAI" FieldOptions="" Order="0010"/><Column DataSource="YT310.KBZAIHURI" FieldOptions="" Order="0020"/><Column DataSource="YT310.AMTORIHIKI" FieldOptions="" Order="0070"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="YT310.QTTORIHIKI" FieldOptions="" Order="0050"/><Column DataSource="BT010.TXHINBAN" FieldOptions="" Order="0030"/><Column DataSource="BT010.TXHINMEI" FieldOptions="" Order="0040"/><Column DataSource="BT010.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0060"/><Filter DataSource="BT010.TXHINBAN" FieldOptions="PROMPT_LIST0" Order="0020"/><Filter DataSource="YT310.KBUKEBARAI" FieldOptions="PROMPT_LIST1" Order="0010"/></Detail><Field DataSource="YT020.AMKIKANNYUKO" FieldOptions="HORIZONTAL" Order="0030"/><Field DataSource="YT020.AMKIKANSYUKKO" FieldOptions="HORIZONTAL" Order="0040"/><Field DataSource="YT020.AMZAIKO" FieldOptions="HORIZONTAL" Order="0050"/><Detail Caption="在庫増減履歴" DetailFunction="FF101" FixedWhere="FGVALID = 'T' AND KBAKADEN = '1'" HeaderKeyFields="" InitialMsg="" KeyFields="DTNEND;DTMSEQ;NRZAITORI" Order="0030" Table="FT100"><Column DataSource="FT100.NRZAITORI" FieldOptions="" Order="0020"/><Column DataSource="FT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="FT100.KBUKEBARAI" FieldOptions="" Order="0030"/><Column DataSource="FT100.KBZAIHURI" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="FT100.TXHINBAN" FieldOptions="" Order="0050"/><Column DataSource="FT100.TXHINMEI" FieldOptions="WIDTH(250)" Order="0060"/><Column DataSource="FT100.KBUNIT" FieldOptions="CAPTION(U/M)" Order="0090"/><Column DataSource="FT100.QTTORIHIKI" FieldOptions="" Order="0080"/><Column DataSource="FT100.AMTORIHIKI" FieldOptions="" Order="0100"/><Filter DataSource="FT100.KBUKEBARAI" FieldOptions="PROMPT_LIST1" Order="0010"/><Filter DataSource="FT100.TXHINBAN" FieldOptions="PROMPT_LIST0" Order="0020"/><Column DataSource="FT100.TXAITESAKI" FieldOptions="WIDTH(250)" Order="0070"/></Detail><Field DataSource="YT020.AMKIKANSEI" FieldOptions="HORIZONTAL" Order="0070"/></Function><Function HeaderFunction="" HeaderKeyFields="" HeaderTable="YT300" ID="YF310" Name="月次在庫品別サマリの検討" Size="AUTO" SubsystemID="Y" Type="XF300"><Field DataSource="YT300.DTNEND" FieldOptions="CAPTION(年月度)" Order="0010"/><Field DataSource="YT300.DTMSEQ" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Field DataSource="YT300.AMKIKANNYUKO" FieldOptions="" Order="0090"/><Field DataSource="YT300.AMKIKANSYUKKO" FieldOptions="HORIZONTAL" Order="0100"/><Field DataSource="YT300.AMZAIKO" FieldOptions="HORIZONTAL" Order="0110"/><Detail Caption="取引区分別サマリ" DetailFunction="YF320" HeaderKeyFields="" InitialListing="T" InitialMsg="" KeyFields="DTNEND;DTMSEQ;IDHINMOKU;KBUKEBARAI;KBZAIHURI" Order="0010" Table="YT310"><Column DataSource="YT310.KBUKEBARAI" FieldOptions="" Order="0010"/><Column DataSource="YT310.KBZAIHURI" FieldOptions="" Order="0020"/><Column DataSource="YT310.AMTORIHIKI" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="YT310.QTTORIHIKI" FieldOptions="" Order="0030"/></Detail><Field DataSource="YT300.QTKIKANNYUKO" FieldOptions="" Order="0050"/><Field DataSource="YT300.QTKIKANSYUKKO" FieldOptions="HORIZONTAL" Order="0060"/><Field DataSource="YT300.QTZAIKO" FieldOptions="HORIZONTAL" Order="0070"/><Field DataSource="BT010.TXHINBAN" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(50)" Order="0030"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0080"/><Detail Caption="在庫増減履歴" DetailFunction="FF101" FixedWhere="FGVALID = 'T' AND KBAKADEN = '1'" HeaderKeyFields="" InitialMsg="" KeyFields="DTNEND;DTMSEQ;IDHINMOKU;NRZAITORI" Order="0020" Table="FT100"><Column DataSource="FT100.NRZAITORI" FieldOptions="" Order="0020"/><Column DataSource="FT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="FT100.KBUKEBARAI" FieldOptions="" Order="0030"/><Column DataSource="FT100.KBZAIHURI" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="FT100.TXAITESAKI" FieldOptions="" Order="0050"/><Column DataSource="FT100.QTTORIHIKI" FieldOptions="" Order="0060"/><Column DataSource="FT100.AMTORIHIKI" FieldOptions="" Order="0070"/><Filter DataSource="FT100.KBUKEBARAI" FieldOptions="PROMPT_LIST1" Order="0010"/></Detail><Field DataSource="YT300.QTKIKANURI" FieldOptions="HORIZONTAL" Order="0140"/><Field DataSource="YT300.AMKIKANURI" FieldOptions="HORIZONTAL" Order="0180"/><Field DataSource="YT300.AMKIKANARARI" FieldOptions="HORIZONTAL(22)" Order="0190"/><Detail Caption="売掛増減履歴" DetailFunction="DF101" HeaderKeyFields="" InitialMsg="" KeyFields="DTNEND;DTMSEQ;IDHINMOKU;NRURIKAKE" Order="0030" Table="ET100"><Column DataSource="ET100.NRURIKAKE" FieldOptions="" Order="0020"/><Column DataSource="ET100.DTTORIHIKI" FieldOptions="" Order="0010"/><Column DataSource="ET100.KBURITORI" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="ET100.PRTORIHIKI" FieldOptions="" Order="0050"/><Column DataSource="ET100.QTTORIHIKI" FieldOptions="" Order="0060"/><Column DataSource="ET100.AMTORIHIKI" FieldOptions="" Order="0070"/><Column DataSource="ET100.AMTAX" FieldOptions="" Order="0080"/><Column DataSource="ET100.AMGENKA" FieldOptions="" Order="0090"/><Column DataSource="AT030.TXKANJI" FieldOptions="WIDTH(200)" Order="0040"/></Detail><Detail Caption="買掛増減履歴" DetailFunction="DF101" HeaderKeyFields="" InitialMsg="" KeyFields="DTNEND;DTMSEQ;IDHINMOKU;NRKAIKAKE" Order="0040" Table="DT100"><Column DataSource="DT100.NRKAIKAKE" FieldOptions="" Order="0010"/><Column DataSource="DT100.IDSIIRESAKI" FieldOptions="" Order="0020"/><Column DataSource="DT100.DTTORIHIKI" FieldOptions="" Order="0030"/><Column DataSource="DT100.KBKAITORI" FieldOptions="" Order="0040"/><Column DataSource="DT100.KBKAIHURI" FieldOptions="" Order="0050"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Detail><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0150"/><Field DataSource="YT300.QTKIKANKAI" FieldOptions="" Order="0120"/><Field DataSource="YT300.AMKIKANKAI" FieldOptions="" Order="0160"/><Field DataSource="YT300.QTKIKANSEI" FieldOptions="HORIZONTAL" Order="0130"/><Field DataSource="YT300.AMKIKANSEI" FieldOptions="HORIZONTAL" Order="0170"/></Function><Function HeaderFunction="" HeaderKeyFields="" HeaderTable="YT310" ID="YF320" Name="月次在庫受払区分別サマリの検討" Size="AUTO" SubsystemID="Y" Type="XF300"><Field DataSource="YT310.DTNEND" FieldOptions="CAPTION(年月度)" Order="0010"/><Field DataSource="YT310.DTMSEQ" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Field DataSource="YT310.KBUKEBARAI" FieldOptions="" Order="0050"/><Field DataSource="YT310.KBZAIHURI" FieldOptions="HORIZONTAL" Order="0060"/><Field DataSource="YT310.AMTORIHIKI" FieldOptions="HORIZONTAL" Order="0090"/><Detail Caption="在庫増減履歴" DetailFunction="FF101" FixedWhere="FGVALID = 'T' AND KBAKADEN = '1'" HeaderKeyFields="DTNEND;DTMSEQ;IDHINMOKU;KBUKEBARAI;KBZAIHURI" InitialListing="T" InitialMsg="" KeyFields="DTNEND;DTMSEQ;IDHINMOKU;KBUKEBARAI;KBZAIHURI;NRZAITORI" Order="0010" Table="FT100"><Column DataSource="FT100.NRZAITORI" FieldOptions="" Order="0020"/><Column DataSource="FT100.DTTORIHIKI" FieldOptions="" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="FT100.TXAITESAKI" FieldOptions="" Order="0030"/><Column DataSource="FT100.QTTORIHIKI" FieldOptions="" Order="0040"/><Column DataSource="FT100.AMTORIHIKI" FieldOptions="" Order="0050"/></Detail><Field DataSource="YT310.QTTORIHIKI" FieldOptions="HORIZONTAL" Order="0070"/><Field DataSource="BT010.TXHINBAN" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(30)" Order="0030"/><Field DataSource="BT010.TXHINMEI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Field DataSource="BT010.KBUNIT" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0080"/></Function><Function HeaderFunction="" HeaderKeyFields="" HeaderTable="YT200" ID="YF210" Name="月次仕入先別サマリの検討" Size="AUTO" SubsystemID="Y" Type="XF300"><Field DataSource="YT200.DTNEND" FieldOptions="CAPTION(年月度)" Order="0010"/><Field DataSource="YT200.DTMSEQ" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Field DataSource="YT200.AMKIKANSIHA" FieldOptions="HORIZONTAL" Order="0070"/><Field DataSource="YT200.AMKAIKAKE" FieldOptions="HORIZONTAL" Order="0080"/><Detail Caption="取引区分別サマリ" DetailFunction="YF220" HeaderKeyFields="" InitialListing="T" InitialMsg="" KeyFields="DTNEND;DTMSEQ;IDSIIRESAKI;KBKAITORI;KBKAIHURI" Order="0010" Table="YT210"><Column DataSource="YT210.KBKAITORI" FieldOptions="" Order="0000"/><Column DataSource="YT210.KBKAIHURI" FieldOptions="" Order="0010"/><Column DataSource="YT210.AMTORIHIKI" FieldOptions="" Order="0020"/><Column DataSource="YT210.AMTAX" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Detail><Field DataSource="AT030.CDTORIHIKISAKI" FieldOptions="CAPTION(仕入先C),CAPTION_LENGTH_VARIABLE,HORIZONTAL(30)" Order="0030"/><Field DataSource="AT030.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Detail Caption="買掛増減履歴" DetailFunction="DF101" FixedWhere="FGVALID = 'T' AND KBAKADEN = '1'" HeaderKeyFields="" InitialMsg="" KeyFields="DTNEND;DTMSEQ;IDSIIRESAKI;NRKAIKAKE" Order="0020" Table="DT100"><Column DataSource="DT100.NRKAIKAKE" FieldOptions="" Order="0010"/><Column DataSource="DT100.DTTORIHIKI" FieldOptions="" Order="0030"/><Column DataSource="DT100.KBKAITORI" FieldOptions="" Order="0040"/><Column DataSource="DT100.KBKAIHURI" FieldOptions="" Order="0050"/><Column DataSource="DT100.KBAKADEN" FieldOptions="" Order="0060"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Filter DataSource="DT100.KBKAITORI" FieldOptions="PROMPT_LIST1" Order="0010"/><Filter DataSource="DT100.TXHINMEI" FieldOptions="SCAN,CAPTION(品名／摘要SCAN)" Order="0020"/></Detail><Field DataSource="YT200.AMKIKANKAI" FieldOptions="" Order="0060"/></Function><Function ID="YF900" Name="取引集計処理の起動" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var count = 0; var errorMessage = ''; var numberOfErrors = 0;#EOL##EOL#//////////////////////////////#EOL#// 年月設定とダイアログ定義 //#EOL#//////////////////////////////#EOL#var wrkStr = session.getSystemVariantString('ALLOWED_FISCAL_MONTH') + '';#EOL#var targetFYear = wrkStr.substring(0, 4);#EOL#var fromMSeq = wrkStr.substring(4, 6);#EOL#var thruMSeq = session.getMSeqOfDate(session.today + '');#EOL#var dialog = session.getInputDialog();#EOL#dialog.setMessage('＊システム変数の「入力認可過去月度」以降の取引実績にもとづいて、年度別・月度別の取引高が集計されます。');#EOL#dialog.setMessageHeight(80);#EOL##EOL#////////////////////////////////////////////#EOL#// ダイアログ表示と条件にもとづく後続処理 //#EOL#////////////////////////////////////////////#EOL#var reply = dialog.request('取引集計処理');#EOL#if (reply == 0) {#EOL##EOL#&#x9;////////////////////////////#EOL#&#x9;// 対象期間データの初期化 //#EOL#&#x9;////////////////////////////#EOL#&#x9;initializeData();#EOL##EOL#&#x9;//////////////////////#EOL#&#x9;// パラメータの設定 //#EOL#&#x9;//////////////////////#EOL#&#x9;instance.parmMap.put('TARGET_FYEAR', targetFYear);#EOL#&#x9;instance.parmMap.put('FROM_MSEQ', fromMSeq);#EOL#&#x9;instance.parmMap.put('THRU_MSEQ', thruMSeq);#EOL##EOL#&#x9;//////////////////////#EOL#&#x9;// 得意先別集計処理 //#EOL#&#x9;//////////////////////#EOL#&#x9;instance.callFunction('YF910'); //増減履歴集計//#EOL#&#x9;instance.callFunction('YF911'); //残高更新//#EOL#&#x9;instance.callFunction('YF912'); //年月集計//#EOL##EOL#&#x9;//////////////////////#EOL#&#x9;// 仕入先別集計処理 //#EOL#&#x9;//////////////////////#EOL#&#x9;instance.callFunction('YF920'); //増減履歴集計//#EOL#&#x9;instance.callFunction('YF921'); //残高繰越//#EOL#&#x9;instance.callFunction('YF922'); //年月集計//#EOL##EOL#&#x9;//////////////////////#EOL#&#x9;// 在庫品別集計処理 //#EOL#&#x9;//////////////////////#EOL#&#x9;instance.callFunction('YF930'); //増減履歴集計//#EOL#&#x9;instance.callFunction('YF931'); //残高繰越//#EOL#&#x9;instance.callFunction('YF932'); //年月集計//#EOL##EOL#&#x9;////////////////#EOL#&#x9;// エラー処理 //#EOL#&#x9;////////////////#EOL#&#x9;if (errorMessage == '') {#EOL#&#x9;&#x9;instance.commit();#EOL#&#x9;&#x9;session.compressTable('YT');#EOL#&#x9;} else {#EOL#&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;}#EOL##EOL#} else {#EOL#&#x9;instance.returnMap.put('RETURN_MESSAGE', '＊処理は取り消されました。');#EOL#}#EOL##EOL#////////////////////////////#EOL#// 対象期間データの初期化 //#EOL#////////////////////////////#EOL#function initializeData() {#EOL##EOL#&#x9;////////////////////////////#EOL#&#x9;// 年次取引サマリの初期化 //#EOL#&#x9;////////////////////////////#EOL#&#x9;var dYT010 = instance.createTableOperator('Delete', 'YT010');#EOL#&#x9;dYT010.addKeyValue('DTNEND >=',&#x9;targetFYear);#EOL#&#x9;dYT010.execute();#EOL#&#x9;var cYT010 = instance.createTableOperator('Insert', 'YT010');#EOL#&#x9;cYT010.addValue('DTNEND',&#x9;targetFYear);#EOL#&#x9;cYT010.execute();#EOL##EOL#&#x9;////////////////////////////#EOL#&#x9;// 月次取引サマリの初期化 //#EOL#&#x9;////////////////////////////#EOL#&#x9;var dYT020 = instance.createTableOperator('Delete', 'YT020');#EOL#&#x9;dYT020.addKeyValue('(', 'DTNEND >',  targetFYear, ') or');#EOL#&#x9;dYT020.addKeyValue('(', 'DTNEND =',  targetFYear, ' and');#EOL#&#x9;dYT020.addKeyValue('',  'DTMSEQ >=', fromMSeq, ')');#EOL#&#x9;dYT020.execute();#EOL#&#x9;var cYT020 = instance.createTableOperator('Insert', 'YT020');#EOL#&#x9;for (i=1; i&lt;=12; i++) {#EOL#&#x9;&#x9;if (i &lt;= thruMSeq) {#EOL#&#x9;&#x9;&#x9;cYT020.addValue('DTNEND',&#x9;targetFYear);#EOL#&#x9;&#x9;&#x9;cYT020.addValue('DTMSEQ',&#x9;i);#EOL#&#x9;&#x9;&#x9;cYT020.execute();#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////#EOL#&#x9;// 月次得意先別サマリの初期化 //#EOL#&#x9;////////////////////////////////#EOL#&#x9;var dYT100 = instance.createTableOperator('Delete', 'YT100');#EOL#&#x9;dYT100.addKeyValue('(', 'DTNEND >',  targetFYear, ') or');#EOL#&#x9;dYT100.addKeyValue('(', 'DTNEND =',  targetFYear, ' and');#EOL#&#x9;dYT100.addKeyValue('',  'DTMSEQ >=', fromMSeq, ')');#EOL#&#x9;dYT100.execute();#EOL#&#x9;var cYT100 = instance.createTableOperator('Insert', 'YT100');#EOL#&#x9;var rET010 = instance.createTableOperator('Select', 'ET010');#EOL#&#x9;while (rET010.next()) {#EOL#&#x9;&#x9;for (i=1; i&lt;=12; i++) {#EOL#&#x9;&#x9;&#x9;if (i &lt;= thruMSeq) {#EOL#&#x9;&#x9;&#x9;&#x9;cYT100.addValue('DTNEND',&#x9;&#x9;targetFYear);#EOL#&#x9;&#x9;&#x9;&#x9;cYT100.addValue('DTMSEQ',&#x9;&#x9;i);#EOL#&#x9;&#x9;&#x9;&#x9;cYT100.addValue('IDTOKUISAKI',&#x9;rET010.getValueOf('IDTOKUISAKI'));#EOL#&#x9;&#x9;&#x9;&#x9;cYT100.execute();#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////#EOL#&#x9;// 月次売掛取引サマリのクリア //#EOL#&#x9;////////////////////////////////#EOL#&#x9;var dYT110 = instance.createTableOperator('Delete', 'YT110');#EOL#&#x9;dYT110.addKeyValue('(', 'DTNEND >',  targetFYear, ') or');#EOL#&#x9;dYT110.addKeyValue('(', 'DTNEND =',  targetFYear, ' and');#EOL#&#x9;dYT110.addKeyValue('',  'DTMSEQ >=', fromMSeq, ')');#EOL#&#x9;dYT110.execute();#EOL##EOL#&#x9;////////////////////////////////#EOL#&#x9;// 月次仕入先別サマリの初期化 //#EOL#&#x9;////////////////////////////////#EOL#&#x9;var dYT200 = instance.createTableOperator('Delete', 'YT200');#EOL#&#x9;dYT200.addKeyValue('(', 'DTNEND >',  targetFYear, ') or');#EOL#&#x9;dYT200.addKeyValue('(', 'DTNEND =',  targetFYear, ' and');#EOL#&#x9;dYT200.addKeyValue('',  'DTMSEQ >=', fromMSeq, ')');#EOL#&#x9;dYT200.execute();#EOL#&#x9;var cYT200 = instance.createTableOperator('Insert', 'YT200');#EOL#&#x9;var rDT010 = instance.createTableOperator('Select', 'DT010');#EOL#&#x9;while (rDT010.next()) {#EOL#&#x9;&#x9;for (i=1; i&lt;=12; i++) {#EOL#&#x9;&#x9;&#x9;if (i &lt;= thruMSeq) {#EOL#&#x9;&#x9;&#x9;&#x9;cYT200.addValue('DTNEND',&#x9;&#x9;targetFYear);#EOL#&#x9;&#x9;&#x9;&#x9;cYT200.addValue('DTMSEQ',&#x9;&#x9;i);#EOL#&#x9;&#x9;&#x9;&#x9;cYT200.addValue('IDSIIRESAKI',&#x9;rDT010.getValueOf('IDSIIRESAKI'));#EOL#&#x9;&#x9;&#x9;&#x9;cYT200.execute();#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////#EOL#&#x9;// 月次買掛取引サマリのクリア //#EOL#&#x9;////////////////////////////////#EOL#&#x9;var dYT210 = instance.createTableOperator('Delete', 'YT210');#EOL#&#x9;dYT210.addKeyValue('(', 'DTNEND >',  targetFYear, ') or');#EOL#&#x9;dYT210.addKeyValue('(', 'DTNEND =',  targetFYear, ' and');#EOL#&#x9;dYT210.addKeyValue('',  'DTMSEQ >=', fromMSeq, ')');#EOL#&#x9;dYT210.execute();#EOL##EOL#&#x9;//////////////////////////////#EOL#&#x9;// 月次品目別サマリの初期化 //#EOL#&#x9;//////////////////////////////#EOL#&#x9;var dYT300 = instance.createTableOperator('Delete', 'YT300');#EOL#&#x9;dYT300.addKeyValue('(', 'DTNEND >',  targetFYear, ') or');#EOL#&#x9;dYT300.addKeyValue('(', 'DTNEND =',  targetFYear, ' and');#EOL#&#x9;dYT300.addKeyValue('',  'DTMSEQ >=', fromMSeq, ')');#EOL#&#x9;dYT300.execute();#EOL#&#x9;var cYT300 = instance.createTableOperator('Insert', 'YT300');#EOL#&#x9;var rBT010 = instance.createTableOperator('Select', 'BT010');#EOL#&#x9;while (rBT010.next()) {#EOL#&#x9;&#x9;if (rBT010.getValueOf('FGZAIKO') == 'T') {#EOL#&#x9;&#x9;&#x9;for (i=1; i&lt;=12; i++) {#EOL#&#x9;&#x9;&#x9;&#x9;if (i &lt;= thruMSeq) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cYT300.addValue('DTNEND',&#x9;&#x9;targetFYear);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cYT300.addValue('DTMSEQ',&#x9;&#x9;i);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cYT300.addValue('IDHINMOKU',&#x9;rBT010.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;cYT300.execute();#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;////////////////////////////////#EOL#&#x9;// 月次在庫取引サマリのクリア //#EOL#&#x9;////////////////////////////////#EOL#&#x9;var dYT310 = instance.createTableOperator('Delete', 'YT310');#EOL#&#x9;dYT310.addKeyValue('(', 'DTNEND >',  targetFYear, ') or');#EOL#&#x9;dYT310.addKeyValue('(', 'DTNEND =',  targetFYear, ' and');#EOL#&#x9;dYT310.addKeyValue('',  'DTMSEQ >=', fromMSeq, ')');#EOL#&#x9;dYT310.execute();#EOL#}" SubsystemID="Y" TimerMessage="" TimerOption="CONSOLE" Type="XF000"/><Function ID="YF910" Name="得意先別増減履歴集計" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rET100; var cYT110; var rYT100; var uYT100;#EOL#var dtNend = 0; var dtMSeq = 0; var idTokuisaki = ''; var kbUritori = ''; var kbUrihuri = '';#EOL#var errorMessage = ''; var count = 0;#EOL##EOL#////////////////////#EOL#// 集計用変数定義 //#EOL#////////////////////#EOL#var amKikanUri100 = 0; var amKikanJyu100 = 0; var amKikanGenka100 = 0;#EOL#var amTorihiki110 = 0; var amTax110 = 0;#EOL##EOL#//////////////////////////////#EOL#// 集計対象最過去年月の設定 //#EOL#//////////////////////////////#EOL#var targetFYear = instance.parmMap.get('TARGET_FYEAR');#EOL#var fromMSeq = instance.parmMap.get('FROM_MSEQ');#EOL#var thruMSeq = instance.parmMap.get('THRU_MSEQ');#EOL##EOL#//////////////////////////////////////////////////////////////////////////////#EOL#// 対象期間の売掛増減履歴(ET100)の読取と取引サマリ(YT100,YT110)の更新 //#EOL#//////////////////////////////////////////////////////////////////////////////#EOL#rET100 = instance.createTableOperator('Select', 'ET100');#EOL#rET100.addKeyValue('FGVALID', 'T');#EOL#rET100.addKeyValue('and', 'KBAKADEN = ', '1', '');#EOL#rET100.addKeyValue('and', 'DTMSEQ >= ', fromMSeq, '');#EOL#rET100.addKeyValue('and', 'DTMSEQ &lt;= ', thruMSeq, '');#EOL#rET100.setOrderBy('DTNEND, DTMSEQ, IDTOKUISAKI, KBURITORI, KBURIHURI');#EOL#while (rET100.next()) {#EOL##EOL#&#x9;/////////////////////////////////////#EOL#&#x9;// 年月BREAKなら集計レコードの追加 //#EOL#&#x9;/////////////////////////////////////#EOL#&#x9;if (Number(rET100.getValueOf('DTMSEQ')) != dtMSeq || rET100.getValueOf('IDTOKUISAKI').trim() != idTokuisaki) {#EOL##EOL#&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;// 月次売掛取引サマリ(YT110)の追加 //#EOL#&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;insertYT110();#EOL#&#x9;&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;// 月次得意先別サマリ(YT100)の追加 //#EOL#&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;insertYT100();#EOL#&#x9;&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;} else {#EOL##EOL#&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;// 区分BREAKなら集計レコードの追加 //#EOL#&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;if (rET100.getValueOf('KBURITORI').trim() != kbUritori || rET100.getValueOf('KBURIHURI').trim() != kbUrihuri) {#EOL##EOL#&#x9;&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;&#x9;// 月次売掛取引サマリ(YT110)の追加 //#EOL#&#x9;&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;&#x9;insertYT110();#EOL#&#x9;&#x9;&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////////#EOL#&#x9;// BREAK検査フィールドの設定 //#EOL#&#x9;///////////////////////////////#EOL#&#x9;dtNend = rET100.getValueOf('DTNEND');#EOL#&#x9;dtMSeq = rET100.getValueOf('DTMSEQ');#EOL#&#x9;idTokuisaki = rET100.getValueOf('IDTOKUISAKI').trim() + '';#EOL#&#x9;kbUritori = rET100.getValueOf('KBURITORI').trim() + '';#EOL#&#x9;kbUrihuri = rET100.getValueOf('KBURIHURI').trim() + '';#EOL##EOL#&#x9;//////////////////////#EOL#&#x9;// 項目値の集計処理 //#EOL#&#x9;//////////////////////#EOL#&#x9;summarizeFields();#EOL#}#EOL##EOL#/////////////////////////////////////#EOL#// 月次売掛取引サマリ(YT110)の追加 //#EOL#/////////////////////////////////////#EOL#insertYT110();#EOL##EOL#/////////////////////////////////////#EOL#// 月次得意先別サマリ(YT100)の追加 //#EOL#/////////////////////////////////////#EOL#insertYT100();#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL##EOL#//////////////////////////////////////////////////////////////////////////////////////////////////////////////#EOL#////////////////////////////////////// S U B R O U T I N E S /////////////////////////////////////////////////#EOL#//////////////////////////////////////////////////////////////////////////////////////////////////////////////#EOL##EOL#///////////////////////////////////#EOL#//// 月次取引サマリ(YT020)の追加 //#EOL#///////////////////////////////////#EOL#//function processYT020() {#EOL#//&#x9;if (dtNend != 0) {#EOL#//&#x9;&#x9;rYT020 = instance.createTableOperator('Select', 'YT020');#EOL#//&#x9;&#x9;rYT020.addKeyValue('DTNEND',&#x9;dtNend);#EOL#//&#x9;&#x9;rYT020.addKeyValue('DTMSEQ',&#x9;dtMSeq);#EOL#//&#x9;&#x9;if (rYT020.execute() == 1) {#EOL#//&#x9;&#x9;&#x9;uYT020 = instance.createTableOperator('Update', 'YT020');#EOL#//&#x9;&#x9;&#x9;uYT020.addValue('AMKIKANURI',&#x9;&#x9;amKikanUri020);#EOL#//&#x9;&#x9;&#x9;uYT020.addValue('AMKIKANJYU',&#x9;&#x9;amKikanJyu020);#EOL#//&#x9;&#x9;&#x9;uYT020.addValue('AMKIKANGENKA',&#x9;&#x9;amKikanGenka020);#EOL#//&#x9;&#x9;&#x9;uYT020.addKeyValue('DTNEND',&#x9;dtNend);#EOL#//&#x9;&#x9;&#x9;uYT020.addKeyValue('DTMSEQ',&#x9;dtMSeq);#EOL#//&#x9;&#x9;&#x9;count = uYT020.execute();#EOL#//&#x9;&#x9;&#x9;if (count != 1) {#EOL#//&#x9;&#x9;&#x9;&#x9;errorMessage = '月次取引サマリ(YT020)の更新に失敗しました。処理はキャンセルされます。';#EOL#//&#x9;&#x9;&#x9;}#EOL#//&#x9;&#x9;}#EOL#//&#x9;&#x9;amKikanUri020 = 0; amKikanJyu020 = 0; amKikanGenka020 = 0;#EOL#//&#x9;}#EOL#//}#EOL##EOL#/////////////////////////////////////#EOL#// 月次得意先別サマリ(YT100)の追加 //#EOL#/////////////////////////////////////#EOL#function insertYT100() {#EOL#&#x9;if (dtNend != 0) {#EOL#&#x9;&#x9;rYT100 = instance.createTableOperator('Select', 'YT100');#EOL#&#x9;&#x9;rYT100.addKeyValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;rYT100.addKeyValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;rYT100.addKeyValue('IDTOKUISAKI',&#x9;idTokuisaki);#EOL#&#x9;&#x9;if (rYT100.execute() == 1) {#EOL#&#x9;&#x9;&#x9;uYT100 = instance.createTableOperator('Update', 'YT100');#EOL#&#x9;&#x9;&#x9;uYT100.addValue('AMKIKANURI',&#x9;&#x9;amKikanUri100);#EOL#&#x9;&#x9;&#x9;uYT100.addValue('AMKIKANJYU',&#x9;&#x9;amKikanJyu100);#EOL#&#x9;&#x9;&#x9;uYT100.addValue('AMKIKANGENKA',&#x9;&#x9;amKikanGenka100);#EOL#&#x9;&#x9;&#x9;uYT100.addKeyValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;&#x9;uYT100.addKeyValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;&#x9;uYT100.addKeyValue('IDTOKUISAKI',&#x9;idTokuisaki);#EOL#&#x9;&#x9;&#x9;count = uYT100.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '月次得意先別サマリ(YT100)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;amKikanUri100 = 0; amKikanJyu100 = 0; amKikanGenka100 = 0;#EOL#&#x9;}#EOL#}#EOL##EOL#/////////////////////////////////////#EOL#// 月次売掛取引サマリ(YT110)の追加 //#EOL#/////////////////////////////////////#EOL#function insertYT110() {#EOL#&#x9;if (dtNend != 0) {#EOL#&#x9;&#x9;cYT110 = instance.createTableOperator('Insert', 'YT110');#EOL#&#x9;&#x9;cYT110.addValue('DTNEND',&#x9;&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;cYT110.addValue('DTMSEQ',&#x9;&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;cYT110.addValue('IDTOKUISAKI',&#x9;&#x9;idTokuisaki);#EOL#&#x9;&#x9;cYT110.addValue('KBURITORI',&#x9;&#x9;kbUritori);#EOL#&#x9;&#x9;if (kbUrihuri == '') {#EOL#&#x9;&#x9;&#x9;cYT110.addValue('KBURIHURI',&#x9;'  ');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;cYT110.addValue('KBURIHURI',&#x9;kbUrihuri);#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;cYT110.addValue('AMTORIHIKI',&#x9;&#x9;amTorihiki110);#EOL#&#x9;&#x9;cYT110.addValue('AMTAX',&#x9;&#x9;&#x9;amTax110);#EOL#&#x9;&#x9;count = cYT110.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '月次売掛取引サマリ(YT110)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#&#x9;amTorihiki110 = 0; amTax110 = 0;#EOL#}#EOL##EOL#//////////////////////#EOL#// 項目値の集計処理 //#EOL#//////////////////////#EOL#function summarizeFields() {#EOL##EOL#&#x9;/////////////////////#EOL#&#x9;//   区分別集計    //#EOL#&#x9;// 00 : 出荷売上   //#EOL#&#x9;// 01 : 直出荷売上 //#EOL#&#x9;// 02 : 売上返品   //#EOL#&#x9;// 10 : 振替控除   //#EOL#&#x9;// 11 : 振替計上   //#EOL#&#x9;// 90 : 現預金受領 //#EOL#&#x9;// 91 : 手形受領   //#EOL#&#x9;// 92 : 手数料     //#EOL#&#x9;/////////////////////#EOL#&#x9;if (rET100.getValueOf('KBURITORI') == '00' || rET100.getValueOf('KBURITORI') == '01' || rET100.getValueOf('KBURITORI') == '11') {#EOL#&#x9;&#x9;amKikanUri100 = Number(amKikanUri100) + Number(rET100.getValueOf('AMTORIHIKI')) + Number(rET100.getValueOf('AMTAX'));#EOL#&#x9;&#x9;amKikanGenka100 = Number(amKikanGenka100) + Number(rET100.getValueOf('AMGENKA'));#EOL#&#x9;}#EOL#&#x9;if (rET100.getValueOf('KBURITORI') == '02' || rET100.getValueOf('KBURITORI') == '10') {#EOL#&#x9;&#x9;amKikanUri100 = Number(amKikanUri100) - Number(rET100.getValueOf('AMTORIHIKI')) - Number(rET100.getValueOf('AMTAX'));#EOL#&#x9;&#x9;amKikanGenka100 = Number(amKikanGenka100) - Number(rET100.getValueOf('AMGENKA'));#EOL#&#x9;}#EOL#&#x9;if (rET100.getValueOf('KBURITORI') == '90' || rET100.getValueOf('KBURITORI') == '91' || rET100.getValueOf('KBURITORI') == '92') {#EOL#&#x9;&#x9;amKikanJyu100 = Number(amKikanJyu100) + Number(rET100.getValueOf('AMTORIHIKI'));#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////////////////#EOL#&#x9;// 月次売掛取引サマリ(YT110)項目集計 //#EOL#&#x9;///////////////////////////////////////#EOL#&#x9;amTorihiki110 = Number(amTorihiki110) + Number(rET100.getValueOf('AMTORIHIKI'));#EOL#&#x9;amTax110 = Number(amTax110) + Number(rET100.getValueOf('AMTAX'));#EOL#}" SubsystemID="Y" Type="XF000"/><Function ID="YF911" Name="得意先別残高更新" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rET010; var rYT100; var uYT100;#EOL#var dtNend = 0; var dtMSeq = 0; var idTokuisaki = ''; var errorMessage = '';#EOL#var count = 0; var amKisyu = 0; var workNend = 0; var workMSeq = 0;#EOL##EOL#//////////////////////////////#EOL#// 集計対象最過去年月の設定 //#EOL#//////////////////////////////#EOL#var targetFYear = instance.parmMap.get('TARGET_FYEAR');#EOL#var thruMSeq = instance.parmMap.get('THRU_MSEQ');#EOL##EOL#/////////////////////////////#EOL#// 顧客マスタ(ET010)の読取 //#EOL#/////////////////////////////#EOL#rET010 = instance.createTableOperator('Select', 'ET010');#EOL#rET010.setSelectFields('IDTOKUISAKI, AMKISYU');#EOL#while (rET010.next()) {#EOL##EOL#&#x9;///////////////////////////////////////////#EOL#&#x9;// 月次得意先別サマリ(YT100)の検索と更新 //#EOL#&#x9;///////////////////////////////////////////#EOL#&#x9;rYT100 = instance.createTableOperator('Select', 'YT100');#EOL#&#x9;rYT100.addKeyValue('DTNEND',&#x9;&#x9;targetFYear);#EOL#&#x9;rYT100.addKeyValue('DTMSEQ',&#x9;&#x9;1);#EOL#&#x9;rYT100.addKeyValue('IDTOKUISAKI',&#x9;rET010.getValueOf('IDTOKUISAKI'));#EOL#&#x9;if (rYT100.next()) {#EOL##EOL#&#x9;&#x9;////////////////////////////////////#EOL#&#x9;&#x9;// レコードがあれば、期首残高更新 //#EOL#&#x9;&#x9;////////////////////////////////////#EOL#&#x9;&#x9;uYT100 = instance.createTableOperator('Update', 'YT100');#EOL#&#x9;&#x9;uYT100.addValue('AMKISYUURI',&#x9;rET010.getValueOf('AMKISYU'));#EOL#&#x9;&#x9;uYT100.addKeyValue('DTNEND',&#x9;&#x9;targetFYear);#EOL#&#x9;&#x9;uYT100.addKeyValue('DTMSEQ',&#x9;&#x9;1);#EOL#&#x9;&#x9;uYT100.addKeyValue('IDTOKUISAKI',&#x9;rET010.getValueOf('IDTOKUISAKI'));#EOL#&#x9;&#x9;count = uYT100.execute();#EOL#&#x9;&#x9;if (count == 1) {#EOL##EOL#&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;// 期首売掛残高の計算 //#EOL#&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;amKisyu = Number(rET010.getValueOf('AMKISYU')) + Number(rYT100.getValueOf('AMKIKANURI')) - Number(rYT100.getValueOf('AMKIKANJYU'));#EOL##EOL#&#x9;&#x9;&#x9;////////////////#EOL#&#x9;&#x9;&#x9;// 年月初期化 //#EOL#&#x9;&#x9;&#x9;////////////////#EOL#&#x9;&#x9;&#x9;workNend = targetFYear;#EOL#&#x9;&#x9;&#x9;workMSeq = 2;#EOL##EOL#&#x9;&#x9;&#x9;////////////////////////////////#EOL#&#x9;&#x9;&#x9;// 期間内の年月向けに繰り返す //#EOL#&#x9;&#x9;&#x9;////////////////////////////////#EOL#&#x9;&#x9;&#x9;while (workNend == targetFYear &amp;&amp; workMSeq &lt;= thruMSeq) {#EOL##EOL#&#x9;&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;// 期首売掛残高の更新 //#EOL#&#x9;&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;rYT100 = instance.createTableOperator('Select', 'YT100');#EOL#&#x9;&#x9;&#x9;&#x9;rYT100.addKeyValue('DTNEND',&#x9;&#x9;workNend);#EOL#&#x9;&#x9;&#x9;&#x9;rYT100.addKeyValue('DTMSEQ',&#x9;&#x9;workMSeq);#EOL#&#x9;&#x9;&#x9;&#x9;rYT100.addKeyValue('IDTOKUISAKI',&#x9;rET010.getValueOf('IDTOKUISAKI'));#EOL#&#x9;&#x9;&#x9;&#x9;if (rYT100.next()) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uYT100 = instance.createTableOperator('Update', 'YT100');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uYT100.addValue('AMKISYUURI',&#x9;amKisyu);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uYT100.addKeyValue('DTNEND',&#x9;&#x9;workNend);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uYT100.addKeyValue('DTMSEQ',&#x9;&#x9;workMSeq);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uYT100.addKeyValue('IDTOKUISAKI',&#x9;rET010.getValueOf('IDTOKUISAKI'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;count = uYT100.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '月次得意先別サマリ(YT100)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;// 期首売掛残高の計算 //#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amKisyu = Number(amKisyu) + Number(rYT100.getValueOf('AMKIKANURI')) - Number(rYT100.getValueOf('AMKIKANJYU'));#EOL##EOL#&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;&#x9;//////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;// 年月のカウントアップ //#EOL#&#x9;&#x9;&#x9;&#x9;//////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;if (workMSeq == 12) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;workNend++;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;workMSeq = 1;#EOL#&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;workMSeq++;#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;errorMessage = '月次得意先別サマリ(YT100)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}" SubsystemID="Y" Type="XF000"/><Function ID="ZF054" Name="セッション状況の確認" Script="instance.parmMap.put('NRSESSION', session.sessionID); //このセッションのセッション№を登録//#EOL#instance.callFunction('ZF051'); //セッションと関連情報の確認//#EOL#" SubsystemID="Z" Type="XF000"/><Function ID="YF920" Name="仕入先別増減履歴集計" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rDT100; var cYT210; var rYT200; var uYT200;#EOL#var dtNend = 0; var dtMSeq = 0; var idSiiresaki = ''; var kbKaitori = ''; var kbKaihuri = '';#EOL#var errorMessage = ''; var count = 0;#EOL##EOL#////////////////////#EOL#// 集計用変数定義 //#EOL#////////////////////#EOL#var amKikanKai200 = 0; var amKikanSiha200 = 0; var amTorihiki210 = 0; var amTax210 = 0;#EOL##EOL#//////////////////////////////#EOL#// 集計対象最過去年月の設定 //#EOL#//////////////////////////////#EOL#var targetFYear = instance.parmMap.get('TARGET_FYEAR');#EOL#var fromMSeq = instance.parmMap.get('FROM_MSEQ');#EOL#var thruMSeq = instance.parmMap.get('THRU_MSEQ');#EOL##EOL#//////////////////////////////////////////////////////////////////////////////#EOL#// 対象期間の買掛増減履歴(DT100)の読取と取引サマリ(YT200,YT210)の更新 //#EOL#//////////////////////////////////////////////////////////////////////////////#EOL#rDT100 = instance.createTableOperator('Select', 'DT100');#EOL#rDT100.addKeyValue('FGVALID', 'T');#EOL#rDT100.addKeyValue('and', 'KBAKADEN = ', '1', '');#EOL#rDT100.addKeyValue('and', 'DTMSEQ >= ', fromMSeq, '');#EOL#rDT100.addKeyValue('and', 'DTMSEQ &lt;= ', thruMSeq, '');#EOL#rDT100.setOrderBy('DTNEND, DTMSEQ, IDSIIRESAKI, KBKAITORI, KBKAIHURI');#EOL#while (rDT100.next()) {#EOL##EOL#&#x9;/////////////////////////////////////#EOL#&#x9;// 年月BREAKなら集計レコードの追加 //#EOL#&#x9;/////////////////////////////////////#EOL#&#x9;if (Number(rDT100.getValueOf('DTMSEQ')) != dtMSeq || rDT100.getValueOf('IDSIIRESAKI').trim() != idSiiresaki) {#EOL##EOL#&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;// 月次買掛取引サマリ(YT210)の追加 //#EOL#&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;insertYT210();#EOL#&#x9;&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;// 月次仕入先別サマリ(YT200)の追加 //#EOL#&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;insertYT200();#EOL#&#x9;&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;} else {#EOL##EOL#&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;// 区分BREAKなら集計レコードの追加 //#EOL#&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;if (rDT100.getValueOf('KBKAITORI').trim() != kbKaitori || rDT100.getValueOf('KBKAIHURI').trim() != kbKaihuri) {#EOL##EOL#&#x9;&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;&#x9;// 月次買掛取引サマリ(YT210)の追加 //#EOL#&#x9;&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;&#x9;insertYT210();#EOL#&#x9;&#x9;&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////////#EOL#&#x9;// BREAK検査フィールドの設定 //#EOL#&#x9;///////////////////////////////#EOL#&#x9;dtNend = rDT100.getValueOf('DTNEND');#EOL#&#x9;dtMSeq = rDT100.getValueOf('DTMSEQ');#EOL#&#x9;idSiiresaki = rDT100.getValueOf('IDSIIRESAKI').trim() + '';#EOL#&#x9;kbKaitori = rDT100.getValueOf('KBKAITORI').trim() + '';#EOL#&#x9;kbKaihuri = rDT100.getValueOf('KBKAIHURI').trim() + '';#EOL##EOL#&#x9;//////////////////////#EOL#&#x9;// 項目値の集計処理 //#EOL#&#x9;//////////////////////#EOL#&#x9;summarizeFields();#EOL#}#EOL##EOL#/////////////////////////////////////#EOL#// 月次買掛取引サマリ(YT210)の追加 //#EOL#/////////////////////////////////////#EOL#insertYT210();#EOL##EOL#/////////////////////////////////////#EOL#// 月次仕入先別サマリ(YT200)の追加 //#EOL#/////////////////////////////////////#EOL#insertYT200();#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL##EOL#//////////////////////////////////////////////////////////////////////////////////////////////////////////////#EOL#////////////////////////////////////// S U B R O U T I N E S /////////////////////////////////////////////////#EOL#//////////////////////////////////////////////////////////////////////////////////////////////////////////////#EOL##EOL#/////////////////////////////////////#EOL#// 月次仕入先別サマリ(YT200)の追加 //#EOL#/////////////////////////////////////#EOL#function insertYT200() {#EOL#&#x9;if (dtNend != 0) {#EOL#&#x9;&#x9;rYT200 = instance.createTableOperator('Select', 'YT200');#EOL#&#x9;&#x9;rYT200.addKeyValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;rYT200.addKeyValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;rYT200.addKeyValue('IDSIIRESAKI',&#x9;idSiiresaki);#EOL#&#x9;&#x9;if (rYT200.execute() == 1) {#EOL#&#x9;&#x9;&#x9;uYT200 = instance.createTableOperator('Update', 'YT200');#EOL#&#x9;&#x9;&#x9;uYT200.addValue('AMKIKANKAI',&#x9;&#x9;amKikanKai200);#EOL#&#x9;&#x9;&#x9;uYT200.addValue('AMKIKANSIHA',&#x9;&#x9;amKikanSiha200);#EOL#&#x9;&#x9;&#x9;uYT200.addKeyValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;&#x9;uYT200.addKeyValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;&#x9;uYT200.addKeyValue('IDSIIRESAKI',&#x9;idSiiresaki);#EOL#&#x9;&#x9;&#x9;count = uYT200.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '月次仕入先別サマリ(YT200)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;amKikanKai200 = 0; amKikanSiha200 = 0;#EOL#&#x9;}#EOL#}#EOL##EOL#/////////////////////////////////////#EOL#// 月次買掛取引サマリ(YT210)の追加 //#EOL#/////////////////////////////////////#EOL#function insertYT210() {#EOL#&#x9;if (dtNend != 0) {#EOL#&#x9;&#x9;cYT210 = instance.createTableOperator('Insert', 'YT210');#EOL#&#x9;&#x9;cYT210.addValue('DTNEND',&#x9;&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;cYT210.addValue('DTMSEQ',&#x9;&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;cYT210.addValue('IDSIIRESAKI',&#x9;&#x9;idSiiresaki);#EOL#&#x9;&#x9;cYT210.addValue('KBKAITORI',&#x9;&#x9;kbKaitori);#EOL#&#x9;&#x9;if (kbKaihuri == '') {#EOL#&#x9;&#x9;&#x9;cYT210.addValue('KBKAIHURI',&#x9;'  ');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;cYT210.addValue('KBKAIHURI',&#x9;kbKaihuri);#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;cYT210.addValue('AMTORIHIKI',&#x9;&#x9;amTorihiki210);#EOL#&#x9;&#x9;cYT210.addValue('AMTAX',&#x9;&#x9;&#x9;amTax210);#EOL#&#x9;&#x9;count = cYT210.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '月次買掛取引サマリ(YT210)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#&#x9;amTorihiki210 = 0; amTax210 = 0;#EOL#}#EOL##EOL#//////////////////////#EOL#// 項目値の集計処理 //#EOL#//////////////////////#EOL#function summarizeFields() {#EOL##EOL#&#x9;/////////////////////#EOL#&#x9;//   区分別集計    //#EOL#&#x9;// 00 : 入荷仕入   //#EOL#&#x9;// 01 : 直入荷仕入 //#EOL#&#x9;// 02 : 仕入返品   //#EOL#&#x9;// 10 : 振替控除   //#EOL#&#x9;// 11 : 振替計上   //#EOL#&#x9;// 90 : 支払       //#EOL#&#x9;/////////////////////#EOL#&#x9;if (rDT100.getValueOf('KBKAITORI') == '00' || rDT100.getValueOf('KBKAITORI') == '01' || rDT100.getValueOf('KBKAITORI') == '11') {#EOL#&#x9;&#x9;amKikanKai200 = Number(amKikanKai200) + Number(rDT100.getValueOf('AMTORIHIKI')) + Number(rDT100.getValueOf('AMTAX'));#EOL#&#x9;}#EOL#&#x9;if (rDT100.getValueOf('KBKAITORI') == '02' || rDT100.getValueOf('KBKAITORI') == '10') {#EOL#&#x9;&#x9;amKikanKai200 = Number(amKikanKai200) - Number(rDT100.getValueOf('AMTORIHIKI')) - Number(rDT100.getValueOf('AMTAX'));#EOL#&#x9;}#EOL#&#x9;if (rDT100.getValueOf('KBKAITORI') == '90') {#EOL#&#x9;&#x9;amKikanSiha200 = Number(amKikanSiha200) + Number(rDT100.getValueOf('AMTORIHIKI'));#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////////////////#EOL#&#x9;// 月次売掛取引サマリ(YT210)項目集計 //#EOL#&#x9;///////////////////////////////////////#EOL#&#x9;amTorihiki210 = Number(amTorihiki210) + Number(rDT100.getValueOf('AMTORIHIKI'));#EOL#&#x9;amTax210 = Number(amTax210) + Number(rDT100.getValueOf('AMTAX'));#EOL#}" SubsystemID="Y" Type="XF000"/><Function ID="YF921" Name="仕入先別残高更新" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rDT010; var rYT200; var uYT200;#EOL#var dtNend = 0; var dtMSeq = 0; var errorMessage = '';#EOL#var count = 0; var amKisyu = 0; var workNend = 0; var workMSeq = 0;#EOL##EOL#//////////////////////////////#EOL#// 集計対象最過去年月の設定 //#EOL#//////////////////////////////#EOL#var targetFYear = instance.parmMap.get('TARGET_FYEAR');#EOL#var thruMSeq = instance.parmMap.get('THRU_MSEQ');#EOL##EOL#///////////////////////////////#EOL#// 仕入先マスタ(DT010)の読取 //#EOL#///////////////////////////////#EOL#rDT010 = instance.createTableOperator('Select', 'DT010');#EOL#rDT010.setSelectFields('IDSIIRESAKI, AMKISYU');#EOL#while (rDT010.next()) {#EOL##EOL#&#x9;///////////////////////////////////////////#EOL#&#x9;// 月次仕入先別サマリ(YT200)の検索と更新 //#EOL#&#x9;///////////////////////////////////////////#EOL#&#x9;rYT200 = instance.createTableOperator('Select', 'YT200');#EOL#&#x9;rYT200.addKeyValue('DTNEND',&#x9;&#x9;targetFYear);#EOL#&#x9;rYT200.addKeyValue('DTMSEQ',&#x9;&#x9;1);#EOL#&#x9;rYT200.addKeyValue('IDSIIRESAKI',&#x9;rDT010.getValueOf('IDSIIRESAKI'));#EOL#&#x9;if (rYT200.next()) {#EOL##EOL#&#x9;&#x9;////////////////////////////////////#EOL#&#x9;&#x9;// レコードがあれば、期首残高更新 //#EOL#&#x9;&#x9;////////////////////////////////////#EOL#&#x9;&#x9;uYT200 = instance.createTableOperator('Update', 'YT200');#EOL#&#x9;&#x9;uYT200.addValue('AMKISYUKAI',&#x9;rDT010.getValueOf('AMKISYU'));#EOL#&#x9;&#x9;uYT200.addKeyValue('DTNEND',&#x9;&#x9;targetFYear);#EOL#&#x9;&#x9;uYT200.addKeyValue('DTMSEQ',&#x9;&#x9;1);#EOL#&#x9;&#x9;uYT200.addKeyValue('IDSIIRESAKI',&#x9;rDT010.getValueOf('IDSIIRESAKI'));#EOL#&#x9;&#x9;count = uYT200.execute();#EOL#&#x9;&#x9;if (count == 1) {#EOL##EOL#&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;// 期首買掛残高の計算 //#EOL#&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;amKisyu = Number(rDT010.getValueOf('AMKISYU')) + Number(rYT200.getValueOf('AMKIKANKAI')) - Number(rYT200.getValueOf('AMKIKANSIHA'));#EOL##EOL#&#x9;&#x9;&#x9;////////////////#EOL#&#x9;&#x9;&#x9;// 年月初期化 //#EOL#&#x9;&#x9;&#x9;////////////////#EOL#&#x9;&#x9;&#x9;workNend = targetFYear;#EOL#&#x9;&#x9;&#x9;workMSeq = 2;#EOL##EOL#&#x9;&#x9;&#x9;////////////////////////////////#EOL#&#x9;&#x9;&#x9;// 期間内の年月向けに繰り返す //#EOL#&#x9;&#x9;&#x9;////////////////////////////////#EOL#&#x9;&#x9;&#x9;while (workNend == targetFYear &amp;&amp; workMSeq &lt;= thruMSeq) {#EOL##EOL#&#x9;&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;// 期首買掛残高の更新 //#EOL#&#x9;&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;rYT200 = instance.createTableOperator('Select', 'YT200');#EOL#&#x9;&#x9;&#x9;&#x9;rYT200.addKeyValue('DTNEND',&#x9;&#x9;workNend);#EOL#&#x9;&#x9;&#x9;&#x9;rYT200.addKeyValue('DTMSEQ',&#x9;&#x9;workMSeq);#EOL#&#x9;&#x9;&#x9;&#x9;rYT200.addKeyValue('IDSIIRESAKI',&#x9;rDT010.getValueOf('IDSIIRESAKI'));#EOL#&#x9;&#x9;&#x9;&#x9;if (rYT200.next()) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uYT200 = instance.createTableOperator('Update', 'YT200');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uYT200.addValue('AMKISYUKAI',&#x9;amKisyu);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uYT200.addKeyValue('DTNEND',&#x9;&#x9;workNend);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uYT200.addKeyValue('DTMSEQ',&#x9;&#x9;workMSeq);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uYT200.addKeyValue('IDSIIRESAKI',&#x9;rDT010.getValueOf('IDSIIRESAKI'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;count = uYT200.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '月次仕入先別サマリ(YT200)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;// 期首買掛残高の計算 //#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amKisyu = Number(amKisyu) + Number(rYT200.getValueOf('AMKIKANKAI')) - Number(rYT200.getValueOf('AMKIKANSIHA'));#EOL##EOL#&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;&#x9;//////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;// 年月のカウントアップ //#EOL#&#x9;&#x9;&#x9;&#x9;//////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;if (workMSeq == 12) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;workNend++;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;workMSeq = 1;#EOL#&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;workMSeq++;#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;errorMessage = '月次仕入先別サマリ(YT200)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}" SubsystemID="Y" Type="XF000"/><Function ID="YF930" Name="在庫品別増減履歴集計" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rFT100; var cYT310; var rYT300; var uYT300;#EOL#var dtNend = 0; var dtMSeq = 0; var idHinmoku = ''; var kbUkebarai = ''; var kbZaihuri = '';#EOL#var errorMessage = ''; var count = 0;#EOL##EOL#////////////////////#EOL#// 集計用変数定義 //#EOL#////////////////////#EOL#var qtKikanNyuko300 = 0; var qtKikanSyukko300 = 0; var amKikanNyuko300 = 0; var amKikanSyukko300 = 0;#EOL#var qtKikanUri300 = 0; var amKikanUri300 = 0; var amKikanArari300 = 0;#EOL#var qtKikanKai300 = 0; var amKikanKai300 = 0; var qtKikanSei300 = 0; var amKikanSei300 = 0;#EOL#var amTorihiki310 = 0; var qtTorihiki310 = 0;#EOL##EOL#//////////////////////////////#EOL#// 集計対象最過去年月の設定 //#EOL#//////////////////////////////#EOL#var targetFYear = instance.parmMap.get('TARGET_FYEAR');#EOL#var fromMSeq = instance.parmMap.get('FROM_MSEQ');#EOL#var thruMSeq = instance.parmMap.get('THRU_MSEQ');#EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#// 対象期間の在庫増減履歴(FT100)の読取と取引サマリ(YT300,YT310)の更新 //#EOL#////////////////////////////////////////////////////////////////////////#EOL#rFT100 = instance.createTableOperator('Select', 'FT100');#EOL#rFT100.addKeyValue('FGVALID', 'T');#EOL#rFT100.addKeyValue('and', 'KBAKADEN = ', '1', '');#EOL#rFT100.addKeyValue('and', 'DTMSEQ >= ', fromMSeq, '');#EOL#rFT100.addKeyValue('and', 'DTMSEQ &lt;= ', thruMSeq, '');#EOL#rFT100.setOrderBy('DTNEND, DTMSEQ, IDHINMOKU, KBUKEBARAI, KBZAIHURI');#EOL#while (rFT100.next()) {#EOL##EOL#&#x9;/////////////////////////////////////#EOL#&#x9;// 年月BREAKなら集計レコードの追加 //#EOL#&#x9;/////////////////////////////////////#EOL#&#x9;if (Number(rFT100.getValueOf('DTMSEQ')) != dtMSeq || rFT100.getValueOf('IDHINMOKU').trim() != idHinmoku) {#EOL##EOL#&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;// 月次在庫取引サマリ(YT310)の追加 //#EOL#&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;insertYT310();#EOL#&#x9;&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;// 月次在庫品別サマリ(YT300)の追加 //#EOL#&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;insertYT300();#EOL#&#x9;&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;} else {#EOL##EOL#&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;// 区分BREAKなら集計レコードの追加 //#EOL#&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;if (rFT100.getValueOf('KBUKEBARAI').trim() != kbUkebarai || rFT100.getValueOf('KBZAIHURI').trim() != kbZaihuri) {#EOL##EOL#&#x9;&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;&#x9;// 月次在庫取引サマリ(YT310)の追加 //#EOL#&#x9;&#x9;&#x9;/////////////////////////////////////#EOL#&#x9;&#x9;&#x9;insertYT310();#EOL#&#x9;&#x9;&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////////#EOL#&#x9;// BREAK検査フィールドの設定 //#EOL#&#x9;///////////////////////////////#EOL#&#x9;dtNend = rFT100.getValueOf('DTNEND');#EOL#&#x9;dtMSeq = rFT100.getValueOf('DTMSEQ');#EOL#&#x9;idHinmoku = rFT100.getValueOf('IDHINMOKU').trim() + '';#EOL#&#x9;kbUkebarai = rFT100.getValueOf('KBUKEBARAI').trim() + '';#EOL#&#x9;kbZaihuri = rFT100.getValueOf('KBZAIHURI').trim() + '';#EOL##EOL#&#x9;//////////////////////#EOL#&#x9;// 項目値の集計処理 //#EOL#&#x9;//////////////////////#EOL#&#x9;summarizeFields();#EOL#}#EOL##EOL#/////////////////////////////////////#EOL#// 月次在庫取引サマリ(YT310)の追加 //#EOL#/////////////////////////////////////#EOL#insertYT310();#EOL##EOL#/////////////////////////////////////#EOL#// 月次在庫品別サマリ(YT300)の追加 //#EOL#/////////////////////////////////////#EOL#insertYT300();#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL##EOL#//////////////////////////////////////////////////////////////////////////////////////////////////////////////#EOL#////////////////////////////////////// S U B R O U T I N E S /////////////////////////////////////////////////#EOL#//////////////////////////////////////////////////////////////////////////////////////////////////////////////#EOL##EOL#/////////////////////////////////////#EOL#// 月次在庫品別サマリ(YT300)の追加 //#EOL#/////////////////////////////////////#EOL#function insertYT300() {#EOL#&#x9;if (dtNend != 0) {#EOL#&#x9;&#x9;rYT300 = instance.createTableOperator('Select', 'YT300');#EOL#&#x9;&#x9;rYT300.addKeyValue('DTNEND',&#x9;dtNend);#EOL#&#x9;&#x9;rYT300.addKeyValue('DTMSEQ',&#x9;dtMSeq);#EOL#&#x9;&#x9;rYT300.addKeyValue('IDHINMOKU',&#x9;idHinmoku);#EOL#&#x9;&#x9;if (rYT300.execute() == 1) {#EOL#&#x9;&#x9;&#x9;uYT300 = instance.createTableOperator('Update', 'YT300');#EOL#&#x9;&#x9;&#x9;uYT300.addValue('AMKIKANNYUKO',&#x9;&#x9;amKikanNyuko300);#EOL#&#x9;&#x9;&#x9;uYT300.addValue('AMKIKANSYUKKO',&#x9;amKikanSyukko300);#EOL#&#x9;&#x9;&#x9;uYT300.addValue('QTKIKANNYUKO',&#x9;&#x9;qtKikanNyuko300);#EOL#&#x9;&#x9;&#x9;uYT300.addValue('QTKIKANSYUKKO',&#x9;qtKikanSyukko300);#EOL#&#x9;&#x9;&#x9;uYT300.addValue('QTKIKANURI',&#x9;&#x9;qtKikanUri300);#EOL#&#x9;&#x9;&#x9;uYT300.addValue('AMKIKANURI',&#x9;&#x9;amKikanUri300);#EOL#&#x9;&#x9;&#x9;uYT300.addValue('AMKIKANARARI',&#x9;&#x9;amKikanArari300);#EOL#&#x9;&#x9;&#x9;uYT300.addValue('QTKIKANKAI',&#x9;&#x9;qtKikanKai300);#EOL#&#x9;&#x9;&#x9;uYT300.addValue('AMKIKANKAI',&#x9;&#x9;amKikanKai300);#EOL#&#x9;&#x9;&#x9;uYT300.addValue('QTKIKANSEI',&#x9;&#x9;qtKikanSei300);#EOL#&#x9;&#x9;&#x9;uYT300.addValue('AMKIKANSEI',&#x9;&#x9;amKikanSei300);#EOL#&#x9;&#x9;&#x9;uYT300.addKeyValue('DTNEND',&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;&#x9;uYT300.addKeyValue('DTMSEQ',&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;&#x9;uYT300.addKeyValue('IDHINMOKU',&#x9;&#x9;idHinmoku);#EOL#&#x9;&#x9;&#x9;count = uYT300.execute();#EOL#&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;errorMessage = '月次在庫品別サマリ(YT300)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;qtKikanNyuko300 = 0; qtKikanSyukko300 = 0; amKikanNyuko300 = 0; amKikanSyukko300 = 0;#EOL#&#x9;&#x9;qtKikanUri300 = 0; amKikanUri300 = 0; amKikanArari300 = 0;#EOL#&#x9;&#x9;qtKikanKai300 = 0; amKikanKai300 = 0; qtKikanSei300 = 0; amKikanSei300 = 0;#EOL#&#x9;}#EOL#}#EOL##EOL#/////////////////////////////////////#EOL#// 月次在庫取引サマリ(YT310)の追加 //#EOL#/////////////////////////////////////#EOL#function insertYT310() {#EOL#&#x9;if (dtNend != 0) {#EOL#&#x9;&#x9;cYT310 = instance.createTableOperator('Insert', 'YT310');#EOL#&#x9;&#x9;cYT310.addValue('DTNEND',&#x9;&#x9;&#x9;dtNend);#EOL#&#x9;&#x9;cYT310.addValue('DTMSEQ',&#x9;&#x9;&#x9;dtMSeq);#EOL#&#x9;&#x9;cYT310.addValue('IDHINMOKU',&#x9;&#x9;idHinmoku);#EOL#&#x9;&#x9;cYT310.addValue('KBUKEBARAI',&#x9;&#x9;kbUkebarai);#EOL#&#x9;&#x9;if (kbZaihuri == '') {#EOL#&#x9;&#x9;&#x9;cYT310.addValue('KBZAIHURI',&#x9;'  ');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;cYT310.addValue('KBZAIHURI',&#x9;kbZaihuri);#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;cYT310.addValue('QTTORIHIKI',&#x9;&#x9;qtTorihiki310);#EOL#&#x9;&#x9;cYT310.addValue('AMTORIHIKI',&#x9;&#x9;amTorihiki310);#EOL#&#x9;&#x9;count = cYT310.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '月次在庫取引サマリ(YT310)の登録に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#&#x9;amTorihiki310 = 0; qtTorihiki310 = 0;#EOL#}#EOL##EOL#//////////////////////#EOL#// 項目値の集計処理 //#EOL#//////////////////////#EOL#function summarizeFields() {#EOL##EOL#&#x9;//////////////////////#EOL#&#x9;//   区分別集計     //#EOL#&#x9;// 010 : 移動入庫   //#EOL#&#x9;// 020 : 振替入庫   //#EOL#&#x9;// 030 : 仕入入庫   //#EOL#&#x9;// 040 : 直仕入入庫 //#EOL#&#x9;// 050 : 売上返品   //#EOL#&#x9;// 060 : 完成入庫   //#EOL#&#x9;// 070 : 棚卸増     //#EOL#&#x9;// 110 : 移動出庫   //#EOL#&#x9;// 120 : 振替出庫   //#EOL#&#x9;// 130 : 売上出庫   //#EOL#&#x9;// 140 : 仕入返品   //#EOL#&#x9;// 150 : 直売上出庫 //#EOL#&#x9;// 160 : 材料出庫   //#EOL#&#x9;// 170 : 棚卸減     //#EOL#&#x9;//////////////////////#EOL#&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '010' || rFT100.getValueOf('KBUKEBARAI') == '020'#EOL#&#x9;&#x9;|| rFT100.getValueOf('KBUKEBARAI') == '030' || rFT100.getValueOf('KBUKEBARAI') == '040'#EOL#&#x9;&#x9;|| rFT100.getValueOf('KBUKEBARAI') == '050' || rFT100.getValueOf('KBUKEBARAI') == '060' || rFT100.getValueOf('KBUKEBARAI') == '070') {#EOL#&#x9;&#x9;amKikanNyuko300 = Number(amKikanNyuko300) + Number(rFT100.getValueOf('AMTORIHIKI'));#EOL#&#x9;&#x9;qtKikanNyuko300 = Number(qtKikanNyuko300) + Number(rFT100.getValueOf('QTTORIHIKI'));#EOL#&#x9;} else {#EOL#&#x9;&#x9;amKikanSyukko300 = Number(amKikanSyukko300) + Number(rFT100.getValueOf('AMTORIHIKI'));#EOL#&#x9;&#x9;qtKikanSyukko300 = Number(qtKikanSyukko300) + Number(rFT100.getValueOf('QTTORIHIKI'));#EOL#&#x9;}#EOL#&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '130' || rFT100.getValueOf('KBUKEBARAI') == '150') {#EOL#&#x9;&#x9;amKikanUri300 = Number(amKikanUri300) + Number(rFT100.getValueOf('AMTORIHIKI'));#EOL#&#x9;&#x9;qtKikanUri300 = Number(qtKikanUri300) + Number(rFT100.getValueOf('QTTORIHIKI'));#EOL#&#x9;&#x9;amKikanArari300 = Number(amKikanArari300) + Number(rFT100.getValueOf('AMSAGAKU'));#EOL#&#x9;}#EOL#&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '050') {#EOL#&#x9;&#x9;amKikanUri300 = Number(amKikanUri300) - Number(rFT100.getValueOf('AMTORIHIKI'));#EOL#&#x9;&#x9;qtKikanUri300 = Number(qtKikanUri300) - Number(rFT100.getValueOf('QTTORIHIKI'));#EOL#&#x9;&#x9;amKikanArari300 = Number(amKikanArari300) - Number(rFT100.getValueOf('AMSAGAKU'));#EOL#&#x9;}#EOL#&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '060') {#EOL#&#x9;&#x9;amKikanSei300 = Number(amKikanSei300) + Number(rFT100.getValueOf('AMTORIHIKI'));#EOL#&#x9;&#x9;qtKikanSei300 = Number(qtKikanSei300) + Number(rFT100.getValueOf('QTTORIHIKI'));#EOL#&#x9;}#EOL#&#x9;if (rFT100.getValueOf('KBUKEBARAI') == '030' || rFT100.getValueOf('KBUKEBARAI') == '040') {#EOL#&#x9;&#x9;amKikanKai300 = Number(amKikanKai300) + Number(rFT100.getValueOf('AMTORIHIKI'));#EOL#&#x9;&#x9;qtKikanKai300 = Number(qtKikanKai300) + Number(rFT100.getValueOf('QTTORIHIKI'));#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////////////////#EOL#&#x9;// 月次在庫取引サマリ(YT310)項目集計 //#EOL#&#x9;///////////////////////////////////////#EOL#&#x9;amTorihiki310 = Number(amTorihiki310) + Number(rFT100.getValueOf('AMTORIHIKI'));#EOL#&#x9;qtTorihiki310 = Number(qtTorihiki310) + Number(rFT100.getValueOf('QTTORIHIKI'));#EOL#}" SubsystemID="Y" Type="XF000"/><Function ID="YF931" Name="在庫品別残高更新" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rBT010; var rFT010; var rYT300; var uYT300;#EOL#var dtNend = 0; var dtMSeq = 0; var idHinmoku = ''; var errorMessage = '';#EOL#var count = 0; var amKisyu = 0; var qtKisyu = 0; var workNend = 0; var workMSeq = 0;#EOL##EOL#//////////////////////////////#EOL#// 集計対象最過去年月の設定 //#EOL#//////////////////////////////#EOL#var targetFYear = instance.parmMap.get('TARGET_FYEAR');#EOL#var thruMSeq = instance.parmMap.get('THRU_MSEQ');#EOL##EOL#/////////////////////////////#EOL#// 品目マスタ(ET010)の読取 //#EOL#/////////////////////////////#EOL#rBT010 = instance.createTableOperator('Select', 'BT010');#EOL#while (rBT010.next()) {#EOL##EOL#&#x9;//////////////////////#EOL#&#x9;// 期首在庫高の集計 //#EOL#&#x9;//////////////////////#EOL#&#x9;amKisyu = 0;#EOL#&#x9;qtKisyu = 0;#EOL#&#x9;rFT010 = instance.createTableOperator('Select', 'FT010');#EOL#&#x9;rFT010.addKeyValue('IDHINMOKU',&#x9;rBT010.getValueOf('IDHINMOKU'));#EOL#&#x9;while (rFT010.next()) {#EOL#&#x9;&#x9;amKisyu = Number(amKisyu) + Number(rFT010.getValueOf('AMKISYU'));#EOL#&#x9;&#x9;qtKisyu = Number(qtKisyu) + Number(rFT010.getValueOf('QTKISYU'));#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////////////////////#EOL#&#x9;// 月次在庫品別サマリ(YT300)の検索と更新 //#EOL#&#x9;///////////////////////////////////////////#EOL#&#x9;rYT300 = instance.createTableOperator('Select', 'YT300');#EOL#&#x9;rYT300.addKeyValue('DTNEND',&#x9;targetFYear);#EOL#&#x9;rYT300.addKeyValue('DTMSEQ',&#x9;1);#EOL#&#x9;rYT300.addKeyValue('IDHINMOKU',&#x9;rBT010.getValueOf('IDHINMOKU'));#EOL#&#x9;if (rYT300.next()) {#EOL##EOL#&#x9;&#x9;////////////////////////////////////#EOL#&#x9;&#x9;// レコードがあれば、期首残高更新 //#EOL#&#x9;&#x9;////////////////////////////////////#EOL#&#x9;&#x9;uYT300 = instance.createTableOperator('Update', 'YT300');#EOL#&#x9;&#x9;uYT300.addValue('AMKISYUZAI',&#x9;amKisyu);#EOL#&#x9;&#x9;uYT300.addValue('QTKISYUZAI',&#x9;qtKisyu);#EOL#&#x9;&#x9;uYT300.addKeyValue('DTNEND',&#x9;targetFYear);#EOL#&#x9;&#x9;uYT300.addKeyValue('DTMSEQ',&#x9;1);#EOL#&#x9;&#x9;uYT300.addKeyValue('IDHINMOKU',&#x9;rBT010.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;count = uYT300.execute();#EOL#&#x9;&#x9;if (count == 1) {#EOL##EOL#&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;// 期首在庫残高の計算 //#EOL#&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;amKisyu = Number(amKisyu) + Number(rYT300.getValueOf('AMKIKANNYUKO')) - Number(rYT300.getValueOf('AMKIKANSYUKKO'));#EOL#&#x9;&#x9;&#x9;qtKisyu = Number(qtKisyu) + Number(rYT300.getValueOf('QTKIKANNYUKO')) - Number(rYT300.getValueOf('QTKIKANSYUKKO'));#EOL##EOL#&#x9;&#x9;&#x9;////////////////#EOL#&#x9;&#x9;&#x9;// 年月初期化 //#EOL#&#x9;&#x9;&#x9;////////////////#EOL#&#x9;&#x9;&#x9;workNend = targetFYear;#EOL#&#x9;&#x9;&#x9;workMSeq = 2;#EOL##EOL#&#x9;&#x9;&#x9;////////////////////////////////#EOL#&#x9;&#x9;&#x9;// 期間内の年月向けに繰り返す //#EOL#&#x9;&#x9;&#x9;////////////////////////////////#EOL#&#x9;&#x9;&#x9;while (workNend == targetFYear &amp;&amp; workMSeq &lt;= thruMSeq) {#EOL##EOL#&#x9;&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;// 期首売掛残高の更新 //#EOL#&#x9;&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;rYT300 = instance.createTableOperator('Select', 'YT300');#EOL#&#x9;&#x9;&#x9;&#x9;rYT300.addKeyValue('DTNEND',&#x9;workNend);#EOL#&#x9;&#x9;&#x9;&#x9;rYT300.addKeyValue('DTMSEQ',&#x9;workMSeq);#EOL#&#x9;&#x9;&#x9;&#x9;rYT300.addKeyValue('IDHINMOKU',&#x9;rBT010.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;if (rYT300.next()) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uYT300 = instance.createTableOperator('Update', 'YT300');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uYT300.addValue('AMKISYUZAI',&#x9;amKisyu);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uYT300.addValue('QTKISYUZAI',&#x9;qtKisyu);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uYT300.addKeyValue('DTNEND',&#x9;workNend);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uYT300.addKeyValue('DTMSEQ',&#x9;workMSeq);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uYT300.addKeyValue('IDHINMOKU',&#x9;rBT010.getValueOf('IDHINMOKU'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;count = uYT300.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = '月次在庫品別サマリ(YT300)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;// 期首在庫残高の計算 //#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;amKisyu = Number(amKisyu) + Number(rYT300.getValueOf('AMKIKANNYUKO')) - Number(rYT300.getValueOf('AMKIKANSYUKKO'));#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;qtKisyu = Number(qtKisyu) + Number(rYT300.getValueOf('QTKIKANNYUKO')) - Number(rYT300.getValueOf('QTKIKANSYUKKO'));#EOL##EOL#&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;&#x9;//////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;// 年月のカウントアップ //#EOL#&#x9;&#x9;&#x9;&#x9;//////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;if (workMSeq == 12) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;workNend++;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;workMSeq = 1;#EOL#&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;workMSeq++;#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;errorMessage = '月次在庫品別サマリ(YT300)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}" SubsystemID="Y" Type="XF000"/><Function ID="YF912" Name="得意先別年月集計" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rYT100; var uYT020; var uYT010;#EOL#var dtMSeq = 0; var errorMessage = ''; var count = 0;#EOL##EOL#////////////////////#EOL#// 集計用変数定義 //#EOL#////////////////////#EOL#var amKisyuUri010 = 0; var amKikanUri010 = 0; var amKikanJyu010 = 0; var amKikanGenka010 = 0;#EOL#var amKisyuUri020 = 0; var amKikanUri020 = 0; var amKikanJyu020 = 0; var amKikanGenka020 = 0;#EOL##EOL#////////////////////////#EOL#// 集計対象最年の設定 //#EOL#////////////////////////#EOL#var targetFYear = instance.parmMap.get('TARGET_FYEAR');#EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#// 月次得意先別サマリ(YT100)の読取と年月取引サマリ(YT010,YT020)の更新 //#EOL#////////////////////////////////////////////////////////////////////////#EOL#rYT100 = instance.createTableOperator('Select', 'YT100');#EOL#rYT100.addKeyValue('DTNEND', targetFYear);#EOL#rYT100.setOrderBy('DTNEND, DTMSEQ');#EOL#while (rYT100.next()) {#EOL##EOL#&#x9;/////////////////////////////////////#EOL#&#x9;// 年月BREAKなら集計レコードの追加 //#EOL#&#x9;/////////////////////////////////////#EOL#&#x9;if (Number(rYT100.getValueOf('DTMSEQ')) != dtMSeq) {#EOL##EOL#&#x9;&#x9;/////////////////////////////////#EOL#&#x9;&#x9;// 月次取引サマリ(YT020)の更新 //#EOL#&#x9;&#x9;/////////////////////////////////#EOL#&#x9;&#x9;updateYT020();#EOL#&#x9;&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////////#EOL#&#x9;// BREAK検査フィールドの設定 //#EOL#&#x9;///////////////////////////////#EOL#&#x9;dtMSeq = rYT100.getValueOf('DTMSEQ');#EOL##EOL#&#x9;//////////////////////#EOL#&#x9;// 項目値の集計処理 //#EOL#&#x9;//////////////////////#EOL#&#x9;summarizeFields();#EOL#}#EOL##EOL#/////////////////////////////////#EOL#// 月次取引サマリ(YT020)の更新 //#EOL#/////////////////////////////////#EOL#updateYT020();#EOL##EOL#/////////////////////////////////#EOL#// 年次取引サマリ(YT010)の更新 //#EOL#/////////////////////////////////#EOL#updateYT010();#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL##EOL#//////////////////////////////////////////////////////////////////////////////////////////////////////////////#EOL#////////////////////////////////////// S U B R O U T I N E S /////////////////////////////////////////////////#EOL#//////////////////////////////////////////////////////////////////////////////////////////////////////////////#EOL##EOL#/////////////////////////////////#EOL#// 月次取引サマリ(YT020)の更新 //#EOL#/////////////////////////////////#EOL#function updateYT020() {#EOL#&#x9;if (dtMSeq != 0) {#EOL#&#x9;&#x9;uYT020 = instance.createTableOperator('Update', 'YT020');#EOL#&#x9;&#x9;uYT020.addValue('AMKISYUURI',&#x9;&#x9;amKisyuUri020);#EOL#&#x9;&#x9;uYT020.addValue('AMKIKANURI',&#x9;&#x9;amKikanUri020);#EOL#&#x9;&#x9;uYT020.addValue('AMKIKANJYU',&#x9;&#x9;amKikanJyu020);#EOL#&#x9;&#x9;uYT020.addValue('AMKIKANGENKA',&#x9;&#x9;amKikanGenka020);#EOL#&#x9;&#x9;uYT020.addKeyValue('DTNEND',&#x9;targetFYear);#EOL#&#x9;&#x9;uYT020.addKeyValue('DTMSEQ',&#x9;dtMSeq);#EOL#&#x9;&#x9;count = uYT020.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '月次取引サマリ(YT020)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;amKisyuUri020 = 0; amKikanUri020 = 0; amKikanJyu020 = 0; amKikanGenka020 = 0;#EOL#&#x9;}#EOL#}#EOL##EOL#/////////////////////////////////#EOL#// 年次取引サマリ(YT010)の更新 //#EOL#/////////////////////////////////#EOL#function updateYT010() {#EOL#&#x9;if (dtMSeq != 0) {#EOL#&#x9;&#x9;uYT010 = instance.createTableOperator('Update', 'YT010');#EOL#&#x9;&#x9;uYT010.addValue('AMKISYUURI',&#x9;&#x9;amKisyuUri010);#EOL#&#x9;&#x9;uYT010.addValue('AMKIKANURI',&#x9;&#x9;amKikanUri010);#EOL#&#x9;&#x9;uYT010.addValue('AMKIKANJYU',&#x9;&#x9;amKikanJyu010);#EOL#&#x9;&#x9;uYT010.addValue('AMKIKANGENKA',&#x9;&#x9;amKikanGenka010);#EOL#&#x9;&#x9;uYT010.addKeyValue('DTNEND',&#x9;targetFYear);#EOL#&#x9;&#x9;count = uYT010.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '年次取引サマリ(YT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;amKisyuUri010 = 0; amKikanUri010 = 0; amKikanJyu010 = 0; amKikanGenka010 = 0;#EOL#&#x9;}#EOL#}#EOL##EOL#//////////////////////#EOL#// 項目値の集計処理 //#EOL#//////////////////////#EOL#function summarizeFields() {#EOL#&#x9;amKisyuUri020 = Number(amKisyuUri020) + Number(rYT100.getValueOf('AMKISYUURI'));#EOL#&#x9;amKikanUri020 = Number(amKikanUri020) + Number(rYT100.getValueOf('AMKIKANURI'));#EOL#&#x9;amKikanJyu020 = Number(amKikanJyu020) + Number(rYT100.getValueOf('AMKIKANJYU'));#EOL#&#x9;amKikanGenka020 = Number(amKikanGenka020) + Number(rYT100.getValueOf('AMKIKANGENKA'));#EOL##EOL#&#x9;amKisyuUri010 = Number(amKisyuUri010) + Number(rYT100.getValueOf('AMKISYUURI'));#EOL#&#x9;amKikanUri010 = Number(amKikanUri010) + Number(rYT100.getValueOf('AMKIKANURI'));#EOL#&#x9;amKikanJyu010 = Number(amKikanJyu010) + Number(rYT100.getValueOf('AMKIKANJYU'));#EOL#&#x9;amKikanGenka010 = Number(amKikanGenka010) + Number(rYT100.getValueOf('AMKIKANGENKA'));#EOL#}" SubsystemID="Y" Type="XF000"/><Function ID="YF922" Name="仕入先別年月集計" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rYT200; var uYT020; var uYT010;#EOL#var dtMSeq = 0; var errorMessage = ''; var count = 0;#EOL##EOL#////////////////////#EOL#// 集計用変数定義 //#EOL#////////////////////#EOL#var amKisyuKai010 = 0; var amKikanKai010 = 0; var amKikanSiha010 = 0;#EOL#var amKisyuKai020 = 0; var amKikanKai020 = 0; var amKikanSiha020 = 0;#EOL##EOL#////////////////////////#EOL#// 集計対象最年の設定 //#EOL#////////////////////////#EOL#var targetFYear = instance.parmMap.get('TARGET_FYEAR');#EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#// 月次仕入先別サマリ(YT200)の読取と年月取引サマリ(YT010,YT020)の更新 //#EOL#////////////////////////////////////////////////////////////////////////#EOL#rYT200 = instance.createTableOperator('Select', 'YT200');#EOL#rYT200.addKeyValue('DTNEND', targetFYear);#EOL#rYT200.setOrderBy('DTNEND, DTMSEQ');#EOL#while (rYT200.next()) {#EOL##EOL#&#x9;/////////////////////////////////////#EOL#&#x9;// 年月BREAKなら集計レコードの追加 //#EOL#&#x9;/////////////////////////////////////#EOL#&#x9;if (Number(rYT200.getValueOf('DTMSEQ')) != dtMSeq) {#EOL##EOL#&#x9;&#x9;/////////////////////////////////#EOL#&#x9;&#x9;// 月次取引サマリ(YT020)の更新 //#EOL#&#x9;&#x9;/////////////////////////////////#EOL#&#x9;&#x9;updateYT020();#EOL#&#x9;&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////////#EOL#&#x9;// BREAK検査フィールドの設定 //#EOL#&#x9;///////////////////////////////#EOL#&#x9;dtMSeq = rYT200.getValueOf('DTMSEQ');#EOL##EOL#&#x9;//////////////////////#EOL#&#x9;// 項目値の集計処理 //#EOL#&#x9;//////////////////////#EOL#&#x9;summarizeFields();#EOL#}#EOL##EOL#/////////////////////////////////#EOL#// 月次取引サマリ(YT020)の更新 //#EOL#/////////////////////////////////#EOL#updateYT020();#EOL##EOL#/////////////////////////////////#EOL#// 年次取引サマリ(YT010)の更新 //#EOL#/////////////////////////////////#EOL#updateYT010();#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL##EOL#//////////////////////////////////////////////////////////////////////////////////////////////////////////////#EOL#////////////////////////////////////// S U B R O U T I N E S /////////////////////////////////////////////////#EOL#//////////////////////////////////////////////////////////////////////////////////////////////////////////////#EOL##EOL#/////////////////////////////////#EOL#// 月次取引サマリ(YT020)の更新 //#EOL#/////////////////////////////////#EOL#function updateYT020() {#EOL#&#x9;if (dtMSeq != 0) {#EOL#&#x9;&#x9;uYT020 = instance.createTableOperator('Update', 'YT020');#EOL#&#x9;&#x9;uYT020.addValue('AMKISYUKAI',&#x9;&#x9;amKisyuKai020);#EOL#&#x9;&#x9;uYT020.addValue('AMKIKANKAI',&#x9;&#x9;amKikanKai020);#EOL#&#x9;&#x9;uYT020.addValue('AMKIKANSIHA',&#x9;&#x9;amKikanSiha020);#EOL#&#x9;&#x9;uYT020.addKeyValue('DTNEND',&#x9;targetFYear);#EOL#&#x9;&#x9;uYT020.addKeyValue('DTMSEQ',&#x9;dtMSeq);#EOL#&#x9;&#x9;count = uYT020.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '月次取引サマリ(YT020)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;amKisyuKai020 = 0; amKikanKai020 = 0; amKikanSiha020 = 0;#EOL#&#x9;}#EOL#}#EOL##EOL#/////////////////////////////////#EOL#// 年次取引サマリ(YT010)の更新 //#EOL#/////////////////////////////////#EOL#function updateYT010() {#EOL#&#x9;if (dtMSeq != 0) {#EOL#&#x9;&#x9;uYT010 = instance.createTableOperator('Update', 'YT010');#EOL#&#x9;&#x9;uYT010.addValue('AMKISYUKAI',&#x9;&#x9;amKisyuKai010);#EOL#&#x9;&#x9;uYT010.addValue('AMKIKANKAI',&#x9;&#x9;amKikanKai010);#EOL#&#x9;&#x9;uYT010.addValue('AMKIKANSIHA',&#x9;&#x9;amKikanSiha010);#EOL#&#x9;&#x9;uYT010.addKeyValue('DTNEND',&#x9;targetFYear);#EOL#&#x9;&#x9;count = uYT010.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '年次取引サマリ(YT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;amKisyuKai010 = 0; amKikanKai010 = 0; amKikanSiha010 = 0;#EOL#&#x9;}#EOL#}#EOL##EOL#//////////////////////#EOL#// 項目値の集計処理 //#EOL#//////////////////////#EOL#function summarizeFields() {#EOL#&#x9;amKisyuKai020 = Number(amKisyuKai020) + Number(rYT200.getValueOf('AMKISYUKAI'));#EOL#&#x9;amKikanKai020 = Number(amKikanKai020) + Number(rYT200.getValueOf('AMKIKANKAI'));#EOL#&#x9;amKikanSiha020 = Number(amKikanSiha020) + Number(rYT200.getValueOf('AMKIKANSIHA'));#EOL##EOL#&#x9;amKisyuKai010 = Number(amKisyuKai010) + Number(rYT200.getValueOf('AMKISYUKAI'));#EOL#&#x9;amKikanKai010 = Number(amKikanKai010) + Number(rYT200.getValueOf('AMKIKANKAI'));#EOL#&#x9;amKikanSiha010 = Number(amKikanSiha010) + Number(rYT200.getValueOf('AMKIKANSIHA'));#EOL#}" SubsystemID="Y" Type="XF000"/><Function ID="YF932" Name="在庫品別年月集計" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rYT300; var uYT020; var uYT010;#EOL#var dtMSeq = 0; var errorMessage = ''; var count = 0;#EOL##EOL#////////////////////#EOL#// 集計用変数定義 //#EOL#////////////////////#EOL#var amKisyuZai010 = 0; var amKikanNyuko010 = 0; var amKikanSyukko010 = 0; var amKikanSei010 = 0;#EOL#var amKisyuZai020 = 0; var amKikanNyuko020 = 0; var amKikanSyukko020 = 0; var amKikanSei020 = 0;#EOL##EOL#////////////////////////#EOL#// 集計対象最年の設定 //#EOL#////////////////////////#EOL#var targetFYear = instance.parmMap.get('TARGET_FYEAR');#EOL##EOL#////////////////////////////////////////////////////////////////////////#EOL#// 月次在庫品別サマリ(YT300)の読取と年月取引サマリ(YT010,YT020)の更新 //#EOL#////////////////////////////////////////////////////////////////////////#EOL#rYT300 = instance.createTableOperator('Select', 'YT300');#EOL#rYT300.addKeyValue('DTNEND', targetFYear);#EOL#rYT300.setOrderBy('DTNEND, DTMSEQ');#EOL#while (rYT300.next()) {#EOL##EOL#&#x9;/////////////////////////////////////#EOL#&#x9;// 年月BREAKなら集計レコードの追加 //#EOL#&#x9;/////////////////////////////////////#EOL#&#x9;if (Number(rYT300.getValueOf('DTMSEQ')) != dtMSeq) {#EOL##EOL#&#x9;&#x9;/////////////////////////////////#EOL#&#x9;&#x9;// 月次取引サマリ(YT020)の更新 //#EOL#&#x9;&#x9;/////////////////////////////////#EOL#&#x9;&#x9;updateYT020();#EOL#&#x9;&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#&#x9;///////////////////////////////#EOL#&#x9;// BREAK検査フィールドの設定 //#EOL#&#x9;///////////////////////////////#EOL#&#x9;dtMSeq = rYT300.getValueOf('DTMSEQ');#EOL##EOL#&#x9;//////////////////////#EOL#&#x9;// 項目値の集計処理 //#EOL#&#x9;//////////////////////#EOL#&#x9;summarizeFields();#EOL#}#EOL##EOL#/////////////////////////////////#EOL#// 月次取引サマリ(YT020)の更新 //#EOL#/////////////////////////////////#EOL#updateYT020();#EOL##EOL#/////////////////////////////////#EOL#// 年次取引サマリ(YT010)の更新 //#EOL#/////////////////////////////////#EOL#updateYT010();#EOL##EOL#////////////////#EOL#// エラー処理 //#EOL#////////////////#EOL#if (errorMessage != '') {#EOL#&#x9;instance.cancelWithMessage(errorMessage);#EOL#}#EOL##EOL#//////////////////////////////////////////////////////////////////////////////////////////////////////////////#EOL#////////////////////////////////////// S U B R O U T I N E S /////////////////////////////////////////////////#EOL#//////////////////////////////////////////////////////////////////////////////////////////////////////////////#EOL##EOL#/////////////////////////////////#EOL#// 月次取引サマリ(YT020)の更新 //#EOL#/////////////////////////////////#EOL#function updateYT020() {#EOL#&#x9;if (dtMSeq != 0) {#EOL#&#x9;&#x9;uYT020 = instance.createTableOperator('Update', 'YT020');#EOL#&#x9;&#x9;uYT020.addValue('AMKISYUZAI',&#x9;&#x9;amKisyuZai020);#EOL#&#x9;&#x9;uYT020.addValue('AMKIKANNYUKO',&#x9;&#x9;amKikanNyuko020);#EOL#&#x9;&#x9;uYT020.addValue('AMKIKANSYUKKO',&#x9;amKikanSyukko020);#EOL#&#x9;&#x9;uYT020.addValue('AMKIKANSEI',&#x9;&#x9;amKikanSei020);#EOL#&#x9;&#x9;uYT020.addKeyValue('DTNEND',&#x9;targetFYear);#EOL#&#x9;&#x9;uYT020.addKeyValue('DTMSEQ',&#x9;dtMSeq);#EOL#&#x9;&#x9;count = uYT020.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '月次取引サマリ(YT020)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;amKisyuZai020 = 0; amKikanNyuko020 = 0; amKikanSyukko020 = 0; amKikanSei020 = 0;#EOL#&#x9;}#EOL#}#EOL##EOL#/////////////////////////////////#EOL#// 年次取引サマリ(YT010)の更新 //#EOL#/////////////////////////////////#EOL#function updateYT010() {#EOL#&#x9;if (dtMSeq != 0) {#EOL#&#x9;&#x9;uYT010 = instance.createTableOperator('Update', 'YT010');#EOL#&#x9;&#x9;uYT010.addValue('AMKISYUZAI',&#x9;&#x9;amKisyuZai010);#EOL#&#x9;&#x9;uYT010.addValue('AMKIKANNYUKO',&#x9;&#x9;amKikanNyuko010);#EOL#&#x9;&#x9;uYT010.addValue('AMKIKANSYUKKO',&#x9;amKikanSyukko010);#EOL#&#x9;&#x9;uYT010.addValue('AMKIKANSEI',&#x9;&#x9;amKikanSei010);#EOL#&#x9;&#x9;uYT010.addKeyValue('DTNEND',&#x9;targetFYear);#EOL#&#x9;&#x9;count = uYT010.execute();#EOL#&#x9;&#x9;if (count != 1) {#EOL#&#x9;&#x9;&#x9;errorMessage = '年次取引サマリ(YT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;amKisyuZai010 = 0; amKikanNyuko010 = 0; amKikanSyukko010 = 0; amKikanSei010 = 0;#EOL#&#x9;}#EOL#}#EOL##EOL#//////////////////////#EOL#// 項目値の集計処理 //#EOL#//////////////////////#EOL#function summarizeFields() {#EOL#&#x9;amKisyuZai020 = Number(amKisyuZai020) + Number(rYT300.getValueOf('AMKISYUZAI'));#EOL#&#x9;amKikanNyuko020 = Number(amKikanNyuko020) + Number(rYT300.getValueOf('AMKIKANNYUKO'));#EOL#&#x9;amKikanSyukko020 = Number(amKikanSyukko020) + Number(rYT300.getValueOf('AMKIKANSYUKKO'));#EOL#&#x9;amKikanSei020 = Number(amKikanSei020) + Number(rYT300.getValueOf('AMKIKANSEI'));#EOL##EOL#&#x9;amKisyuZai010 = Number(amKisyuZai010) + Number(rYT300.getValueOf('AMKISYUZAI'));#EOL#&#x9;amKikanNyuko010 = Number(amKikanNyuko010) + Number(rYT300.getValueOf('AMKIKANNYUKO'));#EOL#&#x9;amKikanSyukko010 = Number(amKikanSyukko010) + Number(rYT300.getValueOf('AMKIKANSYUKKO'));#EOL#&#x9;amKikanSei010 = Number(amKikanSei010) + Number(rYT300.getValueOf('AMKIKANSEI'));#EOL#}" SubsystemID="Y" Type="XF000"/><MaintenanceLog Descriptions="最初の公開版" Headder="1.0.0" ID="0" SortKey="20150401"/><Function ID="DF810" Name="買掛取引区分リスト" Script="////////////////////#EOL#// ダイアログ定義 //#EOL#////////////////////#EOL#var dialog = session.getCheckListDialog();#EOL#var rZT040 = instance.createTableOperator('Select', 'ZT040'); //ユーザ定義区分の検索//#EOL#rZT040.addKeyValue('IDUSERKUBUN',&#x9;'KBKAITORI');#EOL#rZT040.setOrderBy('SQLIST');#EOL#while (rZT040.next()) {#EOL#&#x9;var keyValue = rZT040.getValueOf('KBUSERKUBUN') + '';#EOL#&#x9;dialog.addRow(keyValue, rZT040.getValueOf('TXUSERKUBUN'));#EOL#}#EOL#dialog.setListSelected(instance.parmMap.get('DT100.KBKAITORI'));#EOL##EOL#////////////////////////////////////////#EOL#// ダイアログ表示と選択値リストの返信 //#EOL#////////////////////////////////////////#EOL#var reply = dialog.request('買掛取引区分リスト');#EOL#if (reply == 0) {#EOL#&#x9;instance.returnMap.put('DT100.KBKAITORI', dialog.getListSelected());#EOL#} else {#EOL#&#x9;instance.returnMap.remove('DT100.KBKAITORI');#EOL#}" SubsystemID="D" Type="XF000"/><Function ID="EF810" Name="売掛取引区分リスト" Script="////////////////////#EOL#// ダイアログ定義 //#EOL#////////////////////#EOL#var dialog = session.getCheckListDialog();#EOL#var rZT040 = instance.createTableOperator('Select', 'ZT040'); //ユーザ定義区分の検索//#EOL#rZT040.addKeyValue('IDUSERKUBUN',&#x9;'KBURITORI');#EOL#rZT040.setOrderBy('SQLIST');#EOL#while (rZT040.next()) {#EOL#&#x9;var keyValue = rZT040.getValueOf('KBUSERKUBUN') + '';#EOL#&#x9;dialog.addRow(keyValue, rZT040.getValueOf('TXUSERKUBUN'));#EOL#}#EOL#dialog.setListSelected(instance.parmMap.get('ET100.KBURITORI'));#EOL##EOL#////////////////////////////////////////#EOL#// ダイアログ表示と選択値リストの返信 //#EOL#////////////////////////////////////////#EOL#var reply = dialog.request('売掛取引区分リスト');#EOL#if (reply == 0) {#EOL#&#x9;instance.returnMap.put('ET100.KBURITORI', dialog.getListSelected());#EOL#} else {#EOL#&#x9;instance.returnMap.remove('ET100.KBURITORI');#EOL#}" SubsystemID="E" Type="XF000"/><Function ID="FF800" Name="受払区分リスト" Script="////////////////////#EOL#// ダイアログ定義 //#EOL#////////////////////#EOL#var dialog = session.getCheckListDialog();#EOL#var rZT040 = instance.createTableOperator('Select', 'ZT040'); //ユーザ定義区分の検索//#EOL#rZT040.addKeyValue('IDUSERKUBUN',&#x9;'KBUKEBARAI');#EOL#rZT040.setOrderBy('SQLIST');#EOL#while (rZT040.next()) {#EOL#&#x9;var keyValue = rZT040.getValueOf('KBUSERKUBUN') + '';#EOL#&#x9;dialog.addRow(keyValue, rZT040.getValueOf('TXUSERKUBUN'));#EOL#}#EOL#dialog.setListSelected(instance.parmMap.get('FT100.KBUKEBARAI'));#EOL##EOL#////////////////////////////////////////#EOL#// ダイアログ表示と選択値リストの返信 //#EOL#////////////////////////////////////////#EOL#var reply = dialog.request('受払区分リスト');#EOL#if (reply == 0) {#EOL#&#x9;instance.returnMap.put('FT100.KBUKEBARAI', dialog.getListSelected());#EOL#} else {#EOL#&#x9;instance.returnMap.remove('FT100.KBUKEBARAI');#EOL#}" SubsystemID="F" Type="XF000"/><Function ID="ZF072" Name="土日一括登録" Script="////////////////////////////#EOL#// 変数とダイアログの定義 //#EOL#////////////////////////////#EOL#var date; var dtOff = ''; var rZT070; var cZT070;#EOL#var dialog = session.getInputDialog();#EOL#dialog.setMessageHeight(80);#EOL#var kubun = dialog.addField('カレンダー区分', 'LISTBOX');#EOL#var rZT040 = instance.createTableOperator('Select', 'ZT040'); //ユーザ定義区分の検索用//#EOL#rZT040.addKeyValue('IDUSERKUBUN',&#x9;'KBCALENDAR');#EOL#rZT040.setOrderBy('SQLIST');#EOL#while (rZT040.next()) {#EOL#&#x9;kubun.addItem(rZT040.getValueOf('TXUSERKUBUN'), rZT040.getValueOf('KBUSERKUBUN'));#EOL#}#EOL#var year = dialog.addField('対象年', 'ALPHA');#EOL#var wrkStr = session.getSystemVariantString('ALLOWED_FISCAL_MONTH') + '';#EOL#year.value = Number(wrkStr.substring(0, 4)) + Number(1) + '';#EOL#dialog.setMessage('＊指定された年の土曜と日曜が休日として一括登録されます。既存であれば無視されます。');#EOL##EOL#////////////////////////////////////////////#EOL#// ダイアログ表示と条件にもとづく後続処理 //#EOL#////////////////////////////////////////////#EOL#var reply = dialog.request('土日一括登録');#EOL#if (reply == 0) {#EOL##EOL#&#x9;//////////////////////////////////////////#EOL#&#x9;// 土日であればその日付を休日として登録 //#EOL#&#x9;//////////////////////////////////////////#EOL#&#x9;for (month = 0; month &lt; 12; month++) {#EOL#&#x9;&#x9;for (day = 1; day &lt;= 31; day++) {#EOL#&#x9;&#x9;&#x9;date = new Date(year.value, month, day);#EOL#&#x9;&#x9;&#x9;dtOff = year.value + '-' + (month + Number(1)) + '-' + day;#EOL#&#x9;&#x9;&#x9;if(dtOff == (date.getFullYear() + &quot;-&quot; + (date.getMonth() + Number(1)) + &quot;-&quot; + date.getDate())) {#EOL#&#x9;&#x9;&#x9;&#x9;if (date.getDay() == 0 || date.getDay() == 6) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rZT070 = instance.createTableOperator('Count', 'ZT070');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rZT070.addKeyValue('KBCALENDAR',&#x9;kubun.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rZT070.addKeyValue('DTOFF',&#x9;&#x9;&#x9;dtOff);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (rZT070.execute() == 0) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cZT070 = instance.createTableOperator('Insert', 'ZT070');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cZT070.addValue('KBCALENDAR',&#x9;kubun.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cZT070.addValue('DTOFF',&#x9;&#x9;dtOff);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cZT070.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#&#x9;instance.returnMap.put('RETURN_CODE', '10');#EOL#&#x9;instance.commit();#EOL##EOL#} else {#EOL#&#x9;instance.returnMap.put('RETURN_MESSAGE', '処理は取り消されました。');#EOL#&#x9;instance.returnMap.put('RETURN_CODE', '01');#EOL#}#EOL#" SubsystemID="Z" Type="XF000"/><Function ID="HF016" Name="発注エントリー用JCL" Script="instance.callFunction('HF012'); //発注見出し／明細の保守//#EOL#instance.callFunction('HF013'); //発注見出し／明細の検討//" SubsystemID="H" Type="XF000"/><Function ID="JF013A" Name="完成・出荷エントリー用JCL" Script="////////////////////#EOL#// ダイアログ定義 //#EOL#////////////////////#EOL#var dialog = session.getInputDialog();#EOL#dialog.setMessage('＊製造指示№を入力してOKボタンを押してください。事前に材料出庫報告がなされている必要があります。');#EOL#dialog.setMessageHeight(80);#EOL#var nrSeizo = dialog.addField('製造指示№', 'ZEROFILL');#EOL#nrSeizo.setSize(7);#EOL##EOL#////////////////////////////////////////////#EOL#// ダイアログ表示と条件にもとづく後続処理 //#EOL#////////////////////////////////////////////#EOL#var reply = dialog.request('完成・出庫エントリー');#EOL#if (reply == 0) {#EOL#&#x9;instance.parmMap.put('NRSEIZO', nrSeizo.value);#EOL#&#x9;instance.callFunction('JF013');#EOL#} else {#EOL#&#x9;instance.returnMap.put('RETURN_MESSAGE', '＊処理は取り消されました。');#EOL#}" SubsystemID="J" Type="XF000"/><MaintenanceLog Descriptions="・「BT010 品目」のスクリプト定義を修正。レコード追加時にエラーになることがあった#EOL#・「BF011 品目の保守」と「DF012 仕入先マスターの保守」のプロンプタ交換フィールドの抜けを修正#EOL#・「BF030 製造品工程明細の一括保守」と「BF040 製造品材料明細の一括保守」のこまごましたバグを修正#EOL#・品目の在庫換算係数をNULL不可にして、省略値として１が設定されるようにした#EOL#・加工レートを製造品工程明細から作業場に移動するとともに、製造指示工程明細の加工レートを削除した#EOL#・加工レートを時間あたりの労務費にするとともに、製造指示工程明細のリードタイムを物理フィールドに変更した#EOL#・「JF012 製造指示と関連情報の確認」の明細部に製造LTと加工費を追加した" Headder="1.0.1" ID="1" SortKey="20150415"/><MaintenanceLog Descriptions="・Java1.8に対応するために、スクリプト中のimportPackage()を廃止した#EOL#" Headder="1.0.2" ID="2" SortKey="20150427"/></System>